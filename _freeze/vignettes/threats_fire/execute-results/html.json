{
  "hash": "eb6bcf9385e7041c0c6fd134ad7ad6e8",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Threats: Fire\"\nauthor: \"Jay Matsushiba\"\ndate: \"2025/04/25\"\nformat:\n  html:\n    code-fold: true\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(bowen.biodiversity.webapp)\nlibrary(here)\nlibrary(sf)\nlibrary(ggplot2)\nlibrary(leaflet)\nlibrary(tidyverse)\nlibrary(terra)\n```\n:::\n\n\n\n\n# Bowen Wildland Urban Interfaces (WUI)\n\nSources:\nhttps://www2.gov.bc.ca/gov/content/safety/wildfire-status/prevention/fire-fuel-management/wui-risk-class-maps/wui-downloads\nhttps://www.for.gov.bc.ca/ftp/HPR/external/!publish/WUI_RiskClass/Maps/Coast/WUI_RiskClass_36x48L_92G_SW.pdf\n![Bowen WUI](images/bowen_wui.png) Previous to this step, the KMZ files\nwere loaded into QGIS and clipped to\n`data-raw/bowen_boundary/Bowen_boundary.shp`. This clipped KMZ was saved\nas `data-raw/bowen_wui.gpkg`.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbowen_wui <- here(\"data-raw/bowen_wui.gpkg\") %>% \n  st_read() %>%\n  select(Name, PSTA) %>%\n  rename(WUI = Name) %>%\n  mutate(WUI_PSTA = paste0(WUI, \"_\", PSTA))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `bowen_wui' from data source \n  `/home/jay/Programming_Projects/bowen.biodiversity.webapp/data-raw/bowen_wui.gpkg' \n  using driver `GPKG'\nSimple feature collection with 115 features and 15 fields\nGeometry type: MULTIPOLYGON\nDimension:     XYZ\nBounding box:  xmin: -123.4291 ymin: 49.33442 xmax: -123.3084 ymax: 49.41975\nz_range:       zmin: 0 zmax: 0\nGeodetic CRS:  WGS 84\n```\n\n\n:::\n\n```{.r .cell-code}\nggplot(bowen_wui) + \n  geom_sf(aes(fill = PSTA))\n```\n\n::: {.cell-output-display}\n![](threats_fire_files/figure-html/plots-1.png){width=672}\n:::\n\n```{.r .cell-code}\nggplot(bowen_wui) + \n  geom_sf(aes(fill = WUI))\n```\n\n::: {.cell-output-display}\n![](threats_fire_files/figure-html/plots-2.png){width=672}\n:::\n\n```{.r .cell-code}\nggplot(bowen_wui) + \n  geom_sf(aes(fill = WUI_PSTA))\n```\n\n::: {.cell-output-display}\n![](threats_fire_files/figure-html/plots-3.png){width=672}\n:::\n:::\n\n\n\n\n## Convert to raster matching the resolution and extent of Zonation inputs\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbowen_mask <- here(\"inst/extdata/bowen_mask.tif\") %>% rast()\nbowen_wui_vect <- bowen_wui %>% vect() %>% project(bowen_mask)\n\nbowen_wui_rast <- bowen_wui_vect %>%\n  rasterize(bowen_mask, \"WUI_PSTA\", touches = T)\n```\n:::\n\n\n\n\n## Notes on threat due to fire from Tom Sisk\n\nObjective: Index of Vulnerability to Fire. We are not trying to assess\nthe probability of fire nor how hot it might burn or its behavior.\nInstead, we want to know the relative vulnerability to biodiversity loss\ndue to fire, if habitats were to burn.\n\nThree major components of vulnerability:\n\n1.  Slope. Fires spread more quickly when they move uphill. Relative\n    ranking might look like this:\n\n    1 0-10 degree slopes: lower vulnerability\n    2 10-30 degrees: moderate vulnerability\n    3 Above 30 degrees: higher vulnerability\n\n2.  Aspect. Southerly exposures burn hotter, fire spreads more quickly,\n    effects more uniform and destructive than on northern exposures, all\n    else being equal. Might consider this as a first approximation: \n    1 0-45: Low vulnerability because fires unlikely to spread as fast or burn as hot \n    2 45-90: moderately low \n    4 90-135: moderately high \n    6 135-225: southerly exposures burn hotter, spread quickly and more\n    uniformly \n    4 225-270: Moderately high \n    2 270-315 Moderately low \n    1 315-360: Low vulnerability\n\n3.  Fuels. On Bowen, the main differences in fuel loads have to do with\n    whether a location is forested or not forested. Forested areas burn\n    hotter and longer and long, hot burns have a more detrimental effect\n    that shorter less intense fires. So the main distinctions should be\n    made between forested and unforested. Forest stands comprised of\n    larger trees are, of course, of higher value to biodiversity than\n    denser stands with smaller trees, so we would like to be able to\n    distinguish between forest structures to some degree. At the same\n    time, when more mesic habitats burn the biodiversity effects tend to\n    be high, because species are not adapted to fire. So we will need to\n    rank habitats based on the differential effects of forest fuels\n    present, as well as the difference in flora and fauna that make\n    those locations more or less vulnerable in terms of biodiversity\n    loss. \n    First Cut Ranking Scheme: \n    14 Forest, large/old trees \n    10 Forest, mature second growth \n    6 Forest, young regrowth \n    6 Shrublands \n    2 Grasslands: often burn and effects are modest, even positive in some\n    cases \n    4 Riparian: seldom burns, but if it burns biodiversity effects\n    may be very negative \n    2 Wetlands: seldom burn, more often they create fire breaks \n    0 Water: does not burn, but is vulnerable to ash deposition NA Built environment: NA (default to WUI map when talking about the built environment\n\nI suggest that we think about these basic ideas:\n\n1. We pursue an index of vulnerability, rather than a more\nsophisticated approach to modeling fire or adapting an index that was\ndeveloped for other purposes (i.e. WUI).\n\n2. We create a simple index that allows us to compare the relative\nvulnerability of all locations on Bowen (with the exception of the built\nenvironment).\n\n3. We consider slope, aspect, and fuels by habitat as the three\ncomponents of an index.\n\n4. We determine the relative ranks within each of the three components\n\n5. Integrate the scores into an index that produces an aggregate\nvulnerability index score for each pixel. As a first approximation, this\nshould be the additive (sum) of the three components – and then let’s\nsee how that performs.\n\n\n- Rationale for score scaling from Tom \n- Calculating rasters from the LiDAR data directly \n- Add together the three components raster\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Slope Score\n## Create slope raster from LiDAR data\nslope <- rast(here(\"data/bowen_slope.tif\"))\n## Create matrix of scores\n### 1 0-10 degree slopes: lower vulnerability\n### 2 10-30 degrees: moderate vulnerability\n### 3 Above 30 degrees: higher vulnerability\nslope_m <- matrix(c(\n  0, 10, 1,\n  10, 30, 2,\n  30, 91, 3\n), ncol = 3, byrow = T)\n## Classify original slope raster to slope score \nslope_score <- slope %>%\n  classify(slope_m)\n\n# Aspect Score\n## Create aspect raster from LiDAR data\naspect <- rast(here(\"data/bowen_aspect.tif\"))\n## Create matrix of scores\n### 1 0-45: Low vulnerability because fires unlikely to spread as fast or burn as hot \n### 2 45-90: moderately low \n### 4 90-135: moderately high \n### 6 135-225: southerly exposures burn hotter, spread quickly and more uniformly \n### 4 225-270: Moderately high \n### 2 270-315 Moderately low \n### 1 315-360: Low vulnerability\naspect_m <- matrix(c(\n  0, 45, 1,\n  45, 90, 2,\n  90, 135, 4,\n  135, 225, 6,\n  225, 270, 4,\n  270, 315, 2,\n  315, 360, 1\n), ncol = 3, byrow = T)\n## Classify original aspect raster to aspect score \naspect_score <- aspect %>%\n  classify(aspect_m)\n\n# Fuel Score\n## Get habitat classes from combination of WUI, MVSEI, TEM, AW layers \nmv_sei <- st_read(here(\"data-raw/metrovancouver_sensitive_ecosystem_inventory/Sensitive_Ecosystem_Inventory_for_Metro_Vancouver__2020__-5580727563910851507.gpkg\")) %>%\n  st_transform(project_crs) %>%\n  st_crop(bowen_boundary) \n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in CPL_read_ogr(dsn, layer, query, as.character(options), quiet, : GDAL\nMessage 1: This version of GeoPackage user_version=0x000028A0 (10400, v1.4.0)\non\n'/home/jay/Programming_Projects/bowen.biodiversity.webapp/data-raw/metrovancouver_sensitive_ecosystem_inventory/Sensitive_Ecosystem_Inventory_for_Metro_Vancouver__2020__-5580727563910851507.gpkg'\nmay only be partially supported\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `Sensitive_Ecosystem_Inventory_for_Metro_Vancouver__2020_' from data source `/home/jay/Programming_Projects/bowen.biodiversity.webapp/data-raw/metrovancouver_sensitive_ecosystem_inventory/Sensitive_Ecosystem_Inventory_for_Metro_Vancouver__2020__-5580727563910851507.gpkg' \n  using driver `GPKG'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in CPL_read_ogr(dsn, layer, query, as.character(options), quiet, : GDAL\nMessage 1: Non-conformant content for record 1 in column SourceDate,\n2011-04-29T00:00:00.0Z, successfully parsed\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 25637 features and 99 fields\nGeometry type: MULTIPOLYGON\nDimension:     XYZ\nBounding box:  xmin: 468516.6 ymin: 5427679 xmax: 547072.5 ymax: 5495732\nz_range:       zmin: 0 zmax: 0\nProjected CRS: NAD83 / UTM zone 10N\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: attribute variables are assumed to be spatially constant throughout\nall geometries\n```\n\n\n:::\n\n```{.r .cell-code}\nmv_sei_secl_codes <- read.csv(here(\"data-raw/metrovancouver_sensitive_ecosystem_inventory/SEI_SECl_codes.csv\"))\n\n## Generate fuel score raster based on habitat type \n### 14 Forest, large/old trees \n### 10 Forest, mature second growth \n### 6 Forest, young regrowth \n### 6 Shrublands \n### 2 Grasslands: often burn and effects are modest, even positive in some cases \n### 4 Riparian: seldom burns, but if it burns biodiversity effects may be very negative \n### 2 Wetlands: seldom burn, more often they create fire breaks \n### 0 Water: does not burn, but is vulnerable to ash deposition \n### NA Built environment: NA (default to WUI map when talking about the built environment\n\n### Using SEI \n### TODO: use A. Whitehead wetland and freshwater layers \nmv_sei_mod <- mv_sei %>%\n  select(\"SECl_1\", \"SEsubcl_1\", \"SECl_2\") %>%\n  filter(!str_detect(SECl_1, \"x\")) %>% # remove lost habitats\n  mutate(\n    fuel_score = \n      case_when(\n        SECl_1 == \"OF\" ~ 14,\n        SECl_1 == \"MF\" ~ 10,\n        SECl_1 == \"YF\" ~ 6,\n        SECl_1 == \"YS\" ~ 6,\n        SECl_1 == \"WD\" ~ 6, # TODO: what score for \"Woodland\" category? \n        SECl_1 == \"HB\" & SEsubcl_1 == \"sh\" ~ 6, # Herbaceous, shrub\n        SECl_1 == \"HB\" & SEsubcl_1 != \"sh\" ~ 2, # Herbaceous, non-shrub\n        SECl_1 == \"RI\" ~ 4, # \"Riparian\"\n        SECl_1 == \"WN\" ~ 2, # \"Wetland\"\n        SECl_1 == \"OD\" ~ 2, # \"Old Field\"\n        SECl_1 == \"SV\" ~ 0, # TODO: what score for \"Sparsely Vegetated\" category?\n        SECl_1 == \"IT\" ~ 0, # TODO: what score for \"Intertidal\" category? \n        SECl_1 == \"FW\" ~ 0,\n        # Deal with XX Non-SE\n        SECl_1 == \"XX\" & SECl_2 == \"MF\" ~ 10,\n        SECl_1 == \"XX\" & SECl_2 == \"YS\" ~ 6,\n        SECl_1 == \"XX\" & SECl_2 == \"WD\" ~ 6,\n        SECl_1 == \"XX\" & SECl_2 == \"RI\" ~ 4,\n        SECl_1 == \"XX\" & SECl_2 == \"SV\" ~ 0,\n      )\n  )\n# Rasterize habitat polygons fuel score\nfuel_score <- mv_sei_mod %>%\n  vect() %>%\n  project(aspect_score) %>%\n  rasterize(aspect_score, field = \"fuel_score\") \n\n# Cumulative Fire Vulnerability Index\nfire_index <- slope_score + aspect_score + fuel_score\nplot(fire_index)\n```\n\n::: {.cell-output-display}\n![](threats_fire_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "threats_fire_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}