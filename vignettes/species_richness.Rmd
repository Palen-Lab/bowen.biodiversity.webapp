---
title: "species_richness"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{species_richness}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(bowen.biodiversity.webapp)
library(here)
library(terra)
library(magrittr)
library(stringr)
```


```{r}
# Created using vignettes/zonation.Rmd
# Contains all SDM layers included in Zonation output 
load(here("inst/extdata/bowen_sdm_status.rda"))
# Create relative path to read in each SDM
bowen_sdm_status$relpath <- paste0("inst/extdata/species_distribution_models_bowen/", bowen_sdm_status$filepath)
# Create all species raster stack 
sdm_stack <- lapply(bowen_sdm_status$relpath, function(x) {here(x) %>% rast()}) %>% rast()
# Create species richness SDM 
presence_threshold <- 0.7
total_richness_0.7 <- sdm_to_species_richness(SDM_stack = sdm_stack,
                                          presence_threshold = presence_threshold)
writeRaster(total_richness_0.7, here("inst/extdata/bowen_sdm_richness.tif"))
```


