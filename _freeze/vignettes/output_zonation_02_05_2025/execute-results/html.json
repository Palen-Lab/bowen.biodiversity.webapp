{
  "hash": "12bd980a50ccaae4dcb4816ef8d4d63e",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Conservation Prioritization May 2 2025 Update\"\nauthor: \"Jay Matsushiba\"\ndate: \"2025/05/02\"\nformat:\n  html:\n    code-fold: true\n---\n\n\n\n\n# Bowen Island Biodiversity Prioritization - Zonation5\n\nThis Rmarkdown documents the Zonation run used for the May 2 2025 iteration for Bowen Island Biodiversity Planning.\n\n<https://github.com/zonationteam/Zonation5>\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#### Palen Lab Packages ####\nlibrary(bowen.biodiversity.webapp)\n\n#### Other Packages ####\nlibrary(here)\nlibrary(dplyr)\nlibrary(stringr)\nlibrary(foreach)\nlibrary(sf)\nlibrary(terra)\nlibrary(tidyterra)\nlibrary(readxl)\nlibrary(googlesheets4)\nlibrary(ggplot2)\nlibrary(ggnewscale)\nlibrary(RColorBrewer)\n\nsdm_url <- \"https://docs.google.com/spreadsheets/d/1IGFwkr9LidcZwbzOJJGSEXLsmpKp0a9gBs65EY-H1xw/edit?usp=sharing\"\nhabitats_url <- \"https://docs.google.com/spreadsheets/d/1yDKw4r3tbXYivwtxbbfxc-pYSbtbj_o2ee1pwlNCOO4/edit?usp=drive_link\"\noutput_date <- \"2025-05-02\"\noutput_dir <- here(\"inst/extdata/output_zonation\", output_date)\n```\n:::\n\n\n\n\n## Zonation\n\n> Zonation 5 is a spatial prioritization software that can be used to identify priority areas to support conservation planning, land use planning, ecological impact avoidance and other similar tasks. The software uses spatial raster data on the distributions of individual biodiversity features (species, habitats, ecosystem services etc.) to identify which locations in a landscape are most important for retaining biodiversity. Zonation can account for local habitat quality and ecological connectivity together with costs, threats and different land tenure, thus providing a quantitative method for spatial planning that enhances the persistence of biodiversity in the long term.\n\n<https://zonationteam.github.io/Zonation5/>\n\nWe took all of the rasters prepared earlier and fed these into the Zonation 5 software. This should provide a relative ranking for locations from highest to lowest for the purposes of biodiversity conservation.\n\n**Note:** Zonation 5 is usually a standalone application. Here, I have enabled running of Zonation from R, using command line functions. This way we can adjust and automatically run Zonation, reading from data in R.\n\nCheck input layers hosted at this link: <https://github.com/Palen-Lab/bowen.biodiversity.webapp/tree/main/vignettes/figures/output_zonation_02_05_2025> \n\nInformation about input layers to the Zonation run here: \nHabitats - <https://docs.google.com/spreadsheets/d/1yDKw4r3tbXYivwtxbbfxc-pYSbtbj_o2ee1pwlNCOO4/edit?gid=1153014884#gid=1153014884>\nSDMs - <https://docs.google.com/spreadsheets/d/1IGFwkr9LidcZwbzOJJGSEXLsmpKp0a9gBs65EY-H1xw/edit?gid=702573996#gid=702573996>\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#### CREATE DATAFRAME FOR INPUT LAYERS ####\n# Read from Google Sheets\nhabitats_df <- read_sheet(habitats_url, sheet = output_date)\nhabitats_df$weight <- habitats_df$weight / nrow(habitats_df)\nsdm_df <- read_sheet(sdm_url, sheet = output_date) %>%\n  select(colnames(habitats_df)) # Select common columns\nsdm_df$weight <- sdm_df$weight / nrow(sdm_df)\n# Bind all input layers together\nlayers_df <- bind_rows(habitats_df, sdm_df) %>%\n  filter(weight > 0)\n\n# # Check input layers with figure output\n# foreach(i=1:nrow(layers_df)) %do% {\n#   input_raster <- layers_df[[i, \"path\"]] %>% rast()\n#   bowen_plot <- bowen_map(\n#     raster_layer = input_raster,\n#     title = layers_df[[i, \"name\"]],\n#     subtitle = paste0(\n#       \"Category: \", layers_df[[i, \"category\"]], \" \", \n#       \"Filepath: \", layers_df[[i, \"filename\"]], \" \", \n#       \"Weight: \", layers_df[[i, \"weight\"]], \" \",\n#       \"Notes: \", layers_df[[i, \"notes\"]]\n#     ),\n#     caption = paste0(\"Source: \", layers_df[[i, \"source\"]]),\n#     legend_label = \"value\"\n#   )\n#   figure_output_path <- here(\"vignettes/figures/output_zonation_02_05_2025/\")\n#   if(!dir.exists(figure_output_path)) {\n#     dir.create(figure_output_path)\n#   }\n#   ggplot2::ggsave(\n#     here(figure_output_path, paste0(tools::file_path_sans_ext(layers_df[[i, \"filename\"]]), \".png\")),\n#     bowen_plot,\n#     device = ragg::agg_png,\n#     width = 9, height = 12, units = \"in\", res = 300\n#   )\n# }\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#### UPDATE features.txt FOR ZONATION RUN ####\n# UPDATE features.txt from files available in data\nfeatures_path <- here(\"vignettes/zonation/features.txt\")\ncat('\"weight\" \"filename\"', \n    file = features_path,\n    sep = \"\\n\")\nfor(i in 1:nrow(layers_df)) {\n  next_row <- paste0(layers_df[i, \"weight\"], \" \", layers_df[i, \"path\"])\n  cat(next_row,\n      file = features_path,\n      append = TRUE,\n      sep = \"\\n\")\n}\n#### SET PARAMS FOR ZONATION RUN ####\nzonation5_location <- here(\"vignettes/zonation/zonation5\") \nzonation5_mode <- \"CAZ2\"\n# Zonation5 Setting Text File\nzonation5_settings <-  here(\"vignettes/zonation/settings.z5\")\nzonation5_settings_txt <- c(\"feature list file = features.txt\", \n                            paste0(\"analysis area mask layer = \", here(\"inst/extdata/bowen_mask.tif\"))) # Add Bowen Island Mask\nwriteLines(zonation5_settings_txt, zonation5_settings)\nzonation5_output <- here(\"vignettes/zonation/output\") \nzonation5_command <- str_glue(\n  '{zonation5_location} -a -w --mode={zonation5_mode} {zonation5_settings} {zonation5_output}',\n  zonation5_location = zonation5_location,\n  zonation5_mode = zonation5_mode,\n  zonation5_settings = zonation5_settings,\n  zonation5_output = zonation5_output\n) %>%\n  str_c()\n#### ZONATION RUN ####\nsystem(command = zonation5_command)\n\n#### Save Zonation Run #### \ndir.create(output_dir)\nfile.copy(list.files(here(\"vignettes/zonation/output\"), full.names = T, recursive = T),\n          output_dir,\n          recursive = T)\n```\n:::\n\n\n\n\n## Output\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#### VISUALIZE OUTPUT ####\nrankmap <- here(output_dir , \"rankmap.tif\") %>% rast()\nplot(rankmap)\n```\n\n::: {.cell-output-display}\n![](output_zonation_02_05_2025_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n\n\n## Overlap Statistics\n\nHere we calculate the overlap of the top % of conservation values with these other layers:\n\n-   Protected areas\n-   Private land\n-   Human Footprint (HFP)\n-   Freshwater habitats\n    -   Lakes\n    -   Ponds\n    -   Streams\n    -   Wetlands\n    -   Riparian\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Function for converting Zonation output to boolean based on percentage (in top XX%)\nrankmap <- here(output_dir , \"rankmap.tif\") %>% rast() %>% project(project_crs)\n\n#' Only keep top or bottom cell values by quantile \n#'\n#' @param x SpatRaster \n#' @param prob Quantile between 0 and 1\n#' @param direction \"top\" or \"bottom\", for direction of keep / discard cell values\n#'\n#' @returns SpatRaster\n#' @export\nremove_by_quantile <- function(x, prob, direction = \"top\") {\n  val <- x %>%\n    values() %>%\n    quantile(probs = prob, na.rm = T)\n  min_val <- x %>%\n    values() %>%\n    min(na.rm = T)\n  max_val <- x %>%\n    values() %>%\n    max(na.rm = T)\n  if(direction == \"top\") {\n    m <- matrix(c(\n      min_val, val, NA,\n      val, max_val, 1\n    ), ncol = 3, byrow = T)\n  } else if (direction == \"bottom\") {\n    m <- matrix(c(\n      min_val, val, 1,\n      val, max_val, NA\n    ), ncol = 3, byrow = T)\n  }\n  mask_quantile <- x %>%\n    classify(m,, include.lowest = T) \n  mask_quantile * x\n}\n\n#' Provide ratio of overlap between two rasters (in terms of NA vs nonNA)\n#'  \nraster_overlap_ratio <- function(top_rast, area_rast) {\n  overlap_res <- (top_rast * area_rast)\n  top_cell_count <- top_rast %>% terra::global(fun=\"notNA\")\n  overlap_cell_count <- overlap_res %>% terra::global(fun=\"notNA\")\n  overlap_ratio <- (overlap_cell_count / top_cell_count) %>% as.numeric()\n  return(overlap_ratio)\n}\n\n# Protected Areas from JD\nbowen_protectedareas_rast <- bowen.biodiversity.webapp::bowen_protectedareas %>%\n  bowen.biodiversity.webapp::bowen_rasterize()\n\n# Private Land\nbowen_mask <- rast(here(\"inst/extdata/bowen_mask.tif\"))\nbowen_parcelmap_rast <- bowen.biodiversity.webapp::bowen_parcelmap %>%\n  st_cast(\"MULTIPOLYGON\") %>% # Need this due to MULTISURFACE - see: https://gis.stackexchange.com/questions/389814/r-st-centroid-geos-error-unknown-wkb-type-12 \n  filter(OwnerType == \"Private\") %>%\n  bowen.biodiversity.webapp::bowen_rasterize()\n\n# Freshwater Habitats \nfw_rast_paths <- c(\n  here(\"inst/extdata/habitats/lakes.tif\"),\n  here(\"inst/extdata/habitats/ponds.tif\"),\n  here(\"inst/extdata/habitats/riparian.tif\"),\n  here(\"inst/extdata/habitats/wetlands.tif\"),\n  here(\"inst/extdata/habitats/streams.tif\")\n)\nfw_rast_stack <- lapply(fw_rast_paths, rast) %>%\n  rast()\nfw_rast_dissolve <- fw_rast_stack %>% \n  sum(na.rm = T) \n\n# Human Footprint (classified)\nbowen_hfp <- here(\"inst/extdata/habitats/bowen_human_footprint_recl.tif\") %>%\n  rast()\nbowen_hfp_low <- bowen_hfp %>%\n  classify(cbind(3, NA)) %>%\n  classify(cbind(2, NA))\nbowen_hfp_med <- bowen_hfp %>%\n  classify(cbind(3, NA)) %>%\n  classify(cbind(1, NA))\nbowen_hfp_high <- bowen_hfp %>%\n  classify(cbind(2, NA)) %>%\n  classify(cbind(1, NA))\n\n# Overlap calculation \noverlap_stats <- function(top_rast) {\n  data.frame(\n    protectedareas_overlap = raster_overlap_ratio(top_rast, bowen_protectedareas_rast),\n    privatelands_overlap = raster_overlap_ratio(top_rast, bowen_parcelmap_rast),\n    freshwater_overlap = raster_overlap_ratio(top_rast, fw_rast_dissolve),\n    hfp_low_overlap = raster_overlap_ratio(top_rast, bowen_hfp_low),\n    hfp_med_overlap = raster_overlap_ratio(top_rast, bowen_hfp_med),\n    hfp_high_overlap = raster_overlap_ratio(top_rast, bowen_hfp_high)\n  )\n}\n\nquants <- seq(from = 0, to = 1, by = 0.1)\noverlap_results <- foreach(quant = quants, .combine = \"rbind\") %do% {\n  rankmap %>%\n    remove_by_quantile(quant) %>%\n    overlap_stats() %>% \n    mutate(\"removed_bottom_quantile\" = quant) %>%\n    relocate(\"removed_bottom_quantile\")\n}\n# Visualize output as table for overlap % \nknitr::kable(overlap_results)\n```\n\n::: {.cell-output-display}\n\n\n| removed_bottom_quantile| protectedareas_overlap| privatelands_overlap| freshwater_overlap| hfp_low_overlap| hfp_med_overlap| hfp_high_overlap|\n|-----------------------:|----------------------:|--------------------:|------------------:|---------------:|---------------:|----------------:|\n|                     0.0|              0.3388200|            0.5714814|          0.4675421|       0.0329203|       0.6461994|        0.3208803|\n|                     0.1|              0.3716869|            0.5925622|          0.4885967|       0.0297925|       0.6330388|        0.3371687|\n|                     0.2|              0.3700878|            0.6067961|          0.5000000|       0.0187240|       0.6259824|        0.3552936|\n|                     0.3|              0.3601057|            0.6232497|          0.5077939|       0.0187583|       0.6126816|        0.3685601|\n|                     0.4|              0.3861325|            0.6302003|          0.5155624|       0.0157165|       0.6231125|        0.3611710|\n|                     0.5|              0.4064349|            0.6453402|          0.5244083|       0.0110947|       0.6331361|        0.3557692|\n|                     0.6|              0.4225613|            0.6657420|          0.5469256|       0.0078595|       0.6329172|        0.3592233|\n|                     0.7|              0.4423906|            0.6709797|          0.5656192|       0.0036969|       0.6241528|        0.3721503|\n|                     0.8|              0.4390018|            0.6487985|          0.5988909|       0.0036969|       0.5757856|        0.4205176|\n|                     0.9|              0.5064695|            0.6118299|          0.6229205|       0.0055453|       0.5526802|        0.4417745|\n|                     1.0|                    NaN|                  NaN|                NaN|             NaN|             NaN|              NaN|\n\n\n:::\n:::\n\n\n\n\n\n## Overlap Statistics - Polygon on Raster\n\nHere we calculate the overlap of the top % of conservation values with these other layers:\n\n-   Protected areas\n    - From John Dowler's Protected Areas, vs Bowen Island Municipality Protected Areas polygons used for February 1 ver.\n    - Contains main municipal parks, provincial parks, federal parks (both JD and BIM ver.)\n    - Addition of covenants, park land exchanges, small municipal parks in JD ver.\n    - Slightly higher than original February 1 ver. (~18% vs ~21%)\n    - Protected areas polygons / Bowen Island full polygon (inc. Hutt Island) = 0.2149664\n    - Protected area extent proportion of Bowen Island using raster method = 0.2189496\n-   Private land\n    - \"Private\" - Defined as \"Private\" in BC ParcelMap polygons \n    - \"Other\" - Defined as anything other than \"Private\" in BC ParcelMap polygons\n        - Used to see how much of BC ParcelMap polygons are not Private lands \n    - Does not add up to 100%, since there are large areas that are not included in BC ParcelMap \n    - Private lands polygons / Bowen Island full polygon (inc. Hutt Island) = 0.4398566 \n    - Private lands extent proportion of Bowen Island using raster method = 0.4398923\n    \n-   Human Footprint (HFP)\n    - Proportion of each HFP category (low, medium, high) in the top XX% of biodiversity values\n    - Should add up to 100% \n-   Freshwater habitats\n    -   Lakes\n    -   Ponds\n    -   Streams\n    -   Wetlands\n    -   Riparian\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Function for converting Zonation output to boolean based on percentage (in top XX%)\nrankmap <- here(output_dir , \"rankmap.tif\") %>% rast() %>% project(project_crs)\n\n#' Only keep top or bottom cell values by quantile \n#'\n#' @param x SpatRaster \n#' @param prob Quantile between 0 and 1\n#' @param direction \"top\" or \"bottom\", for direction of keep / discard cell values\n#'\n#' @returns SpatRaster\n#' @export\nremove_by_quantile <- function(x, prob, direction = \"top\") {\n  val <- x %>%\n    values() %>%\n    quantile(probs = prob, na.rm = T)\n  min_val <- x %>%\n    values() %>%\n    min(na.rm = T)\n  max_val <- x %>%\n    values() %>%\n    max(na.rm = T)\n  if(direction == \"top\") {\n    m <- matrix(c(\n      min_val, val, NA,\n      val, max_val, 1\n    ), ncol = 3, byrow = T)\n  } else if (direction == \"bottom\") {\n    m <- matrix(c(\n      min_val, val, 1,\n      val, max_val, NA\n    ), ncol = 3, byrow = T)\n  }\n  mask_quantile <- x %>%\n    classify(m,, include.lowest = T) \n  mask_quantile * x\n}\n\n#' Rasterize to Bowen Island Mask\nbowen_rasterize_cover <- function(sf) {\n  bowen_island_mask <- here(\"inst/extdata/bowen_mask.tif\") %>%\n    rast() %>%\n    project(bowen.biodiversity.webapp::project_crs)\n\n  output <- sf %>%\n    terra::vect() %>% # Change to SpatVector for rasterization\n    terra::project(bowen.biodiversity.webapp::project_crs) %>% # Reproject to the mask CRS\n    terra::rasterize(bowen_island_mask,\n                     cover = T, # Return proportion of cell covered by polygon \n                     background = NA) # Rasterize to match mask, set background values to NA\n}\n\n#' Provide ratio of overlap between two rasters (in terms of NA vs nonNA)\nraster_overlap_ratio <- function(top_rast, area_rast) {\n  overlap_res <- (top_rast * area_rast)\n  top_cell_count <- top_rast %>% \n    global(\"sum\", na.rm = T)\n  overlap_cell_values <- overlap_res %>% \n    values(na.rm = T) \n  overlap_cell_area <-overlap_cell_values %>% sum()\n  overlap_ratio <- (overlap_cell_area / top_cell_count) %>% as.numeric()\n  return(overlap_ratio)\n}\n\n# Bowen entire area\nbowen_island <- st_read(here(\"data-raw/bowen_island_shoreline_w_hutt.gpkg\"), layer = \"bowen_island_shoreline_w_hutt__bowen_islands\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `bowen_island_shoreline_w_hutt__bowen_islands' from data source \n  `/home/jay/Programming_Projects/bowen.biodiversity.webapp/data-raw/bowen_island_shoreline_w_hutt.gpkg' \n  using driver `GPKG'\nSimple feature collection with 11 features and 1 field\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: 4001956 ymin: 2020764 xmax: 4013988 ymax: 2028901\nProjected CRS: NAD83 / Statistics Canada Lambert\n```\n\n\n:::\n\n```{.r .cell-code}\n# Protected Areas from JD\nbowen_protectedareas_include <- bowen.biodiversity.webapp::bowen_protectedareas %>%\n  filter(type != \"Agricultural Land Reserve\") # Remove ALR\n# Protected Areas from Bowen Island Municipality \nbowen_protectedareas_2 <- st_read(here(\"data-raw/archive/bowen_island_protectedareas/BM_PROTECTED_AREAS.shp\")) %>%\n  filter(NAME != \"Old Growth Management Area\") \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `BM_PROTECTED_AREAS' from data source \n  `/home/jay/Programming_Projects/bowen.biodiversity.webapp/data-raw/archive/bowen_island_protectedareas/BM_PROTECTED_AREAS.shp' \n  using driver `ESRI Shapefile'\nSimple feature collection with 61 features and 2 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 468632.2 ymin: 5464739 xmax: 476690.7 ymax: 5472342\nProjected CRS: NAD83 / UTM zone 10N\n```\n\n\n:::\n\n```{.r .cell-code}\n# JD protected areas is more complete, with smaller municipal parks, covenants, and park land exchanges\n\nbowen_protectedareas_rast <- bowen_protectedareas_include %>%\n  bowen_rasterize_cover()\n\n# Check with polygon / polygon area calculations for full Bowen Island\nsum(st_area(bowen_protectedareas_include)) / sum(st_area(bowen_island)) # 0.2149664\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n0.2149664 [1]\n```\n\n\n:::\n\n```{.r .cell-code}\nsum(st_area(bowen_protectedareas_2)) / sum(st_area(bowen_island)) # 0.17935\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n0.17935 [1]\n```\n\n\n:::\n\n```{.r .cell-code}\n# Private Land\nbowen_mask <- rast(here(\"inst/extdata/bowen_mask.tif\"))\nbowen_parcelmap_priv <- bowen.biodiversity.webapp::bowen_parcelmap %>%\n  st_cast(\"MULTIPOLYGON\") %>% # Need this due to MULTISURFACE - see: https://gis.stackexchange.com/questions/389814/r-st-centroid-geos-error-unknown-wkb-type-12 \n  filter(OwnerType == \"Private\")\nbowen_parcelmap_rast <- bowen_parcelmap_priv %>%\n  bowen_rasterize_cover()\n\n# Check with polygon / polygon area calculations for full Bowen Island \nsum(st_area(bowen_parcelmap_priv)) / sum(st_area(bowen_island)) # 0.4398566\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n0.4398566 [1]\n```\n\n\n:::\n\n```{.r .cell-code}\n# Other Land\nbowen_mask <- rast(here(\"inst/extdata/bowen_mask.tif\"))\nbowen_parcelmap_other_rast <- bowen.biodiversity.webapp::bowen_parcelmap %>%\n  st_cast(\"MULTIPOLYGON\") %>%# Need this due to MULTISURFACE - see: https://gis.stackexchange.com/questions/389814/r-st-centroid-geos-error-unknown-wkb-type-12 \n  filter(OwnerType != \"Private\") %>%\n  bowen_rasterize_cover()\n\n# Freshwater Habitats \nfw_rast_paths <- c(\n  here(\"inst/extdata/habitats/lakes.tif\"),\n  here(\"inst/extdata/habitats/ponds.tif\"),\n  here(\"inst/extdata/habitats/riparian.tif\"),\n  here(\"inst/extdata/habitats/wetlands.tif\"),\n  here(\"inst/extdata/habitats/streams.tif\")\n)\nfw_rast_stack <- lapply(fw_rast_paths, rast) %>%\n  rast()\nfw_rast_dissolve <- fw_rast_stack %>% \n  sum(na.rm = T) %>%\n  not.na() %>%\n  classify(cbind(FALSE, NA)) \n\n# Human Footprint (classified)\nbowen_hfp <- here(\"inst/extdata/habitats/bowen_human_footprint_recl.tif\") %>%\n  rast()\nbowen_hfp_low <- bowen_hfp %>%\n  classify(cbind(3, NA)) %>%\n  classify(cbind(2, NA)) %>%\n  not.na() %>%\n  classify(cbind(FALSE, NA)) \nbowen_hfp_med <- bowen_hfp %>%\n  classify(cbind(3, NA)) %>%\n  classify(cbind(1, NA)) %>%\n  not.na() %>%\n  classify(cbind(FALSE, NA)) \nbowen_hfp_high <- bowen_hfp %>%\n  classify(cbind(2, NA)) %>%\n  classify(cbind(1, NA)) %>%\n  not.na() %>%\n  classify(cbind(FALSE, NA)) \n\n# Overlap calculation \noverlap_stats <- function(top_rast) {\n  data.frame(\n    protectedareas_overlap = raster_overlap_ratio(top_rast, bowen_protectedareas_rast),\n    privatelands_overlap = raster_overlap_ratio(top_rast, bowen_parcelmap_rast),\n    otherlands_overlap = raster_overlap_ratio(top_rast, bowen_parcelmap_other_rast),\n    freshwater_overlap = raster_overlap_ratio(top_rast, fw_rast_dissolve),\n    hfp_low_overlap = raster_overlap_ratio(top_rast, bowen_hfp_low),\n    hfp_med_overlap = raster_overlap_ratio(top_rast, bowen_hfp_med),\n    hfp_high_overlap = raster_overlap_ratio(top_rast, bowen_hfp_high)\n  )\n}\n\nquants <- seq(from = 0.9, to = 0, by = -0.1)\noverlap_results <- foreach(quant = quants, .combine = \"rbind\") %do% {\n  rankmap %>%\n    remove_by_quantile(quant) %>%\n    overlap_stats() %>% \n    mutate(\"top_bioval_prop\" = 1-quant) %>%\n    relocate(\"top_bioval_prop\") \n}\n# Visualize output as table for overlap % \nknitr::kable(overlap_results)\n```\n\n::: {.cell-output-display}\n\n\n| top_bioval_prop| protectedareas_overlap| privatelands_overlap| otherlands_overlap| freshwater_overlap| hfp_low_overlap| hfp_med_overlap| hfp_high_overlap|\n|---------------:|----------------------:|--------------------:|------------------:|------------------:|---------------:|---------------:|----------------:|\n|             0.1|              0.3124423|            0.3795192|          0.2906374|          0.6226816|       0.0054456|       0.5537784|        0.4407760|\n|             0.2|              0.2576209|            0.4192964|          0.2647501|          0.6000695|       0.0037542|       0.5748986|        0.4213472|\n|             0.3|              0.2564521|            0.4540426|          0.2471943|          0.5709715|       0.0037013|       0.6179604|        0.3783383|\n|             0.4|              0.2431700|            0.4613479|          0.2352942|          0.5549381|       0.0070288|       0.6267193|        0.3662519|\n|             0.5|              0.2363831|            0.4537550|          0.2365963|          0.5372824|       0.0094810|       0.6277376|        0.3627814|\n|             0.6|              0.2259497|            0.4482119|          0.2348407|          0.5302837|       0.0126638|       0.6219566|        0.3653796|\n|             0.7|              0.2156027|            0.4476938|          0.2283363|          0.5248914|       0.0145286|       0.6163718|        0.3690996|\n|             0.8|              0.2187919|            0.4433284|          0.2247543|          0.5211019|       0.0147846|       0.6213660|        0.3638494|\n|             0.9|              0.2207292|            0.4408476|          0.2216530|          0.5178973|       0.0176398|       0.6236032|        0.3587571|\n|             1.0|              0.2189496|            0.4398923|          0.2205924|          0.5152604|       0.0180923|       0.6248389|        0.3570688|\n\n\n:::\n:::\n",
    "supporting": [
      "output_zonation_02_05_2025_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}