# Bowen Island Biodiversity Web Application

An interactive Shiny web application for exploring biodiversity conservation data for Bowen Island, BC. This application visualizes species distributions, habitat extents, conservation priorities, and development threats to support evidence-based community planning.

**Live Application**: <https://palenlab.shinyapps.io/Bowen-Biodiversity-WebApp/>

## Overview

This web application provides an interactive interface to explore:
- **Species distributions** - 193 species distribution models for vertebrates
- **Habitat maps** - ~50 critical habitat layers from TEM, SEI, and field surveys
- **Conservation values** - Priority areas identified through Zonation5 analysis
- **Protected areas** - Current conservation lands and gap analysis
- **Threats** - Development pressure, wildfire risk, and human disturbance
- **Overlay analysis** - Combine layers to identify areas of high conservation value facing development pressure

## Quick Start

### Local Development

```r
# From the web-application/ directory

# 1. Restore package environment (first time only)
renv::restore()

# 2. Load and run the application
pkgload::load_all()
run_app()

# Or simply run the app.R file
source("app.R")
```

The application will open in your default web browser at `http://127.0.0.1:XXXX`.

### Prerequisites

- **R** ≥ 3.5 (R 4.4+ recommended)
- **Required system libraries**:
  - GDAL for spatial data processing
  - GEOS for geometric operations
  - PROJ for coordinate transformations

All R package dependencies are managed via `renv` and will be automatically installed when running `renv::restore()`.

## Application Structure

This is a {golem}-based Shiny application structured as an R package. Key components:

```
web-application/
├── app.R                # Application entry point
├── DESCRIPTION          # Package metadata and dependencies
├── R/                   # Application modules and utilities
│   ├── app_ui.R        # Main UI definition
│   ├── app_server.R    # Main server logic
│   ├── app_config.R    # Configuration settings
│   ├── mod_*.R         # Shiny modules for each tab
│   ├── plots.R         # Plotting functions
│   ├── utils-*.R       # Helper utilities
│   └── run_app.R       # Application launcher
├── inst/               # Installed files (data, assets)
│   ├── app/www/        # CSS, JavaScript, images
│   └── extdata/        # GeoJSON files for mapping
├── dev/                # Development scripts
└── renv/               # Package dependency management
```

### Key Shiny Modules

The application is organized into modular components:

- [mod_start.R](R/mod_start.R) - Landing page with project overview
- [mod_species.R](R/mod_species.R) - Species distribution mapping
- [mod_habitats.R](R/mod_habitats.R) - Habitat extent visualization
- [mod_values.R](R/mod_values.R) - Conservation priority areas
- [mod_protected_areas.R](R/mod_protected_areas.R) - Current protected areas and gaps
- [mod_threats.R](R/mod_threats.R) - Development and disturbance threats
- [mod_overlay.R](R/mod_overlay.R) - Multi-layer analysis tool
- [mod_action.R](R/mod_action.R) - Take action resources
- [mod_people.R](R/mod_people.R) - Contributors and acknowledgments

## Data Requirements

The application expects processed spatial data in the `inst/extdata/` directory. These files are generated by the data pipeline in the parent `data-etl/` directory.

### Required Data Files

GeoJSON files for interactive mapping:
- Species distribution polygons (`inst/extdata/species/`)
- Habitat extent polygons (`inst/extdata/habitats/`)
- Conservation priority zones (`inst/extdata/values/`)
- Protected area boundaries (`inst/extdata/protected/`)
- Threat layers (`inst/extdata/threats/`)

Raster files for detailed analysis:
- Species distribution models (`.tif` format)
- Habitat suitability rasters
- Zonation conservation rankings

To generate these data files, run the data processing pipeline:

```r
# From the parent data-etl/ directory
source("data-etl/00_run_all.R")
```

See [../data-etl/README.md](../data-etl/README.md) for full data pipeline documentation.

## Deployment

### Deploy to shinyapps.io

```r
# Set up account (first time only)
rsconnect::setAccountInfo(name = "your-account",
                          token = "your-token",
                          secret = "your-secret")

# Deploy the application
rsconnect::deployApp(appDir = "web-application",
                     appName = "Bowen-Biodiversity-WebApp",
                     account = "palenlab")
```

### Deploy to Shiny Server

```bash
# Copy application to server
scp -r web-application/ user@server:/srv/shiny-server/bowen-biodiversity/

# Ensure proper permissions
sudo chown -R shiny:shiny /srv/shiny-server/bowen-biodiversity/
```

### Configuration

Application settings are managed in [R/app_config.R](R/app_config.R):
- Map tile providers
- Default map extent
- Color palettes
- File paths

For production deployment, set:
```r
options("golem.app.prod" = TRUE)
```

## Development

### Adding a New Module

1. Create module file: `R/mod_new_feature.R`
2. Define UI and server functions using golem module template
3. Add module to main UI in `R/app_ui.R`
4. Connect module in main server in `R/app_server.R`
5. Document the module with roxygen2 comments

### Styling

The application uses {bslib} for Bootstrap theming. Modify theme settings in [R/app_ui.R](R/app_ui.R).

Custom CSS and JavaScript can be added to `inst/app/www/`.

### Testing

```r
# Run automated tests
devtools::test()

# Run interactive tests with shinytest2
shinytest2::record_test()
```

## Key Dependencies

- **{golem}** - Shiny application framework
- **{shiny}** - Web application framework
- **{bslib}** - Bootstrap theming
- **{leaflet}** - Interactive mapping
- **{sf}** - Spatial data handling
- **{terra}** - Raster data processing
- **{DT}** - Interactive data tables
- **{ggplot2}** - Static visualizations

See [DESCRIPTION](DESCRIPTION) for complete dependency list.

## Performance Considerations

- **Spatial data** - Large GeoJSON files are simplified for web display
- **Caching** - Leaflet maps use tile caching for faster loading
- **Reactive programming** - Modules use reactive expressions to minimize recomputation
- **Lazy loading** - Data files are loaded on-demand rather than at startup

## Contributing

For bug reports or feature requests:
- Open an issue: <https://github.com/Palen-Lab/bowen.biodiversity.webapp/issues>

## Citation

If using this application or its data:

```
Matsushiba, J., Tylo, M., Palen, W., & Sisk, T. (2025).
Bowen Island Biodiversity Web Application.
Bowen Island Municipality. https://palenlab.shinyapps.io/Bowen-Biodiversity-WebApp/
```

## License

MIT License - See [../LICENSE](../LICENSE)

## Contact

- **Developer**: Jay Matsushiba (hello@jmatsushiba.com)
- **Principal Investigator**: Wendy Palen, Simon Fraser University

## Related Documentation

- [Data Pipeline README](../data-etl/README.md) - How to process raw data
- [Analysis Documentation](../data-etl/analyses/README.md) - Methodological details
- [Project Website](https://palen-lab.github.io/bowen.biodiversity.webapp/) - Full documentation
