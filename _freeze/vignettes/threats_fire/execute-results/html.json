{
  "hash": "8f0856b5cf9627ea9bfe62eda085398d",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Threats: Fire\"\nauthor: \"Jay Matsushiba\"\ndate: \"2025/09/12\"\nformat:\n  html:\n    code-fold: true\nnotebook-view:\n  - notebook: lidar_dem.qmd\n    title: \"Creating DEM from LiDAR Data\"\n---\n\n::: {.cell}\n\n```{.r .cell-code}\n# This repository, access to data objects created for this project \nlibrary(bowen.biodiversity.webapp)\n\n# Spatial data packages\nlibrary(sf)\nlibrary(terra)\n\n# Visualization \nlibrary(ggplot2)\nlibrary(leaflet)\nlibrary(tidyterra)\n\n# Utilities \nlibrary(here)\nlibrary(tidyverse)\n```\n:::\n\n\n\n\n# Threats: Wildfire\n\nOne major potential threat for biodiversity on Bowen Island is wildfire.\nWe wanted to analyze the spatial overlap between Conservation Values\noutput we generated and wildfire impacts. With this, we could understand\nwhere on Bowen Island would be relatively more affected if/when a\nwildfire occurs.\n\n## Existing Data Sources\n\nRather than creating our own wildfire index, we first explored what\ndatasets existed. This section describes the data that we are aware of,\nand their strengths and limitations.\n\n### Bowen Wildland Urban Interfaces (WUI)\n\n![Bowen Island WIldland Urban Interface\nMap](images/clipboard-1378344876.png)\n\nThe Province of British Columbia produces the Wildland Urban Interface\n(WUI) maps, with their intention being to use these maps to inform the\nrelative impact of wildfires on human development. These maps take into\nconsideration three key variables - fuel load, climate conditons, and\nhuman development at the interface between urban and wildland areas. The\nintended use case for these maps are to inform wildfire prevention and\nresponse in British Columbia.\n\nThe WUI seems to be rigourous in their modelling of fuel load and\nclimate conditions, but because these values are not provided separately\nfrom the final WUI map, we are not able to use these layers for our\npurposes. For our purposes, we want to look at how wildfires would\nimpact biodiversity, and would need to remove the human development\nvariable. Therefore, after exploring the data, we have elected not to\nuse the WUI map to estimate the vulnerability of biodiversity to\nwildfires.\n\nSources: [BC Wildfire Service:\nWUI](https://www2.gov.bc.ca/gov/content/safety/wildfire-status/prevention/fire-fuel-management/wui-risk-class-maps)\n\n#### Preparing WUI Downloaded Layers\n\nThe original WUI maps are provided as a KMZ file. The KMZ files were\nfirst loaded into QGIS and clipped to\n`data-raw/bowen_boundary/Bowen_boundary.shp`. This clipped KMZ was saved\nas `data-raw/bowen_wui.gpkg`.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbowen_wui <- here(\"data-raw/bowen_wui.gpkg\") %>% \n  st_read(quiet = T) %>%\n  select(Name, PSTA) %>%\n  rename(WUI = Name) %>%\n  mutate(WUI_PSTA = paste0(WUI, \"_\", PSTA))\n\nggplot(bowen_wui) + \n  geom_sf(aes(fill = PSTA))\n```\n\n::: {.cell-output-display}\n![](threats_fire_files/figure-html/plots-1.png){width=672}\n:::\n\n```{.r .cell-code}\nggplot(bowen_wui) + \n  geom_sf(aes(fill = WUI))\n```\n\n::: {.cell-output-display}\n![](threats_fire_files/figure-html/plots-2.png){width=672}\n:::\n\n```{.r .cell-code}\nggplot(bowen_wui) + \n  geom_sf(aes(fill = WUI_PSTA))\n```\n\n::: {.cell-output-display}\n![](threats_fire_files/figure-html/plots-3.png){width=672}\n:::\n:::\n\n\n\n\n#### Rasterizing WUI Maps\n\nIn case we would like to overlap the WUI risk classification with the\nConservation Values raster, we need to rasterize the vector WUI layer.\n\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Moderate_5-6\"               \"No Data (Private Land)_1-4\"\n[3] \"Water_1-4\"                  \"Low_1-4\"                   \n[5] \"Moderate_1-4\"              \n```\n\n\n:::\n:::\n\n\n\n\n## Wildfire Vulnerability Index\n\nSince the existing data sources that we could identify do not suit our\nuse case, we decided to create our own Wildfire Vulnerability Index. To\nclarify, this index does not assess the probability, severity, or\nbehaviour of wildfire. Instead, we want to know the relative\nvulnerability to biodiversity loss due to fire, given a wildfire\nsituation.\n\nThree major components of vulnerability:\n\n1.  Slope. Fires spread more quickly when they move uphill. Relative\n    ranking might look like this:\n\n| Slope Description                       | Score |\n|-----------------------------------------|-------|\n| 0-10 degree slopes: lower vulnerability | 1     |\n| 10-30 degrees: moderate vulnerability   | 2     |\n| Above 30 degrees: higher vulnerability  | 3     |\n\n2.  Aspect. Southerly exposures burn hotter, fire spreads more quickly,\n    effects more uniform and destructive than on northern exposures, all\n    else being equal. Might consider this as a first approximation:\n\n| Aspect Description | Score |\n|------------------------------------|------------------------------------|\n| 0-45: Low vulnerability because fires unlikely to spread as fast or burn as hot | 1 |\n| 45-90: moderately low | 2 |\n| 90-135: moderately high | 4 |\n| 135-225: southerly exposures burn hotter, spread quickly and more uniformly | 6 |\n| 225-270: Moderately high | 4 |\n| 270-315 Moderately low | 2 |\n| 315-360: Low vulnerability | 1 |\n\n3.  Fuels. On Bowen, the main differences in fuel loads have to do with\n    whether a location is forested or not forested. Forested areas burn\n    hotter and longer and long, hot burns have a more detrimental effect\n    that shorter less intense fires. So the main distinctions should be\n    made between forested and unforested. Forest stands comprised of\n    larger trees are, of course, of higher value to biodiversity than\n    denser stands with smaller trees, so we would like to be able to\n    distinguish between forest structures to some degree. At the same\n    time, when more mesic habitats burn the biodiversity effects tend to\n    be high, because species are not adapted to fire. So we will need to\n    rank habitats based on the differential effects of forest fuels\n    present, as well as the difference in flora and fauna that make\n    those locations more or less vulnerable in terms of biodiversity\n    loss.\n\nFirst Cut Ranking Scheme:\n\n| Habitat Description | Score |\n|------------------------------------|------------------------------------|\n| Forest, large/old trees | 14 |\n| Forest, mature second growth | 10 |\n| Forest, young regrowth | 6 |\n| Shrublands | 6 |\n| Grasslands: often burn and effects are modest, even positive in some cases | 2 |\n| Riparian: seldom burns, but if it burns biodiversity effects may be very negative | 4 |\n| Wetlands: seldom burn, more often they create fire breaks | 2 |\n| Water: does not burn, but is vulnerable to ash deposition | 0 |\n| Built environment (default to WUI map when talking about the built environment) | NA |\n\nWe conducted our further work around these basic ideas:\n\n1.  We pursue an index of vulnerability, rather than a more\n    sophisticated approach to modeling fire or adapting an index that\n    was developed for other purposes (i.e. WUI).\n\n2.  We create a simple index that allows us to compare the relative\n    vulnerability of all locations on Bowen (with the exception of the\n    built environment).\n\n3.  We consider slope, aspect, and fuels by habitat as the three\n    components of an index.\n\n4.  We determine the relative ranks within each of the three components\n\n5.  Integrate the scores into an index that produces an aggregate\n    vulnerability index score for each pixel. As a first approximation,\n    this should be the additive (sum) of the three components – and then\n    let’s see how that performs.\n\n### Generate Wildfire Vulnerability Index Raster\n\n#### Input Data 1: LiDAR\n\nWe prepared the slope and aspect rasters from the LiDAR data provided by\nBC LiDAR. We then assigned the scores to these rasters according to the\nabove scoring tables.\n\nSee [Bowen Island DTM](lidar_dem.qmd) for more details.\n\n#### Input Data 2: Metro Vancouver Sensitive Ecosystem Inventory (MVSEI) \n\nThe Metro Vancouver Sensitive Ecosystem Inventory (MVSEI) provides\nalmost full coverage of habitat types across Bowen Island. The locations\nthat do not have habitat type data from the MVSEI are those that have\nbeen subject to human development, and are no longer considered to be\nhabitat. The more general classifications of the MVSEI make it easier to\nassign the scores, compared to using the Terrestrial Ecosystem Mapping\n(TEM) products.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Slope Score\n## Create slope raster from LiDAR data\nslope <- rast(here(\"data/bowen_slope.tif\"))\n## Create matrix of scores\n### 1 0-10 degree slopes: lower vulnerability\n### 2 10-30 degrees: moderate vulnerability\n### 3 Above 30 degrees: higher vulnerability\nslope_m <- matrix(c(\n  0, 10, 1,\n  10, 30, 2,\n  30, 91, 3\n), ncol = 3, byrow = T)\n## Classify original slope raster to slope score \nslope_score <- slope %>%\n  classify(slope_m)\nplot(slope_score, main = \"Slope Score\")\n```\n\n::: {.cell-output-display}\n![](threats_fire_files/figure-html/raw_wildfire_index-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Aspect Score\n## Create aspect raster from LiDAR data\naspect <- rast(here(\"data/bowen_aspect.tif\"))\n## Create matrix of scores\n### 1 0-45: Low vulnerability because fires unlikely to spread as fast or burn as hot \n### 2 45-90: moderately low \n### 4 90-135: moderately high \n### 6 135-225: southerly exposures burn hotter, spread quickly and more uniformly \n### 4 225-270: Moderately high \n### 2 270-315 Moderately low \n### 1 315-360: Low vulnerability\naspect_m <- matrix(c(\n  0, 45, 1,\n  45, 90, 2,\n  90, 135, 4,\n  135, 225, 6,\n  225, 270, 4,\n  270, 315, 2,\n  315, 360, 1\n), ncol = 3, byrow = T)\n## Classify original aspect raster to aspect score \naspect_score <- aspect %>%\n  classify(aspect_m)\nplot(aspect_score, main = \"Aspect Score\")\n```\n\n::: {.cell-output-display}\n![](threats_fire_files/figure-html/raw_wildfire_index-2.png){width=672}\n:::\n\n```{.r .cell-code}\n# Fuel Score\n## Get habitat classes from combination of WUI, MVSEI, TEM, AW layers \nmv_sei <- st_read(here(\"data-raw/metrovancouver_sensitive_ecosystem_inventory/Sensitive_Ecosystem_Inventory_for_Metro_Vancouver__2020__-5580727563910851507.gpkg\"),\n                  quiet = T) %>%\n  st_transform(project_crs) %>%\n  st_crop(bowen_boundary) \n\nmv_sei_secl_codes <- read.csv(here(\"data-raw/metrovancouver_sensitive_ecosystem_inventory/SEI_SECl_codes.csv\"))\n\n## Generate fuel score raster based on habitat type \n### 14 Forest, large/old trees \n### 10 Forest, mature second growth \n### 6 Forest, young regrowth \n### 6 Shrublands \n### 2 Grasslands: often burn and effects are modest, even positive in some cases \n### 4 Riparian: seldom burns, but if it burns biodiversity effects may be very negative \n### 2 Wetlands: seldom burn, more often they create fire breaks \n### 0 Water: does not burn, but is vulnerable to ash deposition \n### NA Built environment: NA (default to WUI map when talking about the built environment\n\n### Using SEI \n### TODO: use A. Whitehead wetland and freshwater layers \n### Go with the lowest habitat score\n\n### In order to integrate A. Whitehead's layers, need to figure out the order to prioritize layers. \nmv_sei_mod <- mv_sei %>%\n  select(\"SECl_1\", \"SEsubcl_1\", \"SECl_2\") %>%\n  filter(!str_detect(SECl_1, \"x\")) %>% # remove lost habitats\n  mutate(\n    fuel_score = \n      case_when(\n        SECl_1 == \"OF\" ~ 14,\n        SECl_1 == \"MF\" ~ 10,\n        SECl_1 == \"YF\" ~ 6,\n        SECl_1 == \"YS\" ~ 6,\n        SECl_1 == \"WD\" ~ 6, # TODO: what score for \"Woodland\" category? \n        SECl_1 == \"HB\" & SEsubcl_1 == \"sh\" ~ 6, # Herbaceous, shrub\n        SECl_1 == \"HB\" & SEsubcl_1 != \"sh\" ~ 2, # Herbaceous, non-shrub\n        SECl_1 == \"RI\" ~ 4, # \"Riparian\"\n        SECl_1 == \"WN\" ~ 2, # \"Wetland\"\n        SECl_1 == \"OD\" ~ 2, # \"Old Field\"\n        SECl_1 == \"SV\" ~ 1, # 2025/6/12: updated to score 1 after meeting with Wendy\n        SECl_1 == \"IT\" ~ 0, # 2025/6/12: keep to score 0\n        SECl_1 == \"FW\" ~ 0,\n        # Deal with XX Non-SE\n        SECl_1 == \"XX\" & SECl_2 == \"MF\" ~ 10,\n        SECl_1 == \"XX\" & SECl_2 == \"YS\" ~ 6,\n        SECl_1 == \"XX\" & SECl_2 == \"WD\" ~ 6,\n        SECl_1 == \"XX\" & SECl_2 == \"RI\" ~ 4,\n        SECl_1 == \"XX\" & SECl_2 == \"SV\" ~ 0,\n      )\n  )\n# Rasterize habitat polygons fuel score\nfuel_score <- mv_sei_mod %>%\n  vect() %>%\n  project(aspect_score) %>%\n  rasterize(aspect_score, field = \"fuel_score\") \nplot(fuel_score, main = \"Fuel Score\")\n```\n\n::: {.cell-output-display}\n![](threats_fire_files/figure-html/raw_wildfire_index-3.png){width=672}\n:::\n\n```{.r .cell-code}\n# Cumulative Fire Vulnerability Index\nfire_index <- slope_score + aspect_score + fuel_score\nplot(fire_index, main = \"Wildfire Vulnerability Index\")\n```\n\n::: {.cell-output-display}\n![](threats_fire_files/figure-html/raw_wildfire_index-4.png){width=672}\n:::\n:::\n\n\n\n\n### Further Cleaning / Preparing Wildfire Vulnerability Index\n\nWe decided to further clean up the Wildfire Vulnerability Index raster\nbased on our intended use case.\n\n#### Mask WUI Area in Wildfire Vulnerability Index\n\nWe investigated masking the Wildfire Vulnerability Index (WVI) with the\nWUI map, so that our WVI is only in locations without a WUI risk\nclassification. However, we decided ultimately not to do this as the WUI\noverlaps almost entirely with our WVI. Additionally, this would be\nflawed for assessing vulnerability of biodiversity as the WUI focuses on\nhuman developments.\n\n#### Mask Private Lands in Wildfire Vulnerabilty Index\n\nWe decided to mask the Private Lands from the WVI, in order to prevent\nmisconstruing of the WVI as a wildfire risk map and unnecessarily\nalerting private property owners. This index does not make any\nassessment of risk, severity, or behaviour of wildfire. This index does\nattempt to quantify the impact that a given wildfire could have on\nbiodiversity.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Crop WUI out\n# bowen_wui_rast_fi <- bowen_wui_vect %>%\n#   project(fire_index) %>%\n#   rasterize(fire_index, \"WUI_PSTA\", touches = T)\n# Decided to not do this, since the WUI overlaps so much with our fire index\n# Instead, present both WUI and our fire index layers in the web application\n# Tom to write clarifying text on difference between the two\n# Fire index descirbes vulnerability of biodiversity, rather than risk of fire\n\n# Mask private land parcels on fire index layer \nbowen_parcelmap_rast <- bowen_parcelmap %>% \n  st_cast(\"MULTIPOLYGON\") %>% # WKB type 12, curved polygons need to be recast\n  vect() %>%\n  project(fire_index) %>%\n  rasterize(fire_index, field = 1)\n\nfire_index_m <- fire_index %>% \n  mask(bowen_parcelmap_rast, inverse = T)\n\n# Save\nwriteRaster(\n  fire_index_m, \n  here(\"inst/extdata/6_threats/fire_index.tif\"),\n  overwrite = T\n)\n# Save simple for web app\nfire_index_simple <- fire_index_m %>%\n  aggregate(fact = 20, fun = mean) %>%\n  round()\nwriteRaster(fire_index_simple, here(\"inst/extdata/6_threats/fire_index_40m.tif\"),\n            overwrite = T)\n\n# Save WUI rast at same res as fire_index\nbowen_wui_rast_m <- bowen_wui_vect %>%\n  project(fire_index_simple) %>%\n  rasterize(fire_index_simple, \"id\", touches = T)\nwriteRaster(bowen_wui_rast_m, here(\"inst/extdata/6_threats/fire_wui_40m.tif\"),\n            overwrite = T)\n```\n:::\n\n\n\n\n### Plotting\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfire_index_mp <- fire_index_m %>%\n  project(\"EPSG: 3857\")\n\nfire_gg <- function() {\n  list(\n    geom_spatraster(data = fire_index_mp),\n    scale_fill_viridis_c(option = \"inferno\", na.value = NA, name = \"Fire Vul. Index\"),\n    ggnewscale::new_scale_fill(),\n    ggnewscale::new_scale_colour()\n  )\n}\nfire_ggplot <- bowen_map_ggplot(fire_gg,\n                 title = \"Fire Vulnerability Index\",\n                 subtitle = \"Index of Vulnerability to Fire. This is not an assessment of the probability or behaviour of the fire. The intention of this index is to describe the relative vulnerability to biodiversity loss due to fire, under a scenario where the habitats burn. The three major components of this vulnerability index are slope, aspect, and fuel.\",\n                 caption = \"Created by Jay Matsushiba (jmatsush@sfu.ca).\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `bowen_island_shoreline_w_hutt__bowen_islands' from data source \n  `/home/jay/Programming_Projects/bowen.biodiversity.webapp/data-raw/bowen_island_shoreline_w_hutt.gpkg' \n  using driver `GPKG'\nSimple feature collection with 11 features and 1 field\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: 4001956 ymin: 2020764 xmax: 4013988 ymax: 2028901\nProjected CRS: NAD83 / Statistics Canada Lambert\nLoading basemap 'backdrop' from map service 'maptiler'...\n```\n\n\n:::\n\n```{.r .cell-code}\noutput_dir <- here(\"vignettes/figures/threats_fire\")\nif(!dir.exists(output_dir)) {\n  dir.create(output_dir)\n}\nggplot2::ggsave(\n  here(output_dir, \"/\", paste0(Sys.Date(), \"_fire_vulnerability_index.png\")),\n  fire_ggplot,\n  device = ragg::agg_png,\n  width = 9, height = 12, units = \"in\", res = 300\n)\n\nfire_ggplot\n```\n\n::: {.cell-output-display}\n![](threats_fire_files/figure-html/unnamed-chunk-1-1.png){width=2700}\n:::\n:::\n",
    "supporting": [
      "threats_fire_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}