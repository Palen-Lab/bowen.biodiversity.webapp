[
  {
    "objectID": "vignettes/threats_logging.html",
    "href": "vignettes/threats_logging.html",
    "title": "Threats: Logging",
    "section": "",
    "text": "Code\nlibrary(bowen.biodiversity.webapp)",
    "crumbs": [
      "Threats",
      "Threats: Logging"
    ]
  },
  {
    "objectID": "vignettes/threats_fire.html",
    "href": "vignettes/threats_fire.html",
    "title": "Threats: Fire",
    "section": "",
    "text": "Code\nlibrary(bowen.biodiversity.webapp)\nlibrary(here)\n#&gt; here() starts at /home/jay/Programming_Projects/bowen.biodiversity.webapp\nlibrary(sf)\n#&gt; Linking to GEOS 3.11.1, GDAL 3.6.4, PROJ 9.1.1; sf_use_s2() is TRUE\nlibrary(ggplot2)\nlibrary(leaflet)\nlibrary(tidyverse)\n#&gt; ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n#&gt; ✔ dplyr     1.1.4     ✔ readr     2.1.5\n#&gt; ✔ forcats   1.0.0     ✔ stringr   1.5.1\n#&gt; ✔ lubridate 1.9.4     ✔ tibble    3.2.1\n#&gt; ✔ purrr     1.0.2     ✔ tidyr     1.3.1\n#&gt; ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n#&gt; ✖ dplyr::filter() masks stats::filter()\n#&gt; ✖ dplyr::lag()    masks stats::lag()\n#&gt; ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors\nlibrary(terra)\n#&gt; terra 1.8.5\n#&gt; \n#&gt; Attaching package: 'terra'\n#&gt; \n#&gt; The following object is masked from 'package:tidyr':\n#&gt; \n#&gt;     extract",
    "crumbs": [
      "Threats",
      "Threats: Fire"
    ]
  },
  {
    "objectID": "vignettes/threats_fire.html#convert-to-raster-matching-the-resolution-and-extent-of-zonation-inputs",
    "href": "vignettes/threats_fire.html#convert-to-raster-matching-the-resolution-and-extent-of-zonation-inputs",
    "title": "Threats: Fire",
    "section": "Convert to raster matching the resolution and extent of Zonation inputs",
    "text": "Convert to raster matching the resolution and extent of Zonation inputs\n\n\nCode\nbowen_mask &lt;- here(\"inst/extdata/bowen_mask.tif\") %&gt;% rast()\nbowen_wui_vect &lt;- bowen_wui %&gt;% vect() %&gt;% project(bowen_mask)\n\nbowen_wui_rast &lt;- bowen_wui_vect %&gt;%\n  rasterize(bowen_mask, \"WUI_PSTA\", touches = T)",
    "crumbs": [
      "Threats",
      "Threats: Fire"
    ]
  },
  {
    "objectID": "vignettes/input_habitats.html",
    "href": "vignettes/input_habitats.html",
    "title": "Conservation Layer: Habitats",
    "section": "",
    "text": "Code\nlibrary(bowen.biodiversity.webapp)\nlibrary(here)\n#&gt; here() starts at /home/jay/Programming_Projects/bowen.biodiversity.webapp\nlibrary(sf)\n#&gt; Linking to GEOS 3.11.1, GDAL 3.6.4, PROJ 9.1.1; sf_use_s2() is TRUE\nlibrary(tidyverse)\n#&gt; ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n#&gt; ✔ dplyr     1.1.4     ✔ readr     2.1.5\n#&gt; ✔ forcats   1.0.0     ✔ stringr   1.5.1\n#&gt; ✔ ggplot2   3.5.1     ✔ tibble    3.2.1\n#&gt; ✔ lubridate 1.9.4     ✔ tidyr     1.3.1\n#&gt; ✔ purrr     1.0.2\n#&gt; ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n#&gt; ✖ dplyr::filter() masks stats::filter()\n#&gt; ✖ dplyr::lag()    masks stats::lag()\n#&gt; ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors\nlibrary(terra)\n#&gt; terra 1.8.5\n#&gt; \n#&gt; Attaching package: 'terra'\n#&gt; \n#&gt; The following object is masked from 'package:tidyr':\n#&gt; \n#&gt;     extract\nlibrary(leaflet)\nlibrary(googlesheets4)\n\n# Load Bowen Island Mask Created Previously\nbowen_island_mask &lt;- here(\"inst/extdata/bowen_mask.tif\") %&gt;%\n  rast() %&gt;%\n  project(project_crs)\n\n# Rasterize to Bowen Island Mask \nbowen_rasterize &lt;- function(sf) {\n  output &lt;- sf %&gt;% \n    terra::vect() %&gt;% # Change to SpatVector for rasterization\n    terra::project(project_crs) %&gt;% # Reproject to the mask CRS\n    terra::rasterize(bowen_island_mask,\n                     touches = T,\n                     background = NA) # Rasterize to match mask, set background values to NA\n}\n\n# Path for this vignette's outputs\noutput_path &lt;- here(\"inst/extdata/habitats\")\n\n# Habitats table \nhabitats_df &lt;- data.frame(\n  path = as.character(),\n  filename = as.character(),\n  name = as.character(),\n  weight = as.numeric(),\n  category = as.character(),\n  source = as.character(),\n  notes = as.character()\n)",
    "crumbs": [
      "Conservation Layers",
      "Conservation Layer: Habitats"
    ]
  },
  {
    "objectID": "vignettes/input_habitats.html#wetlands",
    "href": "vignettes/input_habitats.html#wetlands",
    "title": "Conservation Layer: Habitats",
    "section": "Wetlands",
    "text": "Wetlands\nThere were some areas identified as potentially incorrect during the Feb 1 2025 workshop. We followed up with Alan Whitehead and John Dowler via email for additional details. See issue here: https://github.com/Palen-Lab/bowen.biodiversity.webapp/issues/23\nAlan Whitehead provided ponds and wetlands shapefiles, that he had created over the years as an environmental consultant on Bowen Island.\nIn the first Zonation run, we combined WN for both SECl_1 and SECl_2. This overestimated wetland extent, since this included areas that were more likely to have another habitat quality based off of MV methodology (which was mostly based on aerial surveys). We also pulled out the “Shallow Water” subcategory into its seperate layer.\nFor this next Zonation run, we will use the wetlands layer provided by Alan Whitehead. This layer seemed to be more complete with ground-truthing of the location of these wetlands, in comparison to the SEI layers from MetroVancouver that were verified using aerial imagery. “Shallow Water” is no longer a separate habitat type, since Alan Whitehead’s layers do not provide this classification.\n\n\nCode\n# Alan Whitehead's Wetland Layer\nwetlands_aw &lt;- bowen.biodiversity.webapp::bowen_wetlands_whitehead_consultants\n# Bowen SEI SECl_1 \nbowen_sei_wn_1 &lt;- bowen_sei %&gt;%\n  filter(SECl_1 == \"WN\")\n# Bowen SEI SECl_2\nbowen_sei_wn_2 &lt;- bowen_sei %&gt;%\n  filter(SECl_2 == \"WN\")\n\nwetlands_aw_rast &lt;- bowen_rasterize(wetlands_aw)\nbowen_sei_wn_1_rast &lt;- bowen_rasterize(bowen_sei_wn_1)\nbowen_sei_wn_2_rast &lt;- bowen_rasterize(bowen_sei_wn_2)\n\n# Compare wetlands \nleaflet(width = \"100%\", height = \"800px\") %&gt;%\n  addProviderTiles(provider = providers$Stadia.AlidadeSmooth) %&gt;%\n  addRasterImage(x = wetlands_aw_rast, group = \"A. Whitehead Wetlands\", colors = \"green\") %&gt;%\n  addPolygons(data = st_transform(wetlands_aw, 4326), group = \"A. Whitehead Wetlands\", color = \"darkgreen\") %&gt;%\n  addRasterImage(x = bowen_sei_wn_1_rast, group = \"Bowen SEI SECl_1 Wetlands\", colors = \"blue\") %&gt;%\n  addPolygons(data = st_transform(bowen_sei_wn_1, 4326), group = \"Bowen SEI SECl_1 Wetlands\", color = \"darkblue\") %&gt;%\n  addRasterImage(x = bowen_sei_wn_2_rast, group = \"Bowen SEI SECl_2 Wetlands\", colors = \"orange\") %&gt;%\n  addPolygons(data = st_transform(bowen_sei_wn_2, 4326), group = \"Bowen SEI SECl_2 Wetlands\", color = \"darkorange\") %&gt;%\n  addLayersControl(overlayGroups = c(\"A. Whitehead Wetlands\", \n                                     \"Bowen SEI SECl_1 Wetlands\", \n                                     \"Bowen SEI SECl_2 Wetlands\"\n  ),\n  options = layersControlOptions(collapsed = F)) \n\n\n\n\n\n\nCode\n\n# Output \nwriteRaster(wetlands_aw_rast, here(output_path, \"wetlands.tif\"), overwrite = T)\nhabitats_df &lt;- data.frame(\n  path = here(output_path, \"wetlands.tif\"),\n  filename = \"wetlands.tif\",\n  name = \"Wetlands\",\n  weight = 1.0,\n  category = \"Freshwater\",\n  source = \"Alan Whitehead\",\n  notes = \"replaces MVSEI\"\n) %&gt;%\n  bind_rows(habitats_df)",
    "crumbs": [
      "Conservation Layers",
      "Conservation Layer: Habitats"
    ]
  },
  {
    "objectID": "vignettes/input_habitats.html#freshwater",
    "href": "vignettes/input_habitats.html#freshwater",
    "title": "Conservation Layer: Habitats",
    "section": "Freshwater",
    "text": "Freshwater\nThe initial Feb1 Zonation run used the SEI categories to represent freshwater ecosystems. Each subcategory of freshwater was used as a distinct layer in the Zonation run. We have since acquired some new layers, which we can simply convert to raster and include as a conservation value input to start.\nAlan Whitehead’s Ponds layer seems much more complete than what is available in SEI, so we will use that instead to create the habitat layer.\n\n\nCode\n#### Ponds ####\n# Create Ponds Layer from Alan Whitehead's Map and SEI Freshwaster Ponds\nponds_aw &lt;- bowen.biodiversity.webapp::bowen_ponds_whitehead_consultants\nponds_aw\n#&gt; Simple feature collection with 122 features and 7 fields\n#&gt; Geometry type: MULTIPOLYGON\n#&gt; Dimension:     XY\n#&gt; Bounding box:  xmin: 469230.7 ymin: 5464929 xmax: 476786.3 ymax: 5473554\n#&gt; Projected CRS: NAD83 / UTM zone 10N\n#&gt; First 10 features:\n#&gt;    ID    Area                  NAME\n#&gt; 1  66  196.48       Everhard's Pond\n#&gt; 2  67  701.58        Trethewey Pond\n#&gt; 3  42  793.69           Ballou Pond\n#&gt; 4  78   84.99              un named\n#&gt; 5  79  416.44                island\n#&gt; 6  80  183.33              un named\n#&gt; 7  72 2701.43 Little Josephine Lake\n#&gt; 8  36 3962.48          Macleod Pond\n#&gt; 9  37 1761.08     Upper Quarry Pond\n#&gt; 10 69  816.51           Carter Pond\n#&gt;                                             COMMENT                 OCP_CLASS\n#&gt; 1                          constructed private pond          non-fish bearing\n#&gt; 2                          constructed private pond          non-fish bearing\n#&gt; 3                          constructed private pond          non-fish bearing\n#&gt; 4                          constructed private pond          non-fish bearing\n#&gt; 5     island in constructed pond FID43; fix polygon                      &lt;NA&gt;\n#&gt; 6                          constructed private pond          non-fish bearing\n#&gt; 7  constructed private pond, hist. w/ stocked trout tributary to fish-fearing\n#&gt; 8                   constructed pond, former quarry tributary to fish-bearing\n#&gt; 9                   constructed pond, former quarry tributary to fish-bearing\n#&gt; 10     in Terminal Creek, water source for hatchery              fish-bearing\n#&gt;    Source Perimeter                           geom\n#&gt; 1    &lt;NA&gt;        52 MULTIPOLYGON (((474905.9 54...\n#&gt; 2    &lt;NA&gt;        97 MULTIPOLYGON (((475005 5470...\n#&gt; 3    &lt;NA&gt;       146 MULTIPOLYGON (((474696.6 54...\n#&gt; 4    &lt;NA&gt;        57 MULTIPOLYGON (((470954.3 54...\n#&gt; 5      AW        76 MULTIPOLYGON (((471305.8 54...\n#&gt; 6    &lt;NA&gt;        52 MULTIPOLYGON (((471427.8 54...\n#&gt; 7    &lt;NA&gt;       477 MULTIPOLYGON (((472313.9 54...\n#&gt; 8    &lt;NA&gt;       355 MULTIPOLYGON (((471303.8 54...\n#&gt; 9    &lt;NA&gt;       163 MULTIPOLYGON (((471181.1 54...\n#&gt; 10   &lt;NA&gt;        72 MULTIPOLYGON (((474527 5469...\n# Source for ponds is Islands Trust TEM\nbowen_sei_fw_pd &lt;- bowen_sei %&gt;%\n  filter(SEsubcl_1 == \"pd\" | SEsubcl_2 == \"pd\") %&gt;%\n  st_transform(st_crs(ponds_aw))\n# Ponds Rasters \nponds_aw_rast &lt;- bowen_rasterize(ponds_aw)\nbowen_sei_fw_pd_rast &lt;- bowen_rasterize(bowen_sei_fw_pd)\n# Compare ponds \nleaflet(width = \"100%\", height = \"800px\") %&gt;%\n  addProviderTiles(provider = providers$Stadia.AlidadeSmooth) %&gt;%\n  addRasterImage(x = ponds_aw_rast, group = \"A. Whitehead Ponds\", colors = \"green\") %&gt;%\n  addPolygons(data = st_transform(ponds_aw, 4326), group = \"A. Whitehead Ponds\", color = \"darkgreen\") %&gt;%\n  addRasterImage(x = bowen_sei_fw_pd_rast, group = \"Bowen SEI Ponds\", colors = \"blue\") %&gt;%\n  addPolygons(data = st_transform(bowen_sei_fw_pd, 4326), group = \"Bowen SEI Ponds\", color = \"darkblue\") %&gt;%\n  addLayersControl(overlayGroups = c(\"A. Whitehead Ponds\", \n                                     \"Bowen SEI Ponds\"\n  ),\n  options = layersControlOptions(collapsed = F)) \n\n\n\n\n\n\nCode\n# Save AW ponds\nwriteRaster(ponds_aw_rast, here(output_path, \"ponds.tif\"), overwrite = T)\nhabitats_df &lt;- data.frame(\n  path = here(output_path, \"ponds.tif\"),\n  filename = \"ponds.tif\",\n  name = \"Ponds\",\n  weight = 1.0,\n  category = \"Freshwater\",\n  source = \"Alan Whitehead\",\n  notes = \"replaces MVSEI\"\n) %&gt;%\n  bind_rows(habitats_df)\n#### Lakes ####\nbowen_sei_fw_la_rast &lt;- bowen_sei %&gt;%\n  filter(SEsubcl_1 == \"la\" | SEsubcl_2 == \"la\") %&gt;%\n  bowen_rasterize()\nwriteRaster(bowen_sei_fw_la_rast, here(output_path, \"lakes.tif\"), overwrite = T)\nhabitats_df &lt;- data.frame(\n  path = here(output_path, \"lakes.tif\"),\n  filename = \"lakes.tif\",\n  name = \"Lakes\",\n  weight = 1.0,\n  category = \"Freshwater\",\n  source = \"MVSEI\",\n  notes = \"\"\n) %&gt;%\n  bind_rows(habitats_df)\n\n#### Fish Bearing Streams ####\n# Create separate raster for each OCP class\nstreams_fishbearing_rast &lt;- bowen.biodiversity.webapp::bowen_fish_whitehead_consultants %&gt;%\n  filter(OCP_CLASS == \"fish-bearing\") %&gt;%\n  bowen_rasterize() %&gt;%\n  classify(matrix(c(1, 3), ncol = 2, byrow = T)) # Assign value 3 \nstreams_tributary_rast &lt;- bowen.biodiversity.webapp::bowen_fish_whitehead_consultants %&gt;%\n  filter(OCP_CLASS == \"tributary to fish-bearing\") %&gt;%\n  bowen_rasterize() %&gt;%\n  classify(matrix(c(1, 2), ncol = 2, byrow = T)) # Assign value 2\nstreams_nonfishbearing_rast &lt;- bowen.biodiversity.webapp::bowen_fish_whitehead_consultants %&gt;%\n  filter(OCP_CLASS == \"non-fish bearing\") %&gt;%\n  bowen_rasterize() %&gt;%\n  classify(matrix(c(1, 1), ncol = 2, byrow = T)) # Assign value 1\nstreams_drainage_rast &lt;- bowen.biodiversity.webapp::bowen_fish_whitehead_consultants %&gt;%\n  filter(OCP_CLASS == \"drainage channel\") %&gt;% \n  bowen_rasterize() %&gt;% \n  classify(matrix(c(1, 1), ncol = 2, byrow = T)) # Assign value 1\nstreams_NA_rast &lt;- bowen.biodiversity.webapp::bowen_fish_whitehead_consultants %&gt;%\n  filter(is.na(OCP_CLASS)) %&gt;%\n  bowen_rasterize() %&gt;%\n  classify(matrix(c(1, 1), ncol = 2, byrow = T)) # Assign value 1\n# Combine stream rasters together, cover in order of importance\nstreams_rast &lt;- streams_NA_rast %&gt;%\n  cover(streams_drainage_rast) %&gt;%\n  cover(streams_nonfishbearing_rast) %&gt;%\n  cover(streams_tributary_rast) %&gt;%\n  cover(streams_fishbearing_rast)\nwriteRaster(streams_rast, here(output_path, \"streams.tif\"), overwrite = T)\nhabitats_df &lt;- data.frame(\n  path = here(output_path, \"streams.tif\"),\n  filename = \"streams.tif\",\n  name = \"Streams\",\n  weight = 1.0,\n  category = \"Freshwater\",\n  source = \"Alan Whitehead\",\n  notes = \"Raster value 3 for fish-bearing streams, 2 for non-fish bearing, 1 for drainage channel and NA\"\n) %&gt;%\n  bind_rows(habitats_df)\n\n#### Riparian #### \n# Combine ff (fringe) and gu (gully) riparian classes into one habitat layer\nbowen_sei_ri_rast &lt;- bowen_sei %&gt;%\n  filter(SECl_1 == \"RI\" | SECl_2 == \"RI\") %&gt;%\n  bowen_rasterize()\nwriteRaster(bowen_sei_ri_rast, here(output_path, \"riparian.tif\"), overwrite = T)\nhabitats_df &lt;- data.frame(\n  path = here(output_path, \"riparian.tif\"),\n  filename = \"riparian.tif\",\n  name = \"Riparian\",\n  weight = 1.0,\n  category = \"Freshwater\",\n  source = \"MVSEI\",\n  notes = \"\"\n) %&gt;%\n  bind_rows(habitats_df)",
    "crumbs": [
      "Conservation Layers",
      "Conservation Layer: Habitats"
    ]
  },
  {
    "objectID": "vignettes/input_habitats.html#terrestrial-ecosystem-mapping",
    "href": "vignettes/input_habitats.html#terrestrial-ecosystem-mapping",
    "title": "Conservation Layer: Habitats",
    "section": "Terrestrial Ecosystem Mapping",
    "text": "Terrestrial Ecosystem Mapping\nWe originally used the Metro Vancouver SEI for the Feb 1 Zonation run, but many of the habitat types are not very specific. Ex. “Mature Forest” is a habitat category that covers much of Bowen Island, but does not provide detail of what species exist there.\nWe got the TEM (Terrestrial Ecosystem Mapping) layers from Jeff Matheson via email on April 6 2025.\nFrom my own digging through the MVSEI layers and comparing to the TEM, I think that the original 2009 version of the TEMs are included in the current MVSEI. Since then TEM has been updated (2011 and 2017), mostly with larger polygons being split into smaller and more specific areas, but these have not been incorporated into MVSEI. The most recent additions to MVSEI from the TEM are in 2016, before the most recent updates.\n\n\nCode\n#### Bowen TEM for detailed terrestrial habitat identity ####\nbowen_TEM &lt;- st_read(here(\"data-raw/bowen_TEM/BM_TEM.shp\")) %&gt;%\n  # Remove habitat types that are already represented or not important ecosystems\n  filter(!SITE_S1_LA %in% c(\n    # Freshwater  \n    \"Reservoir\",\n    \"Shallow Open Water\",\n    \"Lake\",\n    # Developed \n    \"Gravel Pit\",\n    \"Cultivated Field\",\n    \"Golf Course\",\n    \"Rural\",\n    \"Industrial\",\n    \"Urban/Suburban\",\n    # Wetlands - already represented in A.Whitehead's layers\n    \"Wetland swamp\",\n    \"Wetland fenn\"\n    )\n  )\n#&gt; Reading layer `BM_TEM' from data source \n#&gt;   `/home/jay/Programming_Projects/bowen.biodiversity.webapp/data-raw/bowen_TEM/BM_TEM.shp' \n#&gt;   using driver `ESRI Shapefile'\n#&gt; Simple feature collection with 615 features and 43 fields\n#&gt; Geometry type: POLYGON\n#&gt; Dimension:     XY\n#&gt; Bounding box:  xmin: 468516.6 ymin: 5464606 xmax: 477662.2 ymax: 5474194\n#&gt; Projected CRS: NAD83 / UTM zone 10N\n# Create rasters and save\nbowen_TEM_categories &lt;- unique(bowen_TEM$SITE_S1_LA)\nfor(tem_code in bowen_TEM_categories) {\n  output &lt;- bowen_TEM[bowen_TEM$SITE_S1_LA == tem_code,] %&gt;%\n    bowen_rasterize()\n  output_filename &lt;- tem_code %&gt;% \n    gsub(\"-\", \"_\", .) %&gt;%\n    gsub(\" \", \"\", .) %&gt;%\n    gsub(\"'\", \"\", .) %&gt;%\n    paste0(\".tif\")\n  writeRaster(output, here(output_path, output_filename), overwrite = T)\n  habitats_df &lt;- data.frame(\n    path = here(output_path, output_filename),\n    filename = output_filename,\n    name = tem_code,\n    weight = 1.0,\n    category = \"Terrestrial\",\n    source = \"TEM\",\n    notes = \"Detailed types, plant community descriptions\"\n  ) %&gt;%\n    bind_rows(habitats_df)\n}\n\n#### Metro Vancouver SEI for Young Forest, Mature Forest, Old Forest designation ####\n# OF - Old Forest\n# MF - Mature Forest\n# YF - Young Forest\n# YS - Young Forest (Small)\nbowen_SEI_forests &lt;- bowen_sei %&gt;%\n  select(SECl_1) %&gt;%\n  filter(SECl_1 %in% c(\"OF\", \"MF\", \"YF\", \"YS\")) %&gt;%\n  st_transform(st_crs(bowen_TEM))\nbowen_TEM_forests &lt;- bowen_sei %&gt;%\n  select(SECl_1) %&gt;%\n  filter(SECl_1 %in% c(\"OF\", \"MF\", \"YF\", \"YS\")) %&gt;%\n  st_transform(st_crs(bowen_TEM)) %&gt;%\n  st_join(bowen_TEM, ., largest = T) # Spatial join by largest, so each TEM polygon has forest category\n#&gt; Warning: attribute variables are assumed to be spatially constant throughout\n#&gt; all geometries\n# Compare forest maps to check\nggplot(bowen_TEM_forests) + geom_sf(aes(fill = SECl_1))\n\n\n\n\n\n\n\n\n\nCode\nggplot(bowen_SEI_forests) + geom_sf(aes(fill = SECl_1))\n\n\n\n\n\n\n\n\n\nCode\n# Create rasters and save\nbowen_forest_categories &lt;- unique(bowen_TEM_forests$SECl_1) \nbowen_forest_categories &lt;- bowen_forest_categories[!is.na(bowen_forest_categories)]\nfor(category in bowen_forest_categories) {\n  output &lt;- bowen_TEM_forests[bowen_TEM_forests$SECl_1 == category,] %&gt;%\n    bowen_rasterize()\n  output_filename &lt;- category %&gt;% \n    gsub(\"-\", \"_\", .) %&gt;%\n    gsub(\" \", \"\", .) %&gt;%\n    gsub(\"'\", \"\", .) %&gt;%\n    paste0(\".tif\")\n  writeRaster(output, here(output_path, output_filename), overwrite = T)\n  habitats_df &lt;- data.frame(\n    path = here(output_path, output_filename),\n    filename = output_filename,\n    name = category,\n    weight = 1.0,\n    category = \"Terrestrial\",\n    source = \"MVSEI\",\n    notes = mvsei_secl_codes[mvsei_secl_codes$code == category, \"description\"]\n  ) %&gt;%\n    bind_rows(habitats_df)\n}\n\n# Metro Vancouver SEI for coastal areas - intertidal (IT), herbaceous (HB)\nbowen_sei_no_tem &lt;- bowen_sei %&gt;%\n  filter(!ProjType == \"TEM\" & !ProjType == \"NEM\") %&gt;%\n  # Remove polygons with SECl x__, because these are lost ecosystem areas \n  filter(!SECl_1 %in% c(\"xRI\", \"xWD\", \"xMF\")) %&gt;%\n  # Remove polygons with these SEsubcl, since represented elsewhere\n  # co conifer dominated\n  # ff riparian fringe\n  # sp swamp\n  # sw shallow water\n  # mx mixed confider broadleaf\n  filter(!SEsubcl_1 %in% c(\"co\", \"ff\", \"sp\", \"sw\", \"mx\")) \n\nbowen_sei_no_tem_categories &lt;- bowen_sei_no_tem$SEsubcl_1 %&gt;% unique()\nfor(category in bowen_sei_no_tem_categories) {\n  output &lt;- bowen_sei_no_tem[bowen_sei_no_tem$SEsubcl_1 == category,] %&gt;%\n    bowen_rasterize()\n  output_filename &lt;- category %&gt;% \n    gsub(\"-\", \"_\", .) %&gt;%\n    gsub(\" \", \"\", .) %&gt;%\n    gsub(\"'\", \"\", .) %&gt;%\n    paste0(\".tif\")\n  writeRaster(output, here(output_path, output_filename), overwrite = T)\n  habitats_df &lt;- data.frame(\n    path = here(output_path, output_filename),\n    filename = output_filename,\n    name = category,\n    weight = 1.0,\n    category = \"Terrestrial\",\n    source = \"MVSEI\",\n    notes = mvsei_sesubcl_codes[mvsei_sesubcl_codes$SEsubcl == category, \"description\"]\n  ) %&gt;%\n    bind_rows(habitats_df)\n}",
    "crumbs": [
      "Conservation Layers",
      "Conservation Layer: Habitats"
    ]
  },
  {
    "objectID": "vignettes/input_habitats.html#bowen-heron-watch",
    "href": "vignettes/input_habitats.html#bowen-heron-watch",
    "title": "Conservation Layer: Habitats",
    "section": "Bowen Heron Watch",
    "text": "Bowen Heron Watch\nData on Heron and Raptor nest sites on Bowen Island from Carla Skuce on Feb 4 2025.\nChallenges: - No common ID between Excel spreadsheet and shapefile point locations\nAddressed by manually looking up location description on Google Maps and matching to points in QGIS. For some points, I created new points that matched the location description. I figured at the 100 m resolution that we are working with, the precise location would not be that necessary.\n\n\nCode\n#### Heron Nests ####\n# This geopackage was created in QGIS with manual matching between excel spreadsheet and shapefile provided from Bowen Heron Watch\nbowen_heron_watch &lt;- st_read(here(\"data-raw/bowen_heron_watch/bowen_heron_watch.gpkg\")) \n#&gt; Reading layer `heronnest' from data source \n#&gt;   `/home/jay/Programming_Projects/bowen.biodiversity.webapp/data-raw/bowen_heron_watch/bowen_heron_watch.gpkg' \n#&gt;   using driver `GPKG'\n#&gt; Simple feature collection with 17 features and 31 fields\n#&gt; Geometry type: POINT\n#&gt; Dimension:     XY\n#&gt; Bounding box:  xmin: -13739170 ymin: 6335327 xmax: -13729030 ymax: 6343408\n#&gt; Projected CRS: WGS 84 / Pseudo-Mercator\n# Replace NAs\nbowen_heron_watch[is.na(bowen_heron_watch)] &lt;- 0 \nbowen_heron_watch$bowen_heron_watch_2018 &lt;- as.numeric(bowen_heron_watch$bowen_heron_watch_2018)\n# Summarize - total nests all time\nbowen_heron_watch$total &lt;- bowen_heron_watch[,6:31] %&gt;%\n  st_drop_geometry() %&gt;%\n  rowSums()\n# Rasterize the heron sites \nbowen_heron_nest_rast &lt;- bowen_heron_watch %&gt;%\n  vect() %&gt;% \n  project(bowen_island_mask) %&gt;%\n  rasterize(bowen_island_mask, field = \"total\", fun = sum, cover = T, touches = T) \nplot(bowen_heron_nest_rast)\n\n\n\n\n\n\n\n\n\nCode\nwriteRaster(bowen_heron_nest_rast, here(output_path, \"bowen_heron_nest.tif\"), overwrite = T)\nhabitats_df &lt;- data.frame(\n    path = here(output_path, \"bowen_heron_nest.tif\"),\n    filename = \"bowen_heron_nest.tif\",\n    name = \"Heron Nests\",\n    weight = 1.0,\n    category = \"Bird Nesting Site\",\n    source = \"Bowen Heron Watch\",\n    notes = \"Heron Nests\"\n  ) %&gt;%\n    bind_rows(habitats_df)\n\n#### Raptor Nests ####\nbowen_raptor_watch_rast &lt;- st_read(here(\"data-raw/bowen_heron_watch/2025_01_30_bowen_heron_watch/RaptorNest.shp\")) %&gt;%\n  vect() %&gt;%\n  project(bowen_island_mask) %&gt;%\n  rasterize(bowen_island_mask, cover = T, touches = T) \n#&gt; Reading layer `RaptorNest' from data source \n#&gt;   `/home/jay/Programming_Projects/bowen.biodiversity.webapp/data-raw/bowen_heron_watch/2025_01_30_bowen_heron_watch/RaptorNest.shp' \n#&gt;   using driver `ESRI Shapefile'\n#&gt; Simple feature collection with 14 features and 10 fields\n#&gt; Geometry type: POINT\n#&gt; Dimension:     XY\n#&gt; Bounding box:  xmin: -13738410 ymin: 6331978 xmax: -13727110 ymax: 6345503\n#&gt; Projected CRS: WGS 84 / Pseudo-Mercator\nplot(bowen_raptor_watch_rast)\n\n\n\n\n\n\n\n\n\nCode\nwriteRaster(bowen_raptor_watch_rast, here(output_path, \"bowen_raptor_nest.tif\"), overwrite = T)\nhabitats_df &lt;- data.frame(\n    path = here(output_path, \"bowen_raptor_nest.tif\"),\n    filename = \"bowen_raptor_nest.tif\",\n    name = \"Raptor Nests\",\n    weight = 1.0,\n    category = \"Bird Nesting Site\",\n    source = \"Bowen Heron Watch\",\n    notes = \"Raptor Nests\"\n  ) %&gt;%\n    bind_rows(habitats_df)",
    "crumbs": [
      "Conservation Layers",
      "Conservation Layer: Habitats"
    ]
  },
  {
    "objectID": "vignettes/input_habitats.html#human-disturbance",
    "href": "vignettes/input_habitats.html#human-disturbance",
    "title": "Conservation Layer: Habitats",
    "section": "Human Disturbance",
    "text": "Human Disturbance\nWe followed the methods from Arias-Patino et al. (2024) for the human disturbance layers included in the analyses. Pressures included urban areas, buildings, population density, roads, railways, navigable waterways, transmission lines, seismic lines, pipelines, mining, dams and reservoirs, oil and gas infrastructure, agriculture, pastures, forest harvesting, and recreation features. We reclassified the human disturbance raster into four levels based on intensity of disturbance: intact, low disturbance, medium disturbance, and high disturbance. We then normalized and inverted the values to prepare the disturbance data for input into Zonation, ensuring that areas with less disturbance correspond to higher values on a 0-1 scale.\n\n\nCode\n#### Human Disturbance #### \n# Contents of \"data-raw/human_disturbance/\" received from Miguel Arias Patino (marias@unbc.ca)\n# https://1sfu.sharepoint.com/:f:/r/teams/Cumulativeeffects-SFUTeams9/Shared%20Documents/General/BC%20Hydro%202025%20IRP/Environmental%20Layers/Human%20Footprint?csf=1&web=1&e=hUYDs7 \n# Thesis (methods): https://unbc.arcabc.ca/islandora/object/unbc%3A59107\n# Paper (methods): https://doi.org/10.1016/j.ecolind.2024.112407 \n# Paper (methods): https://doi.org/10.1139/facets-2021-0063  \ndisturb_path &lt;- here(\"data-raw/human_disturbance/human_footprint_30m_v2.tif\")\ndisturb &lt;- terra::rast(disturb_path)\n# Load Bowen Island Mask Created Previously\nbowen_island_mask &lt;- here(\"inst/extdata/bowen_mask.tif\") %&gt;%\n  rast()\n#### Resample Raster to Bowen Island ####\ndisturb_resamp &lt;- terra::resample(disturb, bowen_island_mask)\nwriteRaster(disturb_resamp, \n            here::here(output_path, \"bowen_human_footprint.tif\"), \n            overwrite=TRUE)\nhabitats_df &lt;- data.frame(\n    path = here(output_path, \"bowen_human_footprint.tif\"),\n    filename = \"bowen_human_footprint.tif\",\n    name = \"Human Disturbance\",\n    weight = 0,\n    category = \"Human Disturbance\",\n    source = \"Miguel Arias Patino (marias@unbc.ca)\",\n    notes = \"Original human disturbance layer\"\n  ) %&gt;%\n    bind_rows(habitats_df)\n#### Reclassify Raster to Intact, Low, Medium, High ####\n# https://www.facetsjournal.com/doi/10.1139/facets-2021-0063#sec-2 \n# Intact is 0 to 1 \n# Low disturbance is 1 to 4\n# Medium disturbance is 4 to 10\n# High disturbance is 10+ \n# Maximum theoretical value is 66\ndisturb_m &lt;- c(0, 1, 0,\n       1, 4, 1,\n       4, 10, 2,\n       10, 100, 3) %&gt;%\n  matrix(ncol = 3, byrow = T)\n# Reclassify disturbance to levels\ndisturb_recl &lt;- disturb_resamp %&gt;%\n  classify(disturb_m, include.lowest = T)\nwriteRaster(disturb_recl, \n            here::here(output_path, \"bowen_human_footprint_recl.tif\"), \n            overwrite=TRUE)\nhabitats_df &lt;- data.frame(\n    path = here(output_path, \"bowen_human_footprint_recl.tif\"),\n    filename = \"bowen_human_footprint_recl.tif\",\n    name = \"Classified Human Disturbance\",\n    weight = 0,\n    category = \"Human Disturbance\",\n    source = \"Miguel Arias Patino (marias@unbc.ca)\",\n    notes = \"Reclassified to Low Medium High disturbance\"\n  ) %&gt;%\n    bind_rows(habitats_df)\n#### Inverse Disturbance ####\n#' Normalize on 0 to 1 scale\nnormalize &lt;- function(input_rast) {\n  mm &lt;- minmax(input_rast)\n  min &lt;- mm[1]\n  max &lt;- mm[2]\n  normalized &lt;- (input_rast - min) / (max - min)\n}\n#' Invert raster, so max values are min and vice versa. \ninvert &lt;- function(input_rast) {\n  mm &lt;- minmax(input_rast)\n  max &lt;- mm[2]\n  inverted &lt;- max - input_rast \n}\n# Normalize and invert the disturbance, so its positive as Zonation input\ndisturb_inv &lt;- disturb_resamp %&gt;% \n  normalize() %&gt;%\n  invert()\nwriteRaster(disturb_inv, here(output_path,\"bowen_human_footprint_inv.tif\"), overwrite=TRUE)\nhabitats_df &lt;- data.frame(\n    path = here(output_path, \"bowen_human_footprint_inv.tif\"),\n    filename = \"bowen_human_footprint_inv.tif\",\n    name = \"Inverse Human Disturbance\",\n    weight = 1.0,\n    category = \"Human Disturbance\",\n    source = \"Miguel Arias Patino (marias@unbc.ca)\",\n    notes = \"Inverse with low values describing high disturbance and vice versa, use for zonation\"\n  ) %&gt;%\n    bind_rows(habitats_df)",
    "crumbs": [
      "Conservation Layers",
      "Conservation Layer: Habitats"
    ]
  },
  {
    "objectID": "vignettes/input_habitats.html#save-habitat-weights",
    "href": "vignettes/input_habitats.html#save-habitat-weights",
    "title": "Conservation Layer: Habitats",
    "section": "Save Habitat Weights",
    "text": "Save Habitat Weights\n\n\nCode\n# Save to CSV\nwrite.csv(habitats_df, here(output_path, paste0(Sys.Date(),\"_habitats.csv\")))\n# Save to Google Sheets\nhabitats_url &lt;- \"https://docs.google.com/spreadsheets/d/1yDKw4r3tbXYivwtxbbfxc-pYSbtbj_o2ee1pwlNCOO4/edit?usp=drive_link\"\nwrite_sheet(\n  habitats_df,\n  habitats_url,\n  sheet = as.character(Sys.Date())\n)\n#&gt; ℹ Suitable tokens found in the cache, associated with these emails:\n#&gt; • 'hello@jmatsushiba.com'\n#&gt; • 'palenlab@gmail.com'\n#&gt;   Defaulting to the first email.\n#&gt; ! Using an auto-discovered, cached token.\n#&gt;   To suppress this message, modify your code or options to clearly consent to\n#&gt;   the use of a cached token.\n#&gt;   See gargle's \"Non-interactive auth\" vignette for more details:\n#&gt;   &lt;https://gargle.r-lib.org/articles/non-interactive-auth.html&gt;\n#&gt; ℹ The googlesheets4 package is using a cached token for\n#&gt;   'hello@jmatsushiba.com'.\n#&gt; ✔ Writing to \"habitats\".\n#&gt; ✔ Writing to sheet '2025-04-25'.",
    "crumbs": [
      "Conservation Layers",
      "Conservation Layer: Habitats"
    ]
  },
  {
    "objectID": "vignettes/input_habitats.html#exploring-habitat-rasters",
    "href": "vignettes/input_habitats.html#exploring-habitat-rasters",
    "title": "Conservation Layer: Habitats",
    "section": "Exploring Habitat Rasters",
    "text": "Exploring Habitat Rasters\n\n\nCode\nleaflet(width = \"100%\", height = \"800px\") %&gt;%\n  addProviderTiles(provider = providers$Stadia.AlidadeSmooth) %&gt;%\n  addRasterImage(x = wetlands_aw_rast, group = \"A. Whitehead Wetlands\", colors = \"lightgreen\") %&gt;%\n  addRasterImage(x = bowen_sei_wn_1_rast, group = \"Bowen SEI SECl_1 Wetlands\", colors = \"green\") %&gt;%\n  addRasterImage(x = bowen_sei_wn_2_rast, group = \"Bowen SEI SECl_2 Wetlands\", colors = \"darkgreen\") %&gt;%\n  addRasterImage(x = bowen_sei_ri_rast, group = \"Bowen SEI Riparian\", colors = \"lightblue\") %&gt;%\n  addRasterImage(x = bowen_sei_fw_la_rast, group = \"Bowen SEI Freshwater Lakes\", colors = \"darkblue\") %&gt;%\n  addRasterImage(x = ponds_aw_rast, group = \"A. Whitehead Freshwater Ponds\", colors = \"blue\") %&gt;%\n  # addPolygons(data = bowen_sei_fw_pd, label = \"Bowen SEI ponds\") %&gt;%\n  # addPolygons(data = ponds_aw, label = \"A. Whitehead ponds\") %&gt;%\n  addRasterImage(x = streams_rast, group = \"A. Whitehead Streams\") %&gt;%\n  addLayersControl(overlayGroups = c(\"A. Whitehead Wetlands\", \n                                     \"Bowen SEI SECl_1 Wetlands\", \n                                     \"Bowen SEI SECl_2 Wetlands\", \n                                     \"Bowen SEI Riparian\", \n                                     \"Bowen SEI Freshwater Lakes\", \n                                     \"Bowen SEI + A. Whitehead Freshwater Ponds\", \n                                     \"A. Whitehead Streams\"\n                                     ),\n                   options = layersControlOptions(collapsed = F))",
    "crumbs": [
      "Conservation Layers",
      "Conservation Layer: Habitats"
    ]
  },
  {
    "objectID": "vignettes/output_zonation_24_04_2025.html",
    "href": "vignettes/output_zonation_24_04_2025.html",
    "title": "Conservation Prioritization April 24 2025 Update",
    "section": "",
    "text": "This Rmarkdown documents the Zonation run used for the April 24 2025 iteration for Bowen Island Biodiversity Planning.\nhttps://github.com/zonationteam/Zonation5\n\n\nCode\n#### Palen Lab Packages ####\nlibrary(bowen.biodiversity.webapp)\n\n#### Other Packages ####\nlibrary(here)\n#&gt; here() starts at /home/jay/Programming_Projects/bowen.biodiversity.webapp\nlibrary(dplyr)\n#&gt; \n#&gt; Attaching package: 'dplyr'\n#&gt; The following objects are masked from 'package:stats':\n#&gt; \n#&gt;     filter, lag\n#&gt; The following objects are masked from 'package:base':\n#&gt; \n#&gt;     intersect, setdiff, setequal, union\nlibrary(stringr)\nlibrary(foreach)\nlibrary(sf)\n#&gt; Linking to GEOS 3.11.1, GDAL 3.6.4, PROJ 9.1.1; sf_use_s2() is TRUE\nlibrary(terra)\n#&gt; terra 1.8.5\nlibrary(tidyterra)\n#&gt; \n#&gt; Attaching package: 'tidyterra'\n#&gt; The following object is masked from 'package:stats':\n#&gt; \n#&gt;     filter\nlibrary(readxl)\nlibrary(googlesheets4)\n\nsdm_url &lt;- \"https://docs.google.com/spreadsheets/d/1IGFwkr9LidcZwbzOJJGSEXLsmpKp0a9gBs65EY-H1xw/edit?usp=sharing\"\nhabitats_url &lt;- \"https://docs.google.com/spreadsheets/d/1yDKw4r3tbXYivwtxbbfxc-pYSbtbj_o2ee1pwlNCOO4/edit?usp=drive_link\"\n\n\n\n\n\nZonation 5 is a spatial prioritization software that can be used to identify priority areas to support conservation planning, land use planning, ecological impact avoidance and other similar tasks. The software uses spatial raster data on the distributions of individual biodiversity features (species, habitats, ecosystem services etc.) to identify which locations in a landscape are most important for retaining biodiversity. Zonation can account for local habitat quality and ecological connectivity together with costs, threats and different land tenure, thus providing a quantitative method for spatial planning that enhances the persistence of biodiversity in the long term.\n\nhttps://zonationteam.github.io/Zonation5/\nWe took all of the rasters prepared earlier and fed these into the Zonation 5 software. This should provide a relative ranking for locations from highest to lowest for the purposes of biodiversity conservation.\nNote: Zonation 5 is usually a standalone application. Here, I have enabled running of Zonation from R, using command line functions. This way we can adjust and automatically run Zonation, reading from data in R.\n\n\nCode\n#### CREATE DATAFRAME FOR INPUT LAYERS ####\n# Read from Google Sheets\nhabitats_df &lt;- read_sheet(habitats_url, sheet = \"2025-04-24\") \n#&gt; ℹ Suitable tokens found in the cache, associated with these emails:\n#&gt; • 'hello@jmatsushiba.com'\n#&gt; • 'palenlab@gmail.com'\n#&gt;   Defaulting to the first email.\n#&gt; ! Using an auto-discovered, cached token.\n#&gt;   To suppress this message, modify your code or options to clearly consent to\n#&gt;   the use of a cached token.\n#&gt;   See gargle's \"Non-interactive auth\" vignette for more details:\n#&gt;   &lt;https://gargle.r-lib.org/articles/non-interactive-auth.html&gt;\n#&gt; ℹ The googlesheets4 package is using a cached token for\n#&gt;   'hello@jmatsushiba.com'.\n#&gt; ✔ Reading from \"habitats\".\n#&gt; ✔ Range ''2025-04-24''.\nhabitats_df$weight &lt;- habitats_df$weight / nrow(habitats_df)\nsdm_df &lt;- read_sheet(sdm_url, sheet = \"2025-04-24\") %&gt;%\n  select(colnames(habitats_df)) # Select common columns\n#&gt; ✔ Reading from \"sdm\".\n#&gt; ✔ Range ''2025-04-24''.\nsdm_df$weight &lt;- sdm_df$weight / nrow(sdm_df)\n# Bind all input layers together\nlayers_df &lt;- bind_rows(habitats_df, sdm_df) %&gt;%\n  filter(weight &gt; 0)\n\n#### UPDATE features.txt FOR ZONATION RUN ####\n# UPDATE features.txt from files available in data\nfeatures_path &lt;- here(\"vignettes/zonation/features.txt\")\ncat('\"weight\" \"filename\"', \n    file = features_path,\n    sep = \"\\n\")\nfor(i in 1:nrow(layers_df)) {\n  next_row &lt;- paste0(layers_df[i, \"weight\"], \" \", layers_df[i, \"path\"])\n  cat(next_row,\n      file = features_path,\n      append = TRUE,\n      sep = \"\\n\")\n}\n#### SET PARAMS FOR ZONATION RUN ####\nzonation5_location &lt;- here(\"vignettes/zonation/zonation5\") \nzonation5_mode &lt;- \"CAZ2\"\n# Zonation5 Setting Text File\nzonation5_settings &lt;-  here(\"vignettes/zonation/settings.z5\")\nzonation5_settings_txt &lt;- c(\"feature list file = features.txt\", \n                            paste0(\"analysis area mask layer = \", here(\"inst/extdata/bowen_mask.tif\"))) # Add Bowen Island Mask\nwriteLines(zonation5_settings_txt, zonation5_settings)\nzonation5_output &lt;- here(\"vignettes/zonation/output\") \nzonation5_command &lt;- str_glue(\n  '{zonation5_location} -a -w --mode={zonation5_mode} {zonation5_settings} {zonation5_output}',\n  zonation5_location = zonation5_location,\n  zonation5_mode = zonation5_mode,\n  zonation5_settings = zonation5_settings,\n  zonation5_output = zonation5_output\n) %&gt;%\n  str_c()\n#### ZONATION RUN ####\nsystem(command = zonation5_command)\n\n#### Save Zonation Run #### \noutput_dir &lt;- here(\"inst/extdata/output_zonation\", Sys.Date())\ndir.create(output_dir)\nfile.copy(list.files(here(\"vignettes/zonation/output\"), full.names = T, recursive = T),\n          output_dir,\n          recursive = T)\n#&gt;  [1] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE\n\n\n\n\n\n\n\nCode\n#### VISUALIZE OUTPUT ####\nrankmap &lt;- here(output_dir , \"rankmap.tif\") %&gt;% rast()\nplot(rankmap)",
    "crumbs": [
      "Zonation",
      "Conservation Prioritization April 24 2025 Update"
    ]
  },
  {
    "objectID": "vignettes/output_zonation_24_04_2025.html#zonation",
    "href": "vignettes/output_zonation_24_04_2025.html#zonation",
    "title": "Conservation Prioritization April 24 2025 Update",
    "section": "",
    "text": "Zonation 5 is a spatial prioritization software that can be used to identify priority areas to support conservation planning, land use planning, ecological impact avoidance and other similar tasks. The software uses spatial raster data on the distributions of individual biodiversity features (species, habitats, ecosystem services etc.) to identify which locations in a landscape are most important for retaining biodiversity. Zonation can account for local habitat quality and ecological connectivity together with costs, threats and different land tenure, thus providing a quantitative method for spatial planning that enhances the persistence of biodiversity in the long term.\n\nhttps://zonationteam.github.io/Zonation5/\nWe took all of the rasters prepared earlier and fed these into the Zonation 5 software. This should provide a relative ranking for locations from highest to lowest for the purposes of biodiversity conservation.\nNote: Zonation 5 is usually a standalone application. Here, I have enabled running of Zonation from R, using command line functions. This way we can adjust and automatically run Zonation, reading from data in R.\n\n\nCode\n#### CREATE DATAFRAME FOR INPUT LAYERS ####\n# Read from Google Sheets\nhabitats_df &lt;- read_sheet(habitats_url, sheet = \"2025-04-24\") \n#&gt; ℹ Suitable tokens found in the cache, associated with these emails:\n#&gt; • 'hello@jmatsushiba.com'\n#&gt; • 'palenlab@gmail.com'\n#&gt;   Defaulting to the first email.\n#&gt; ! Using an auto-discovered, cached token.\n#&gt;   To suppress this message, modify your code or options to clearly consent to\n#&gt;   the use of a cached token.\n#&gt;   See gargle's \"Non-interactive auth\" vignette for more details:\n#&gt;   &lt;https://gargle.r-lib.org/articles/non-interactive-auth.html&gt;\n#&gt; ℹ The googlesheets4 package is using a cached token for\n#&gt;   'hello@jmatsushiba.com'.\n#&gt; ✔ Reading from \"habitats\".\n#&gt; ✔ Range ''2025-04-24''.\nhabitats_df$weight &lt;- habitats_df$weight / nrow(habitats_df)\nsdm_df &lt;- read_sheet(sdm_url, sheet = \"2025-04-24\") %&gt;%\n  select(colnames(habitats_df)) # Select common columns\n#&gt; ✔ Reading from \"sdm\".\n#&gt; ✔ Range ''2025-04-24''.\nsdm_df$weight &lt;- sdm_df$weight / nrow(sdm_df)\n# Bind all input layers together\nlayers_df &lt;- bind_rows(habitats_df, sdm_df) %&gt;%\n  filter(weight &gt; 0)\n\n#### UPDATE features.txt FOR ZONATION RUN ####\n# UPDATE features.txt from files available in data\nfeatures_path &lt;- here(\"vignettes/zonation/features.txt\")\ncat('\"weight\" \"filename\"', \n    file = features_path,\n    sep = \"\\n\")\nfor(i in 1:nrow(layers_df)) {\n  next_row &lt;- paste0(layers_df[i, \"weight\"], \" \", layers_df[i, \"path\"])\n  cat(next_row,\n      file = features_path,\n      append = TRUE,\n      sep = \"\\n\")\n}\n#### SET PARAMS FOR ZONATION RUN ####\nzonation5_location &lt;- here(\"vignettes/zonation/zonation5\") \nzonation5_mode &lt;- \"CAZ2\"\n# Zonation5 Setting Text File\nzonation5_settings &lt;-  here(\"vignettes/zonation/settings.z5\")\nzonation5_settings_txt &lt;- c(\"feature list file = features.txt\", \n                            paste0(\"analysis area mask layer = \", here(\"inst/extdata/bowen_mask.tif\"))) # Add Bowen Island Mask\nwriteLines(zonation5_settings_txt, zonation5_settings)\nzonation5_output &lt;- here(\"vignettes/zonation/output\") \nzonation5_command &lt;- str_glue(\n  '{zonation5_location} -a -w --mode={zonation5_mode} {zonation5_settings} {zonation5_output}',\n  zonation5_location = zonation5_location,\n  zonation5_mode = zonation5_mode,\n  zonation5_settings = zonation5_settings,\n  zonation5_output = zonation5_output\n) %&gt;%\n  str_c()\n#### ZONATION RUN ####\nsystem(command = zonation5_command)\n\n#### Save Zonation Run #### \noutput_dir &lt;- here(\"inst/extdata/output_zonation\", Sys.Date())\ndir.create(output_dir)\nfile.copy(list.files(here(\"vignettes/zonation/output\"), full.names = T, recursive = T),\n          output_dir,\n          recursive = T)\n#&gt;  [1] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE",
    "crumbs": [
      "Zonation",
      "Conservation Prioritization April 24 2025 Update"
    ]
  },
  {
    "objectID": "vignettes/output_zonation_24_04_2025.html#output",
    "href": "vignettes/output_zonation_24_04_2025.html#output",
    "title": "Conservation Prioritization April 24 2025 Update",
    "section": "",
    "text": "Code\n#### VISUALIZE OUTPUT ####\nrankmap &lt;- here(output_dir , \"rankmap.tif\") %&gt;% rast()\nplot(rankmap)",
    "crumbs": [
      "Zonation",
      "Conservation Prioritization April 24 2025 Update"
    ]
  },
  {
    "objectID": "vignettes/output_zonation_01_02_2025.html",
    "href": "vignettes/output_zonation_01_02_2025.html",
    "title": "Conservation Prioritization for February 1st Bowen Island Workshop",
    "section": "",
    "text": "This Rmarkdown documents the Zonation run used for the initial February 1st, 2025 Bowen Island Workshop on Biodiversity Planning.\nhttps://github.com/zonationteam/Zonation5\n\n\nCode\n#### Palen Lab Packages ####\nlibrary(bowen.biodiversity.webapp)\n#remotes::install_github(\"Palen-Lab/sdmcsr\")\nlibrary(sdmcsr) # SDM congruence functions with iNaturalist observations\n#remotes::install_github(\"Palen-Lab/rinat\") # Fork by Jay Matsushiba\nlibrary(rinat) \n\n#### Other Packages ####\nlibrary(here)\n#&gt; here() starts at /home/jay/Programming_Projects/bowen.biodiversity.webapp\nlibrary(dplyr)\n#&gt; \n#&gt; Attaching package: 'dplyr'\n#&gt; The following objects are masked from 'package:stats':\n#&gt; \n#&gt;     filter, lag\n#&gt; The following objects are masked from 'package:base':\n#&gt; \n#&gt;     intersect, setdiff, setequal, union\nlibrary(stringr)\nlibrary(foreach)\nlibrary(sf)\n#&gt; Linking to GEOS 3.11.1, GDAL 3.6.4, PROJ 9.1.1; sf_use_s2() is TRUE\nlibrary(terra)\n#&gt; terra 1.8.5\nlibrary(tidyterra)\n#&gt; \n#&gt; Attaching package: 'tidyterra'\n#&gt; The following object is masked from 'package:stats':\n#&gt; \n#&gt;     filter\nlibrary(readxl)\nlibrary(googlesheets4)\n\n#### Common Objects Across Analyses ####\n# Defining CRS to make sure all SDMs have the same\nsdm_crs &lt;- \"+proj=aea +lat_0=45 +lon_0=-126 +lat_1=50 +lat_2=58.5 +x_0=1000000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs\"\n# Bowen Island Administrative Boundary (from Metro Vancouver)\nbowen_island_admin &lt;- vect(bowen.biodiversity.webapp::bowen_boundary) %&gt;%\n  project(sdm_crs)\n\n\n\n\n\n\nRaw data (temp files) into data-raw and added to data-raw/.gitignore Save finished outputs (as used by the application) into inst/extdata - Convention is to save files that are not .rda into this folder (https://rstudio.github.io/r-manuals/r-exts/Creating-R-packages.html#data-in-packages)\n\n\n\nThe species distribution models (SDMs) included in the Bowen Island Conservation Plan analyses were originally produced by Viorel Popescu (Popescu et al., 2020). Out of the 341 SDMs available, we included 193 of the SDMs. Occurrence locations of small vertebrate species were gathered from Global Biodiversity Information Facility (data.gbif.org) and Nature Counts (birdscanada.org/birdmon) open-access databases. Inclusion of small mammal species was based on Appendix 2 & 3 from the 2005 Environmental Inventory report, which states species presence on Bowen Island. We used the iNaturalist and eBird databases of observations for the inclusion criteria for reptiles, amphibians, and birds (described in further detail in Methods).\n\n\nCode\n#### SPECIES DISTRIBUTION MODELS ####\n# Contents of \"data-raw/species_distribution_models/\" downloaded from Cumulative effects - SFU Teams Sharepoint \n# https://1sfu.sharepoint.com/:f:/r/teams/Cumulativeeffects-SFUTeams9/Shared%20Documents/BCH_project_backup/SPECIES?csf=1&web=1&e=FpNkgc \n# Directory Path: BCH_project_backup/SPECIES/\n# Paper: https://www.nature.com/articles/s41598-020-64501-7#MOESM1\n# See Wendy Palen (SFU) for access \n#### PROCESSING SDM ####\n# Get list of available SDMs\nsdm_folder &lt;- here(\"data-raw/species_distribution_models\")\nsdm_folder_tif &lt;- list.files(sdm_folder, recursive = T, pattern = \"*.tif$\") # Get only .tif files\n# Correspondence with Viorel Popescu confirms that _NAs_ should be SDMs with rock, ice, large lakes layers masked\nsdm_folder_tif_NAs &lt;- sdm_folder_tif[grepl(\"_NAs_\", sdm_folder_tif)] # Get only .tif with \"_NAs_\" in filename\n# Directory to save SDMs\nsdm_output_dir &lt;- here(\"inst/extdata/species_distribution_models_bowen\")\nif(!dir.exists(sdm_output_dir)) {\n  dir.create(sdm_output_dir)\n}\n# Create Bowen Island mask using DSM\nsample_sdm &lt;- rast(here(sdm_folder, sdm_folder_tif_NAs[1])) %&gt;%\n  terra::project(y = sdm_crs) %&gt;%\n  terra::crop(bowen_island_admin, snap = \"out\") %&gt;%\n  terra::disagg(fact = 4)\ndsm &lt;- rast(here(\"data-raw/bowen_dsm/chm.tif\"))\ndsm_smooth &lt;- dsm %&gt;% \n  focal(w=9, fun=mean, na.policy=\"only\", na.rm=T) %&gt;% \n  terra::project(y = sdm_crs) %&gt;%\n  terra::resample(sample_sdm, method = \"average\")\nm &lt;- c(-1, 35, 1) %&gt;% matrix(ncol = 3, byrow=T)\nbowen_island_mask &lt;- dsm_smooth %&gt;% \n  classify(m) %&gt;%\n  as.int()\nwriteRaster(bowen_island_mask, here(\"inst/extdata/bowen_mask.tif\"), overwrite = T)\n# Weights for terra::focal() function that provides moving window average\n# - Smoothing algorithm \n# - Use this to fill some empty cells on Bowen Island with weighted mean of the neighbouring cells.\nweights &lt;- matrix(c(0, 0, 1, 1, 1, 0, 0,\n                    0, 1, 1, 2, 1, 1, 0,\n                    1, 1, 3, 3, 3, 1, 1,\n                    1, 2, 3, 5, 3, 2, 1,\n                    1, 1, 3, 3, 3, 1, 1,\n                    0, 1, 1, 2, 1, 1, 0,\n                    0, 0, 1, 1, 1, 0, 0\n), nrow=7)\n#### PREPARE SDMs TO BOWEN ISLAND ####\n# Loop through SDMs\nforeach(sdm_tif = sdm_folder_tif_NAs) %do% {\n  sdm_path &lt;- here(sdm_folder, sdm_tif) \n  sdm_output_path &lt;- here(sdm_output_dir, basename(sdm_tif))\n  sdm &lt;- rast(sdm_path)\n  # Normalize SDMs that range from 0 to 1000\n  sdm_minmax &lt;- terra::minmax(sdm)\n  if(sdm_minmax[2] &gt; 1) {\n    sdm &lt;- sdm / 1000\n  }\n  sdm_output &lt;- sdm %&gt;%\n    #### Reproject SDM ####\n    terra::project(y = sdm_crs) %&gt;%\n    #### Crop SDM ####\n    # Figured out why the SDMs were cropped incorrectly\n    # The default for cropping a raster by a polygon is to snap = \"near\"\n    # This means that the polygon extent is snapped to the closest raster\n    # We need snap = \"out\" to make sure the full extent of the polygon is covered by the output raster\n    terra::crop(bowen_island_admin, snap = \"out\") %&gt;%\n    #### Extrapolate for Southern Parts of Bowen Island\n    # - fills the NA values missing in south part of Bowen Island\n    terra::focal(w = weights,\n                 fun = \"mean\",\n                 na.policy = \"only\") %&gt;%\n    #### Downsamples ####\n    # - from 400 m to 100 m resolution\n    terra::disagg(fact = 4) %&gt;%\n    #### Smooths the raster ####\n    terra::focal(w = weights,\n                 fun = \"mean\",\n                 na.rm = T,\n                 na.policy = \"omit\") %&gt;%\n    terra::mask(bowen_island_mask)\n  \n  writeRaster(sdm_output, sdm_output_path, overwrite = T)\n}\n# Create species list from available SDMs\nspecies_list &lt;- sdm_folder_tif_NAs %&gt;%\n  basename() %&gt;%\n  stringr::str_extract(\"^\\\\S+\\\\.[a-zA-Z]+_\") %&gt;%\n  stringr::str_remove(\"_\") %&gt;%\n  stringr::str_replace(\"\\\\.\", \" \")\n# Create taxon list \ntaxon_list &lt;- sdm_folder_tif_NAs %&gt;%\n  dirname() %&gt;%\n  str_remove(\"_mask\")\n# Get iNaturalist and SDM congruence\nsdm_inat &lt;- foreach(i = 1:length(species_list), .combine = \"rbind\") %do% {\n  # Progress Message \n  print(paste0(\"Currently working on species \", i, \" out of \", length(species_list),\". This is \", species_list[i], \".\"))\n  # Query iNaturalist by species name and Bowen Island Administrative Boundaries\n  rinat_results_sf &lt;- tryCatch({\n    Sys.sleep(3) # Need to slow down queries to prevent requests being blocked\n    rinat::get_inat_obs_sf(taxon_name = species_list[i],\n                           area = st_as_sf(bowen_island_admin),\n                           maxresults = 10000)\n  }, error = function(cond) {\n    NA\n  })\n  # Get number of iNaturalist observations\n  if(!is.data.frame(rinat_results_sf)) {\n    inat_n_obs &lt;- 0\n  } else {\n    inat_n_obs &lt;- nrow(rinat_results_sf)\n  }\n  # Get Bowen Island SDM\n  sdm &lt;- paste0(str_replace(species_list[i], \" \", \".\"), \"_NAs_pu_mask.tif\") %&gt;%\n    here(sdm_output_dir, .) %&gt;%\n    rast()\n  # Get highest value in SDM\n  sdm_max &lt;- sdm %&gt;% \n    minmax() %&gt;% \n    max()\n  # PREPARE OUTPUT ROW\n  # 1. scientific species name\n  # 2. highest SDM cell value within area \n  # 3. observation count from iNaturalist\n  result &lt;- data.frame(species = species_list[i],\n                       sdm_max_value = sdm_max,\n                       inat_n_obs = inat_n_obs)\n}\nsdm_inat$taxon_group &lt;- taxon_list\n#### Query eBird for birds ####\n# Number of eBird observations by bird species on Bowen Island\n# - Results from Natasha Beauregard (Summer 2024 USRA)\nbowen_ebird &lt;- read.csv(here(\"data-raw/bowen_ebird/final_bird.csv\")) %&gt;%\n  select(c(\"scientific_name\", \"n_ebird\"))\n# Combine eBird and iNaturalist counts\nbowen_SDM_iNat_ebird &lt;- merge(sdm_inat, \n                              bowen_ebird, \n                              by.x = \"species\", \n                              by.y = \"scientific_name\",\n                              all.x = TRUE) %&gt;%\n  rename(n_obs_inat = inat_n_obs,\n         n_obs_ebird = n_ebird) %&gt;%\n  select(\n    species,\n    sdm_max_value,\n    taxon_group,\n    n_obs_inat,\n    n_obs_ebird\n  )\n# Query Pottinger Report (2005) for small mammals\nbowen_mammals &lt;- read_xlsx(here(\"data-raw/pottinger_report/Appendix 2 - Expected Occurrence of Wildlife Species In The Cape Roger Curtis Area.xlsx\")) %&gt;%\n  filter(`Documented on Bowen` == \"y\" | `Documented on Bowen` == \"?\" | `Documented on Bowen` == \"One or more spp\" )\n# Include Species if they meet any of the following criteria:\n# - eBird observations &gt; 0\n# - iNaturalist observations &gt; 0\n# - included in Pottinger Report \ninclude_threshold &lt;- 0.5 # Min SDM cell value somewhere on Bowen Island for including species into focal list\nbowen_SDM_obs_focal_df &lt;- bowen_SDM_iNat_ebird %&gt;%\n  mutate(include = case_when(\n    (n_obs_inat &gt; 0 | n_obs_ebird &gt; 0 ) & sdm_max_value &gt; include_threshold ~ \"y\",\n    species %in% bowen_mammals$`Scientific name` ~ \"y\")\n  )\n# Create list of species names to include\nbowen_focal_list &lt;- bowen_SDM_obs_focal_df %&gt;%\n  filter(include == \"y\") %&gt;%\n  select(species) %&gt;%\n  unlist() %&gt;%\n  unname() \n# Get filepath for each SDM\nbowen_SDM_iNat_ebird$filepath &lt;- lapply(bowen_SDM_iNat_ebird$species, function(x) {paste0(str_replace(x, \" \", \".\"), \"_NAs_pu_mask.tif\")})\n# Add columns that can be adjusted manually\nbowen_SDM_iNat_ebird$prov_status &lt;- \"\"\nbowen_SDM_iNat_ebird$fed_status &lt;- \"\"\nbowen_SDM_iNat_ebird$IUCN_status &lt;- \"\"\nbowen_SDM_iNat_ebird$weights &lt;- 1.0\n# Dataframe for focal species on Bowen Island\nbowen_sdm_focal &lt;- bowen_SDM_iNat_ebird %&gt;%\n  filter(species %in% bowen_focal_list)\n#### UPLOAD ####\n# This sheet was uploaded to Google Sheets\n# WARNING: DO NOT RUN OR WILL OVERWRITE MANUAL INPUT TO GOOGLE SHEETS\n# write_sheet(bowen_sdm_focal,\n#             \"https://docs.google.com/spreadsheets/d/1ehO30w4i7EDafilNyRpq3sgc86fm8g_TmYMI4ql3qms/edit?usp=sharing\",\n#             \"species\")\nspecies_distribution_models_focal_bowen_info &lt;- bowen_sdm_focal\nsave(species_distribution_models_focal_bowen_info, file = here(\"inst/extdata/species_distribution_models_focal_bowen_info.rda\"))\n\n\n\n\nConservation statuses for species at the provincial, federal, and global levels were obtained from the BC Species & Ecosystems Explorer and the IUCN Red List. Provincial statuses followed the Red, Blue, and Yellow List classifications, while federal statuses were based on COSEWIC assessments where applicable. In cases of taxonomic discrepancies, species names were updated to reflect current classifications and documented accordingly.\nBC Species and Ecosystems Explorer: https://a100.gov.bc.ca/pub/eswp/ IUCN Red List: https://www.iucnredlist.org/\nThe spreadsheet below contains all of the information on species name, taxon group, threatened status, weights to use for Zonation.\nVisit this link to view the spreadsheet, hosted on Google Drive. https://docs.google.com/spreadsheets/d/1ehO30w4i7EDafilNyRpq3sgc86fm8g_TmYMI4ql3qms/edit?usp=sharing\n\n\nCode\nload(here(\"inst/extdata/species_distribution_models_focal_bowen_info.rda\"))\n#### REVISION ####\n# - This section necessary, since Google Sheet was uploaded at earlier time\n# - Changes since made to the creation of Bowen SDM Focal\n# - Michael Tylo (USRA Spring 2025) did the work in the Google Sheet\n# Manually look up species and correct taxonomy, add conservation status\nsdm_googlesheet &lt;- read_sheet(\"https://docs.google.com/spreadsheets/d/1ehO30w4i7EDafilNyRpq3sgc86fm8g_TmYMI4ql3qms/edit?usp=sharing\") %&gt;%\n  select(!c(\"full_path\", \"filename\"))\n# Drop duplicate columns, keep columns for n eBird and iNaturalist observations, max SDM values\nbowen_sdm_focal_sel &lt;- species_distribution_models_focal_bowen_info %&gt;%\n  select(!c(\"taxon_group\", \"prov_status\", \"fed_status\", \"IUCN_status\", \"weights\"))\n# Merge\nbowen_sdm_status &lt;- merge(bowen_sdm_focal_sel, sdm_googlesheet, by.x = \"species\", by.y = \"sci_name\", all.x = T) \nsave(bowen_sdm_status, file = here(\"inst/extdata/bowen_sdm_status.rda\"))\n\n\n\n\n\n\nWe derived Habitat Type layers from the Metro Vancouver Sensitive Ecosystem Inventory (MVSEI) mapping app. Data was downloaded from the Open Data Catalogue as a GeoPackage. Habitats were grouped into three main categories: water, vegetation, and intertidal.\nWater subcategories included riparian fringe, riparian gully, wetland shallow water, freshwater lake, freshwater pond, and wetland, with bog, fen, and swamp habitats grouped under wetland.\nFor vegetation, we generated habitat layers for herbaceous coastal, herbaceous vegetated shoreline, sparse vegetation rocky outcrop, woodland conifer, woodland mixed, young forest conifer, young forest mixed, as well as broader categories of mature forest and old forest.\nIntertidal habitat layers included mudflats, eelgrass beds, and beaches.\n\n\nCode\n#### Metro Vancouver Sensitive Ecosystems Inventory ####\n# Contents of \"data-raw/metrovancouver_sensitive_ecosystem_inventory/\" downloaded from MetroVancouver Open Data Catalogue\n# GeoPackage download: https://arcg.is/TnfXL \n# Reports download: https://metrovancouver.org/services/regional-planning/sensitive-ecosystem-inventory-mapping-app\nmvsei &lt;- st_read(here(\"data-raw/metrovancouver_sensitive_ecosystem_inventory/Sensitive_Ecosystem_Inventory_for_Metro_Vancouver__2020__-5580727563910851507.gpkg\")) %&gt;%\n  st_transform(crs = sdm_crs)\n#&gt; Reading layer `Sensitive_Ecosystem_Inventory_for_Metro_Vancouver__2020_' from data source `/home/jay/Programming_Projects/bowen.biodiversity.webapp/data-raw/metrovancouver_sensitive_ecosystem_inventory/Sensitive_Ecosystem_Inventory_for_Metro_Vancouver__2020__-5580727563910851507.gpkg' \n#&gt;   using driver `GPKG'\n#&gt; Simple feature collection with 25637 features and 99 fields\n#&gt; Geometry type: MULTIPOLYGON\n#&gt; Dimension:     XYZ\n#&gt; Bounding box:  xmin: 468516.6 ymin: 5427679 xmax: 547072.5 ymax: 5495732\n#&gt; z_range:       zmin: 0 zmax: 0\n#&gt; Projected CRS: NAD83 / UTM zone 10N\n# Create directory to save SEI rasters \nsei_dir &lt;- here(\"inst/extdata/bowen_sei_rasters\")\nif(!dir.exists(sei_dir)) {\n  dir.create(sei_dir)\n}\n# Load Bowen Island Mask Created Previously\nbowen_island_mask &lt;- here(\"inst/extdata/bowen_mask.tif\") %&gt;%\n  rast()\n# Bowen Island SEI \nbowen_sei &lt;- mvsei %&gt;% \n  st_intersection(st_as_sf(bowen_island_admin))\n#&gt; Warning: attribute variables are assumed to be spatially constant throughout\n#&gt; all geometries\n#### SEI sf Into spatRaster Function ####\nsei_raster_by_class &lt;- function(sei, SECl, SEsubcl = NA, mask) {\n  # Filter by SEI classes\n  if(!is.na(SEsubcl)) {\n    selected_sei &lt;- sei %&gt;%\n      filter(SECl_1 == SECl | SECl_2 == SECl) %&gt;%\n      filter(SEsubcl_1 == SEsubcl | SEsubcl_2 == SEsubcl)\n    sei_name &lt;- paste0(SECl, \"_\", SEsubcl)\n  } else {\n    selected_sei &lt;- sei %&gt;%\n      filter(SECl_1 == SECl | SECl_2 == SECl) \n    sei_name &lt;- SECl\n  }\n  output_rast &lt;- selected_sei %&gt;%\n    terra::vect() %&gt;% # Change to SpatVector for rasterization\n    terra::project(mask) %&gt;% # Reproject to the mask CRS\n    terra::rasterize(mask,\n                     touches = T,\n                     background = NA) # Rasterize to match mask, set background values to NA\n  names(output_rast) &lt;- sei_name\n  return(output_rast)\n}\n#### Running SEI Function to Create Habitat Layers ####\n#### WATER\n# RI ff (riparian fringe)\nRI_ff &lt;- sei_raster_by_class(sei = bowen_sei, SECl = \"RI\", SEsubcl = \"ff\", mask = bowen_island_mask)\n# RI gu (riparian gully)\nRI_gu &lt;- sei_raster_by_class(sei = bowen_sei, SECl = \"RI\", SEsubcl = \"gu\", mask = bowen_island_mask)\n# WN sw (wetland shallow water)\nWN_sw &lt;- sei_raster_by_class(sei = bowen_sei, SECl = \"WN\", SEsubcl = \"sw\", mask = bowen_island_mask)\n# FW la (freshwater lake)\nFW_la &lt;- sei_raster_by_class(sei = bowen_sei, SECl = \"FW\", SEsubcl = \"la\", mask = bowen_island_mask)\n# FW pd (freshwater pond)\nFW_pd &lt;- sei_raster_by_class(sei = bowen_sei, SECl = \"FW\", SEsubcl = \"pd\", mask = bowen_island_mask)\n# WN bo (bog)\nWN_bo &lt;- sei_raster_by_class(sei = bowen_sei, SECl = \"WN\", SEsubcl = \"bo\", mask = bowen_island_mask)\n#&gt; Warning: [SpatVector from sf] empty SpatVector\n# WN fn (fen)\nWN_fn &lt;- sei_raster_by_class(sei = bowen_sei, SECl = \"WN\", SEsubcl = \"fn\", mask = bowen_island_mask)\n# WN sp (swamp)\nWN_sp &lt;- sei_raster_by_class(sei = bowen_sei, SECl = \"WN\", SEsubcl = \"sp\", mask = bowen_island_mask)\n# WN (wetland) for bo, fn, sp\nWN_bo_fn_sp &lt;- terra::allNA(c(WN_bo, WN_fn, WN_sp)) %&gt;%\n  terra::as.int() %&gt;% # TRUE FALSE to 1 0\n  classify(rbind(c(1, NA), c(0, 1))) # Change 1 to NA, 0 to 1 \nnames(WN_bo_fn_sp) &lt;- \"WN_bo_fn_sp\"\n#### VEGETATION\n# HB cs (herbaceous coastal)\nHB_cs &lt;- sei_raster_by_class(sei = bowen_sei, SECl = \"HB\", SEsubcl = \"cs\", mask = bowen_island_mask)\n# HB vs (herbaceous vegetated shoreline)\nHB_vs &lt;- sei_raster_by_class(sei = bowen_sei, SECl = \"HB\", SEsubcl = \"vs\", mask = bowen_island_mask)\n# SV ro (sparse vegetation rocky outcrop)\nSV_ro &lt;- sei_raster_by_class(sei = bowen_sei, SECl = \"SV\", SEsubcl = \"ro\", mask = bowen_island_mask)\n# WD co (woodland conifers)\nWD_co &lt;- sei_raster_by_class(sei = bowen_sei, SECl = \"WD\", SEsubcl = \"co\", mask = bowen_island_mask)\n# WD mx (woodland mix)\nWD_mx &lt;- sei_raster_by_class(sei = bowen_sei, SECl = \"WD\", SEsubcl = \"mx\", mask = bowen_island_mask)\n# YF co (young forest conifer)\nYF_co &lt;- sei_raster_by_class(sei = bowen_sei, SECl = \"YF\", SEsubcl = \"co\", mask = bowen_island_mask)\n# YF mx (young forest mix)\nYF_mx &lt;- sei_raster_by_class(sei = bowen_sei, SECl = \"YF\", SEsubcl = \"mx\", mask = bowen_island_mask)\n# MF (Mature Forest)\nMF &lt;- sei_raster_by_class(sei = bowen_sei, SECl = \"MF\", mask = bowen_island_mask)\n# OF (Old Forest)\nOF &lt;- sei_raster_by_class(sei = bowen_sei, SECl = \"OF\", mask = bowen_island_mask)\n#### INTERTIDAL\n## IT mf (Mudflats)\nIT_mf &lt;- sei_raster_by_class(sei = bowen_sei, SECl = \"IT\", SEsubcl = \"mf\", mask = bowen_island_mask)\n## IT el (Eelgrass)\nIT_el &lt;- sei_raster_by_class(sei = bowen_sei, SECl = \"IT\", SEsubcl = \"el\", mask = bowen_island_mask)\n## IT bs (Beaches)\nIT_bs &lt;- sei_raster_by_class(sei = bowen_sei, SECl = \"IT\", SEsubcl = \"bs\", mask = bowen_island_mask)\n#### EXPORT AS RASTER AND DOCUMENT LAYERS IN CSV ####\nsei_rasters &lt;- c(RI_ff, RI_gu, FW_la, FW_pd, WN_sw, WN_bo_fn_sp, HB_cs, HB_vs, SV_ro, WD_co, WD_mx, YF_co, YF_mx, MF, OF, IT_mf, IT_el, IT_bs)\nsei_rasters %&gt;%\n  lapply(function(x) {\n    sei_name &lt;- names(x)\n    writeRaster(x, here(sei_dir, paste0(sei_name, \".tif\")), overwrite=TRUE)\n  })\n#&gt; [[1]]\n#&gt; class       : SpatRaster \n#&gt; dimensions  : 108, 96, 1  (nrow, ncol, nlyr)\n#&gt; resolution  : 100, 100  (x, y)\n#&gt; extent      : 1186388, 1195988, 482587.5, 493387.5  (xmin, xmax, ymin, ymax)\n#&gt; coord. ref. : +proj=aea +lat_0=45 +lon_0=-126 +lat_1=50 +lat_2=58.5 +x_0=1000000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs \n#&gt; source      : RI_ff.tif \n#&gt; name        : RI_ff \n#&gt; min value   :     1 \n#&gt; max value   :     1 \n#&gt; \n#&gt; [[2]]\n#&gt; class       : SpatRaster \n#&gt; dimensions  : 108, 96, 1  (nrow, ncol, nlyr)\n#&gt; resolution  : 100, 100  (x, y)\n#&gt; extent      : 1186388, 1195988, 482587.5, 493387.5  (xmin, xmax, ymin, ymax)\n#&gt; coord. ref. : +proj=aea +lat_0=45 +lon_0=-126 +lat_1=50 +lat_2=58.5 +x_0=1000000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs \n#&gt; source      : RI_gu.tif \n#&gt; name        : RI_gu \n#&gt; min value   :     1 \n#&gt; max value   :     1 \n#&gt; \n#&gt; [[3]]\n#&gt; class       : SpatRaster \n#&gt; dimensions  : 108, 96, 1  (nrow, ncol, nlyr)\n#&gt; resolution  : 100, 100  (x, y)\n#&gt; extent      : 1186388, 1195988, 482587.5, 493387.5  (xmin, xmax, ymin, ymax)\n#&gt; coord. ref. : +proj=aea +lat_0=45 +lon_0=-126 +lat_1=50 +lat_2=58.5 +x_0=1000000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs \n#&gt; source      : FW_la.tif \n#&gt; name        : FW_la \n#&gt; min value   :     1 \n#&gt; max value   :     1 \n#&gt; \n#&gt; [[4]]\n#&gt; class       : SpatRaster \n#&gt; dimensions  : 108, 96, 1  (nrow, ncol, nlyr)\n#&gt; resolution  : 100, 100  (x, y)\n#&gt; extent      : 1186388, 1195988, 482587.5, 493387.5  (xmin, xmax, ymin, ymax)\n#&gt; coord. ref. : +proj=aea +lat_0=45 +lon_0=-126 +lat_1=50 +lat_2=58.5 +x_0=1000000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs \n#&gt; source      : FW_pd.tif \n#&gt; name        : FW_pd \n#&gt; min value   :     1 \n#&gt; max value   :     1 \n#&gt; \n#&gt; [[5]]\n#&gt; class       : SpatRaster \n#&gt; dimensions  : 108, 96, 1  (nrow, ncol, nlyr)\n#&gt; resolution  : 100, 100  (x, y)\n#&gt; extent      : 1186388, 1195988, 482587.5, 493387.5  (xmin, xmax, ymin, ymax)\n#&gt; coord. ref. : +proj=aea +lat_0=45 +lon_0=-126 +lat_1=50 +lat_2=58.5 +x_0=1000000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs \n#&gt; source      : WN_sw.tif \n#&gt; name        : WN_sw \n#&gt; min value   :     1 \n#&gt; max value   :     1 \n#&gt; \n#&gt; [[6]]\n#&gt; class       : SpatRaster \n#&gt; dimensions  : 108, 96, 1  (nrow, ncol, nlyr)\n#&gt; resolution  : 100, 100  (x, y)\n#&gt; extent      : 1186388, 1195988, 482587.5, 493387.5  (xmin, xmax, ymin, ymax)\n#&gt; coord. ref. : +proj=aea +lat_0=45 +lon_0=-126 +lat_1=50 +lat_2=58.5 +x_0=1000000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs \n#&gt; source      : WN_bo_fn_sp.tif \n#&gt; name        : WN_bo_fn_sp \n#&gt; min value   :           1 \n#&gt; max value   :           1 \n#&gt; \n#&gt; [[7]]\n#&gt; class       : SpatRaster \n#&gt; dimensions  : 108, 96, 1  (nrow, ncol, nlyr)\n#&gt; resolution  : 100, 100  (x, y)\n#&gt; extent      : 1186388, 1195988, 482587.5, 493387.5  (xmin, xmax, ymin, ymax)\n#&gt; coord. ref. : +proj=aea +lat_0=45 +lon_0=-126 +lat_1=50 +lat_2=58.5 +x_0=1000000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs \n#&gt; source      : HB_cs.tif \n#&gt; name        : HB_cs \n#&gt; min value   :     1 \n#&gt; max value   :     1 \n#&gt; \n#&gt; [[8]]\n#&gt; class       : SpatRaster \n#&gt; dimensions  : 108, 96, 1  (nrow, ncol, nlyr)\n#&gt; resolution  : 100, 100  (x, y)\n#&gt; extent      : 1186388, 1195988, 482587.5, 493387.5  (xmin, xmax, ymin, ymax)\n#&gt; coord. ref. : +proj=aea +lat_0=45 +lon_0=-126 +lat_1=50 +lat_2=58.5 +x_0=1000000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs \n#&gt; source      : HB_vs.tif \n#&gt; name        : HB_vs \n#&gt; min value   :     1 \n#&gt; max value   :     1 \n#&gt; \n#&gt; [[9]]\n#&gt; class       : SpatRaster \n#&gt; dimensions  : 108, 96, 1  (nrow, ncol, nlyr)\n#&gt; resolution  : 100, 100  (x, y)\n#&gt; extent      : 1186388, 1195988, 482587.5, 493387.5  (xmin, xmax, ymin, ymax)\n#&gt; coord. ref. : +proj=aea +lat_0=45 +lon_0=-126 +lat_1=50 +lat_2=58.5 +x_0=1000000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs \n#&gt; source      : SV_ro.tif \n#&gt; name        : SV_ro \n#&gt; min value   :     1 \n#&gt; max value   :     1 \n#&gt; \n#&gt; [[10]]\n#&gt; class       : SpatRaster \n#&gt; dimensions  : 108, 96, 1  (nrow, ncol, nlyr)\n#&gt; resolution  : 100, 100  (x, y)\n#&gt; extent      : 1186388, 1195988, 482587.5, 493387.5  (xmin, xmax, ymin, ymax)\n#&gt; coord. ref. : +proj=aea +lat_0=45 +lon_0=-126 +lat_1=50 +lat_2=58.5 +x_0=1000000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs \n#&gt; source      : WD_co.tif \n#&gt; name        : WD_co \n#&gt; min value   :     1 \n#&gt; max value   :     1 \n#&gt; \n#&gt; [[11]]\n#&gt; class       : SpatRaster \n#&gt; dimensions  : 108, 96, 1  (nrow, ncol, nlyr)\n#&gt; resolution  : 100, 100  (x, y)\n#&gt; extent      : 1186388, 1195988, 482587.5, 493387.5  (xmin, xmax, ymin, ymax)\n#&gt; coord. ref. : +proj=aea +lat_0=45 +lon_0=-126 +lat_1=50 +lat_2=58.5 +x_0=1000000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs \n#&gt; source      : WD_mx.tif \n#&gt; name        : WD_mx \n#&gt; min value   :     1 \n#&gt; max value   :     1 \n#&gt; \n#&gt; [[12]]\n#&gt; class       : SpatRaster \n#&gt; dimensions  : 108, 96, 1  (nrow, ncol, nlyr)\n#&gt; resolution  : 100, 100  (x, y)\n#&gt; extent      : 1186388, 1195988, 482587.5, 493387.5  (xmin, xmax, ymin, ymax)\n#&gt; coord. ref. : +proj=aea +lat_0=45 +lon_0=-126 +lat_1=50 +lat_2=58.5 +x_0=1000000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs \n#&gt; source      : YF_co.tif \n#&gt; name        : YF_co \n#&gt; min value   :     1 \n#&gt; max value   :     1 \n#&gt; \n#&gt; [[13]]\n#&gt; class       : SpatRaster \n#&gt; dimensions  : 108, 96, 1  (nrow, ncol, nlyr)\n#&gt; resolution  : 100, 100  (x, y)\n#&gt; extent      : 1186388, 1195988, 482587.5, 493387.5  (xmin, xmax, ymin, ymax)\n#&gt; coord. ref. : +proj=aea +lat_0=45 +lon_0=-126 +lat_1=50 +lat_2=58.5 +x_0=1000000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs \n#&gt; source      : YF_mx.tif \n#&gt; name        : YF_mx \n#&gt; min value   :     1 \n#&gt; max value   :     1 \n#&gt; \n#&gt; [[14]]\n#&gt; class       : SpatRaster \n#&gt; dimensions  : 108, 96, 1  (nrow, ncol, nlyr)\n#&gt; resolution  : 100, 100  (x, y)\n#&gt; extent      : 1186388, 1195988, 482587.5, 493387.5  (xmin, xmax, ymin, ymax)\n#&gt; coord. ref. : +proj=aea +lat_0=45 +lon_0=-126 +lat_1=50 +lat_2=58.5 +x_0=1000000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs \n#&gt; source      : MF.tif \n#&gt; name        : MF \n#&gt; min value   :  1 \n#&gt; max value   :  1 \n#&gt; \n#&gt; [[15]]\n#&gt; class       : SpatRaster \n#&gt; dimensions  : 108, 96, 1  (nrow, ncol, nlyr)\n#&gt; resolution  : 100, 100  (x, y)\n#&gt; extent      : 1186388, 1195988, 482587.5, 493387.5  (xmin, xmax, ymin, ymax)\n#&gt; coord. ref. : +proj=aea +lat_0=45 +lon_0=-126 +lat_1=50 +lat_2=58.5 +x_0=1000000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs \n#&gt; source      : OF.tif \n#&gt; name        : OF \n#&gt; min value   :  1 \n#&gt; max value   :  1 \n#&gt; \n#&gt; [[16]]\n#&gt; class       : SpatRaster \n#&gt; dimensions  : 108, 96, 1  (nrow, ncol, nlyr)\n#&gt; resolution  : 100, 100  (x, y)\n#&gt; extent      : 1186388, 1195988, 482587.5, 493387.5  (xmin, xmax, ymin, ymax)\n#&gt; coord. ref. : +proj=aea +lat_0=45 +lon_0=-126 +lat_1=50 +lat_2=58.5 +x_0=1000000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs \n#&gt; source      : IT_mf.tif \n#&gt; name        : IT_mf \n#&gt; min value   :     1 \n#&gt; max value   :     1 \n#&gt; \n#&gt; [[17]]\n#&gt; class       : SpatRaster \n#&gt; dimensions  : 108, 96, 1  (nrow, ncol, nlyr)\n#&gt; resolution  : 100, 100  (x, y)\n#&gt; extent      : 1186388, 1195988, 482587.5, 493387.5  (xmin, xmax, ymin, ymax)\n#&gt; coord. ref. : +proj=aea +lat_0=45 +lon_0=-126 +lat_1=50 +lat_2=58.5 +x_0=1000000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs \n#&gt; source      : IT_el.tif \n#&gt; name        : IT_el \n#&gt; min value   :     1 \n#&gt; max value   :     1 \n#&gt; \n#&gt; [[18]]\n#&gt; class       : SpatRaster \n#&gt; dimensions  : 108, 96, 1  (nrow, ncol, nlyr)\n#&gt; resolution  : 100, 100  (x, y)\n#&gt; extent      : 1186388, 1195988, 482587.5, 493387.5  (xmin, xmax, ymin, ymax)\n#&gt; coord. ref. : +proj=aea +lat_0=45 +lon_0=-126 +lat_1=50 +lat_2=58.5 +x_0=1000000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs \n#&gt; source      : IT_bs.tif \n#&gt; name        : IT_bs \n#&gt; min value   :     1 \n#&gt; max value   :     1\nsei_rasters_df &lt;- data.frame(sei_habitat = names(sei_rasters))\nsei_rasters_df$filepath &lt;- paste0(sei_rasters_df$sei_habitat, \".tif\")\nsei_rasters_df$weights &lt;- 1.0\nsave(sei_rasters_df, file = here(\"inst/extdata/\", \"bowen_sei_rasters_info.rda\"))\nwrite.csv(sei_rasters_df, here(\"inst/extdata/\", \"bowen_sei_rasters_info.csv\"))\n\n\n\n\n\nWe followed the methods from Arias-Patino et al. (2024) for the human disturbance layers included in the analyses. Pressures included urban areas, buildings, population density, roads, railways, navigable waterways, transmission lines, seismic lines, pipelines, mining, dams and reservoirs, oil and gas infrastructure, agriculture, pastures, forest harvesting, and recreation features. We reclassified the human disturbance raster into four levels based on intensity of disturbance: intact, low disturbance, medium disturbance, and high disturbance. We then normalized and inverted the values to prepare the disturbance data for input into Zonation, ensuring that areas with less disturbance correspond to higher values on a 0-1 scale.\n\n\nCode\n#### Human Disturbance #### \n# Contents of \"data-raw/human_disturbance/\" received from Miguel Arias Patino (marias@unbc.ca)\n# https://1sfu.sharepoint.com/:f:/r/teams/Cumulativeeffects-SFUTeams9/Shared%20Documents/General/BC%20Hydro%202025%20IRP/Environmental%20Layers/Human%20Footprint?csf=1&web=1&e=hUYDs7 \n# Thesis (methods): https://unbc.arcabc.ca/islandora/object/unbc%3A59107\n# Paper (methods): https://doi.org/10.1016/j.ecolind.2024.112407 \n# Paper (methods): https://doi.org/10.1139/facets-2021-0063  \ndisturb_path &lt;- here(\"data-raw/human_disturbance/human_footprint_30m_v2.tif\")\ndisturb &lt;- terra::rast(disturb_path)\n# Load Bowen Island Mask Created Previously\nbowen_island_mask &lt;- here(\"inst/extdata/bowen_mask.tif\") %&gt;%\n  rast()\n#### Resample Raster to Bowen Island ####\ndisturb_resamp &lt;- terra::resample(disturb, bowen_island_mask)\nwriteRaster(disturb_resamp, \n            here::here(\"inst/extdata\", \"bowen_human_footprint.tif\"), \n            overwrite=TRUE)\n#### Reclassify Raster to Intact, Low, Medium, High ####\n# https://www.facetsjournal.com/doi/10.1139/facets-2021-0063#sec-2 \n# Intact is 0 to 1 \n# Low disturbance is 1 to 4\n# Medium disturbance is 4 to 10\n# High disturbance is 10+ \n# Maximum theoretical value is 66\ndisturb_m &lt;- c(0, 1, 0,\n       1, 4, 1,\n       4, 10, 2,\n       10, 100, 3) %&gt;%\n  matrix(ncol = 3, byrow = T)\n# Reclassify disturbance to levels\ndisturb_recl &lt;- disturb_resamp %&gt;%\n  classify(disturb_m, include.lowest = T)\nwriteRaster(disturb_recl, \n            here::here(\"inst/extdata\", \"bowen_human_footprint_recl.tif\"), \n            overwrite=TRUE)\n#### Inverse Disturbance ####\n#' Normalize on 0 to 1 scale\nnormalize &lt;- function(input_rast) {\n  mm &lt;- minmax(input_rast)\n  min &lt;- mm[1]\n  max &lt;- mm[2]\n  normalized &lt;- (input_rast - min) / (max - min)\n}\n#' Invert raster, so max values are min and vice versa. \ninvert &lt;- function(input_rast) {\n  mm &lt;- minmax(input_rast)\n  max &lt;- mm[2]\n  inverted &lt;- max - input_rast \n}\n# Normalize and invert the disturbance, so its positive as Zonation input\ndisturb_inv &lt;- disturb_resamp %&gt;% \n  normalize() %&gt;%\n  invert()\nwriteRaster(disturb_inv, here(\"inst/extdata/bowen_human_footprint_inv.tif\"), overwrite=TRUE)\n\n\n\n\n\n\n\nZonation 5 is a spatial prioritization software that can be used to identify priority areas to support conservation planning, land use planning, ecological impact avoidance and other similar tasks. The software uses spatial raster data on the distributions of individual biodiversity features (species, habitats, ecosystem services etc.) to identify which locations in a landscape are most important for retaining biodiversity. Zonation can account for local habitat quality and ecological connectivity together with costs, threats and different land tenure, thus providing a quantitative method for spatial planning that enhances the persistence of biodiversity in the long term.\n\nhttps://zonationteam.github.io/Zonation5/\nWe took all of the rasters prepared earlier and fed these into the Zonation 5 software. This should provide a relative ranking for locations from highest to lowest for the purposes of biodiversity conservation.\nNote: Zonation 5 is usually a standalone application. Here, I have enabled running of Zonation from R, using command line functions. This way we can adjust and automatically run Zonation, reading from data in R.\n\n\nCode\n#### CREATE DATAFRAME FOR INPUT LAYERS ####\n# Bowen Island SDM Table\nload(here(\"inst/extdata/bowen_sdm_status.rda\"))\nbowen_sdm_rasters_df &lt;- bowen_sdm_status %&gt;% \n  select(species, filepath, weights) %&gt;%\n  rename(group = species)\nbowen_sdm_rasters_df$filepath &lt;- bowen_sdm_rasters_df$filepath %&gt;% unlist()\nbowen_sdm_rasters_df$type &lt;- \"sdm\"\n# Bowen Island SEI Table\nload(here(\"inst/extdata/bowen_sei_rasters_info.rda\")) \nsei_rasters_df &lt;- sei_rasters_df %&gt;% \n  select(sei_habitat, filepath, weights) %&gt;%\n  rename(group = sei_habitat)\nsei_rasters_df$type &lt;- \"habitat\"\n# Bowen Island Disturbance\ndisturb_rasters_df &lt;- data.frame(filepath = \"bowen_human_footprint_inv.tif\",\n                                 weights = 1.0)\ndisturb_rasters_df$type &lt;- \"habitat\"\n# Bind all input layers together\nlayers_df &lt;- bind_rows(bowen_sdm_rasters_df, sei_rasters_df, disturb_rasters_df)\n#### Set weights based on \"species\" and \"habitat\" type so 50/50 weight\n# Get SDM weight\nn_sdm &lt;- layers_df %&gt;%\n  filter(type == \"sdm\") %&gt;%\n  nrow()\nweight_sdm &lt;- 1/n_sdm\n# Get habitat weight\nn_habitat &lt;- layers_df %&gt;%\n  filter(type == \"habitat\") %&gt;%\n  nrow()\nweight_habitat &lt;- 1/n_habitat\n# Set weights\nlayers_df &lt;- layers_df %&gt;%\n  mutate(\n    weights = case_when(\n      type == \"sdm\" ~ weight_sdm,\n      type == \"habitat\" ~ weight_habitat\n    )\n  )\n#### Get fullpaths for filenames in inst/extdata\nrasters_df &lt;- data.frame(fullpath = here(\"inst/extdata/\", list.files(path = here(\"inst/extdata\"), recursive = T, pattern = \"*.tif$\")))\nrasters_df$filepath &lt;- basename(rasters_df$fullpath)\n# Merge with weights\nweights_df &lt;- merge(layers_df, rasters_df, by = \"filepath\")\nweights_df$relpath &lt;- weights_df$fullpath %&gt;%\n  gsub(paste0(here(),\"/\"), \"\", .) # Prepare paths for Shiny app \nsave(weights_df, file = here(\"inst/extdata/weights_df.rda\"))\n#### CREATE features.txt FOR ZONATION RUN ####\n# Create features.txt from files available in data\nfeatures_path &lt;- here(\"vignettes/zonation/features.txt\")\ncat('\"weight\" \"filename\"', \n    file = features_path,\n    sep = \"\\n\")\nfor(i in 1:nrow(weights_df)) {\n  next_row &lt;- paste0(weights_df[i, \"weights\"], \" \", weights_df[i, \"fullpath\"])\n  cat(next_row,\n      file = features_path,\n      append = TRUE,\n      sep = \"\\n\")\n}\n#### SET PARAMS FOR ZONATION RUN ####\nzonation5_location &lt;- here(\"vignettes/zonation/zonation5\") \nzonation5_mode &lt;- \"CAZ2\"\n# Zonation5 Setting Text File\nzonation5_settings &lt;-  here(\"vignettes/zonation/settings.z5\")\nzonation5_settings_txt &lt;- c(\"feature list file = features.txt\", \n                            paste0(\"analysis area mask layer = \", here(\"inst/extdata/bowen_mask.tif\"))) # Add Bowen Island Mask\nwriteLines(zonation5_settings_txt, zonation5_settings)\nzonation5_output &lt;- here(\"vignettes/zonation/output\") \nzonation5_command &lt;- str_glue(\n  '{zonation5_location} -a --mode={zonation5_mode} {zonation5_settings} {zonation5_output}',\n  zonation5_location = zonation5_location,\n  zonation5_mode = zonation5_mode,\n  zonation5_settings = zonation5_settings,\n  zonation5_output = zonation5_output\n) %&gt;%\n  str_c()\n#### ZONATION RUN ####\nsystem(command = zonation5_command)\n\n\n\n\n\n\n\nCode\n#### VISUALIZE OUTPUT ####\nrankmap &lt;- here(\"vignettes/zonation/output/rankmap.tif\") %&gt;% rast()\nplot(rankmap)",
    "crumbs": [
      "Zonation",
      "Conservation Prioritization for February 1st Bowen Island Workshop"
    ]
  },
  {
    "objectID": "vignettes/output_zonation_01_02_2025.html#loading-datasets",
    "href": "vignettes/output_zonation_01_02_2025.html#loading-datasets",
    "title": "Conservation Prioritization for February 1st Bowen Island Workshop",
    "section": "",
    "text": "Raw data (temp files) into data-raw and added to data-raw/.gitignore Save finished outputs (as used by the application) into inst/extdata - Convention is to save files that are not .rda into this folder (https://rstudio.github.io/r-manuals/r-exts/Creating-R-packages.html#data-in-packages)\n\n\n\nThe species distribution models (SDMs) included in the Bowen Island Conservation Plan analyses were originally produced by Viorel Popescu (Popescu et al., 2020). Out of the 341 SDMs available, we included 193 of the SDMs. Occurrence locations of small vertebrate species were gathered from Global Biodiversity Information Facility (data.gbif.org) and Nature Counts (birdscanada.org/birdmon) open-access databases. Inclusion of small mammal species was based on Appendix 2 & 3 from the 2005 Environmental Inventory report, which states species presence on Bowen Island. We used the iNaturalist and eBird databases of observations for the inclusion criteria for reptiles, amphibians, and birds (described in further detail in Methods).\n\n\nCode\n#### SPECIES DISTRIBUTION MODELS ####\n# Contents of \"data-raw/species_distribution_models/\" downloaded from Cumulative effects - SFU Teams Sharepoint \n# https://1sfu.sharepoint.com/:f:/r/teams/Cumulativeeffects-SFUTeams9/Shared%20Documents/BCH_project_backup/SPECIES?csf=1&web=1&e=FpNkgc \n# Directory Path: BCH_project_backup/SPECIES/\n# Paper: https://www.nature.com/articles/s41598-020-64501-7#MOESM1\n# See Wendy Palen (SFU) for access \n#### PROCESSING SDM ####\n# Get list of available SDMs\nsdm_folder &lt;- here(\"data-raw/species_distribution_models\")\nsdm_folder_tif &lt;- list.files(sdm_folder, recursive = T, pattern = \"*.tif$\") # Get only .tif files\n# Correspondence with Viorel Popescu confirms that _NAs_ should be SDMs with rock, ice, large lakes layers masked\nsdm_folder_tif_NAs &lt;- sdm_folder_tif[grepl(\"_NAs_\", sdm_folder_tif)] # Get only .tif with \"_NAs_\" in filename\n# Directory to save SDMs\nsdm_output_dir &lt;- here(\"inst/extdata/species_distribution_models_bowen\")\nif(!dir.exists(sdm_output_dir)) {\n  dir.create(sdm_output_dir)\n}\n# Create Bowen Island mask using DSM\nsample_sdm &lt;- rast(here(sdm_folder, sdm_folder_tif_NAs[1])) %&gt;%\n  terra::project(y = sdm_crs) %&gt;%\n  terra::crop(bowen_island_admin, snap = \"out\") %&gt;%\n  terra::disagg(fact = 4)\ndsm &lt;- rast(here(\"data-raw/bowen_dsm/chm.tif\"))\ndsm_smooth &lt;- dsm %&gt;% \n  focal(w=9, fun=mean, na.policy=\"only\", na.rm=T) %&gt;% \n  terra::project(y = sdm_crs) %&gt;%\n  terra::resample(sample_sdm, method = \"average\")\nm &lt;- c(-1, 35, 1) %&gt;% matrix(ncol = 3, byrow=T)\nbowen_island_mask &lt;- dsm_smooth %&gt;% \n  classify(m) %&gt;%\n  as.int()\nwriteRaster(bowen_island_mask, here(\"inst/extdata/bowen_mask.tif\"), overwrite = T)\n# Weights for terra::focal() function that provides moving window average\n# - Smoothing algorithm \n# - Use this to fill some empty cells on Bowen Island with weighted mean of the neighbouring cells.\nweights &lt;- matrix(c(0, 0, 1, 1, 1, 0, 0,\n                    0, 1, 1, 2, 1, 1, 0,\n                    1, 1, 3, 3, 3, 1, 1,\n                    1, 2, 3, 5, 3, 2, 1,\n                    1, 1, 3, 3, 3, 1, 1,\n                    0, 1, 1, 2, 1, 1, 0,\n                    0, 0, 1, 1, 1, 0, 0\n), nrow=7)\n#### PREPARE SDMs TO BOWEN ISLAND ####\n# Loop through SDMs\nforeach(sdm_tif = sdm_folder_tif_NAs) %do% {\n  sdm_path &lt;- here(sdm_folder, sdm_tif) \n  sdm_output_path &lt;- here(sdm_output_dir, basename(sdm_tif))\n  sdm &lt;- rast(sdm_path)\n  # Normalize SDMs that range from 0 to 1000\n  sdm_minmax &lt;- terra::minmax(sdm)\n  if(sdm_minmax[2] &gt; 1) {\n    sdm &lt;- sdm / 1000\n  }\n  sdm_output &lt;- sdm %&gt;%\n    #### Reproject SDM ####\n    terra::project(y = sdm_crs) %&gt;%\n    #### Crop SDM ####\n    # Figured out why the SDMs were cropped incorrectly\n    # The default for cropping a raster by a polygon is to snap = \"near\"\n    # This means that the polygon extent is snapped to the closest raster\n    # We need snap = \"out\" to make sure the full extent of the polygon is covered by the output raster\n    terra::crop(bowen_island_admin, snap = \"out\") %&gt;%\n    #### Extrapolate for Southern Parts of Bowen Island\n    # - fills the NA values missing in south part of Bowen Island\n    terra::focal(w = weights,\n                 fun = \"mean\",\n                 na.policy = \"only\") %&gt;%\n    #### Downsamples ####\n    # - from 400 m to 100 m resolution\n    terra::disagg(fact = 4) %&gt;%\n    #### Smooths the raster ####\n    terra::focal(w = weights,\n                 fun = \"mean\",\n                 na.rm = T,\n                 na.policy = \"omit\") %&gt;%\n    terra::mask(bowen_island_mask)\n  \n  writeRaster(sdm_output, sdm_output_path, overwrite = T)\n}\n# Create species list from available SDMs\nspecies_list &lt;- sdm_folder_tif_NAs %&gt;%\n  basename() %&gt;%\n  stringr::str_extract(\"^\\\\S+\\\\.[a-zA-Z]+_\") %&gt;%\n  stringr::str_remove(\"_\") %&gt;%\n  stringr::str_replace(\"\\\\.\", \" \")\n# Create taxon list \ntaxon_list &lt;- sdm_folder_tif_NAs %&gt;%\n  dirname() %&gt;%\n  str_remove(\"_mask\")\n# Get iNaturalist and SDM congruence\nsdm_inat &lt;- foreach(i = 1:length(species_list), .combine = \"rbind\") %do% {\n  # Progress Message \n  print(paste0(\"Currently working on species \", i, \" out of \", length(species_list),\". This is \", species_list[i], \".\"))\n  # Query iNaturalist by species name and Bowen Island Administrative Boundaries\n  rinat_results_sf &lt;- tryCatch({\n    Sys.sleep(3) # Need to slow down queries to prevent requests being blocked\n    rinat::get_inat_obs_sf(taxon_name = species_list[i],\n                           area = st_as_sf(bowen_island_admin),\n                           maxresults = 10000)\n  }, error = function(cond) {\n    NA\n  })\n  # Get number of iNaturalist observations\n  if(!is.data.frame(rinat_results_sf)) {\n    inat_n_obs &lt;- 0\n  } else {\n    inat_n_obs &lt;- nrow(rinat_results_sf)\n  }\n  # Get Bowen Island SDM\n  sdm &lt;- paste0(str_replace(species_list[i], \" \", \".\"), \"_NAs_pu_mask.tif\") %&gt;%\n    here(sdm_output_dir, .) %&gt;%\n    rast()\n  # Get highest value in SDM\n  sdm_max &lt;- sdm %&gt;% \n    minmax() %&gt;% \n    max()\n  # PREPARE OUTPUT ROW\n  # 1. scientific species name\n  # 2. highest SDM cell value within area \n  # 3. observation count from iNaturalist\n  result &lt;- data.frame(species = species_list[i],\n                       sdm_max_value = sdm_max,\n                       inat_n_obs = inat_n_obs)\n}\nsdm_inat$taxon_group &lt;- taxon_list\n#### Query eBird for birds ####\n# Number of eBird observations by bird species on Bowen Island\n# - Results from Natasha Beauregard (Summer 2024 USRA)\nbowen_ebird &lt;- read.csv(here(\"data-raw/bowen_ebird/final_bird.csv\")) %&gt;%\n  select(c(\"scientific_name\", \"n_ebird\"))\n# Combine eBird and iNaturalist counts\nbowen_SDM_iNat_ebird &lt;- merge(sdm_inat, \n                              bowen_ebird, \n                              by.x = \"species\", \n                              by.y = \"scientific_name\",\n                              all.x = TRUE) %&gt;%\n  rename(n_obs_inat = inat_n_obs,\n         n_obs_ebird = n_ebird) %&gt;%\n  select(\n    species,\n    sdm_max_value,\n    taxon_group,\n    n_obs_inat,\n    n_obs_ebird\n  )\n# Query Pottinger Report (2005) for small mammals\nbowen_mammals &lt;- read_xlsx(here(\"data-raw/pottinger_report/Appendix 2 - Expected Occurrence of Wildlife Species In The Cape Roger Curtis Area.xlsx\")) %&gt;%\n  filter(`Documented on Bowen` == \"y\" | `Documented on Bowen` == \"?\" | `Documented on Bowen` == \"One or more spp\" )\n# Include Species if they meet any of the following criteria:\n# - eBird observations &gt; 0\n# - iNaturalist observations &gt; 0\n# - included in Pottinger Report \ninclude_threshold &lt;- 0.5 # Min SDM cell value somewhere on Bowen Island for including species into focal list\nbowen_SDM_obs_focal_df &lt;- bowen_SDM_iNat_ebird %&gt;%\n  mutate(include = case_when(\n    (n_obs_inat &gt; 0 | n_obs_ebird &gt; 0 ) & sdm_max_value &gt; include_threshold ~ \"y\",\n    species %in% bowen_mammals$`Scientific name` ~ \"y\")\n  )\n# Create list of species names to include\nbowen_focal_list &lt;- bowen_SDM_obs_focal_df %&gt;%\n  filter(include == \"y\") %&gt;%\n  select(species) %&gt;%\n  unlist() %&gt;%\n  unname() \n# Get filepath for each SDM\nbowen_SDM_iNat_ebird$filepath &lt;- lapply(bowen_SDM_iNat_ebird$species, function(x) {paste0(str_replace(x, \" \", \".\"), \"_NAs_pu_mask.tif\")})\n# Add columns that can be adjusted manually\nbowen_SDM_iNat_ebird$prov_status &lt;- \"\"\nbowen_SDM_iNat_ebird$fed_status &lt;- \"\"\nbowen_SDM_iNat_ebird$IUCN_status &lt;- \"\"\nbowen_SDM_iNat_ebird$weights &lt;- 1.0\n# Dataframe for focal species on Bowen Island\nbowen_sdm_focal &lt;- bowen_SDM_iNat_ebird %&gt;%\n  filter(species %in% bowen_focal_list)\n#### UPLOAD ####\n# This sheet was uploaded to Google Sheets\n# WARNING: DO NOT RUN OR WILL OVERWRITE MANUAL INPUT TO GOOGLE SHEETS\n# write_sheet(bowen_sdm_focal,\n#             \"https://docs.google.com/spreadsheets/d/1ehO30w4i7EDafilNyRpq3sgc86fm8g_TmYMI4ql3qms/edit?usp=sharing\",\n#             \"species\")\nspecies_distribution_models_focal_bowen_info &lt;- bowen_sdm_focal\nsave(species_distribution_models_focal_bowen_info, file = here(\"inst/extdata/species_distribution_models_focal_bowen_info.rda\"))\n\n\n\n\nConservation statuses for species at the provincial, federal, and global levels were obtained from the BC Species & Ecosystems Explorer and the IUCN Red List. Provincial statuses followed the Red, Blue, and Yellow List classifications, while federal statuses were based on COSEWIC assessments where applicable. In cases of taxonomic discrepancies, species names were updated to reflect current classifications and documented accordingly.\nBC Species and Ecosystems Explorer: https://a100.gov.bc.ca/pub/eswp/ IUCN Red List: https://www.iucnredlist.org/\nThe spreadsheet below contains all of the information on species name, taxon group, threatened status, weights to use for Zonation.\nVisit this link to view the spreadsheet, hosted on Google Drive. https://docs.google.com/spreadsheets/d/1ehO30w4i7EDafilNyRpq3sgc86fm8g_TmYMI4ql3qms/edit?usp=sharing\n\n\nCode\nload(here(\"inst/extdata/species_distribution_models_focal_bowen_info.rda\"))\n#### REVISION ####\n# - This section necessary, since Google Sheet was uploaded at earlier time\n# - Changes since made to the creation of Bowen SDM Focal\n# - Michael Tylo (USRA Spring 2025) did the work in the Google Sheet\n# Manually look up species and correct taxonomy, add conservation status\nsdm_googlesheet &lt;- read_sheet(\"https://docs.google.com/spreadsheets/d/1ehO30w4i7EDafilNyRpq3sgc86fm8g_TmYMI4ql3qms/edit?usp=sharing\") %&gt;%\n  select(!c(\"full_path\", \"filename\"))\n# Drop duplicate columns, keep columns for n eBird and iNaturalist observations, max SDM values\nbowen_sdm_focal_sel &lt;- species_distribution_models_focal_bowen_info %&gt;%\n  select(!c(\"taxon_group\", \"prov_status\", \"fed_status\", \"IUCN_status\", \"weights\"))\n# Merge\nbowen_sdm_status &lt;- merge(bowen_sdm_focal_sel, sdm_googlesheet, by.x = \"species\", by.y = \"sci_name\", all.x = T) \nsave(bowen_sdm_status, file = here(\"inst/extdata/bowen_sdm_status.rda\"))\n\n\n\n\n\n\nWe derived Habitat Type layers from the Metro Vancouver Sensitive Ecosystem Inventory (MVSEI) mapping app. Data was downloaded from the Open Data Catalogue as a GeoPackage. Habitats were grouped into three main categories: water, vegetation, and intertidal.\nWater subcategories included riparian fringe, riparian gully, wetland shallow water, freshwater lake, freshwater pond, and wetland, with bog, fen, and swamp habitats grouped under wetland.\nFor vegetation, we generated habitat layers for herbaceous coastal, herbaceous vegetated shoreline, sparse vegetation rocky outcrop, woodland conifer, woodland mixed, young forest conifer, young forest mixed, as well as broader categories of mature forest and old forest.\nIntertidal habitat layers included mudflats, eelgrass beds, and beaches.\n\n\nCode\n#### Metro Vancouver Sensitive Ecosystems Inventory ####\n# Contents of \"data-raw/metrovancouver_sensitive_ecosystem_inventory/\" downloaded from MetroVancouver Open Data Catalogue\n# GeoPackage download: https://arcg.is/TnfXL \n# Reports download: https://metrovancouver.org/services/regional-planning/sensitive-ecosystem-inventory-mapping-app\nmvsei &lt;- st_read(here(\"data-raw/metrovancouver_sensitive_ecosystem_inventory/Sensitive_Ecosystem_Inventory_for_Metro_Vancouver__2020__-5580727563910851507.gpkg\")) %&gt;%\n  st_transform(crs = sdm_crs)\n#&gt; Reading layer `Sensitive_Ecosystem_Inventory_for_Metro_Vancouver__2020_' from data source `/home/jay/Programming_Projects/bowen.biodiversity.webapp/data-raw/metrovancouver_sensitive_ecosystem_inventory/Sensitive_Ecosystem_Inventory_for_Metro_Vancouver__2020__-5580727563910851507.gpkg' \n#&gt;   using driver `GPKG'\n#&gt; Simple feature collection with 25637 features and 99 fields\n#&gt; Geometry type: MULTIPOLYGON\n#&gt; Dimension:     XYZ\n#&gt; Bounding box:  xmin: 468516.6 ymin: 5427679 xmax: 547072.5 ymax: 5495732\n#&gt; z_range:       zmin: 0 zmax: 0\n#&gt; Projected CRS: NAD83 / UTM zone 10N\n# Create directory to save SEI rasters \nsei_dir &lt;- here(\"inst/extdata/bowen_sei_rasters\")\nif(!dir.exists(sei_dir)) {\n  dir.create(sei_dir)\n}\n# Load Bowen Island Mask Created Previously\nbowen_island_mask &lt;- here(\"inst/extdata/bowen_mask.tif\") %&gt;%\n  rast()\n# Bowen Island SEI \nbowen_sei &lt;- mvsei %&gt;% \n  st_intersection(st_as_sf(bowen_island_admin))\n#&gt; Warning: attribute variables are assumed to be spatially constant throughout\n#&gt; all geometries\n#### SEI sf Into spatRaster Function ####\nsei_raster_by_class &lt;- function(sei, SECl, SEsubcl = NA, mask) {\n  # Filter by SEI classes\n  if(!is.na(SEsubcl)) {\n    selected_sei &lt;- sei %&gt;%\n      filter(SECl_1 == SECl | SECl_2 == SECl) %&gt;%\n      filter(SEsubcl_1 == SEsubcl | SEsubcl_2 == SEsubcl)\n    sei_name &lt;- paste0(SECl, \"_\", SEsubcl)\n  } else {\n    selected_sei &lt;- sei %&gt;%\n      filter(SECl_1 == SECl | SECl_2 == SECl) \n    sei_name &lt;- SECl\n  }\n  output_rast &lt;- selected_sei %&gt;%\n    terra::vect() %&gt;% # Change to SpatVector for rasterization\n    terra::project(mask) %&gt;% # Reproject to the mask CRS\n    terra::rasterize(mask,\n                     touches = T,\n                     background = NA) # Rasterize to match mask, set background values to NA\n  names(output_rast) &lt;- sei_name\n  return(output_rast)\n}\n#### Running SEI Function to Create Habitat Layers ####\n#### WATER\n# RI ff (riparian fringe)\nRI_ff &lt;- sei_raster_by_class(sei = bowen_sei, SECl = \"RI\", SEsubcl = \"ff\", mask = bowen_island_mask)\n# RI gu (riparian gully)\nRI_gu &lt;- sei_raster_by_class(sei = bowen_sei, SECl = \"RI\", SEsubcl = \"gu\", mask = bowen_island_mask)\n# WN sw (wetland shallow water)\nWN_sw &lt;- sei_raster_by_class(sei = bowen_sei, SECl = \"WN\", SEsubcl = \"sw\", mask = bowen_island_mask)\n# FW la (freshwater lake)\nFW_la &lt;- sei_raster_by_class(sei = bowen_sei, SECl = \"FW\", SEsubcl = \"la\", mask = bowen_island_mask)\n# FW pd (freshwater pond)\nFW_pd &lt;- sei_raster_by_class(sei = bowen_sei, SECl = \"FW\", SEsubcl = \"pd\", mask = bowen_island_mask)\n# WN bo (bog)\nWN_bo &lt;- sei_raster_by_class(sei = bowen_sei, SECl = \"WN\", SEsubcl = \"bo\", mask = bowen_island_mask)\n#&gt; Warning: [SpatVector from sf] empty SpatVector\n# WN fn (fen)\nWN_fn &lt;- sei_raster_by_class(sei = bowen_sei, SECl = \"WN\", SEsubcl = \"fn\", mask = bowen_island_mask)\n# WN sp (swamp)\nWN_sp &lt;- sei_raster_by_class(sei = bowen_sei, SECl = \"WN\", SEsubcl = \"sp\", mask = bowen_island_mask)\n# WN (wetland) for bo, fn, sp\nWN_bo_fn_sp &lt;- terra::allNA(c(WN_bo, WN_fn, WN_sp)) %&gt;%\n  terra::as.int() %&gt;% # TRUE FALSE to 1 0\n  classify(rbind(c(1, NA), c(0, 1))) # Change 1 to NA, 0 to 1 \nnames(WN_bo_fn_sp) &lt;- \"WN_bo_fn_sp\"\n#### VEGETATION\n# HB cs (herbaceous coastal)\nHB_cs &lt;- sei_raster_by_class(sei = bowen_sei, SECl = \"HB\", SEsubcl = \"cs\", mask = bowen_island_mask)\n# HB vs (herbaceous vegetated shoreline)\nHB_vs &lt;- sei_raster_by_class(sei = bowen_sei, SECl = \"HB\", SEsubcl = \"vs\", mask = bowen_island_mask)\n# SV ro (sparse vegetation rocky outcrop)\nSV_ro &lt;- sei_raster_by_class(sei = bowen_sei, SECl = \"SV\", SEsubcl = \"ro\", mask = bowen_island_mask)\n# WD co (woodland conifers)\nWD_co &lt;- sei_raster_by_class(sei = bowen_sei, SECl = \"WD\", SEsubcl = \"co\", mask = bowen_island_mask)\n# WD mx (woodland mix)\nWD_mx &lt;- sei_raster_by_class(sei = bowen_sei, SECl = \"WD\", SEsubcl = \"mx\", mask = bowen_island_mask)\n# YF co (young forest conifer)\nYF_co &lt;- sei_raster_by_class(sei = bowen_sei, SECl = \"YF\", SEsubcl = \"co\", mask = bowen_island_mask)\n# YF mx (young forest mix)\nYF_mx &lt;- sei_raster_by_class(sei = bowen_sei, SECl = \"YF\", SEsubcl = \"mx\", mask = bowen_island_mask)\n# MF (Mature Forest)\nMF &lt;- sei_raster_by_class(sei = bowen_sei, SECl = \"MF\", mask = bowen_island_mask)\n# OF (Old Forest)\nOF &lt;- sei_raster_by_class(sei = bowen_sei, SECl = \"OF\", mask = bowen_island_mask)\n#### INTERTIDAL\n## IT mf (Mudflats)\nIT_mf &lt;- sei_raster_by_class(sei = bowen_sei, SECl = \"IT\", SEsubcl = \"mf\", mask = bowen_island_mask)\n## IT el (Eelgrass)\nIT_el &lt;- sei_raster_by_class(sei = bowen_sei, SECl = \"IT\", SEsubcl = \"el\", mask = bowen_island_mask)\n## IT bs (Beaches)\nIT_bs &lt;- sei_raster_by_class(sei = bowen_sei, SECl = \"IT\", SEsubcl = \"bs\", mask = bowen_island_mask)\n#### EXPORT AS RASTER AND DOCUMENT LAYERS IN CSV ####\nsei_rasters &lt;- c(RI_ff, RI_gu, FW_la, FW_pd, WN_sw, WN_bo_fn_sp, HB_cs, HB_vs, SV_ro, WD_co, WD_mx, YF_co, YF_mx, MF, OF, IT_mf, IT_el, IT_bs)\nsei_rasters %&gt;%\n  lapply(function(x) {\n    sei_name &lt;- names(x)\n    writeRaster(x, here(sei_dir, paste0(sei_name, \".tif\")), overwrite=TRUE)\n  })\n#&gt; [[1]]\n#&gt; class       : SpatRaster \n#&gt; dimensions  : 108, 96, 1  (nrow, ncol, nlyr)\n#&gt; resolution  : 100, 100  (x, y)\n#&gt; extent      : 1186388, 1195988, 482587.5, 493387.5  (xmin, xmax, ymin, ymax)\n#&gt; coord. ref. : +proj=aea +lat_0=45 +lon_0=-126 +lat_1=50 +lat_2=58.5 +x_0=1000000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs \n#&gt; source      : RI_ff.tif \n#&gt; name        : RI_ff \n#&gt; min value   :     1 \n#&gt; max value   :     1 \n#&gt; \n#&gt; [[2]]\n#&gt; class       : SpatRaster \n#&gt; dimensions  : 108, 96, 1  (nrow, ncol, nlyr)\n#&gt; resolution  : 100, 100  (x, y)\n#&gt; extent      : 1186388, 1195988, 482587.5, 493387.5  (xmin, xmax, ymin, ymax)\n#&gt; coord. ref. : +proj=aea +lat_0=45 +lon_0=-126 +lat_1=50 +lat_2=58.5 +x_0=1000000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs \n#&gt; source      : RI_gu.tif \n#&gt; name        : RI_gu \n#&gt; min value   :     1 \n#&gt; max value   :     1 \n#&gt; \n#&gt; [[3]]\n#&gt; class       : SpatRaster \n#&gt; dimensions  : 108, 96, 1  (nrow, ncol, nlyr)\n#&gt; resolution  : 100, 100  (x, y)\n#&gt; extent      : 1186388, 1195988, 482587.5, 493387.5  (xmin, xmax, ymin, ymax)\n#&gt; coord. ref. : +proj=aea +lat_0=45 +lon_0=-126 +lat_1=50 +lat_2=58.5 +x_0=1000000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs \n#&gt; source      : FW_la.tif \n#&gt; name        : FW_la \n#&gt; min value   :     1 \n#&gt; max value   :     1 \n#&gt; \n#&gt; [[4]]\n#&gt; class       : SpatRaster \n#&gt; dimensions  : 108, 96, 1  (nrow, ncol, nlyr)\n#&gt; resolution  : 100, 100  (x, y)\n#&gt; extent      : 1186388, 1195988, 482587.5, 493387.5  (xmin, xmax, ymin, ymax)\n#&gt; coord. ref. : +proj=aea +lat_0=45 +lon_0=-126 +lat_1=50 +lat_2=58.5 +x_0=1000000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs \n#&gt; source      : FW_pd.tif \n#&gt; name        : FW_pd \n#&gt; min value   :     1 \n#&gt; max value   :     1 \n#&gt; \n#&gt; [[5]]\n#&gt; class       : SpatRaster \n#&gt; dimensions  : 108, 96, 1  (nrow, ncol, nlyr)\n#&gt; resolution  : 100, 100  (x, y)\n#&gt; extent      : 1186388, 1195988, 482587.5, 493387.5  (xmin, xmax, ymin, ymax)\n#&gt; coord. ref. : +proj=aea +lat_0=45 +lon_0=-126 +lat_1=50 +lat_2=58.5 +x_0=1000000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs \n#&gt; source      : WN_sw.tif \n#&gt; name        : WN_sw \n#&gt; min value   :     1 \n#&gt; max value   :     1 \n#&gt; \n#&gt; [[6]]\n#&gt; class       : SpatRaster \n#&gt; dimensions  : 108, 96, 1  (nrow, ncol, nlyr)\n#&gt; resolution  : 100, 100  (x, y)\n#&gt; extent      : 1186388, 1195988, 482587.5, 493387.5  (xmin, xmax, ymin, ymax)\n#&gt; coord. ref. : +proj=aea +lat_0=45 +lon_0=-126 +lat_1=50 +lat_2=58.5 +x_0=1000000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs \n#&gt; source      : WN_bo_fn_sp.tif \n#&gt; name        : WN_bo_fn_sp \n#&gt; min value   :           1 \n#&gt; max value   :           1 \n#&gt; \n#&gt; [[7]]\n#&gt; class       : SpatRaster \n#&gt; dimensions  : 108, 96, 1  (nrow, ncol, nlyr)\n#&gt; resolution  : 100, 100  (x, y)\n#&gt; extent      : 1186388, 1195988, 482587.5, 493387.5  (xmin, xmax, ymin, ymax)\n#&gt; coord. ref. : +proj=aea +lat_0=45 +lon_0=-126 +lat_1=50 +lat_2=58.5 +x_0=1000000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs \n#&gt; source      : HB_cs.tif \n#&gt; name        : HB_cs \n#&gt; min value   :     1 \n#&gt; max value   :     1 \n#&gt; \n#&gt; [[8]]\n#&gt; class       : SpatRaster \n#&gt; dimensions  : 108, 96, 1  (nrow, ncol, nlyr)\n#&gt; resolution  : 100, 100  (x, y)\n#&gt; extent      : 1186388, 1195988, 482587.5, 493387.5  (xmin, xmax, ymin, ymax)\n#&gt; coord. ref. : +proj=aea +lat_0=45 +lon_0=-126 +lat_1=50 +lat_2=58.5 +x_0=1000000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs \n#&gt; source      : HB_vs.tif \n#&gt; name        : HB_vs \n#&gt; min value   :     1 \n#&gt; max value   :     1 \n#&gt; \n#&gt; [[9]]\n#&gt; class       : SpatRaster \n#&gt; dimensions  : 108, 96, 1  (nrow, ncol, nlyr)\n#&gt; resolution  : 100, 100  (x, y)\n#&gt; extent      : 1186388, 1195988, 482587.5, 493387.5  (xmin, xmax, ymin, ymax)\n#&gt; coord. ref. : +proj=aea +lat_0=45 +lon_0=-126 +lat_1=50 +lat_2=58.5 +x_0=1000000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs \n#&gt; source      : SV_ro.tif \n#&gt; name        : SV_ro \n#&gt; min value   :     1 \n#&gt; max value   :     1 \n#&gt; \n#&gt; [[10]]\n#&gt; class       : SpatRaster \n#&gt; dimensions  : 108, 96, 1  (nrow, ncol, nlyr)\n#&gt; resolution  : 100, 100  (x, y)\n#&gt; extent      : 1186388, 1195988, 482587.5, 493387.5  (xmin, xmax, ymin, ymax)\n#&gt; coord. ref. : +proj=aea +lat_0=45 +lon_0=-126 +lat_1=50 +lat_2=58.5 +x_0=1000000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs \n#&gt; source      : WD_co.tif \n#&gt; name        : WD_co \n#&gt; min value   :     1 \n#&gt; max value   :     1 \n#&gt; \n#&gt; [[11]]\n#&gt; class       : SpatRaster \n#&gt; dimensions  : 108, 96, 1  (nrow, ncol, nlyr)\n#&gt; resolution  : 100, 100  (x, y)\n#&gt; extent      : 1186388, 1195988, 482587.5, 493387.5  (xmin, xmax, ymin, ymax)\n#&gt; coord. ref. : +proj=aea +lat_0=45 +lon_0=-126 +lat_1=50 +lat_2=58.5 +x_0=1000000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs \n#&gt; source      : WD_mx.tif \n#&gt; name        : WD_mx \n#&gt; min value   :     1 \n#&gt; max value   :     1 \n#&gt; \n#&gt; [[12]]\n#&gt; class       : SpatRaster \n#&gt; dimensions  : 108, 96, 1  (nrow, ncol, nlyr)\n#&gt; resolution  : 100, 100  (x, y)\n#&gt; extent      : 1186388, 1195988, 482587.5, 493387.5  (xmin, xmax, ymin, ymax)\n#&gt; coord. ref. : +proj=aea +lat_0=45 +lon_0=-126 +lat_1=50 +lat_2=58.5 +x_0=1000000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs \n#&gt; source      : YF_co.tif \n#&gt; name        : YF_co \n#&gt; min value   :     1 \n#&gt; max value   :     1 \n#&gt; \n#&gt; [[13]]\n#&gt; class       : SpatRaster \n#&gt; dimensions  : 108, 96, 1  (nrow, ncol, nlyr)\n#&gt; resolution  : 100, 100  (x, y)\n#&gt; extent      : 1186388, 1195988, 482587.5, 493387.5  (xmin, xmax, ymin, ymax)\n#&gt; coord. ref. : +proj=aea +lat_0=45 +lon_0=-126 +lat_1=50 +lat_2=58.5 +x_0=1000000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs \n#&gt; source      : YF_mx.tif \n#&gt; name        : YF_mx \n#&gt; min value   :     1 \n#&gt; max value   :     1 \n#&gt; \n#&gt; [[14]]\n#&gt; class       : SpatRaster \n#&gt; dimensions  : 108, 96, 1  (nrow, ncol, nlyr)\n#&gt; resolution  : 100, 100  (x, y)\n#&gt; extent      : 1186388, 1195988, 482587.5, 493387.5  (xmin, xmax, ymin, ymax)\n#&gt; coord. ref. : +proj=aea +lat_0=45 +lon_0=-126 +lat_1=50 +lat_2=58.5 +x_0=1000000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs \n#&gt; source      : MF.tif \n#&gt; name        : MF \n#&gt; min value   :  1 \n#&gt; max value   :  1 \n#&gt; \n#&gt; [[15]]\n#&gt; class       : SpatRaster \n#&gt; dimensions  : 108, 96, 1  (nrow, ncol, nlyr)\n#&gt; resolution  : 100, 100  (x, y)\n#&gt; extent      : 1186388, 1195988, 482587.5, 493387.5  (xmin, xmax, ymin, ymax)\n#&gt; coord. ref. : +proj=aea +lat_0=45 +lon_0=-126 +lat_1=50 +lat_2=58.5 +x_0=1000000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs \n#&gt; source      : OF.tif \n#&gt; name        : OF \n#&gt; min value   :  1 \n#&gt; max value   :  1 \n#&gt; \n#&gt; [[16]]\n#&gt; class       : SpatRaster \n#&gt; dimensions  : 108, 96, 1  (nrow, ncol, nlyr)\n#&gt; resolution  : 100, 100  (x, y)\n#&gt; extent      : 1186388, 1195988, 482587.5, 493387.5  (xmin, xmax, ymin, ymax)\n#&gt; coord. ref. : +proj=aea +lat_0=45 +lon_0=-126 +lat_1=50 +lat_2=58.5 +x_0=1000000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs \n#&gt; source      : IT_mf.tif \n#&gt; name        : IT_mf \n#&gt; min value   :     1 \n#&gt; max value   :     1 \n#&gt; \n#&gt; [[17]]\n#&gt; class       : SpatRaster \n#&gt; dimensions  : 108, 96, 1  (nrow, ncol, nlyr)\n#&gt; resolution  : 100, 100  (x, y)\n#&gt; extent      : 1186388, 1195988, 482587.5, 493387.5  (xmin, xmax, ymin, ymax)\n#&gt; coord. ref. : +proj=aea +lat_0=45 +lon_0=-126 +lat_1=50 +lat_2=58.5 +x_0=1000000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs \n#&gt; source      : IT_el.tif \n#&gt; name        : IT_el \n#&gt; min value   :     1 \n#&gt; max value   :     1 \n#&gt; \n#&gt; [[18]]\n#&gt; class       : SpatRaster \n#&gt; dimensions  : 108, 96, 1  (nrow, ncol, nlyr)\n#&gt; resolution  : 100, 100  (x, y)\n#&gt; extent      : 1186388, 1195988, 482587.5, 493387.5  (xmin, xmax, ymin, ymax)\n#&gt; coord. ref. : +proj=aea +lat_0=45 +lon_0=-126 +lat_1=50 +lat_2=58.5 +x_0=1000000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs \n#&gt; source      : IT_bs.tif \n#&gt; name        : IT_bs \n#&gt; min value   :     1 \n#&gt; max value   :     1\nsei_rasters_df &lt;- data.frame(sei_habitat = names(sei_rasters))\nsei_rasters_df$filepath &lt;- paste0(sei_rasters_df$sei_habitat, \".tif\")\nsei_rasters_df$weights &lt;- 1.0\nsave(sei_rasters_df, file = here(\"inst/extdata/\", \"bowen_sei_rasters_info.rda\"))\nwrite.csv(sei_rasters_df, here(\"inst/extdata/\", \"bowen_sei_rasters_info.csv\"))\n\n\n\n\n\nWe followed the methods from Arias-Patino et al. (2024) for the human disturbance layers included in the analyses. Pressures included urban areas, buildings, population density, roads, railways, navigable waterways, transmission lines, seismic lines, pipelines, mining, dams and reservoirs, oil and gas infrastructure, agriculture, pastures, forest harvesting, and recreation features. We reclassified the human disturbance raster into four levels based on intensity of disturbance: intact, low disturbance, medium disturbance, and high disturbance. We then normalized and inverted the values to prepare the disturbance data for input into Zonation, ensuring that areas with less disturbance correspond to higher values on a 0-1 scale.\n\n\nCode\n#### Human Disturbance #### \n# Contents of \"data-raw/human_disturbance/\" received from Miguel Arias Patino (marias@unbc.ca)\n# https://1sfu.sharepoint.com/:f:/r/teams/Cumulativeeffects-SFUTeams9/Shared%20Documents/General/BC%20Hydro%202025%20IRP/Environmental%20Layers/Human%20Footprint?csf=1&web=1&e=hUYDs7 \n# Thesis (methods): https://unbc.arcabc.ca/islandora/object/unbc%3A59107\n# Paper (methods): https://doi.org/10.1016/j.ecolind.2024.112407 \n# Paper (methods): https://doi.org/10.1139/facets-2021-0063  \ndisturb_path &lt;- here(\"data-raw/human_disturbance/human_footprint_30m_v2.tif\")\ndisturb &lt;- terra::rast(disturb_path)\n# Load Bowen Island Mask Created Previously\nbowen_island_mask &lt;- here(\"inst/extdata/bowen_mask.tif\") %&gt;%\n  rast()\n#### Resample Raster to Bowen Island ####\ndisturb_resamp &lt;- terra::resample(disturb, bowen_island_mask)\nwriteRaster(disturb_resamp, \n            here::here(\"inst/extdata\", \"bowen_human_footprint.tif\"), \n            overwrite=TRUE)\n#### Reclassify Raster to Intact, Low, Medium, High ####\n# https://www.facetsjournal.com/doi/10.1139/facets-2021-0063#sec-2 \n# Intact is 0 to 1 \n# Low disturbance is 1 to 4\n# Medium disturbance is 4 to 10\n# High disturbance is 10+ \n# Maximum theoretical value is 66\ndisturb_m &lt;- c(0, 1, 0,\n       1, 4, 1,\n       4, 10, 2,\n       10, 100, 3) %&gt;%\n  matrix(ncol = 3, byrow = T)\n# Reclassify disturbance to levels\ndisturb_recl &lt;- disturb_resamp %&gt;%\n  classify(disturb_m, include.lowest = T)\nwriteRaster(disturb_recl, \n            here::here(\"inst/extdata\", \"bowen_human_footprint_recl.tif\"), \n            overwrite=TRUE)\n#### Inverse Disturbance ####\n#' Normalize on 0 to 1 scale\nnormalize &lt;- function(input_rast) {\n  mm &lt;- minmax(input_rast)\n  min &lt;- mm[1]\n  max &lt;- mm[2]\n  normalized &lt;- (input_rast - min) / (max - min)\n}\n#' Invert raster, so max values are min and vice versa. \ninvert &lt;- function(input_rast) {\n  mm &lt;- minmax(input_rast)\n  max &lt;- mm[2]\n  inverted &lt;- max - input_rast \n}\n# Normalize and invert the disturbance, so its positive as Zonation input\ndisturb_inv &lt;- disturb_resamp %&gt;% \n  normalize() %&gt;%\n  invert()\nwriteRaster(disturb_inv, here(\"inst/extdata/bowen_human_footprint_inv.tif\"), overwrite=TRUE)",
    "crumbs": [
      "Zonation",
      "Conservation Prioritization for February 1st Bowen Island Workshop"
    ]
  },
  {
    "objectID": "vignettes/output_zonation_01_02_2025.html#zonation",
    "href": "vignettes/output_zonation_01_02_2025.html#zonation",
    "title": "Conservation Prioritization for February 1st Bowen Island Workshop",
    "section": "",
    "text": "Zonation 5 is a spatial prioritization software that can be used to identify priority areas to support conservation planning, land use planning, ecological impact avoidance and other similar tasks. The software uses spatial raster data on the distributions of individual biodiversity features (species, habitats, ecosystem services etc.) to identify which locations in a landscape are most important for retaining biodiversity. Zonation can account for local habitat quality and ecological connectivity together with costs, threats and different land tenure, thus providing a quantitative method for spatial planning that enhances the persistence of biodiversity in the long term.\n\nhttps://zonationteam.github.io/Zonation5/\nWe took all of the rasters prepared earlier and fed these into the Zonation 5 software. This should provide a relative ranking for locations from highest to lowest for the purposes of biodiversity conservation.\nNote: Zonation 5 is usually a standalone application. Here, I have enabled running of Zonation from R, using command line functions. This way we can adjust and automatically run Zonation, reading from data in R.\n\n\nCode\n#### CREATE DATAFRAME FOR INPUT LAYERS ####\n# Bowen Island SDM Table\nload(here(\"inst/extdata/bowen_sdm_status.rda\"))\nbowen_sdm_rasters_df &lt;- bowen_sdm_status %&gt;% \n  select(species, filepath, weights) %&gt;%\n  rename(group = species)\nbowen_sdm_rasters_df$filepath &lt;- bowen_sdm_rasters_df$filepath %&gt;% unlist()\nbowen_sdm_rasters_df$type &lt;- \"sdm\"\n# Bowen Island SEI Table\nload(here(\"inst/extdata/bowen_sei_rasters_info.rda\")) \nsei_rasters_df &lt;- sei_rasters_df %&gt;% \n  select(sei_habitat, filepath, weights) %&gt;%\n  rename(group = sei_habitat)\nsei_rasters_df$type &lt;- \"habitat\"\n# Bowen Island Disturbance\ndisturb_rasters_df &lt;- data.frame(filepath = \"bowen_human_footprint_inv.tif\",\n                                 weights = 1.0)\ndisturb_rasters_df$type &lt;- \"habitat\"\n# Bind all input layers together\nlayers_df &lt;- bind_rows(bowen_sdm_rasters_df, sei_rasters_df, disturb_rasters_df)\n#### Set weights based on \"species\" and \"habitat\" type so 50/50 weight\n# Get SDM weight\nn_sdm &lt;- layers_df %&gt;%\n  filter(type == \"sdm\") %&gt;%\n  nrow()\nweight_sdm &lt;- 1/n_sdm\n# Get habitat weight\nn_habitat &lt;- layers_df %&gt;%\n  filter(type == \"habitat\") %&gt;%\n  nrow()\nweight_habitat &lt;- 1/n_habitat\n# Set weights\nlayers_df &lt;- layers_df %&gt;%\n  mutate(\n    weights = case_when(\n      type == \"sdm\" ~ weight_sdm,\n      type == \"habitat\" ~ weight_habitat\n    )\n  )\n#### Get fullpaths for filenames in inst/extdata\nrasters_df &lt;- data.frame(fullpath = here(\"inst/extdata/\", list.files(path = here(\"inst/extdata\"), recursive = T, pattern = \"*.tif$\")))\nrasters_df$filepath &lt;- basename(rasters_df$fullpath)\n# Merge with weights\nweights_df &lt;- merge(layers_df, rasters_df, by = \"filepath\")\nweights_df$relpath &lt;- weights_df$fullpath %&gt;%\n  gsub(paste0(here(),\"/\"), \"\", .) # Prepare paths for Shiny app \nsave(weights_df, file = here(\"inst/extdata/weights_df.rda\"))\n#### CREATE features.txt FOR ZONATION RUN ####\n# Create features.txt from files available in data\nfeatures_path &lt;- here(\"vignettes/zonation/features.txt\")\ncat('\"weight\" \"filename\"', \n    file = features_path,\n    sep = \"\\n\")\nfor(i in 1:nrow(weights_df)) {\n  next_row &lt;- paste0(weights_df[i, \"weights\"], \" \", weights_df[i, \"fullpath\"])\n  cat(next_row,\n      file = features_path,\n      append = TRUE,\n      sep = \"\\n\")\n}\n#### SET PARAMS FOR ZONATION RUN ####\nzonation5_location &lt;- here(\"vignettes/zonation/zonation5\") \nzonation5_mode &lt;- \"CAZ2\"\n# Zonation5 Setting Text File\nzonation5_settings &lt;-  here(\"vignettes/zonation/settings.z5\")\nzonation5_settings_txt &lt;- c(\"feature list file = features.txt\", \n                            paste0(\"analysis area mask layer = \", here(\"inst/extdata/bowen_mask.tif\"))) # Add Bowen Island Mask\nwriteLines(zonation5_settings_txt, zonation5_settings)\nzonation5_output &lt;- here(\"vignettes/zonation/output\") \nzonation5_command &lt;- str_glue(\n  '{zonation5_location} -a --mode={zonation5_mode} {zonation5_settings} {zonation5_output}',\n  zonation5_location = zonation5_location,\n  zonation5_mode = zonation5_mode,\n  zonation5_settings = zonation5_settings,\n  zonation5_output = zonation5_output\n) %&gt;%\n  str_c()\n#### ZONATION RUN ####\nsystem(command = zonation5_command)",
    "crumbs": [
      "Zonation",
      "Conservation Prioritization for February 1st Bowen Island Workshop"
    ]
  },
  {
    "objectID": "vignettes/output_zonation_01_02_2025.html#output",
    "href": "vignettes/output_zonation_01_02_2025.html#output",
    "title": "Conservation Prioritization for February 1st Bowen Island Workshop",
    "section": "",
    "text": "Code\n#### VISUALIZE OUTPUT ####\nrankmap &lt;- here(\"vignettes/zonation/output/rankmap.tif\") %&gt;% rast()\nplot(rankmap)",
    "crumbs": [
      "Zonation",
      "Conservation Prioritization for February 1st Bowen Island Workshop"
    ]
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Bowen Island Biodiversity Plan",
    "section": "",
    "text": "The purpose of this website is to capture and share the analyses for conducting spatial prioritization of conservation areas on Bowen Island. This is part of a greater effort to inform the decision-making and community planning for the Bowen Island Municipality.\n\n\n\n\n\nJay Matsushiba\nMichael Tylo\nWendy Palen\nTom Sisk\n\n\n\nMaya Persam\nKyra Rolfe\nValerie Kwok\n\n\n\n\nAdd workshop participants",
    "crumbs": [
      "Home"
    ]
  },
  {
    "objectID": "index.html#purpose",
    "href": "index.html#purpose",
    "title": "Bowen Island Biodiversity Plan",
    "section": "",
    "text": "The purpose of this website is to capture and share the analyses for conducting spatial prioritization of conservation areas on Bowen Island. This is part of a greater effort to inform the decision-making and community planning for the Bowen Island Municipality.",
    "crumbs": [
      "Home"
    ]
  },
  {
    "objectID": "index.html#contributors",
    "href": "index.html#contributors",
    "title": "Bowen Island Biodiversity Plan",
    "section": "",
    "text": "Jay Matsushiba\nMichael Tylo\nWendy Palen\nTom Sisk\n\n\n\nMaya Persam\nKyra Rolfe\nValerie Kwok\n\n\n\n\nAdd workshop participants",
    "crumbs": [
      "Home"
    ]
  },
  {
    "objectID": "vignettes/output_zonation_17_04_2025.html",
    "href": "vignettes/output_zonation_17_04_2025.html",
    "title": "Conservation Prioritization April 17 2025 Update",
    "section": "",
    "text": "This Rmarkdown documents the Zonation run used for the April 17 2025 iteration for Bowen Island Biodiversity Planning.\nhttps://github.com/zonationteam/Zonation5\n\n\nCode\n#### Palen Lab Packages ####\nlibrary(bowen.biodiversity.webapp)\n\n#### Other Packages ####\nlibrary(here)\n#&gt; here() starts at /home/jay/Programming_Projects/bowen.biodiversity.webapp\nlibrary(dplyr)\n#&gt; \n#&gt; Attaching package: 'dplyr'\n#&gt; The following objects are masked from 'package:stats':\n#&gt; \n#&gt;     filter, lag\n#&gt; The following objects are masked from 'package:base':\n#&gt; \n#&gt;     intersect, setdiff, setequal, union\nlibrary(stringr)\nlibrary(foreach)\nlibrary(sf)\n#&gt; Linking to GEOS 3.11.1, GDAL 3.6.4, PROJ 9.1.1; sf_use_s2() is TRUE\nlibrary(terra)\n#&gt; terra 1.8.5\nlibrary(tidyterra)\n#&gt; \n#&gt; Attaching package: 'tidyterra'\n#&gt; The following object is masked from 'package:stats':\n#&gt; \n#&gt;     filter\nlibrary(readxl)\nlibrary(googlesheets4)\n\nsdm_url &lt;- \"https://docs.google.com/spreadsheets/d/1IGFwkr9LidcZwbzOJJGSEXLsmpKp0a9gBs65EY-H1xw/edit?usp=sharing\"\nhabitats_url &lt;- \"https://docs.google.com/spreadsheets/d/1yDKw4r3tbXYivwtxbbfxc-pYSbtbj_o2ee1pwlNCOO4/edit?usp=drive_link\"\n\n\n\n\n\nZonation 5 is a spatial prioritization software that can be used to identify priority areas to support conservation planning, land use planning, ecological impact avoidance and other similar tasks. The software uses spatial raster data on the distributions of individual biodiversity features (species, habitats, ecosystem services etc.) to identify which locations in a landscape are most important for retaining biodiversity. Zonation can account for local habitat quality and ecological connectivity together with costs, threats and different land tenure, thus providing a quantitative method for spatial planning that enhances the persistence of biodiversity in the long term.\n\nhttps://zonationteam.github.io/Zonation5/\nWe took all of the rasters prepared earlier and fed these into the Zonation 5 software. This should provide a relative ranking for locations from highest to lowest for the purposes of biodiversity conservation.\nNote: Zonation 5 is usually a standalone application. Here, I have enabled running of Zonation from R, using command line functions. This way we can adjust and automatically run Zonation, reading from data in R.\n\n\nCode\n#### CREATE DATAFRAME FOR INPUT LAYERS ####\n# Read from Google Sheets\nhabitats_df &lt;- read_sheet(habitats_url, sheet = \"2025-04-17\") \n#&gt; ℹ Suitable tokens found in the cache, associated with these emails:\n#&gt; • 'hello@jmatsushiba.com'\n#&gt; • 'palenlab@gmail.com'\n#&gt;   Defaulting to the first email.\n#&gt; ! Using an auto-discovered, cached token.\n#&gt;   To suppress this message, modify your code or options to clearly consent to\n#&gt;   the use of a cached token.\n#&gt;   See gargle's \"Non-interactive auth\" vignette for more details:\n#&gt;   &lt;https://gargle.r-lib.org/articles/non-interactive-auth.html&gt;\n#&gt; ℹ The googlesheets4 package is using a cached token for\n#&gt;   'hello@jmatsushiba.com'.\n#&gt; Auto-refreshing stale OAuth token.\n#&gt; ✔ Reading from \"habitats\".\n#&gt; ✔ Range ''2025-04-17''.\nsdm_df &lt;- read_sheet(sdm_url, sheet = \"2025-04-17\") %&gt;%\n  select(colnames(habitats_df)) # Select common columns\n#&gt; ✔ Reading from \"sdm\".\n#&gt; ✔ Range ''2025-04-17''.\n# Bind all input layers together\nlayers_df &lt;- bind_rows(habitats_df, sdm_df) %&gt;%\n  filter(weight &gt; 0)\n\n#### UPDATE features.txt FOR ZONATION RUN ####\n# UPDATE features.txt from files available in data\nfeatures_path &lt;- here(\"vignettes/zonation/features.txt\")\ncat('\"weight\" \"filename\"', \n    file = features_path,\n    sep = \"\\n\")\nfor(i in 1:nrow(layers_df)) {\n  next_row &lt;- paste0(layers_df[i, \"weight\"], \" \", layers_df[i, \"path\"])\n  cat(next_row,\n      file = features_path,\n      append = TRUE,\n      sep = \"\\n\")\n}\n#### SET PARAMS FOR ZONATION RUN ####\nzonation5_location &lt;- here(\"vignettes/zonation/zonation5\") \nzonation5_mode &lt;- \"CAZ2\"\n# Zonation5 Setting Text File\nzonation5_settings &lt;-  here(\"vignettes/zonation/settings.z5\")\nzonation5_settings_txt &lt;- c(\"feature list file = features.txt\", \n                            paste0(\"analysis area mask layer = \", here(\"inst/extdata/bowen_mask.tif\"))) # Add Bowen Island Mask\nwriteLines(zonation5_settings_txt, zonation5_settings)\nzonation5_output &lt;- here(\"vignettes/zonation/output\") \nzonation5_command &lt;- str_glue(\n  '{zonation5_location} -a -w --mode={zonation5_mode} {zonation5_settings} {zonation5_output}',\n  zonation5_location = zonation5_location,\n  zonation5_mode = zonation5_mode,\n  zonation5_settings = zonation5_settings,\n  zonation5_output = zonation5_output\n) %&gt;%\n  str_c()\n#### ZONATION RUN ####\nsystem(command = zonation5_command)\n\n#### Save Zonation Run #### \noutput_dir &lt;- here(\"inst/extdata/output_zonation\", Sys.Date())\ndir.create(output_dir)\nfile.copy(list.files(here(\"vignettes/zonation/output\"), full.names = T, recursive = T),\n          output_dir,\n          recursive = T)\n#&gt;  [1] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE\n\n\n\n\n\n\n\nCode\n#### VISUALIZE OUTPUT ####\nrankmap &lt;- here(output_dir , \"rankmap.tif\") %&gt;% rast()\nplot(rankmap)",
    "crumbs": [
      "Zonation",
      "Conservation Prioritization April 17 2025 Update"
    ]
  },
  {
    "objectID": "vignettes/output_zonation_17_04_2025.html#zonation",
    "href": "vignettes/output_zonation_17_04_2025.html#zonation",
    "title": "Conservation Prioritization April 17 2025 Update",
    "section": "",
    "text": "Zonation 5 is a spatial prioritization software that can be used to identify priority areas to support conservation planning, land use planning, ecological impact avoidance and other similar tasks. The software uses spatial raster data on the distributions of individual biodiversity features (species, habitats, ecosystem services etc.) to identify which locations in a landscape are most important for retaining biodiversity. Zonation can account for local habitat quality and ecological connectivity together with costs, threats and different land tenure, thus providing a quantitative method for spatial planning that enhances the persistence of biodiversity in the long term.\n\nhttps://zonationteam.github.io/Zonation5/\nWe took all of the rasters prepared earlier and fed these into the Zonation 5 software. This should provide a relative ranking for locations from highest to lowest for the purposes of biodiversity conservation.\nNote: Zonation 5 is usually a standalone application. Here, I have enabled running of Zonation from R, using command line functions. This way we can adjust and automatically run Zonation, reading from data in R.\n\n\nCode\n#### CREATE DATAFRAME FOR INPUT LAYERS ####\n# Read from Google Sheets\nhabitats_df &lt;- read_sheet(habitats_url, sheet = \"2025-04-17\") \n#&gt; ℹ Suitable tokens found in the cache, associated with these emails:\n#&gt; • 'hello@jmatsushiba.com'\n#&gt; • 'palenlab@gmail.com'\n#&gt;   Defaulting to the first email.\n#&gt; ! Using an auto-discovered, cached token.\n#&gt;   To suppress this message, modify your code or options to clearly consent to\n#&gt;   the use of a cached token.\n#&gt;   See gargle's \"Non-interactive auth\" vignette for more details:\n#&gt;   &lt;https://gargle.r-lib.org/articles/non-interactive-auth.html&gt;\n#&gt; ℹ The googlesheets4 package is using a cached token for\n#&gt;   'hello@jmatsushiba.com'.\n#&gt; Auto-refreshing stale OAuth token.\n#&gt; ✔ Reading from \"habitats\".\n#&gt; ✔ Range ''2025-04-17''.\nsdm_df &lt;- read_sheet(sdm_url, sheet = \"2025-04-17\") %&gt;%\n  select(colnames(habitats_df)) # Select common columns\n#&gt; ✔ Reading from \"sdm\".\n#&gt; ✔ Range ''2025-04-17''.\n# Bind all input layers together\nlayers_df &lt;- bind_rows(habitats_df, sdm_df) %&gt;%\n  filter(weight &gt; 0)\n\n#### UPDATE features.txt FOR ZONATION RUN ####\n# UPDATE features.txt from files available in data\nfeatures_path &lt;- here(\"vignettes/zonation/features.txt\")\ncat('\"weight\" \"filename\"', \n    file = features_path,\n    sep = \"\\n\")\nfor(i in 1:nrow(layers_df)) {\n  next_row &lt;- paste0(layers_df[i, \"weight\"], \" \", layers_df[i, \"path\"])\n  cat(next_row,\n      file = features_path,\n      append = TRUE,\n      sep = \"\\n\")\n}\n#### SET PARAMS FOR ZONATION RUN ####\nzonation5_location &lt;- here(\"vignettes/zonation/zonation5\") \nzonation5_mode &lt;- \"CAZ2\"\n# Zonation5 Setting Text File\nzonation5_settings &lt;-  here(\"vignettes/zonation/settings.z5\")\nzonation5_settings_txt &lt;- c(\"feature list file = features.txt\", \n                            paste0(\"analysis area mask layer = \", here(\"inst/extdata/bowen_mask.tif\"))) # Add Bowen Island Mask\nwriteLines(zonation5_settings_txt, zonation5_settings)\nzonation5_output &lt;- here(\"vignettes/zonation/output\") \nzonation5_command &lt;- str_glue(\n  '{zonation5_location} -a -w --mode={zonation5_mode} {zonation5_settings} {zonation5_output}',\n  zonation5_location = zonation5_location,\n  zonation5_mode = zonation5_mode,\n  zonation5_settings = zonation5_settings,\n  zonation5_output = zonation5_output\n) %&gt;%\n  str_c()\n#### ZONATION RUN ####\nsystem(command = zonation5_command)\n\n#### Save Zonation Run #### \noutput_dir &lt;- here(\"inst/extdata/output_zonation\", Sys.Date())\ndir.create(output_dir)\nfile.copy(list.files(here(\"vignettes/zonation/output\"), full.names = T, recursive = T),\n          output_dir,\n          recursive = T)\n#&gt;  [1] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE",
    "crumbs": [
      "Zonation",
      "Conservation Prioritization April 17 2025 Update"
    ]
  },
  {
    "objectID": "vignettes/output_zonation_17_04_2025.html#output",
    "href": "vignettes/output_zonation_17_04_2025.html#output",
    "title": "Conservation Prioritization April 17 2025 Update",
    "section": "",
    "text": "Code\n#### VISUALIZE OUTPUT ####\nrankmap &lt;- here(output_dir , \"rankmap.tif\") %&gt;% rast()\nplot(rankmap)",
    "crumbs": [
      "Zonation",
      "Conservation Prioritization April 17 2025 Update"
    ]
  },
  {
    "objectID": "vignettes/input_sdm.html",
    "href": "vignettes/input_sdm.html",
    "title": "Conservation Layer: Species",
    "section": "",
    "text": "Code\n#### Palen Lab Packages ####\nlibrary(bowen.biodiversity.webapp)\n\n#### Other Packages ####\nlibrary(here)\n#&gt; here() starts at /home/jay/Programming_Projects/bowen.biodiversity.webapp\nlibrary(dplyr)\n#&gt; \n#&gt; Attaching package: 'dplyr'\n#&gt; The following objects are masked from 'package:stats':\n#&gt; \n#&gt;     filter, lag\n#&gt; The following objects are masked from 'package:base':\n#&gt; \n#&gt;     intersect, setdiff, setequal, union\nlibrary(stringr)\nlibrary(foreach)\nlibrary(sf)\n#&gt; Linking to GEOS 3.11.1, GDAL 3.6.4, PROJ 9.1.1; sf_use_s2() is TRUE\nlibrary(terra)\n#&gt; terra 1.8.5\nlibrary(tidyterra)\n#&gt; \n#&gt; Attaching package: 'tidyterra'\n#&gt; The following object is masked from 'package:stats':\n#&gt; \n#&gt;     filter\nlibrary(readxl)\nlibrary(googlesheets4)",
    "crumbs": [
      "Conservation Layers",
      "Conservation Layer: Species"
    ]
  },
  {
    "objectID": "vignettes/input_sdm.html#species-distribution-models",
    "href": "vignettes/input_sdm.html#species-distribution-models",
    "title": "Conservation Layer: Species",
    "section": "Species Distribution Models",
    "text": "Species Distribution Models\nThe species distribution models (SDMs) included in the Bowen Island Conservation Plan analyses were originally produced by Viorel Popescu (Popescu et al., 2020). Out of the 341 SDMs available, we included 193 of the SDMs. Occurrence locations of small vertebrate species were gathered from Global Biodiversity Information Facility (data.gbif.org) and Nature Counts (birdscanada.org/birdmon) open-access databases. Inclusion of small mammal species was based on Appendix 2 & 3 from the 2005 Environmental Inventory report, which states species presence on Bowen Island. We used the iNaturalist and eBird databases of observations for the inclusion criteria for reptiles, amphibians, and birds (described in further detail in Methods).\n\n\nCode\n#### SPECIES DISTRIBUTION MODELS ####\n# Contents of \"data-raw/species_distribution_models/\" downloaded from Cumulative effects - SFU Teams Sharepoint \n# https://1sfu.sharepoint.com/:f:/r/teams/Cumulativeeffects-SFUTeams9/Shared%20Documents/BCH_project_backup/SPECIES?csf=1&web=1&e=FpNkgc \n# Directory Path: BCH_project_backup/SPECIES/\n# Paper: https://www.nature.com/articles/s41598-020-64501-7#MOESM1\n# See Wendy Palen (SFU) for access \n#### PROCESSING SDM ####\n# Get list of available SDMs\nsdm_folder &lt;- here(\"data-raw/species_distribution_models\")\nsdm_folder_tif &lt;- list.files(sdm_folder, recursive = T, pattern = \"*.tif$\") # Get only .tif files\n# Correspondence with Viorel Popescu confirms that _NAs_ should be SDMs with rock, ice, large lakes layers masked\nsdm_folder_tif_NAs &lt;- sdm_folder_tif[grepl(\"_NAs_\", sdm_folder_tif)] # Get only .tif with \"_NAs_\" in filename\n# Directory to save SDMs\nsdm_output_dir &lt;- here(\"inst/extdata/sdm\")\nif(!dir.exists(sdm_output_dir)) {\n  dir.create(sdm_output_dir)\n}\n\n\n\n\nCode\n# Create Bowen Island mask using DSM\nsample_sdm &lt;- rast(here(sdm_folder, sdm_folder_tif_NAs[1])) %&gt;%\n  terra::project(y = sdm_crs) %&gt;%\n  terra::crop(bowen_island_admin, snap = \"out\") %&gt;%\n  terra::disagg(fact = 4)\ndsm &lt;- rast(here(\"data-raw/bowen_dsm/chm.tif\"))\ndsm_smooth &lt;- dsm %&gt;% \n  focal(w=9, fun=mean, na.policy=\"only\", na.rm=T) %&gt;% \n  terra::project(y = sdm_crs) %&gt;%\n  terra::resample(sample_sdm, method = \"average\")\nm &lt;- c(-1, 35, 1) %&gt;% matrix(ncol = 3, byrow=T)\nbowen_island_mask &lt;- dsm_smooth %&gt;% \n  classify(m) %&gt;%\n  as.int()\nwriteRaster(bowen_island_mask, here(\"inst/extdata/bowen_mask.tif\"), overwrite = T)\n# Weights for terra::focal() function that provides moving window average\n# - Smoothing algorithm \n# - Use this to fill some empty cells on Bowen Island with weighted mean of the neighbouring cells.\nweights &lt;- matrix(c(0, 0, 1, 1, 1, 0, 0,\n                    0, 1, 1, 2, 1, 1, 0,\n                    1, 1, 3, 3, 3, 1, 1,\n                    1, 2, 3, 5, 3, 2, 1,\n                    1, 1, 3, 3, 3, 1, 1,\n                    0, 1, 1, 2, 1, 1, 0,\n                    0, 0, 1, 1, 1, 0, 0\n), nrow=7)\n#### PREPARE SDMs TO BOWEN ISLAND ####\n# Loop through SDMs\nforeach(sdm_tif = sdm_folder_tif_NAs) %do% {\n  sdm_path &lt;- here(sdm_folder, sdm_tif) \n  sdm_output_path &lt;- here(sdm_output_dir, basename(sdm_tif))\n  sdm &lt;- rast(sdm_path)\n  # Normalize SDMs that range from 0 to 1000\n  sdm_minmax &lt;- terra::minmax(sdm)\n  if(sdm_minmax[2] &gt; 1) {\n    sdm &lt;- sdm / 1000\n  }\n  sdm_output &lt;- sdm %&gt;%\n    #### Reproject SDM ####\n    terra::project(y = sdm_crs) %&gt;%\n    #### Crop SDM ####\n    # Figured out why the SDMs were cropped incorrectly\n    # The default for cropping a raster by a polygon is to snap = \"near\"\n    # This means that the polygon extent is snapped to the closest raster\n    # We need snap = \"out\" to make sure the full extent of the polygon is covered by the output raster\n    terra::crop(bowen_island_admin, snap = \"out\") %&gt;%\n    #### Extrapolate for Southern Parts of Bowen Island\n    # - fills the NA values missing in south part of Bowen Island\n    terra::focal(w = weights,\n                 fun = \"mean\",\n                 na.policy = \"only\") %&gt;%\n    #### Downsamples ####\n    # - from 400 m to 100 m resolution\n    terra::disagg(fact = 4) %&gt;%\n    #### Smooths the raster ####\n    terra::focal(w = weights,\n                 fun = \"mean\",\n                 na.rm = T,\n                 na.policy = \"omit\") %&gt;%\n    terra::mask(bowen_island_mask)\n  \n  writeRaster(sdm_output, sdm_output_path, overwrite = T)\n}\n# Create species list from available SDMs\nspecies_list &lt;- sdm_folder_tif_NAs %&gt;%\n  basename() %&gt;%\n  stringr::str_extract(\"^\\\\S+\\\\.[a-zA-Z]+_\") %&gt;%\n  stringr::str_remove(\"_\") %&gt;%\n  stringr::str_replace(\"\\\\.\", \" \")\n# Create taxon list \ntaxon_list &lt;- sdm_folder_tif_NAs %&gt;%\n  dirname() %&gt;%\n  str_remove(\"_mask\")\n# Get iNaturalist and SDM congruence\nsdm_inat &lt;- foreach(i = 1:length(species_list), .combine = \"rbind\") %do% {\n  # Progress Message \n  print(paste0(\"Currently working on species \", i, \" out of \", length(species_list),\". This is \", species_list[i], \".\"))\n  # Query iNaturalist by species name and Bowen Island Administrative Boundaries\n  rinat_results_sf &lt;- tryCatch({\n    Sys.sleep(3) # Need to slow down queries to prevent requests being blocked\n    rinat::get_inat_obs_sf(taxon_name = species_list[i],\n                           area = st_as_sf(bowen_island_admin),\n                           maxresults = 10000)\n  }, error = function(cond) {\n    NA\n  })\n  # Get number of iNaturalist observations\n  if(!is.data.frame(rinat_results_sf)) {\n    inat_n_obs &lt;- 0\n  } else {\n    inat_n_obs &lt;- nrow(rinat_results_sf)\n  }\n  # Get Bowen Island SDM\n  sdm &lt;- paste0(str_replace(species_list[i], \" \", \".\"), \"_NAs_pu_mask.tif\") %&gt;%\n    here(sdm_output_dir, .) %&gt;%\n    rast()\n  # Get highest value in SDM\n  sdm_max &lt;- sdm %&gt;% \n    minmax() %&gt;% \n    max()\n  # PREPARE OUTPUT ROW\n  # 1. scientific species name\n  # 2. highest SDM cell value within area \n  # 3. observation count from iNaturalist\n  result &lt;- data.frame(species = species_list[i],\n                       sdm_max_value = sdm_max,\n                       inat_n_obs = inat_n_obs)\n}\nsdm_inat$taxon_group &lt;- taxon_list\n#### Query eBird for birds ####\n# Number of eBird observations by bird species on Bowen Island\n# - Results from Natasha Beauregard (Summer 2024 USRA)\nbowen_ebird &lt;- read.csv(here(\"data-raw/bowen_ebird/final_bird.csv\")) %&gt;%\n  select(c(\"scientific_name\", \"n_ebird\"))\n# Combine eBird and iNaturalist counts\nbowen_SDM_iNat_ebird &lt;- merge(sdm_inat, \n                              bowen_ebird, \n                              by.x = \"species\", \n                              by.y = \"scientific_name\",\n                              all.x = TRUE) %&gt;%\n  rename(n_obs_inat = inat_n_obs,\n         n_obs_ebird = n_ebird) %&gt;%\n  select(\n    species,\n    sdm_max_value,\n    taxon_group,\n    n_obs_inat,\n    n_obs_ebird\n  )\n# Query Pottinger Report (2005) for small mammals\nbowen_mammals &lt;- read_xlsx(here(\"data-raw/pottinger_report/Appendix 2 - Expected Occurrence of Wildlife Species In The Cape Roger Curtis Area.xlsx\")) %&gt;%\n  filter(`Documented on Bowen` == \"y\" | `Documented on Bowen` == \"?\" | `Documented on Bowen` == \"One or more spp\" )\n# Include Species if they meet any of the following criteria:\n# - eBird observations &gt; 0\n# - iNaturalist observations &gt; 0\n# - included in Pottinger Report \ninclude_threshold &lt;- 0.5 # Min SDM cell value somewhere on Bowen Island for including species into focal list\nbowen_SDM_obs_focal_df &lt;- bowen_SDM_iNat_ebird %&gt;%\n  mutate(include = case_when(\n    (n_obs_inat &gt; 0 | n_obs_ebird &gt; 0 ) & sdm_max_value &gt; include_threshold ~ \"y\",\n    species %in% bowen_mammals$`Scientific name` ~ \"y\")\n  )\n# Create list of species names to include\nbowen_focal_list &lt;- bowen_SDM_obs_focal_df %&gt;%\n  filter(include == \"y\") %&gt;%\n  select(species) %&gt;%\n  unlist() %&gt;%\n  unname() \n# Get filepath for each SDM\nbowen_SDM_iNat_ebird$filepath &lt;- lapply(bowen_SDM_iNat_ebird$species, function(x) {paste0(str_replace(x, \" \", \".\"), \"_NAs_pu_mask.tif\")})\n# Add columns that can be adjusted manually\nbowen_SDM_iNat_ebird$prov_status &lt;- \"\"\nbowen_SDM_iNat_ebird$fed_status &lt;- \"\"\nbowen_SDM_iNat_ebird$IUCN_status &lt;- \"\"\nbowen_SDM_iNat_ebird$weights &lt;- 1.0\n# Dataframe for focal species on Bowen Island\nbowen_sdm_focal &lt;- bowen_SDM_iNat_ebird %&gt;%\n  filter(species %in% bowen_focal_list)\n#### UPLOAD ####\n# This sheet was uploaded to Google Sheets\n# WARNING: DO NOT RUN OR WILL OVERWRITE MANUAL INPUT TO GOOGLE SHEETS\n# write_sheet(bowen_sdm_focal,\n#             \"https://docs.google.com/spreadsheets/d/1ehO30w4i7EDafilNyRpq3sgc86fm8g_TmYMI4ql3qms/edit?usp=sharing\",\n#             \"species\")\nspecies_distribution_models_focal_bowen_info &lt;- bowen_sdm_focal\nsaveRDS(species_distribution_models_focal_bowen_info, file = here(\"inst/extdata/sdm/sdm_focal.rds\"))\n\n\n\nCreating Species Information Spreadsheet\nConservation statuses for species at the provincial, federal, and global levels were obtained from the BC Species & Ecosystems Explorer and the IUCN Red List. Provincial statuses followed the Red, Blue, and Yellow List classifications, while federal statuses were based on COSEWIC assessments where applicable. In cases of taxonomic discrepancies, species names were updated to reflect current classifications and documented accordingly.\nBC Species and Ecosystems Explorer: https://a100.gov.bc.ca/pub/eswp/ IUCN Red List: https://www.iucnredlist.org/\nThe spreadsheet below contains all of the information on species name, taxon group, threatened status, weights to use for Zonation.\nVisit this link to view the spreadsheet, hosted on Google Drive. https://docs.google.com/spreadsheets/d/1ehO30w4i7EDafilNyRpq3sgc86fm8g_TmYMI4ql3qms/edit?usp=sharing\n\n\nCode\nsdm_focal &lt;- readRDS(here(\"inst/extdata/sdm/sdm_focal.rds\"))\n#### REVISION ####\n# - This section necessary, since Google Sheet was uploaded at earlier time\n# - Changes since made to the creation of Bowen SDM Focal\n# - Michael Tylo (USRA Spring 2025) did the work in the Google Sheet\n# Manually look up species and correct taxonomy, add conservation status\nsdm_googlesheet &lt;- read_sheet(\"https://docs.google.com/spreadsheets/d/1ehO30w4i7EDafilNyRpq3sgc86fm8g_TmYMI4ql3qms/edit?usp=sharing\") %&gt;%\n  select(!c(\"full_path\", \"filename\"))\n#&gt; ℹ Suitable tokens found in the cache, associated with these emails:\n#&gt; • 'hello@jmatsushiba.com'\n#&gt; • 'palenlab@gmail.com'\n#&gt;   Defaulting to the first email.\n#&gt; ! Using an auto-discovered, cached token.\n#&gt;   To suppress this message, modify your code or options to clearly consent to\n#&gt;   the use of a cached token.\n#&gt;   See gargle's \"Non-interactive auth\" vignette for more details:\n#&gt;   &lt;https://gargle.r-lib.org/articles/non-interactive-auth.html&gt;\n#&gt; ℹ The googlesheets4 package is using a cached token for\n#&gt;   'hello@jmatsushiba.com'.\n#&gt; ✔ Reading from \"species_layers\".\n#&gt; ✔ Range 'species'.\n# Drop duplicate columns, keep columns for n eBird and iNaturalist observations, max SDM values\nbowen_sdm_focal_sel &lt;- sdm_focal %&gt;%\n  select(!c(\"taxon_group\", \"prov_status\", \"fed_status\", \"IUCN_status\", \"weights\"))\n# Merge\nbowen_sdm_status &lt;- merge(bowen_sdm_focal_sel, sdm_googlesheet, by.x = \"species\", by.y = \"sci_name\", all.x = T) %&gt;%\n  rename(weight = weights,\n         name = species) %&gt;%\n  mutate(filename = as.character(filepath),\n         path = here(sdm_output_dir, filename),\n         category = taxon_group,\n         source = \"Viorel Popescu (2020), modified by Jay Matsushiba (2025)\") %&gt;%\n  select(!filepath) %&gt;%\n  relocate(path, filename, name, weight, category, source, notes)\n\n# Save to CSV\nwrite.csv(bowen_sdm_status, here(sdm_output_dir, paste0(Sys.Date(),\"_sdm.csv\")))\n# Save to Google Sheets, will be read in for Zonation\nsdm_url &lt;- \"https://docs.google.com/spreadsheets/d/1IGFwkr9LidcZwbzOJJGSEXLsmpKp0a9gBs65EY-H1xw/edit?usp=sharing\"\nwrite_sheet(\n  bowen_sdm_status,\n  sdm_url,\n  sheet = as.character(Sys.Date())\n)\n#&gt; ✔ Writing to \"sdm\".\n#&gt; ✔ Writing to sheet '2025-04-25'.",
    "crumbs": [
      "Conservation Layers",
      "Conservation Layer: Species"
    ]
  },
  {
    "objectID": "vignettes/threats_development.html",
    "href": "vignettes/threats_development.html",
    "title": "Threats: Development",
    "section": "",
    "text": "This vignette describes the first-look exploration and analysis with the BC Assessment data, providing sales history and values of real estate properties throughout British Columbia. The purpose for utilizing this data is to create some spatial layer for modelling development pressures on Bowen Island.\nData citation: BC Assessment, 2020, “BC Assessment Data Advice and Inventory Extracts, 2016-2022”, https://hdl.handle.net/11272.1/AB2/LAPUAB, Abacus Data Network, V6\nCode\nlibrary(bowen.biodiversity.webapp)\nlibrary(sf)\n#&gt; Linking to GEOS 3.11.1, GDAL 3.6.4, PROJ 9.1.1; sf_use_s2() is TRUE\nlibrary(terra)\n#&gt; terra 1.8.5\nlibrary(here)\n#&gt; here() starts at /home/jay/Programming_Projects/bowen.biodiversity.webapp\nlibrary(tidyverse)\n#&gt; ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n#&gt; ✔ dplyr     1.1.4     ✔ readr     2.1.5\n#&gt; ✔ forcats   1.0.0     ✔ stringr   1.5.1\n#&gt; ✔ ggplot2   3.5.1     ✔ tibble    3.2.1\n#&gt; ✔ lubridate 1.9.4     ✔ tidyr     1.3.1\n#&gt; ✔ purrr     1.0.2\n#&gt; ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n#&gt; ✖ tidyr::extract() masks terra::extract()\n#&gt; ✖ dplyr::filter()  masks stats::filter()\n#&gt; ✖ dplyr::lag()     masks stats::lag()\n#&gt; ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors\nlibrary(leaflet)",
    "crumbs": [
      "Threats",
      "Threats: Development"
    ]
  },
  {
    "objectID": "vignettes/threats_development.html#bc-assessment-sales-data",
    "href": "vignettes/threats_development.html#bc-assessment-sales-data",
    "title": "Threats: Development",
    "section": "BC Assessment Sales Data",
    "text": "BC Assessment Sales Data\nThis section deals with the data wrangling steps for the Bowen Island sales information. This data wrangling assumes that prices only increase, so lowest prices are associated with the earlier sale dates and vice versa.\n\n\nCode\nbowen_sales_history &lt;- here(\"data-raw/bc_assessment/bca_folios_spatial_file_20230103/bca_folios.gpkg.gpkg\") %&gt;%\n  # Bowen Island Municipality JURISDICTION_CODE is 321\n  st_read(query = 'SELECT * FROM WHSE_HUMAN_CULTURAL_ECONOMIC_BCA_FOLIO_SALES_SV WHERE JURISDICTION_CODE LIKE 321') \n#&gt; Reading query `SELECT * FROM WHSE_HUMAN_CULTURAL_ECONOMIC_BCA_FOLIO_SALES_SV WHERE JURISDICTION_CODE LIKE 321'\n#&gt; from data source `/home/jay/Programming_Projects/bowen.biodiversity.webapp/data-raw/bc_assessment/bca_folios_spatial_file_20230103/bca_folios.gpkg.gpkg' \n#&gt;   using driver `GPKG'\n#&gt; Simple feature collection with 5394 features and 23 fields\n#&gt; Geometry type: POLYGON\n#&gt; Dimension:     XY\n#&gt; Bounding box:  xmin: 1186718 ymin: 483237.4 xmax: 1195401 ymax: 492971.2\n#&gt; Projected CRS: NAD83 / BC Albers\n\n# Assumes that first date is lowest price, last date is highest price\nbowen_sales_summary  &lt;- bowen_sales_history %&gt;%\n  # Drop spatial geometry, join back later\n  st_drop_geometry() %&gt;%\n  # Remove invalid sales \n  filter(CONVEYANCE_TYPE_DESCRIPTION != \"Reject - Not Suitable for Sales Analysis\") %&gt;%\n  # Group by individual properties, since each transaction separate row\n  group_by(FOLIO_ID) %&gt;%\n  summarise(first_date = min(CONVEYANCE_DATE),\n            last_date = max(CONVEYANCE_DATE),\n            lowest_price = min(CONVEYANCE_PRICE),\n            highest_price = max(CONVEYANCE_PRICE),\n            n_distinct = n_distinct(CONVEYANCE_TYPE_DESCRIPTION) # Show whether land was developed or sold as empty land\n            ) %&gt;%\n  mutate(change_type = case_when(n_distinct &gt; 1 ~ \"changed\", .default = \"unchanged\")) %&gt;% # Show whether land was developed or sold as empty land\n  mutate(days_span = as.double(last_date - first_date, units = \"days\")) %&gt;% # Number of days between first available and most recent sale\n  mutate(price_days_slope = (highest_price - lowest_price)/days_span) %&gt;% # Change in price divided by number of days \n  filter(!is.infinite(price_days_slope) & !is.na(price_days_slope)) # Remove invalid price changes (ex. property has no records of being sold in open market)\n\n\n\nBC Assessment Line Plot\nEach property is one line segment on this plot with start and end points. The start point is the lowest price and first available sale date. The end point is the highest price and most recent sale date.\n\n\nCode\nggplot(bowen_sales_summary) +\n  geom_segment(aes(x = first_date, xend = last_date, y = lowest_price, yend = highest_price, colour = change_type), alpha = 0.2) +\n  xlab(\"Dates\") +\n  ylab(\"Price (CAD)\")\n\n\n\n\n\n\n\n\n\n\n\nBC Assessment Interactive Map\nProperties that have available change in price over time are plotted on an interactive Leaflet map.\n\n\nCode\n# Join with spatial data\nbowen_folio_addresses &lt;- here(\"data-raw/bc_assessment/bca_folios_spatial_file_20230103/bca_folios.gpkg.gpkg\") %&gt;%\n  st_read(query = 'SELECT * FROM WHSE_HUMAN_CULTURAL_ECONOMIC_BCA_FOLIO_ADDRESSES_SV WHERE JURISDICTION_CODE LIKE 321') \n#&gt; Reading query `SELECT * FROM WHSE_HUMAN_CULTURAL_ECONOMIC_BCA_FOLIO_ADDRESSES_SV WHERE JURISDICTION_CODE LIKE 321'\n#&gt; from data source `/home/jay/Programming_Projects/bowen.biodiversity.webapp/data-raw/bc_assessment/bca_folios_spatial_file_20230103/bca_folios.gpkg.gpkg' \n#&gt;   using driver `GPKG'\n#&gt; Warning in CPL_read_ogr(dsn, layer, query, as.character(options), quiet, : GDAL\n#&gt; Message 1: Non-conformant content for record 1294783 in column WHEN_CREATED,\n#&gt; 2022-04-02T16:26:00Z, successfully parsed\n#&gt; Simple feature collection with 2811 features and 29 fields\n#&gt; Geometry type: POLYGON\n#&gt; Dimension:     XY\n#&gt; Bounding box:  xmin: 1119748 ymin: 482273.9 xmax: 1197521 ymax: 493626.9\n#&gt; Projected CRS: NAD83 / BC Albers\n\nbowen_sales_summary_sf &lt;- merge(bowen_sales_summary, bowen_folio_addresses) %&gt;%\n  rename(geometry = geom) %&gt;%\n  st_as_sf() %&gt;%\n  st_transform(4326)\n\n# LEAFLET\nbins &lt;- c(0, 10, 20, 50, 100, 200, 500, 1000, Inf)\npal &lt;- colorBin(\"YlOrRd\", domain = bowen_sales_summary_sf$price_days_slope, bins = bins)\nleaflet(bowen_sales_summary_sf) %&gt;%\n  addProviderTiles(providers$CartoDB.Positron) %&gt;%\n  addPolygons(color = \"#444444\", weight = 0.5,,\n              fillColor = ~pal(price_days_slope),\n              fillOpacity = 0.7\n              ) %&gt;%\n  addLegend(pal = pal, values = ~price_days_slope)",
    "crumbs": [
      "Threats",
      "Threats: Development"
    ]
  },
  {
    "objectID": "vignettes/threats_invasive_species.html",
    "href": "vignettes/threats_invasive_species.html",
    "title": "Threats: Invasive Species",
    "section": "",
    "text": "Code\nlibrary(bowen.biodiversity.webapp)",
    "crumbs": [
      "Threats",
      "Threats: Invasive Species"
    ]
  }
]