[
  {
    "objectID": "vignettes/downloads.html",
    "href": "vignettes/downloads.html",
    "title": "Downloads",
    "section": "",
    "text": "This page contains the download links to many of the spatial layers and mapping products that were generated for the Bowen Biodiversity Plan. The intention is to provide these spatial products in a central location, as transparently as possible, to faciliate further study and decision-making for Bowen Island’s biodiversity.",
    "crumbs": [
      "Downloads"
    ]
  },
  {
    "objectID": "vignettes/downloads.html#species",
    "href": "vignettes/downloads.html#species",
    "title": "Downloads",
    "section": "Species",
    "text": "Species\n\nTotal Species Richness\nThis describes the sum of species presence per 100 m resolution cell on Bowen Island, based on species distribution models.\nLast Updated:\nJuly 16 2025\nDownload:\nPNG TIF\n\n\nTotal Species Diversity\nThis describes the sum of probability of occurence across available species distribution models per 100 m resolution cell on Bowen Island.\nLast Updated:\nJuly 16 2025\nDownload:\nPNG TIF\n\n\nThreatened Species Richness\nThis describes the sum of species presence per 100 m resolution cell on Bowen Island, based on species distribution models. Includes only Threatened species.\nLast Updated:\nJuly 16 2025\nDownload:\nPNG TIF",
    "crumbs": [
      "Downloads"
    ]
  },
  {
    "objectID": "vignettes/downloads.html#habitats",
    "href": "vignettes/downloads.html#habitats",
    "title": "Downloads",
    "section": "Habitats",
    "text": "Habitats",
    "crumbs": [
      "Downloads"
    ]
  },
  {
    "objectID": "vignettes/downloads.html#conservation-values",
    "href": "vignettes/downloads.html#conservation-values",
    "title": "Downloads",
    "section": "Conservation Values",
    "text": "Conservation Values",
    "crumbs": [
      "Downloads"
    ]
  },
  {
    "objectID": "vignettes/downloads.html#threats",
    "href": "vignettes/downloads.html#threats",
    "title": "Downloads",
    "section": "Threats",
    "text": "Threats",
    "crumbs": [
      "Downloads"
    ]
  },
  {
    "objectID": "vignettes/downloads.html#action",
    "href": "vignettes/downloads.html#action",
    "title": "Downloads",
    "section": "Action",
    "text": "Action",
    "crumbs": [
      "Downloads"
    ]
  },
  {
    "objectID": "vignettes/downloads.html#supplementary",
    "href": "vignettes/downloads.html#supplementary",
    "title": "Downloads",
    "section": "Supplementary",
    "text": "Supplementary",
    "crumbs": [
      "Downloads"
    ]
  },
  {
    "objectID": "vignettes/inaturalist.html",
    "href": "vignettes/inaturalist.html",
    "title": "iNaturalist",
    "section": "",
    "text": "iNaturalist Observation Data on Bowen Island\n\n\nCode\n# TODO: iNaturalist observations mapped, used in deciding SDMs to keep (see input_sdm.qmd)",
    "crumbs": [
      "Supplementary",
      "iNaturalist"
    ]
  },
  {
    "objectID": "vignettes/species_richness.html",
    "href": "vignettes/species_richness.html",
    "title": "Species Richness",
    "section": "",
    "text": "Code\nlibrary(bowen.biodiversity.webapp)\nlibrary(here)\n\n\nhere() starts at /home/jay/Programming_Projects/bowen.biodiversity.webapp\n\n\nCode\nlibrary(terra)\n\n\nterra 1.8.5\n\n\nCode\nlibrary(magrittr)\n\n\n\nAttaching package: 'magrittr'\n\n\nThe following objects are masked from 'package:terra':\n\n    extract, inset\n\n\nCode\nlibrary(stringr)\n\n\n\n\nCode\n# Created using vignettes/zonation.Rmd\n# Contains all SDM layers included in Zonation output \nload(here(\"inst/extdata/bowen_sdm_status.rda\"))\n# Create relative path to read in each SDM\nbowen_sdm_status$relpath &lt;- paste0(\"inst/extdata/sdm/\", bowen_sdm_status$filepath)\n# Create all species raster stack \nsdm_stack &lt;- lapply(bowen_sdm_status$relpath, function(x) {here(x) %&gt;% rast()}) %&gt;% rast()\n# Create species richness SDM \npresence_threshold &lt;- 0.7\ntotal_richness_0.7 &lt;- sdm_to_species_richness(SDM_stack = sdm_stack,\n                                          presence_threshold = presence_threshold)\nwriteRaster(total_richness_0.7, here(\"inst/extdata/bowen_sdm_richness.tif\"), overwrite = T)\n\n# Create species richness plots: \n## Each species is marked present in a cell, if they are above a certain \n## threshold of probability in the input SDMs. \nsubtitle &lt;- paste0(\"Based on &gt;\", \n                   presence_threshold,\n                   \" probability of occurrence in Species Distribution Models.\")\ncaption &lt;- paste0(\"Map created: \", date(), \". Palen Lab. Created by Jay Matsushiba (jmatsush@sfu.ca)\")\n\ntitle &lt;- \"Total Species Richness\"\ntotal_richness_0.7_plot &lt;- bowen_map(raster_layer = total_richness_0.7,\n                      title = title,\n                      subtitle = subtitle,\n                      caption = caption,\n                      legend_label = \"Richness\")\n\n\nWarning: Transforming 'ext' to Web Mercator (EPSG: 3857), since 'ext' has a\ndifferent CRS. The CRS of the returned basemap will be Web Mercator, which is\nthe default CRS used by the supported tile services.\n\n\nLoading basemap 'backdrop' from map service 'maptiler'...\n\n\n&lt;SpatRaster&gt; resampled to 501081 cells.\n\n\nCode\n# ggplot2::ggsave(\n#   here(\"vignettes\", \"figures\", paste0(Sys.Date(), \"_total_richness_0.7.png\")),\n#   total_richness_0.7_plot,\n#   device = ragg::agg_png,\n#   width = 9, height = 12, units = \"in\", res = 300\n# )\ntotal_richness_0.7_plot\n\n\n\n\n\n\n\n\nFigure 1",
    "crumbs": [
      "Supplementary",
      "Species Richness"
    ]
  },
  {
    "objectID": "vignettes/threats_invasive_species.html",
    "href": "vignettes/threats_invasive_species.html",
    "title": "Threats: Invasive Species",
    "section": "",
    "text": "Code\nlibrary(bowen.biodiversity.webapp)",
    "crumbs": [
      "Threats",
      "Threats: Invasive Species"
    ]
  },
  {
    "objectID": "vignettes/threats_invasive_species.html#work-in-progress",
    "href": "vignettes/threats_invasive_species.html#work-in-progress",
    "title": "Threats: Invasive Species",
    "section": "",
    "text": "Code\nlibrary(bowen.biodiversity.webapp)",
    "crumbs": [
      "Threats",
      "Threats: Invasive Species"
    ]
  },
  {
    "objectID": "vignettes/threats_development.html",
    "href": "vignettes/threats_development.html",
    "title": "Threats: Development",
    "section": "",
    "text": "This vignette describes the first-look exploration and analysis with the BC Assessment data, providing sales history and values of real estate properties throughout British Columbia. The purpose for utilizing this data is to create some spatial layer for modelling development pressures on Bowen Island.\nData citation: BC Assessment, 2020, “BC Assessment Data Advice and Inventory Extracts, 2016-2022”, https://hdl.handle.net/11272.1/AB2/LAPUAB, Abacus Data Network, V6\nCode\nlibrary(bowen.biodiversity.webapp)\nlibrary(sf)\n#&gt; Linking to GEOS 3.11.1, GDAL 3.6.4, PROJ 9.1.1; sf_use_s2() is TRUE\nlibrary(terra)\n#&gt; terra 1.8.5\nlibrary(here)\n#&gt; here() starts at /home/jay/Programming_Projects/bowen.biodiversity.webapp\nlibrary(tidyverse)\n#&gt; ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n#&gt; ✔ dplyr     1.1.4     ✔ readr     2.1.5\n#&gt; ✔ forcats   1.0.0     ✔ stringr   1.5.1\n#&gt; ✔ ggplot2   3.5.1     ✔ tibble    3.2.1\n#&gt; ✔ lubridate 1.9.4     ✔ tidyr     1.3.1\n#&gt; ✔ purrr     1.0.2\n#&gt; ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n#&gt; ✖ tidyr::extract() masks terra::extract()\n#&gt; ✖ dplyr::filter()  masks stats::filter()\n#&gt; ✖ dplyr::lag()     masks stats::lag()\n#&gt; ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors\nlibrary(leaflet)\nlibrary(scales)\n#&gt; \n#&gt; Attaching package: 'scales'\n#&gt; \n#&gt; The following object is masked from 'package:purrr':\n#&gt; \n#&gt;     discard\n#&gt; \n#&gt; The following object is masked from 'package:readr':\n#&gt; \n#&gt;     col_factor\n#&gt; \n#&gt; The following object is masked from 'package:terra':\n#&gt; \n#&gt;     rescale",
    "crumbs": [
      "Threats",
      "Threats: Development"
    ]
  },
  {
    "objectID": "vignettes/threats_development.html#bc-assessment-sales-data",
    "href": "vignettes/threats_development.html#bc-assessment-sales-data",
    "title": "Threats: Development",
    "section": "BC Assessment Sales Data",
    "text": "BC Assessment Sales Data\nThis section deals with the data wrangling steps for the Bowen Island sales information. This data wrangling assumes that prices only increase, so lowest prices are associated with the earlier sale dates and vice versa.\n\n\nCode\nbowen_sales_history &lt;- here(\"data-raw/bc_assessment/bca_folios_spatial_file_20230103/bca_folios.gpkg.gpkg\") %&gt;%\n  # Bowen Island Municipality JURISDICTION_CODE is 321\n  st_read(query = 'SELECT * FROM WHSE_HUMAN_CULTURAL_ECONOMIC_BCA_FOLIO_SALES_SV WHERE JURISDICTION_CODE LIKE 321') \n#&gt; Reading query `SELECT * FROM WHSE_HUMAN_CULTURAL_ECONOMIC_BCA_FOLIO_SALES_SV WHERE JURISDICTION_CODE LIKE 321'\n#&gt; from data source `/home/jay/Programming_Projects/bowen.biodiversity.webapp/data-raw/bc_assessment/bca_folios_spatial_file_20230103/bca_folios.gpkg.gpkg' \n#&gt;   using driver `GPKG'\n#&gt; Simple feature collection with 5394 features and 23 fields\n#&gt; Geometry type: POLYGON\n#&gt; Dimension:     XY\n#&gt; Bounding box:  xmin: 1186718 ymin: 483237.4 xmax: 1195401 ymax: 492971.2\n#&gt; Projected CRS: NAD83 / BC Albers\n\n# Assumes that first date is lowest price, last date is highest price\nbowen_sales_summary  &lt;- bowen_sales_history %&gt;%\n  # Drop spatial geometry, join back later\n  st_drop_geometry() %&gt;%\n  # Remove invalid sales \n  filter(CONVEYANCE_TYPE_DESCRIPTION != \"Reject - Not Suitable for Sales Analysis\") %&gt;%\n  # Group by individual properties, since each transaction separate row\n  group_by(FOLIO_ID) %&gt;%\n  summarise(first_date = min(CONVEYANCE_DATE),\n            last_date = max(CONVEYANCE_DATE),\n            lowest_price = min(CONVEYANCE_PRICE),\n            highest_price = max(CONVEYANCE_PRICE),\n            n_distinct = n_distinct(CONVEYANCE_TYPE_DESCRIPTION) # Show whether land was developed or sold as empty land\n            ) %&gt;%\n  mutate(change_type = case_when(n_distinct &gt; 1 ~ \"changed\", .default = \"unchanged\")) %&gt;% # Show whether land was developed or sold as empty land\n  mutate(days_span = as.double(last_date - first_date, units = \"days\")) %&gt;% # Number of days between first available and most recent sale\n  mutate(price_days_slope = (highest_price - lowest_price)/days_span) %&gt;% # Change in price divided by number of days \n  filter(!is.infinite(price_days_slope) & !is.na(price_days_slope)) # Remove invalid price changes (ex. property has no records of being sold in open market)\n\n\n\nBC Assessment Line Plot\nEach property is one line segment on this plot with start and end points. The start point is the lowest price and first available sale date. The end point is the highest price and most recent sale date.\n\n\nCode\nggplot(bowen_sales_summary) +\n  geom_segment(aes(x = first_date, xend = last_date, y = lowest_price, yend = highest_price, colour = change_type), alpha = 0.2) +\n  xlab(\"Dates\") +\n  ylab(\"Price (CAD)\")\n\n\n\n\n\n\n\n\n\n\n\nBC Assessment Interactive Map\nProperties that have available change in price over time are plotted on an interactive Leaflet map.\n\n\nCode\n# Join with spatial data\nbowen_folio_addresses &lt;- here(\"data-raw/bc_assessment/bca_folios_spatial_file_20230103/bca_folios.gpkg.gpkg\") %&gt;%\n  st_read(query = 'SELECT * FROM WHSE_HUMAN_CULTURAL_ECONOMIC_BCA_FOLIO_ADDRESSES_SV WHERE JURISDICTION_CODE LIKE 321') \n#&gt; Reading query `SELECT * FROM WHSE_HUMAN_CULTURAL_ECONOMIC_BCA_FOLIO_ADDRESSES_SV WHERE JURISDICTION_CODE LIKE 321'\n#&gt; from data source `/home/jay/Programming_Projects/bowen.biodiversity.webapp/data-raw/bc_assessment/bca_folios_spatial_file_20230103/bca_folios.gpkg.gpkg' \n#&gt;   using driver `GPKG'\n#&gt; Warning in CPL_read_ogr(dsn, layer, query, as.character(options), quiet, : GDAL\n#&gt; Message 1: Non-conformant content for record 1294783 in column WHEN_CREATED,\n#&gt; 2022-04-02T16:26:00Z, successfully parsed\n#&gt; Simple feature collection with 2811 features and 29 fields\n#&gt; Geometry type: POLYGON\n#&gt; Dimension:     XY\n#&gt; Bounding box:  xmin: 1119748 ymin: 482273.9 xmax: 1197521 ymax: 493626.9\n#&gt; Projected CRS: NAD83 / BC Albers\n\nbowen_sales_summary_sf &lt;- merge(bowen_sales_summary, bowen_folio_addresses) %&gt;%\n  rename(geometry = geom) %&gt;%\n  st_as_sf() %&gt;%\n  st_transform(4326)\n\n# LEAFLET\nbins &lt;- c(0, 10, 20, 50, 100, 200, 500, 1000, Inf)\npal &lt;- colorBin(\"YlOrRd\", domain = bowen_sales_summary_sf$price_days_slope, bins = bins)\nleaflet(bowen_sales_summary_sf) %&gt;%\n  addProviderTiles(providers$CartoDB.Positron) %&gt;%\n  addPolygons(color = \"#444444\", weight = 0.5,,\n              fillColor = ~pal(price_days_slope),\n              fillOpacity = 0.7\n              ) %&gt;%\n  addLegend(pal = pal, values = ~price_days_slope)",
    "crumbs": [
      "Threats",
      "Threats: Development"
    ]
  },
  {
    "objectID": "vignettes/threats_development.html#development-subdivision-potential---information-from-daniel-martin-bowen-island-municipality-manager-of-planning-development",
    "href": "vignettes/threats_development.html#development-subdivision-potential---information-from-daniel-martin-bowen-island-municipality-manager-of-planning-development",
    "title": "Threats: Development",
    "section": "Development Subdivision Potential - Information from Daniel Martin (Bowen Island Municipality Manager of Planning & Development)",
    "text": "Development Subdivision Potential - Information from Daniel Martin (Bowen Island Municipality Manager of Planning & Development)\nThis section is on quantifying the development potential on Bowen Island, via subdivisions of land to enable increased development / density. Subdivisions refer to taking larger properties of land and splitting them into smaller properties, which enables increased development and density as it allows more buildings to be built. The current zoning restricts the number of buildings per lot and the minimum area per lot. Therefore, splitting properties that could be made into multiple smaller but above minimum properties increases the number of buildings that can be built.\nDaniel Martin, Manager of Planning and Development at Bowen Island Municipality, provided these spreadsheets with information on the potential for individual lots to be subdivided. Additionally, Martin provided the number of potential further developments possible in Comprehensive Development Zones on Bowen Island.\n\n\nCode\n# RR1 and RR2 (Rural Residential 1 and 2 Zoning)\nrr1_rr2 &lt;- here(\"data-raw/bowen_development_potential_danielmartin/zoning subdivision potential.xlsx\") %&gt;%\n  readxl::read_xlsx(sheet = \"RR1,RR2\")\n#&gt; Warning: Coercing boolean to numeric in K2 / R2C11\n#&gt; Warning: Coercing boolean to numeric in K3 / R3C11\n#&gt; Warning: Coercing boolean to numeric in K4 / R4C11\n#&gt; Warning: Coercing boolean to numeric in K5 / R5C11\n#&gt; Warning: Coercing boolean to numeric in K6 / R6C11\n#&gt; Warning: Coercing boolean to numeric in K7 / R7C11\n#&gt; Warning: Coercing boolean to numeric in K9 / R9C11\n#&gt; Warning: Coercing boolean to numeric in K10 / R10C11\n#&gt; Warning: Coercing boolean to numeric in K11 / R11C11\n#&gt; Warning: Coercing boolean to numeric in K12 / R12C11\n#&gt; Warning: Coercing boolean to numeric in K13 / R13C11\n#&gt; Warning: Coercing boolean to numeric in K14 / R14C11\n#&gt; Warning: Coercing boolean to numeric in K15 / R15C11\n#&gt; Warning: Coercing boolean to numeric in K16 / R16C11\n#&gt; Warning: Coercing boolean to numeric in K17 / R17C11\n#&gt; Warning: Coercing boolean to numeric in K18 / R18C11\n#&gt; Warning: Coercing boolean to numeric in K19 / R19C11\n#&gt; Warning: Coercing boolean to numeric in K20 / R20C11\n#&gt; Warning: Coercing boolean to numeric in K21 / R21C11\n#&gt; Warning: Coercing boolean to numeric in K22 / R22C11\n#&gt; Warning: Coercing boolean to numeric in K23 / R23C11\n#&gt; Warning: Coercing boolean to numeric in K24 / R24C11\n#&gt; Warning: Coercing boolean to numeric in K25 / R25C11\n#&gt; Warning: Coercing boolean to numeric in K26 / R26C11\n#&gt; Warning: Coercing boolean to numeric in K27 / R27C11\n#&gt; Warning: Coercing boolean to numeric in K28 / R28C11\n#&gt; Warning: Coercing boolean to numeric in K29 / R29C11\n#&gt; Warning: Coercing boolean to numeric in K30 / R30C11\n#&gt; Warning: Coercing boolean to numeric in K31 / R31C11\n#&gt; Warning: Coercing boolean to numeric in K32 / R32C11\n#&gt; Warning: Coercing boolean to numeric in K33 / R33C11\n#&gt; Warning: Coercing boolean to numeric in K34 / R34C11\n#&gt; Warning: Coercing boolean to numeric in K36 / R36C11\n#&gt; Warning: Coercing boolean to numeric in K37 / R37C11\n#&gt; Warning: Coercing boolean to numeric in K39 / R39C11\n#&gt; Warning: Coercing boolean to numeric in K40 / R40C11\n#&gt; Warning: Coercing boolean to numeric in K41 / R41C11\n#&gt; Warning: Coercing boolean to numeric in K42 / R42C11\n#&gt; Warning: Coercing boolean to numeric in K43 / R43C11\n#&gt; Warning: Coercing boolean to numeric in K44 / R44C11\n#&gt; Warning: Coercing boolean to numeric in K45 / R45C11\n#&gt; Warning: Coercing boolean to numeric in K46 / R46C11\n#&gt; Warning: Coercing boolean to numeric in K47 / R47C11\n#&gt; Warning: Coercing boolean to numeric in K48 / R48C11\n#&gt; Warning: Coercing boolean to numeric in K49 / R49C11\n#&gt; Warning: Coercing boolean to numeric in K50 / R50C11\n#&gt; Warning: Coercing boolean to numeric in K51 / R51C11\n#&gt; Warning: Coercing boolean to numeric in K52 / R52C11\n#&gt; Warning: Coercing boolean to numeric in K53 / R53C11\n#&gt; Warning: Coercing boolean to numeric in K54 / R54C11\n#&gt; Warning: Coercing boolean to numeric in K55 / R55C11\n#&gt; Warning: Coercing boolean to numeric in K56 / R56C11\n#&gt; Warning: Coercing boolean to numeric in K57 / R57C11\n#&gt; Warning: Coercing boolean to numeric in K58 / R58C11\n#&gt; Warning: Coercing boolean to numeric in K59 / R59C11\n#&gt; Warning: Coercing boolean to numeric in K60 / R60C11\n#&gt; Warning: Coercing boolean to numeric in K61 / R61C11\n#&gt; Warning: Coercing boolean to numeric in K63 / R63C11\n#&gt; Warning: Coercing boolean to numeric in K64 / R64C11\n#&gt; Warning: Coercing boolean to numeric in K65 / R65C11\n#&gt; Warning: Coercing boolean to numeric in K66 / R66C11\n#&gt; Warning: Coercing boolean to numeric in K67 / R67C11\n#&gt; Warning: Coercing boolean to numeric in K68 / R68C11\n#&gt; Warning: Coercing boolean to numeric in K69 / R69C11\n#&gt; Warning: Coercing boolean to numeric in K70 / R70C11\n#&gt; Warning: Coercing boolean to numeric in K74 / R74C11\n#&gt; Warning: Coercing boolean to numeric in K75 / R75C11\n#&gt; Warning: Coercing boolean to numeric in K76 / R76C11\n#&gt; Warning: Coercing boolean to numeric in K77 / R77C11\n#&gt; Warning: Coercing boolean to numeric in K78 / R78C11\n#&gt; Warning: Coercing boolean to numeric in K79 / R79C11\n#&gt; Warning: Coercing boolean to numeric in K80 / R80C11\n#&gt; Warning: Coercing boolean to numeric in K81 / R81C11\n#&gt; Warning: Coercing boolean to numeric in K82 / R82C11\n#&gt; Warning: Coercing boolean to numeric in K83 / R83C11\n#&gt; Warning: Coercing boolean to numeric in K84 / R84C11\n#&gt; Warning: Coercing boolean to numeric in K86 / R86C11\n#&gt; Warning: Coercing boolean to numeric in K87 / R87C11\n#&gt; Warning: Coercing boolean to numeric in K88 / R88C11\n#&gt; Warning: Coercing boolean to numeric in K89 / R89C11\n#&gt; Warning: Coercing boolean to numeric in K90 / R90C11\n#&gt; Warning: Coercing boolean to numeric in K91 / R91C11\n#&gt; Warning: Coercing boolean to numeric in K92 / R92C11\n#&gt; Warning: Coercing boolean to numeric in K93 / R93C11\n#&gt; Warning: Coercing boolean to numeric in K94 / R94C11\n#&gt; Warning: Coercing boolean to numeric in K95 / R95C11\n#&gt; Warning: Coercing boolean to numeric in K96 / R96C11\n#&gt; Warning: Coercing boolean to numeric in K97 / R97C11\n#&gt; Warning: Coercing boolean to numeric in K98 / R98C11\n#&gt; Warning: Coercing boolean to numeric in K99 / R99C11\n#&gt; Warning: Coercing boolean to numeric in K100 / R100C11\n#&gt; Warning: Coercing boolean to numeric in K101 / R101C11\n#&gt; Warning: Coercing boolean to numeric in K102 / R102C11\n#&gt; Warning: Coercing boolean to numeric in K103 / R103C11\n#&gt; Warning: Coercing boolean to numeric in K104 / R104C11\n#&gt; Warning: Coercing boolean to numeric in K105 / R105C11\n#&gt; Warning: Coercing boolean to numeric in K106 / R106C11\n#&gt; Warning: Coercing boolean to numeric in K107 / R107C11\n#&gt; Warning: Coercing boolean to numeric in K108 / R108C11\n#&gt; Warning: Coercing boolean to numeric in K109 / R109C11\n#&gt; Warning: Coercing boolean to numeric in K110 / R110C11\n#&gt; Warning: Coercing boolean to numeric in K111 / R111C11\n#&gt; Warning: Coercing boolean to numeric in K112 / R112C11\n#&gt; Warning: Coercing boolean to numeric in K113 / R113C11\n#&gt; Warning: Coercing boolean to numeric in K114 / R114C11\n#&gt; Warning: Coercing boolean to numeric in K115 / R115C11\n#&gt; Warning: Coercing boolean to numeric in K116 / R116C11\n#&gt; Warning: Coercing boolean to numeric in K117 / R117C11\n#&gt; Warning: Coercing boolean to numeric in K118 / R118C11\n#&gt; Warning: Coercing boolean to numeric in K119 / R119C11\n#&gt; Warning: Coercing boolean to numeric in K120 / R120C11\n#&gt; Warning: Coercing boolean to numeric in K121 / R121C11\n#&gt; Warning: Coercing boolean to numeric in K122 / R122C11\n#&gt; Warning: Coercing boolean to numeric in K123 / R123C11\n#&gt; Warning: Coercing boolean to numeric in K124 / R124C11\n#&gt; Warning: Coercing boolean to numeric in K125 / R125C11\n#&gt; Warning: Coercing boolean to numeric in K126 / R126C11\n#&gt; Warning: Coercing boolean to numeric in K127 / R127C11\n#&gt; Warning: Coercing boolean to numeric in K128 / R128C11\n#&gt; Warning: Coercing boolean to numeric in K129 / R129C11\n#&gt; Warning: Coercing boolean to numeric in K130 / R130C11\n#&gt; Warning: Coercing boolean to numeric in K131 / R131C11\n#&gt; Warning: Coercing boolean to numeric in K132 / R132C11\n#&gt; Warning: Coercing boolean to numeric in K133 / R133C11\n#&gt; Warning: Coercing boolean to numeric in K134 / R134C11\n#&gt; Warning: Coercing boolean to numeric in K135 / R135C11\n#&gt; Warning: Coercing boolean to numeric in K136 / R136C11\n#&gt; Warning: Coercing boolean to numeric in K137 / R137C11\n#&gt; Warning: Coercing boolean to numeric in K138 / R138C11\n#&gt; Warning: Coercing boolean to numeric in K139 / R139C11\n#&gt; Warning: Coercing boolean to numeric in K140 / R140C11\n#&gt; Warning: Coercing boolean to numeric in K143 / R143C11\n#&gt; Warning: Coercing boolean to numeric in K144 / R144C11\n#&gt; Warning: Coercing boolean to numeric in K145 / R145C11\n#&gt; Warning: Coercing boolean to numeric in K146 / R146C11\n#&gt; Warning: Coercing boolean to numeric in K147 / R147C11\n#&gt; Warning: Coercing boolean to numeric in K148 / R148C11\n#&gt; Warning: Coercing boolean to numeric in K150 / R150C11\n#&gt; Warning: Coercing boolean to numeric in K151 / R151C11\n#&gt; Warning: Coercing boolean to numeric in K152 / R152C11\n#&gt; Warning: Coercing boolean to numeric in K153 / R153C11\n#&gt; Warning: Coercing boolean to numeric in K154 / R154C11\n#&gt; Warning: Coercing boolean to numeric in K155 / R155C11\n#&gt; Warning: Coercing boolean to numeric in K157 / R157C11\n#&gt; Warning: Coercing boolean to numeric in K158 / R158C11\n#&gt; Warning: Coercing boolean to numeric in K159 / R159C11\n#&gt; Warning: Coercing boolean to numeric in K160 / R160C11\n#&gt; Warning: Coercing boolean to numeric in K161 / R161C11\n#&gt; Warning: Coercing boolean to numeric in K162 / R162C11\n#&gt; Warning: Coercing boolean to numeric in K163 / R163C11\n#&gt; Warning: Coercing boolean to numeric in K164 / R164C11\n#&gt; Warning: Coercing boolean to numeric in K165 / R165C11\n#&gt; Warning: Coercing boolean to numeric in K166 / R166C11\n#&gt; Warning: Coercing boolean to numeric in K167 / R167C11\n#&gt; Warning: Coercing boolean to numeric in K168 / R168C11\n#&gt; Warning: Coercing boolean to numeric in K169 / R169C11\n#&gt; Warning: Coercing boolean to numeric in K170 / R170C11\n#&gt; Warning: Coercing boolean to numeric in K171 / R171C11\n#&gt; Warning: Coercing boolean to numeric in K172 / R172C11\n#&gt; Warning: Coercing boolean to numeric in K173 / R173C11\n#&gt; Warning: Coercing boolean to numeric in K177 / R177C11\n#&gt; Warning: Coercing boolean to numeric in K178 / R178C11\n#&gt; Warning: Coercing boolean to numeric in K179 / R179C11\n#&gt; Warning: Coercing boolean to numeric in K180 / R180C11\n#&gt; Warning: Coercing boolean to numeric in K181 / R181C11\n#&gt; Warning: Coercing boolean to numeric in K182 / R182C11\n#&gt; Warning: Coercing boolean to numeric in K183 / R183C11\n#&gt; Warning: Coercing boolean to numeric in K185 / R185C11\n#&gt; Warning: Coercing boolean to numeric in K186 / R186C11\n#&gt; Warning: Coercing boolean to numeric in K187 / R187C11\n#&gt; Warning: Coercing boolean to numeric in K188 / R188C11\n#&gt; Warning: Coercing boolean to numeric in K189 / R189C11\n#&gt; Warning: Coercing boolean to numeric in K190 / R190C11\n#&gt; Warning: Coercing boolean to numeric in K192 / R192C11\n#&gt; Warning: Coercing boolean to numeric in K193 / R193C11\n#&gt; Warning: Coercing boolean to numeric in K194 / R194C11\n#&gt; Warning: Coercing boolean to numeric in K195 / R195C11\n#&gt; Warning: Coercing boolean to numeric in K197 / R197C11\n#&gt; Warning: Coercing boolean to numeric in K199 / R199C11\n#&gt; Warning: Coercing boolean to numeric in K200 / R200C11\n#&gt; Warning: Coercing boolean to numeric in K201 / R201C11\n#&gt; Warning: Coercing boolean to numeric in K202 / R202C11\n#&gt; Warning: Coercing boolean to numeric in K203 / R203C11\n#&gt; Warning: Coercing boolean to numeric in K206 / R206C11\n#&gt; Warning: Coercing boolean to numeric in K208 / R208C11\n#&gt; Warning: Coercing boolean to numeric in K210 / R210C11\n#&gt; Warning: Coercing boolean to numeric in K211 / R211C11\n#&gt; Warning: Coercing boolean to numeric in K212 / R212C11\n#&gt; Warning: Coercing boolean to numeric in K213 / R213C11\n#&gt; Warning: Coercing boolean to numeric in K214 / R214C11\n#&gt; Warning: Coercing boolean to numeric in K215 / R215C11\n#&gt; Warning: Coercing boolean to numeric in K216 / R216C11\n#&gt; Warning: Coercing boolean to numeric in K217 / R217C11\n#&gt; Warning: Coercing boolean to numeric in K218 / R218C11\n#&gt; Warning: Coercing boolean to numeric in K219 / R219C11\n#&gt; Warning: Coercing boolean to numeric in K220 / R220C11\n#&gt; Warning: Coercing boolean to numeric in K221 / R221C11\n#&gt; Warning: Coercing boolean to numeric in K222 / R222C11\n#&gt; Warning: Coercing boolean to numeric in K223 / R223C11\n#&gt; Warning: Coercing boolean to numeric in K224 / R224C11\n#&gt; Warning: Coercing boolean to numeric in K225 / R225C11\n#&gt; Warning: Coercing boolean to numeric in K226 / R226C11\n#&gt; Warning: Coercing boolean to numeric in K227 / R227C11\n#&gt; Warning: Coercing boolean to numeric in K228 / R228C11\n#&gt; Warning: Coercing boolean to numeric in K229 / R229C11\n#&gt; Warning: Coercing boolean to numeric in K231 / R231C11\n#&gt; Warning: Coercing boolean to numeric in K232 / R232C11\n#&gt; Warning: Coercing boolean to numeric in K233 / R233C11\n#&gt; Warning: Coercing boolean to numeric in K234 / R234C11\n#&gt; Warning: Coercing boolean to numeric in K235 / R235C11\n#&gt; Warning: Coercing boolean to numeric in K236 / R236C11\n#&gt; Warning: Coercing boolean to numeric in K237 / R237C11\n#&gt; Warning: Coercing boolean to numeric in K239 / R239C11\n#&gt; Warning: Coercing boolean to numeric in K240 / R240C11\n#&gt; Warning: Coercing boolean to numeric in K241 / R241C11\n#&gt; Warning: Coercing boolean to numeric in K242 / R242C11\n#&gt; Warning: Coercing boolean to numeric in K243 / R243C11\n#&gt; Warning: Coercing boolean to numeric in K245 / R245C11\n#&gt; Warning: Coercing boolean to numeric in K246 / R246C11\n#&gt; Warning: Coercing boolean to numeric in K247 / R247C11\n#&gt; Warning: Coercing boolean to numeric in K248 / R248C11\n#&gt; Warning: Coercing boolean to numeric in K249 / R249C11\n#&gt; Warning: Coercing boolean to numeric in K250 / R250C11\n#&gt; Warning: Coercing boolean to numeric in K251 / R251C11\n#&gt; Warning: Coercing boolean to numeric in K252 / R252C11\n#&gt; Warning: Coercing boolean to numeric in K253 / R253C11\n#&gt; Warning: Coercing boolean to numeric in K254 / R254C11\n#&gt; Warning: Coercing boolean to numeric in K255 / R255C11\n#&gt; Warning: Coercing boolean to numeric in K256 / R256C11\n#&gt; Warning: Coercing boolean to numeric in K257 / R257C11\n#&gt; Warning: Coercing boolean to numeric in K258 / R258C11\n#&gt; Warning: Coercing boolean to numeric in K259 / R259C11\n#&gt; Warning: Coercing boolean to numeric in K260 / R260C11\n#&gt; Warning: Coercing boolean to numeric in K261 / R261C11\n#&gt; Warning: Coercing boolean to numeric in K262 / R262C11\n#&gt; Warning: Coercing boolean to numeric in K263 / R263C11\n#&gt; Warning: Coercing boolean to numeric in K264 / R264C11\n#&gt; Warning: Coercing boolean to numeric in K265 / R265C11\n#&gt; Warning: Coercing boolean to numeric in K266 / R266C11\n#&gt; Warning: Coercing boolean to numeric in K267 / R267C11\n#&gt; Warning: Coercing boolean to numeric in K268 / R268C11\n#&gt; Warning: Coercing boolean to numeric in K269 / R269C11\n#&gt; Warning: Coercing boolean to numeric in K270 / R270C11\n#&gt; Warning: Coercing boolean to numeric in K271 / R271C11\n#&gt; Warning: Coercing boolean to numeric in K272 / R272C11\n#&gt; Warning: Coercing boolean to numeric in K273 / R273C11\n#&gt; Warning: Coercing boolean to numeric in K274 / R274C11\n#&gt; Warning: Coercing boolean to numeric in K275 / R275C11\n# RR3 (Rural Residential 3 Zoning)\nrr3 &lt;- here(\"data-raw/bowen_development_potential_danielmartin/zoning subdivision potential.xlsx\") %&gt;%\n  readxl::read_xlsx(sheet = \"RR3 properties\")\n#&gt; Warning: Coercing boolean to numeric in K2 / R2C11\n#&gt; Warning: Coercing boolean to numeric in K4 / R4C11\n#&gt; Warning: Coercing boolean to numeric in K5 / R5C11\n#&gt; Warning: Coercing boolean to numeric in K6 / R6C11\n#&gt; Warning: Coercing boolean to numeric in K8 / R8C11\n#&gt; Warning: Coercing boolean to numeric in K9 / R9C11\n#&gt; Warning: Coercing boolean to numeric in K10 / R10C11\n#&gt; Warning: Coercing boolean to numeric in K11 / R11C11\n#&gt; Warning: Coercing boolean to numeric in K12 / R12C11\n#&gt; Warning: Coercing boolean to numeric in K13 / R13C11\n#&gt; Warning: Coercing boolean to numeric in K14 / R14C11\n#&gt; Warning: Coercing boolean to numeric in K15 / R15C11\n#&gt; Warning: Coercing boolean to numeric in K16 / R16C11\n#&gt; Warning: Coercing boolean to numeric in K17 / R17C11\n#&gt; Warning: Coercing boolean to numeric in K18 / R18C11\n#&gt; Warning: Coercing boolean to numeric in K19 / R19C11\n#&gt; Warning: Coercing boolean to numeric in K20 / R20C11\n#&gt; Warning: Coercing boolean to numeric in K21 / R21C11\n#&gt; Warning: Coercing boolean to numeric in K22 / R22C11\n#&gt; Warning: Coercing boolean to numeric in K23 / R23C11\n#&gt; Warning: Coercing boolean to numeric in K24 / R24C11\n#&gt; Warning: Coercing boolean to numeric in K25 / R25C11\n#&gt; Warning: Coercing boolean to numeric in K26 / R26C11\n#&gt; Warning: Coercing boolean to numeric in K27 / R27C11\n#&gt; Warning: Coercing boolean to numeric in K28 / R28C11\n#&gt; Warning: Coercing boolean to numeric in K29 / R29C11\n#&gt; Warning: Coercing boolean to numeric in K30 / R30C11\n#&gt; Warning: Coercing boolean to numeric in K31 / R31C11\n#&gt; Warning: Coercing boolean to numeric in K32 / R32C11\n#&gt; Warning: Coercing boolean to numeric in K33 / R33C11\n#&gt; Warning: Coercing boolean to numeric in K34 / R34C11\n#&gt; Warning: Coercing boolean to numeric in K35 / R35C11\n#&gt; Warning: Coercing boolean to numeric in K36 / R36C11\n#&gt; Warning: Coercing boolean to numeric in K37 / R37C11\n#&gt; Warning: Coercing boolean to numeric in K38 / R38C11\n#&gt; Warning: Coercing boolean to numeric in K39 / R39C11\n#&gt; Warning: Coercing boolean to numeric in K40 / R40C11\n#&gt; Warning: Coercing boolean to numeric in K41 / R41C11\n#&gt; Warning: Coercing boolean to numeric in K42 / R42C11\n#&gt; Warning: Coercing boolean to numeric in K43 / R43C11\n#&gt; Warning: Coercing boolean to numeric in K44 / R44C11\n#&gt; Warning: Coercing boolean to numeric in K45 / R45C11\n#&gt; Warning: Coercing boolean to numeric in K46 / R46C11\n#&gt; Warning: Coercing boolean to numeric in K47 / R47C11\n#&gt; Warning: Coercing boolean to numeric in K48 / R48C11\n#&gt; Warning: Coercing boolean to numeric in K49 / R49C11\n#&gt; Warning: Coercing boolean to numeric in K50 / R50C11\n#&gt; Warning: Coercing boolean to numeric in K51 / R51C11\n#&gt; Warning: Coercing boolean to numeric in K52 / R52C11\n#&gt; Warning: Coercing boolean to numeric in K53 / R53C11\n#&gt; Warning: Coercing boolean to numeric in K54 / R54C11\n#&gt; Warning: Coercing boolean to numeric in K55 / R55C11\n#&gt; Warning: Coercing boolean to numeric in K56 / R56C11\n#&gt; Warning: Coercing boolean to numeric in K57 / R57C11\n#&gt; Warning: Coercing boolean to numeric in K58 / R58C11\n#&gt; Warning: Coercing boolean to numeric in K59 / R59C11\n#&gt; Warning: Coercing boolean to numeric in K60 / R60C11\n#&gt; Warning: Coercing boolean to numeric in K61 / R61C11\n#&gt; Warning: Coercing boolean to numeric in K62 / R62C11\n#&gt; Warning: Coercing boolean to numeric in K63 / R63C11\n#&gt; Warning: Coercing boolean to numeric in K64 / R64C11\n#&gt; Warning: Coercing boolean to numeric in K65 / R65C11\n#&gt; Warning: Coercing boolean to numeric in K66 / R66C11\n#&gt; Warning: Coercing boolean to numeric in K67 / R67C11\n#&gt; Warning: Coercing boolean to numeric in K69 / R69C11\n#&gt; Warning: Coercing boolean to numeric in K70 / R70C11\n#&gt; Warning: Coercing boolean to numeric in K72 / R72C11\n#&gt; Warning: Coercing boolean to numeric in K74 / R74C11\n#&gt; Warning: Coercing boolean to numeric in K75 / R75C11\n#&gt; Warning: Coercing boolean to numeric in K76 / R76C11\n#&gt; Warning: Coercing boolean to numeric in K77 / R77C11\n#&gt; Warning: Coercing boolean to numeric in K79 / R79C11\n#&gt; Warning: Coercing boolean to numeric in K80 / R80C11\n#&gt; Warning: Coercing boolean to numeric in K81 / R81C11\n#&gt; Warning: Coercing boolean to numeric in K82 / R82C11\n#&gt; Warning: Coercing boolean to numeric in K83 / R83C11\n#&gt; Warning: Coercing boolean to numeric in K84 / R84C11\n#&gt; Warning: Coercing boolean to numeric in K85 / R85C11\n#&gt; Warning: Coercing boolean to numeric in K86 / R86C11\n#&gt; Warning: Coercing boolean to numeric in K87 / R87C11\n#&gt; Warning: Coercing boolean to numeric in K88 / R88C11\n#&gt; Warning: Coercing boolean to numeric in K89 / R89C11\n#&gt; Warning: Coercing boolean to numeric in K90 / R90C11\n#&gt; Warning: Coercing boolean to numeric in K91 / R91C11\n#&gt; Warning: Coercing boolean to numeric in K92 / R92C11\n#&gt; Warning: Coercing boolean to numeric in K93 / R93C11\n#&gt; Warning: Coercing boolean to numeric in K94 / R94C11\n#&gt; Warning: Coercing boolean to numeric in K95 / R95C11\n#&gt; Warning: Coercing boolean to numeric in K96 / R96C11\n#&gt; Warning: Coercing boolean to numeric in K97 / R97C11\n#&gt; Warning: Coercing boolean to numeric in K98 / R98C11\n#&gt; Warning: Coercing boolean to numeric in K99 / R99C11\n#&gt; Warning: Coercing boolean to numeric in K100 / R100C11\n#&gt; Warning: Coercing boolean to numeric in K101 / R101C11\n#&gt; Warning: Coercing boolean to numeric in K102 / R102C11\n#&gt; Warning: Coercing boolean to numeric in K103 / R103C11\n#&gt; Warning: Coercing boolean to numeric in K104 / R104C11\n#&gt; Warning: Coercing boolean to numeric in K105 / R105C11\n#&gt; Warning: Coercing boolean to numeric in K106 / R106C11\n#&gt; Warning: Coercing boolean to numeric in K107 / R107C11\n#&gt; Warning: Coercing boolean to numeric in K108 / R108C11\n#&gt; Warning: Coercing boolean to numeric in K109 / R109C11\n#&gt; Warning: Coercing boolean to numeric in K110 / R110C11\n#&gt; Warning: Coercing boolean to numeric in K111 / R111C11\n#&gt; Warning: Coercing boolean to numeric in K112 / R112C11\n#&gt; Warning: Coercing boolean to numeric in K113 / R113C11\n# SR (Settlement Residential zoning)\nsr &lt;- here(\"data-raw/bowen_development_potential_danielmartin/zoning subdivision potential.xlsx\") %&gt;%\n  readxl::read_xlsx(sheet = \"SR properties\")\n#&gt; Warning: Coercing boolean to numeric in K2 / R2C11\n#&gt; Warning: Coercing boolean to numeric in K3 / R3C11\n#&gt; Warning: Coercing boolean to numeric in K5 / R5C11\n#&gt; Warning: Coercing boolean to numeric in K6 / R6C11\n#&gt; Warning: Coercing boolean to numeric in K7 / R7C11\n#&gt; Warning: Coercing boolean to numeric in K9 / R9C11\n#&gt; Warning: Coercing boolean to numeric in K10 / R10C11\n#&gt; Warning: Coercing boolean to numeric in K11 / R11C11\n#&gt; Warning: Coercing boolean to numeric in K12 / R12C11\n#&gt; Warning: Coercing boolean to numeric in K13 / R13C11\n#&gt; Warning: Coercing boolean to numeric in K14 / R14C11\n#&gt; Warning: Coercing boolean to numeric in K15 / R15C11\n#&gt; Warning: Coercing boolean to numeric in K16 / R16C11\n#&gt; Warning: Coercing boolean to numeric in K17 / R17C11\n#&gt; Warning: Coercing boolean to numeric in K18 / R18C11\n#&gt; Warning: Coercing boolean to numeric in K19 / R19C11\n#&gt; Warning: Coercing boolean to numeric in K20 / R20C11\n#&gt; Warning: Coercing boolean to numeric in K21 / R21C11\n#&gt; Warning: Coercing boolean to numeric in K22 / R22C11\n#&gt; Warning: Coercing boolean to numeric in K23 / R23C11\n#&gt; Warning: Coercing boolean to numeric in K24 / R24C11\n#&gt; Warning: Coercing boolean to numeric in K26 / R26C11\n#&gt; Warning: Coercing boolean to numeric in K27 / R27C11\n#&gt; Warning: Coercing boolean to numeric in K28 / R28C11\n#&gt; Warning: Coercing boolean to numeric in K29 / R29C11\n#&gt; Warning: Coercing boolean to numeric in K30 / R30C11\n#&gt; Warning: Coercing boolean to numeric in K31 / R31C11\n#&gt; Warning: Coercing boolean to numeric in K32 / R32C11\n#&gt; Warning: Coercing boolean to numeric in K33 / R33C11\n#&gt; Warning: Coercing boolean to numeric in K34 / R34C11\n#&gt; Warning: Coercing boolean to numeric in K35 / R35C11\n#&gt; Warning: Coercing boolean to numeric in K36 / R36C11\n#&gt; Warning: Coercing boolean to numeric in K37 / R37C11\n#&gt; Warning: Coercing boolean to numeric in K39 / R39C11\n#&gt; Warning: Coercing boolean to numeric in K40 / R40C11\n#&gt; Warning: Coercing boolean to numeric in K41 / R41C11\n#&gt; Warning: Coercing boolean to numeric in K42 / R42C11\n#&gt; Warning: Coercing boolean to numeric in K43 / R43C11\n#&gt; Warning: Coercing boolean to numeric in K44 / R44C11\n#&gt; Warning: Coercing boolean to numeric in K45 / R45C11\n#&gt; Warning: Coercing boolean to numeric in K46 / R46C11\n#&gt; Warning: Coercing boolean to numeric in K47 / R47C11\n#&gt; Warning: Coercing boolean to numeric in K48 / R48C11\n#&gt; Warning: Coercing boolean to numeric in K49 / R49C11\n#&gt; Warning: Coercing boolean to numeric in K50 / R50C11\n#&gt; Warning: Coercing boolean to numeric in K51 / R51C11\n#&gt; Warning: Coercing boolean to numeric in K52 / R52C11\n#&gt; Warning: Coercing boolean to numeric in K53 / R53C11\n#&gt; Warning: Coercing boolean to numeric in K54 / R54C11\n#&gt; Warning: Coercing boolean to numeric in K55 / R55C11\n#&gt; Warning: Coercing boolean to numeric in K56 / R56C11\n#&gt; Warning: Coercing boolean to numeric in K57 / R57C11\n#&gt; Warning: Coercing boolean to numeric in K58 / R58C11\n#&gt; Warning: Coercing boolean to numeric in K59 / R59C11\n#&gt; Warning: Coercing boolean to numeric in K60 / R60C11\n#&gt; Warning: Coercing boolean to numeric in K61 / R61C11\n#&gt; Warning: Coercing boolean to numeric in K62 / R62C11\n#&gt; Warning: Coercing boolean to numeric in K63 / R63C11\n#&gt; Warning: Coercing boolean to numeric in K64 / R64C11\n#&gt; Warning: Coercing boolean to numeric in K65 / R65C11\n#&gt; Warning: Coercing boolean to numeric in K66 / R66C11\n#&gt; Warning: Coercing boolean to numeric in K67 / R67C11\n#&gt; Warning: Coercing boolean to numeric in K68 / R68C11\n#&gt; Warning: Coercing boolean to numeric in K69 / R69C11\n#&gt; Warning: Coercing boolean to numeric in K70 / R70C11\n#&gt; Warning: Coercing boolean to numeric in K71 / R71C11\n#&gt; Warning: Coercing boolean to numeric in K72 / R72C11\n#&gt; Warning: Coercing boolean to numeric in K73 / R73C11\n#&gt; Warning: Coercing boolean to numeric in K74 / R74C11\n#&gt; Warning: Coercing boolean to numeric in K75 / R75C11\n#&gt; Warning: Coercing boolean to numeric in K76 / R76C11\n#&gt; Warning: Coercing boolean to numeric in K77 / R77C11\n#&gt; Warning: Coercing boolean to numeric in K79 / R79C11\n#&gt; Warning: Coercing boolean to numeric in K80 / R80C11\n#&gt; Warning: Coercing boolean to numeric in K81 / R81C11\n#&gt; Warning: Coercing boolean to numeric in K82 / R82C11\n#&gt; Warning: Coercing boolean to numeric in K83 / R83C11\n#&gt; Warning: Coercing boolean to numeric in K84 / R84C11\n#&gt; Warning: Coercing boolean to numeric in K85 / R85C11\n#&gt; Warning: Coercing boolean to numeric in K86 / R86C11\n#&gt; Warning: Coercing boolean to numeric in K87 / R87C11\n#&gt; Warning: Coercing boolean to numeric in K88 / R88C11\n#&gt; Warning: Coercing boolean to numeric in K89 / R89C11\n#&gt; Warning: Coercing boolean to numeric in K90 / R90C11\n#&gt; Warning: Coercing boolean to numeric in K91 / R91C11\n#&gt; Warning: Coercing boolean to numeric in K92 / R92C11\n#&gt; Warning: Coercing boolean to numeric in K93 / R93C11\n#&gt; Warning: Coercing boolean to numeric in K94 / R94C11\n#&gt; Warning: Coercing boolean to numeric in K95 / R95C11\n#&gt; Warning: Coercing boolean to numeric in K96 / R96C11\n#&gt; Warning: Coercing boolean to numeric in K97 / R97C11\n#&gt; Warning: Coercing boolean to numeric in K98 / R98C11\n#&gt; Warning: Coercing boolean to numeric in K99 / R99C11\n#&gt; Warning: Coercing boolean to numeric in K100 / R100C11\n#&gt; Warning: Coercing boolean to numeric in K101 / R101C11\n#&gt; Warning: Coercing boolean to numeric in K102 / R102C11\n#&gt; Warning: Coercing boolean to numeric in K103 / R103C11\n#&gt; Warning: Coercing boolean to numeric in K104 / R104C11\n#&gt; Warning: Coercing boolean to numeric in K105 / R105C11\n#&gt; Warning: Coercing boolean to numeric in K106 / R106C11\n#&gt; Warning: Coercing boolean to numeric in K107 / R107C11\n#&gt; Warning: Coercing boolean to numeric in K108 / R108C11\n#&gt; Warning: Coercing boolean to numeric in K109 / R109C11\n#&gt; Warning: Coercing boolean to numeric in K110 / R110C11\n#&gt; Warning: Coercing boolean to numeric in K112 / R112C11\n#&gt; Warning: Coercing boolean to numeric in K113 / R113C11\n#&gt; Warning: Coercing boolean to numeric in K114 / R114C11\n#&gt; Warning: Coercing boolean to numeric in K115 / R115C11\n#&gt; Warning: Coercing boolean to numeric in K116 / R116C11\n#&gt; Warning: Coercing boolean to numeric in K117 / R117C11\n#&gt; Warning: Coercing boolean to numeric in K118 / R118C11\n#&gt; Warning: Coercing boolean to numeric in K119 / R119C11\n#&gt; Warning: Coercing boolean to numeric in K120 / R120C11\n#&gt; Warning: Coercing boolean to numeric in K121 / R121C11\n#&gt; Warning: Coercing boolean to numeric in K122 / R122C11\n#&gt; Warning: Coercing boolean to numeric in K123 / R123C11\n#&gt; Warning: Coercing boolean to numeric in K124 / R124C11\n#&gt; Warning: Coercing boolean to numeric in K125 / R125C11\n#&gt; Warning: Coercing boolean to numeric in K126 / R126C11\n#&gt; Warning: Coercing boolean to numeric in K127 / R127C11\n#&gt; Warning: Coercing boolean to numeric in K128 / R128C11\n#&gt; Warning: Coercing boolean to numeric in K129 / R129C11\n#&gt; Warning: Coercing boolean to numeric in K130 / R130C11\n#&gt; Warning: Coercing boolean to numeric in K131 / R131C11\n#&gt; Warning: Coercing boolean to numeric in K133 / R133C11\n#&gt; Warning: Coercing boolean to numeric in K134 / R134C11\n#&gt; Warning: Coercing boolean to numeric in K135 / R135C11\n#&gt; Warning: Coercing boolean to numeric in K136 / R136C11\n#&gt; Warning: Coercing boolean to numeric in K137 / R137C11\n#&gt; Warning: Coercing boolean to numeric in K138 / R138C11\n#&gt; Warning: Coercing boolean to numeric in K140 / R140C11\n#&gt; Warning: Coercing boolean to numeric in K141 / R141C11\n#&gt; Warning: Coercing boolean to numeric in K142 / R142C11\n#&gt; Warning: Coercing boolean to numeric in K143 / R143C11\n#&gt; Warning: Coercing boolean to numeric in K144 / R144C11\n#&gt; Warning: Coercing boolean to numeric in K145 / R145C11\n#&gt; Warning: Coercing boolean to numeric in K147 / R147C11\n#&gt; Warning: Coercing boolean to numeric in K148 / R148C11\n#&gt; Warning: Coercing boolean to numeric in K149 / R149C11\n#&gt; Warning: Coercing boolean to numeric in K151 / R151C11\n#&gt; Warning: Coercing boolean to numeric in K152 / R152C11\n#&gt; Warning: Coercing boolean to numeric in K153 / R153C11\n#&gt; Warning: Coercing boolean to numeric in K154 / R154C11\n#&gt; Warning: Coercing boolean to numeric in K155 / R155C11\n#&gt; Warning: Coercing boolean to numeric in K156 / R156C11\n#&gt; Warning: Coercing boolean to numeric in K157 / R157C11\n#&gt; Warning: Coercing boolean to numeric in K158 / R158C11\n#&gt; Warning: Coercing boolean to numeric in K159 / R159C11\n#&gt; Warning: Coercing boolean to numeric in K160 / R160C11\n#&gt; Warning: Coercing boolean to numeric in K161 / R161C11\n#&gt; Warning: Coercing boolean to numeric in K162 / R162C11\n#&gt; Warning: Coercing boolean to numeric in K163 / R163C11\n#&gt; Warning: Coercing boolean to numeric in K164 / R164C11\n#&gt; Warning: Coercing boolean to numeric in K165 / R165C11\n#&gt; Warning: Coercing boolean to numeric in K166 / R166C11\n#&gt; Warning: Coercing boolean to numeric in K167 / R167C11\n#&gt; Warning: Coercing boolean to numeric in K168 / R168C11\n#&gt; Warning: Coercing boolean to numeric in K169 / R169C11\n#&gt; Warning: Coercing boolean to numeric in K170 / R170C11\n#&gt; Warning: Coercing boolean to numeric in K171 / R171C11\n#&gt; Warning: Coercing boolean to numeric in K172 / R172C11\n#&gt; Warning: Coercing boolean to numeric in K173 / R173C11\n#&gt; Warning: Coercing boolean to numeric in K174 / R174C11\n#&gt; Warning: Coercing boolean to numeric in K175 / R175C11\n#&gt; Warning: Coercing boolean to numeric in K176 / R176C11\n#&gt; Warning: Coercing boolean to numeric in K177 / R177C11\n#&gt; Warning: Coercing boolean to numeric in K178 / R178C11\n#&gt; Warning: Coercing boolean to numeric in K179 / R179C11\n#&gt; Warning: Coercing boolean to numeric in K180 / R180C11\n#&gt; Warning: Coercing boolean to numeric in K181 / R181C11\n#&gt; Warning: Coercing boolean to numeric in K183 / R183C11\n#&gt; Warning: Coercing boolean to numeric in K184 / R184C11\n#&gt; Warning: Coercing boolean to numeric in K185 / R185C11\n#&gt; Warning: Coercing boolean to numeric in K186 / R186C11\n#&gt; Warning: Coercing boolean to numeric in K187 / R187C11\n#&gt; Warning: Coercing boolean to numeric in K188 / R188C11\n#&gt; Warning: Coercing boolean to numeric in K189 / R189C11\n#&gt; Warning: Coercing boolean to numeric in K190 / R190C11\n#&gt; Warning: Coercing boolean to numeric in K191 / R191C11\n#&gt; Warning: Coercing boolean to numeric in K192 / R192C11\n#&gt; Warning: Coercing boolean to numeric in K193 / R193C11\n#&gt; Warning: Coercing boolean to numeric in K194 / R194C11\n#&gt; Warning: Coercing boolean to numeric in K195 / R195C11\n#&gt; Warning: Coercing boolean to numeric in K196 / R196C11\n#&gt; Warning: Coercing boolean to numeric in K197 / R197C11\n#&gt; Warning: Coercing boolean to numeric in K198 / R198C11\n#&gt; Warning: Coercing boolean to numeric in K199 / R199C11\n#&gt; Warning: Coercing boolean to numeric in K200 / R200C11\n#&gt; Warning: Coercing boolean to numeric in K201 / R201C11\n#&gt; Warning: Coercing boolean to numeric in K202 / R202C11\n#&gt; Warning: Coercing boolean to numeric in K203 / R203C11\n#&gt; Warning: Coercing boolean to numeric in K204 / R204C11\n#&gt; Warning: Coercing boolean to numeric in K205 / R205C11\n#&gt; Warning: Coercing boolean to numeric in K206 / R206C11\n#&gt; Warning: Coercing boolean to numeric in K208 / R208C11\n#&gt; Warning: Coercing boolean to numeric in K209 / R209C11\n#&gt; Warning: Coercing boolean to numeric in K210 / R210C11\n#&gt; Warning: Coercing boolean to numeric in K211 / R211C11\n#&gt; Warning: Coercing boolean to numeric in K212 / R212C11\n#&gt; Warning: Coercing boolean to numeric in K213 / R213C11\n#&gt; Warning: Coercing boolean to numeric in K214 / R214C11\n#&gt; Warning: Coercing boolean to numeric in K215 / R215C11\n#&gt; Warning: Coercing boolean to numeric in K216 / R216C11\n#&gt; Warning: Coercing boolean to numeric in K217 / R217C11\n#&gt; Warning: Coercing boolean to numeric in K218 / R218C11\n#&gt; Warning: Coercing boolean to numeric in K219 / R219C11\n#&gt; Warning: Coercing boolean to numeric in K220 / R220C11\n#&gt; Warning: Coercing boolean to numeric in K221 / R221C11\n#&gt; Warning: Coercing boolean to numeric in K223 / R223C11\n#&gt; Warning: Coercing boolean to numeric in K224 / R224C11\n#&gt; Warning: Coercing boolean to numeric in K225 / R225C11\n#&gt; Warning: Coercing boolean to numeric in K226 / R226C11\n#&gt; Warning: Coercing boolean to numeric in K227 / R227C11\n#&gt; Warning: Coercing boolean to numeric in K228 / R228C11\n#&gt; Warning: Coercing boolean to numeric in K229 / R229C11\n#&gt; Warning: Coercing boolean to numeric in K230 / R230C11\n#&gt; Warning: Coercing boolean to numeric in K231 / R231C11\n#&gt; Warning: Coercing boolean to numeric in K232 / R232C11\n#&gt; Warning: Coercing boolean to numeric in K233 / R233C11\n#&gt; Warning: Coercing boolean to numeric in K234 / R234C11\n#&gt; Warning: Coercing boolean to numeric in K235 / R235C11\n#&gt; Warning: Coercing boolean to numeric in K236 / R236C11\n#&gt; Warning: Coercing boolean to numeric in K237 / R237C11\n#&gt; Warning: Coercing boolean to numeric in K238 / R238C11\n#&gt; Warning: Coercing boolean to numeric in K239 / R239C11\n#&gt; Warning: Coercing boolean to numeric in K240 / R240C11\n#&gt; Warning: Coercing boolean to numeric in K241 / R241C11\n#&gt; Warning: Coercing boolean to numeric in K243 / R243C11\n#&gt; Warning: Coercing boolean to numeric in K244 / R244C11\n#&gt; Warning: Coercing boolean to numeric in K245 / R245C11\n#&gt; Warning: Coercing boolean to numeric in K246 / R246C11\n#&gt; Warning: Coercing boolean to numeric in K247 / R247C11\n#&gt; Warning: Coercing boolean to numeric in K248 / R248C11\n#&gt; Warning: Coercing boolean to numeric in K249 / R249C11\n#&gt; Warning: Coercing boolean to numeric in K250 / R250C11\n#&gt; Warning: Coercing boolean to numeric in K251 / R251C11\n#&gt; Warning: Coercing boolean to numeric in K253 / R253C11\n#&gt; Warning: Coercing boolean to numeric in K254 / R254C11\n#&gt; Warning: Coercing boolean to numeric in K255 / R255C11\n#&gt; Warning: Coercing boolean to numeric in K256 / R256C11\n#&gt; Warning: Coercing boolean to numeric in K257 / R257C11\n#&gt; Warning: Coercing boolean to numeric in K258 / R258C11\n#&gt; Warning: Coercing boolean to numeric in K259 / R259C11\n#&gt; Warning: Coercing boolean to numeric in K260 / R260C11\n#&gt; Warning: Coercing boolean to numeric in K261 / R261C11\n#&gt; Warning: Coercing boolean to numeric in K262 / R262C11\n#&gt; Warning: Coercing boolean to numeric in K263 / R263C11\n#&gt; Warning: Coercing boolean to numeric in K264 / R264C11\n#&gt; Warning: Coercing boolean to numeric in K265 / R265C11\n#&gt; Warning: Coercing boolean to numeric in K266 / R266C11\n#&gt; Warning: Coercing boolean to numeric in K267 / R267C11\n#&gt; Warning: Coercing boolean to numeric in K268 / R268C11\n#&gt; Warning: Coercing boolean to numeric in K269 / R269C11\n#&gt; Warning: Coercing boolean to numeric in K271 / R271C11\n#&gt; Warning: Coercing boolean to numeric in K272 / R272C11\n#&gt; Warning: Coercing boolean to numeric in K273 / R273C11\n#&gt; Warning: Coercing boolean to numeric in K274 / R274C11\n#&gt; Warning: Coercing boolean to numeric in K275 / R275C11\n#&gt; Warning: Coercing boolean to numeric in K276 / R276C11\n#&gt; Warning: Coercing boolean to numeric in K277 / R277C11\n#&gt; Warning: Coercing boolean to numeric in K278 / R278C11\n#&gt; Warning: Coercing boolean to numeric in K279 / R279C11\n#&gt; Warning: Coercing boolean to numeric in K280 / R280C11\n#&gt; Warning: Coercing boolean to numeric in K281 / R281C11\n#&gt; Warning: Coercing boolean to numeric in K282 / R282C11\n#&gt; Warning: Coercing boolean to numeric in K283 / R283C11\n#&gt; Warning: Coercing boolean to numeric in K284 / R284C11\n#&gt; Warning: Coercing boolean to numeric in K285 / R285C11\n#&gt; Warning: Coercing boolean to numeric in K286 / R286C11\n#&gt; Warning: Coercing boolean to numeric in K287 / R287C11\n#&gt; Warning: Coercing boolean to numeric in K288 / R288C11\n#&gt; Warning: Coercing boolean to numeric in K289 / R289C11\n#&gt; Warning: Coercing boolean to numeric in K290 / R290C11\n#&gt; Warning: Coercing boolean to numeric in K291 / R291C11\n#&gt; Warning: Coercing boolean to numeric in K293 / R293C11\n#&gt; Warning: Coercing boolean to numeric in K294 / R294C11\n#&gt; Warning: Coercing boolean to numeric in K295 / R295C11\n#&gt; Warning: Coercing boolean to numeric in K296 / R296C11\n#&gt; Warning: Coercing boolean to numeric in K297 / R297C11\n#&gt; Warning: Coercing boolean to numeric in K298 / R298C11\n#&gt; Warning: Coercing boolean to numeric in K299 / R299C11\n#&gt; Warning: Coercing boolean to numeric in K300 / R300C11\n#&gt; Warning: Coercing boolean to numeric in K301 / R301C11\n#&gt; Warning: Coercing boolean to numeric in K302 / R302C11\n#&gt; Warning: Coercing boolean to numeric in K303 / R303C11\n#&gt; Warning: Coercing boolean to numeric in K304 / R304C11\n#&gt; Warning: Coercing boolean to numeric in K305 / R305C11\n#&gt; Warning: Coercing boolean to numeric in K306 / R306C11\n#&gt; Warning: Coercing boolean to numeric in K307 / R307C11\n#&gt; Warning: Coercing boolean to numeric in K308 / R308C11\n#&gt; Warning: Coercing boolean to numeric in K309 / R309C11\n#&gt; Warning: Coercing boolean to numeric in K310 / R310C11\n#&gt; Warning: Coercing boolean to numeric in K311 / R311C11\n#&gt; Warning: Coercing boolean to numeric in K312 / R312C11\n#&gt; Warning: Coercing boolean to numeric in K313 / R313C11\n#&gt; Warning: Coercing boolean to numeric in K314 / R314C11\n#&gt; Warning: Coercing boolean to numeric in K315 / R315C11\n#&gt; Warning: Coercing boolean to numeric in K316 / R316C11\n#&gt; Warning: Coercing boolean to numeric in K317 / R317C11\n#&gt; Warning: Coercing boolean to numeric in K318 / R318C11\n#&gt; Warning: Coercing boolean to numeric in K319 / R319C11\n#&gt; Warning: Coercing boolean to numeric in K320 / R320C11\n#&gt; Warning: Coercing boolean to numeric in K321 / R321C11\n#&gt; Warning: Coercing boolean to numeric in K322 / R322C11\n#&gt; Warning: Coercing boolean to numeric in K323 / R323C11\n#&gt; Warning: Coercing boolean to numeric in K324 / R324C11\n#&gt; Warning: Coercing boolean to numeric in K325 / R325C11\n#&gt; Warning: Coercing boolean to numeric in K326 / R326C11\n#&gt; Warning: Coercing boolean to numeric in K327 / R327C11\n#&gt; Warning: Coercing boolean to numeric in K328 / R328C11\n#&gt; Warning: Coercing boolean to numeric in K329 / R329C11\n#&gt; Warning: Coercing boolean to numeric in K330 / R330C11\n#&gt; Warning: Coercing boolean to numeric in K331 / R331C11\n#&gt; Warning: Coercing boolean to numeric in K332 / R332C11\n#&gt; Warning: Coercing boolean to numeric in K333 / R333C11\n#&gt; Warning: Coercing boolean to numeric in K334 / R334C11\n#&gt; Warning: Coercing boolean to numeric in K335 / R335C11\n#&gt; Warning: Coercing boolean to numeric in K336 / R336C11\n#&gt; Warning: Coercing boolean to numeric in K337 / R337C11\n#&gt; Warning: Coercing boolean to numeric in K338 / R338C11\n#&gt; Warning: Coercing boolean to numeric in K339 / R339C11\n#&gt; Warning: Coercing boolean to numeric in K341 / R341C11\n#&gt; Warning: Coercing boolean to numeric in K342 / R342C11\n#&gt; Warning: Coercing boolean to numeric in K343 / R343C11\n#&gt; Warning: Coercing boolean to numeric in K344 / R344C11\n#&gt; Warning: Coercing boolean to numeric in K345 / R345C11\n#&gt; Warning: Coercing boolean to numeric in K346 / R346C11\n#&gt; Warning: Coercing boolean to numeric in K347 / R347C11\n#&gt; Warning: Coercing boolean to numeric in K348 / R348C11\n#&gt; Warning: Coercing boolean to numeric in K349 / R349C11\n#&gt; Warning: Coercing boolean to numeric in K350 / R350C11\n#&gt; Warning: Coercing boolean to numeric in K351 / R351C11\n#&gt; Warning: Coercing boolean to numeric in K352 / R352C11\n#&gt; Warning: Coercing boolean to numeric in K353 / R353C11\n#&gt; Warning: Coercing boolean to numeric in K354 / R354C11\n#&gt; Warning: Coercing boolean to numeric in K355 / R355C11\n#&gt; Warning: Coercing boolean to numeric in K356 / R356C11\n#&gt; Warning: Coercing boolean to numeric in K357 / R357C11\n#&gt; Warning: Coercing boolean to numeric in K358 / R358C11\n#&gt; Warning: Coercing boolean to numeric in K360 / R360C11\n#&gt; Warning: Coercing boolean to numeric in K361 / R361C11\n#&gt; Warning: Coercing boolean to numeric in K363 / R363C11\n#&gt; Warning: Coercing boolean to numeric in K364 / R364C11\n#&gt; Warning: Coercing boolean to numeric in K365 / R365C11\n#&gt; Warning: Coercing boolean to numeric in K366 / R366C11\n#&gt; Warning: Coercing boolean to numeric in K367 / R367C11\n#&gt; Warning: Coercing boolean to numeric in K368 / R368C11\n#&gt; Warning: Coercing boolean to numeric in K369 / R369C11\n#&gt; Warning: Coercing boolean to numeric in K370 / R370C11\n#&gt; Warning: Coercing boolean to numeric in K372 / R372C11\n#&gt; Warning: Coercing boolean to numeric in K373 / R373C11\n#&gt; Warning: Coercing boolean to numeric in K374 / R374C11\n#&gt; Warning: Coercing boolean to numeric in K375 / R375C11\n#&gt; Warning: Coercing boolean to numeric in K376 / R376C11\n#&gt; Warning: Coercing boolean to numeric in K377 / R377C11\n#&gt; Warning: Coercing boolean to numeric in K378 / R378C11\n#&gt; Warning: Coercing boolean to numeric in K380 / R380C11\n#&gt; Warning: Coercing boolean to numeric in K381 / R381C11\n#&gt; Warning: Coercing boolean to numeric in K382 / R382C11\n#&gt; Warning: Coercing boolean to numeric in K384 / R384C11\n#&gt; Warning: Coercing boolean to numeric in K385 / R385C11\n#&gt; Warning: Coercing boolean to numeric in K386 / R386C11\n#&gt; Warning: Coercing boolean to numeric in K387 / R387C11\n#&gt; Warning: Coercing boolean to numeric in K388 / R388C11\n#&gt; Warning: Coercing boolean to numeric in K389 / R389C11\n#&gt; Warning: Coercing boolean to numeric in K390 / R390C11\n#&gt; Warning: Coercing boolean to numeric in K391 / R391C11\n#&gt; Warning: Coercing boolean to numeric in K392 / R392C11\n#&gt; Warning: Coercing boolean to numeric in K393 / R393C11\n#&gt; Warning: Coercing boolean to numeric in K394 / R394C11\n#&gt; Warning: Coercing boolean to numeric in K395 / R395C11\n#&gt; Warning: Coercing boolean to numeric in K396 / R396C11\n#&gt; Warning: Coercing boolean to numeric in K397 / R397C11\n#&gt; Warning: Coercing boolean to numeric in K398 / R398C11\n#&gt; Warning: Coercing boolean to numeric in K399 / R399C11\n#&gt; Warning: Coercing boolean to numeric in K400 / R400C11\n#&gt; Warning: Coercing boolean to numeric in K401 / R401C11\n#&gt; Warning: Coercing boolean to numeric in K402 / R402C11\n#&gt; Warning: Coercing boolean to numeric in K403 / R403C11\n#&gt; Warning: Coercing boolean to numeric in K406 / R406C11\n#&gt; Warning: Coercing boolean to numeric in K407 / R407C11\n#&gt; Warning: Coercing boolean to numeric in K408 / R408C11\n#&gt; Warning: Coercing boolean to numeric in K409 / R409C11\n#&gt; Warning: Coercing boolean to numeric in K410 / R410C11\n#&gt; Warning: Coercing boolean to numeric in K411 / R411C11\n#&gt; Warning: Coercing boolean to numeric in K412 / R412C11\n#&gt; Warning: Coercing boolean to numeric in K413 / R413C11\n#&gt; Warning: Coercing boolean to numeric in K414 / R414C11\n#&gt; Warning: Coercing boolean to numeric in K415 / R415C11\n#&gt; Warning: Coercing boolean to numeric in K416 / R416C11\n#&gt; Warning: Coercing boolean to numeric in K417 / R417C11\n#&gt; Warning: Coercing boolean to numeric in K418 / R418C11\n#&gt; Warning: Coercing boolean to numeric in K419 / R419C11\n#&gt; Warning: Coercing boolean to numeric in K420 / R420C11\n#&gt; Warning: Coercing boolean to numeric in K421 / R421C11\n#&gt; Warning: Coercing boolean to numeric in K422 / R422C11\n#&gt; Warning: Coercing boolean to numeric in K423 / R423C11\n#&gt; Warning: Coercing boolean to numeric in K424 / R424C11\n#&gt; Warning: Coercing boolean to numeric in K425 / R425C11\n#&gt; Warning: Coercing boolean to numeric in K426 / R426C11\n#&gt; Warning: Coercing boolean to numeric in K427 / R427C11\n#&gt; Warning: Coercing boolean to numeric in K428 / R428C11\n#&gt; Warning: Coercing boolean to numeric in K429 / R429C11\n#&gt; Warning: Coercing boolean to numeric in K431 / R431C11\n#&gt; Warning: Coercing boolean to numeric in K432 / R432C11\n#&gt; Warning: Coercing boolean to numeric in K433 / R433C11\n#&gt; Warning: Coercing boolean to numeric in K434 / R434C11\n#&gt; Warning: Coercing boolean to numeric in K435 / R435C11\n#&gt; Warning: Coercing boolean to numeric in K436 / R436C11\n#&gt; Warning: Coercing boolean to numeric in K437 / R437C11\n#&gt; Warning: Coercing boolean to numeric in K438 / R438C11\n#&gt; Warning: Coercing boolean to numeric in K439 / R439C11\n#&gt; Warning: Coercing boolean to numeric in K440 / R440C11\n#&gt; Warning: Coercing boolean to numeric in K441 / R441C11\n#&gt; Warning: Coercing boolean to numeric in K442 / R442C11\n#&gt; Warning: Coercing boolean to numeric in K443 / R443C11\n#&gt; Warning: Coercing boolean to numeric in K444 / R444C11\n#&gt; Warning: Coercing boolean to numeric in K445 / R445C11\n#&gt; Warning: Coercing boolean to numeric in K446 / R446C11\n#&gt; Warning: Coercing boolean to numeric in K447 / R447C11\n#&gt; Warning: Coercing boolean to numeric in K448 / R448C11\n#&gt; Warning: Coercing boolean to numeric in K449 / R449C11\n#&gt; Warning: Coercing boolean to numeric in K450 / R450C11\n#&gt; Warning: Coercing boolean to numeric in K451 / R451C11\n#&gt; Warning: Coercing boolean to numeric in K452 / R452C11\n#&gt; Warning: Coercing boolean to numeric in K453 / R453C11\n#&gt; Warning: Coercing boolean to numeric in K454 / R454C11\n#&gt; Warning: Coercing boolean to numeric in K455 / R455C11\n#&gt; Warning: Coercing boolean to numeric in K456 / R456C11\n#&gt; Warning: Coercing boolean to numeric in K457 / R457C11\n#&gt; Warning: Coercing boolean to numeric in K458 / R458C11\n#&gt; Warning: Coercing boolean to numeric in K459 / R459C11\n#&gt; Warning: Coercing boolean to numeric in K460 / R460C11\n#&gt; Warning: Coercing boolean to numeric in K461 / R461C11\n#&gt; Warning: Coercing boolean to numeric in K462 / R462C11\n#&gt; Warning: Coercing boolean to numeric in K463 / R463C11\n#&gt; Warning: Coercing boolean to numeric in K464 / R464C11\n#&gt; Warning: Coercing boolean to numeric in K465 / R465C11\n#&gt; Warning: Coercing boolean to numeric in K466 / R466C11\n#&gt; Warning: Coercing boolean to numeric in K467 / R467C11\n#&gt; Warning: Coercing boolean to numeric in K468 / R468C11\n#&gt; Warning: Coercing boolean to numeric in K469 / R469C11\n#&gt; Warning: Coercing boolean to numeric in K470 / R470C11\n#&gt; Warning: Coercing boolean to numeric in K471 / R471C11\n#&gt; Warning: Coercing boolean to numeric in K472 / R472C11\n#&gt; Warning: Coercing boolean to numeric in K473 / R473C11\n#&gt; Warning: Coercing boolean to numeric in K474 / R474C11\n#&gt; Warning: Coercing boolean to numeric in K475 / R475C11\n#&gt; Warning: Coercing boolean to numeric in K476 / R476C11\n#&gt; Warning: Coercing boolean to numeric in K477 / R477C11\n#&gt; Warning: Coercing boolean to numeric in K478 / R478C11\n#&gt; Warning: Coercing boolean to numeric in K479 / R479C11\n#&gt; Warning: Coercing boolean to numeric in K480 / R480C11\n#&gt; Warning: Coercing boolean to numeric in K481 / R481C11\n#&gt; Warning: Coercing boolean to numeric in K482 / R482C11\n#&gt; Warning: Coercing boolean to numeric in K483 / R483C11\n#&gt; Warning: Coercing boolean to numeric in K484 / R484C11\n#&gt; Warning: Coercing boolean to numeric in K485 / R485C11\n#&gt; Warning: Coercing boolean to numeric in K486 / R486C11\n#&gt; Warning: Coercing boolean to numeric in K487 / R487C11\n#&gt; Warning: Coercing boolean to numeric in K488 / R488C11\n#&gt; Warning: Coercing boolean to numeric in K489 / R489C11\n#&gt; Warning: Coercing boolean to numeric in K490 / R490C11\n#&gt; Warning: Coercing boolean to numeric in K491 / R491C11\n#&gt; Warning: Coercing boolean to numeric in K492 / R492C11\n#&gt; Warning: Coercing boolean to numeric in K493 / R493C11\n#&gt; Warning: Coercing boolean to numeric in K494 / R494C11\n#&gt; Warning: Coercing boolean to numeric in K495 / R495C11\n#&gt; Warning: Coercing boolean to numeric in K496 / R496C11\n#&gt; Warning: Coercing boolean to numeric in K497 / R497C11\n#&gt; Warning: Coercing boolean to numeric in K498 / R498C11\n#&gt; Warning: Coercing boolean to numeric in K499 / R499C11\n#&gt; Warning: Coercing boolean to numeric in K500 / R500C11\n#&gt; Warning: Coercing boolean to numeric in K501 / R501C11\n#&gt; Warning: Coercing boolean to numeric in K502 / R502C11\n#&gt; Warning: Coercing boolean to numeric in K503 / R503C11\n#&gt; Warning: Coercing boolean to numeric in K504 / R504C11\n#&gt; Warning: Coercing boolean to numeric in K505 / R505C11\n#&gt; Warning: Coercing boolean to numeric in K506 / R506C11\n#&gt; Warning: Coercing boolean to numeric in K507 / R507C11\n#&gt; Warning: Coercing boolean to numeric in K508 / R508C11\n#&gt; Warning: Coercing boolean to numeric in K509 / R509C11\n#&gt; Warning: Coercing boolean to numeric in K510 / R510C11\n#&gt; Warning: Coercing boolean to numeric in K511 / R511C11\n#&gt; Warning: Coercing boolean to numeric in K512 / R512C11\n#&gt; Warning: Coercing boolean to numeric in K513 / R513C11\n#&gt; Warning: Coercing boolean to numeric in K514 / R514C11\n#&gt; Warning: Coercing boolean to numeric in K515 / R515C11\n#&gt; Warning: Coercing boolean to numeric in K516 / R516C11\n#&gt; Warning: Coercing boolean to numeric in K517 / R517C11\n#&gt; Warning: Coercing boolean to numeric in K518 / R518C11\n#&gt; Warning: Coercing boolean to numeric in K519 / R519C11\n#&gt; Warning: Coercing boolean to numeric in K520 / R520C11\n#&gt; Warning: Coercing boolean to numeric in K521 / R521C11\n#&gt; Warning: Coercing boolean to numeric in K522 / R522C11\n#&gt; Warning: Coercing boolean to numeric in K523 / R523C11\n#&gt; Warning: Coercing boolean to numeric in K524 / R524C11\n#&gt; Warning: Coercing boolean to numeric in K525 / R525C11\n#&gt; Warning: Coercing boolean to numeric in K526 / R526C11\n#&gt; Warning: Coercing boolean to numeric in K527 / R527C11\n#&gt; Warning: Coercing boolean to numeric in K528 / R528C11\n#&gt; Warning: Coercing boolean to numeric in K529 / R529C11\n#&gt; Warning: Coercing boolean to numeric in K530 / R530C11\n#&gt; Warning: Coercing boolean to numeric in K531 / R531C11\n#&gt; Warning: Coercing boolean to numeric in K532 / R532C11\n#&gt; Warning: Coercing boolean to numeric in K533 / R533C11\n#&gt; Warning: Coercing boolean to numeric in K534 / R534C11\n#&gt; Warning: Coercing boolean to numeric in K535 / R535C11\n#&gt; Warning: Coercing boolean to numeric in K536 / R536C11\n#&gt; Warning: Coercing boolean to numeric in K537 / R537C11\n#&gt; Warning: Coercing boolean to numeric in K538 / R538C11\n#&gt; Warning: Coercing boolean to numeric in K539 / R539C11\n#&gt; Warning: Coercing boolean to numeric in K540 / R540C11\n#&gt; Warning: Coercing boolean to numeric in K541 / R541C11\n#&gt; Warning: Coercing boolean to numeric in K542 / R542C11\n#&gt; Warning: Coercing boolean to numeric in K543 / R543C11\n#&gt; Warning: Coercing boolean to numeric in K544 / R544C11\n#&gt; Warning: Coercing boolean to numeric in K545 / R545C11\n#&gt; Warning: Coercing boolean to numeric in K546 / R546C11\n#&gt; Warning: Coercing boolean to numeric in K547 / R547C11\n#&gt; Warning: Coercing boolean to numeric in K548 / R548C11\n#&gt; Warning: Coercing boolean to numeric in K549 / R549C11\n#&gt; Warning: Coercing boolean to numeric in K550 / R550C11\n#&gt; Warning: Coercing boolean to numeric in K551 / R551C11\n#&gt; Warning: Coercing boolean to numeric in K552 / R552C11\n#&gt; Warning: Coercing boolean to numeric in K553 / R553C11\n#&gt; Warning: Coercing boolean to numeric in K554 / R554C11\n#&gt; Warning: Coercing boolean to numeric in K555 / R555C11\n#&gt; Warning: Coercing boolean to numeric in K556 / R556C11\n#&gt; Warning: Coercing boolean to numeric in K557 / R557C11\n#&gt; Warning: Coercing boolean to numeric in K558 / R558C11\n#&gt; Warning: Coercing boolean to numeric in K559 / R559C11\n#&gt; Warning: Coercing boolean to numeric in K560 / R560C11\n#&gt; Warning: Coercing boolean to numeric in K561 / R561C11\n#&gt; Warning: Coercing boolean to numeric in K562 / R562C11\n#&gt; Warning: Coercing boolean to numeric in K563 / R563C11\n#&gt; Warning: Coercing boolean to numeric in K564 / R564C11\n#&gt; Warning: Coercing boolean to numeric in K565 / R565C11\n#&gt; Warning: Coercing boolean to numeric in K566 / R566C11\n#&gt; Warning: Coercing boolean to numeric in K567 / R567C11\n#&gt; Warning: Coercing boolean to numeric in K569 / R569C11\n#&gt; Warning: Coercing boolean to numeric in K570 / R570C11\n#&gt; Warning: Coercing boolean to numeric in K573 / R573C11\n#&gt; Warning: Coercing boolean to numeric in K575 / R575C11\n#&gt; Warning: Coercing boolean to numeric in K576 / R576C11\n#&gt; Warning: Coercing boolean to numeric in K581 / R581C11\n#&gt; Warning: Coercing boolean to numeric in K582 / R582C11\n#&gt; Warning: Coercing boolean to numeric in K583 / R583C11\n#&gt; Warning: Coercing boolean to numeric in K584 / R584C11\n#&gt; Warning: Coercing boolean to numeric in K585 / R585C11\n#&gt; Warning: Coercing boolean to numeric in K586 / R586C11\n#&gt; Warning: Coercing boolean to numeric in K587 / R587C11\n#&gt; Warning: Coercing boolean to numeric in K588 / R588C11\n#&gt; Warning: Coercing boolean to numeric in K589 / R589C11\n#&gt; Warning: Coercing boolean to numeric in K590 / R590C11\n#&gt; Warning: Coercing boolean to numeric in K594 / R594C11\n#&gt; Warning: Coercing boolean to numeric in K595 / R595C11\n#&gt; Warning: Coercing boolean to numeric in K596 / R596C11\n#&gt; Warning: Coercing boolean to numeric in K597 / R597C11\n#&gt; Warning: Coercing boolean to numeric in K599 / R599C11\n#&gt; Warning: Coercing boolean to numeric in K600 / R600C11\n#&gt; Warning: Coercing boolean to numeric in K601 / R601C11\n#&gt; Warning: Coercing boolean to numeric in K602 / R602C11\n#&gt; Warning: Coercing boolean to numeric in K603 / R603C11\n#&gt; Warning: Coercing boolean to numeric in K604 / R604C11\n#&gt; Warning: Coercing boolean to numeric in K605 / R605C11\n#&gt; Warning: Coercing boolean to numeric in K606 / R606C11\n#&gt; Warning: Coercing boolean to numeric in K607 / R607C11\n#&gt; Warning: Coercing boolean to numeric in K608 / R608C11\n#&gt; Warning: Coercing boolean to numeric in K609 / R609C11\n#&gt; Warning: Coercing boolean to numeric in K610 / R610C11\n#&gt; Warning: Coercing boolean to numeric in K611 / R611C11\n#&gt; Warning: Coercing boolean to numeric in K612 / R612C11\n#&gt; Warning: Coercing boolean to numeric in K613 / R613C11\n#&gt; Warning: Coercing boolean to numeric in K614 / R614C11\n#&gt; Warning: Coercing boolean to numeric in K615 / R615C11\n#&gt; Warning: Coercing boolean to numeric in K616 / R616C11\n#&gt; Warning: Coercing boolean to numeric in K617 / R617C11\n#&gt; Warning: Coercing boolean to numeric in K618 / R618C11\n#&gt; Warning: Coercing boolean to numeric in K619 / R619C11\n#&gt; Warning: Coercing boolean to numeric in K620 / R620C11\n#&gt; Warning: Coercing boolean to numeric in K621 / R621C11\n#&gt; Warning: Coercing boolean to numeric in K622 / R622C11\n#&gt; Warning: Coercing boolean to numeric in K623 / R623C11\n#&gt; Warning: Coercing boolean to numeric in K624 / R624C11\n#&gt; Warning: Coercing boolean to numeric in K625 / R625C11\n#&gt; Warning: Coercing boolean to numeric in K626 / R626C11\n#&gt; Warning: Coercing boolean to numeric in K627 / R627C11\n#&gt; Warning: Coercing boolean to numeric in K628 / R628C11\n#&gt; Warning: Coercing boolean to numeric in K630 / R630C11\n#&gt; Warning: Coercing boolean to numeric in K631 / R631C11\n#&gt; Warning: Coercing boolean to numeric in K632 / R632C11\n#&gt; Warning: Coercing boolean to numeric in K633 / R633C11\n#&gt; Warning: Coercing boolean to numeric in K634 / R634C11\n#&gt; Warning: Coercing boolean to numeric in K635 / R635C11\n#&gt; Warning: Coercing boolean to numeric in K636 / R636C11\n#&gt; Warning: Coercing boolean to numeric in K643 / R643C11\n#&gt; Warning: Coercing boolean to numeric in K644 / R644C11\n#&gt; Warning: Coercing boolean to numeric in K645 / R645C11\n#&gt; Warning: Coercing boolean to numeric in K646 / R646C11\n#&gt; Warning: Coercing boolean to numeric in K647 / R647C11\n#&gt; Warning: Coercing boolean to numeric in K648 / R648C11\n#&gt; Warning: Coercing boolean to numeric in K649 / R649C11\n#&gt; Warning: Coercing boolean to numeric in K650 / R650C11\n#&gt; Warning: Coercing boolean to numeric in K651 / R651C11\n#&gt; Warning: Coercing boolean to numeric in K652 / R652C11\n#&gt; Warning: Coercing boolean to numeric in K653 / R653C11\n#&gt; Warning: Coercing boolean to numeric in K654 / R654C11\n#&gt; Warning: Coercing boolean to numeric in K655 / R655C11\n#&gt; Warning: Coercing boolean to numeric in K656 / R656C11\n#&gt; Warning: Coercing boolean to numeric in K657 / R657C11\n#&gt; Warning: Coercing boolean to numeric in K658 / R658C11\n#&gt; Warning: Coercing boolean to numeric in K659 / R659C11\n#&gt; Warning: Coercing boolean to numeric in K660 / R660C11\n#&gt; Warning: Coercing boolean to numeric in K661 / R661C11\n#&gt; Warning: Coercing boolean to numeric in K662 / R662C11\n#&gt; Warning: Coercing boolean to numeric in K663 / R663C11\n#&gt; Warning: Coercing boolean to numeric in K664 / R664C11\n#&gt; Warning: Coercing boolean to numeric in K665 / R665C11\n#&gt; Warning: Coercing boolean to numeric in K666 / R666C11\n#&gt; Warning: Coercing boolean to numeric in K667 / R667C11\n#&gt; Warning: Coercing boolean to numeric in K668 / R668C11\n#&gt; Warning: Coercing boolean to numeric in K669 / R669C11\n#&gt; Warning: Coercing boolean to numeric in K670 / R670C11\n#&gt; Warning: Coercing boolean to numeric in K671 / R671C11\n#&gt; Warning: Coercing boolean to numeric in K672 / R672C11\n#&gt; Warning: Coercing boolean to numeric in K673 / R673C11\n#&gt; Warning: Coercing boolean to numeric in K674 / R674C11\n#&gt; Warning: Coercing boolean to numeric in K675 / R675C11\n#&gt; Warning: Coercing boolean to numeric in K676 / R676C11\n#&gt; Warning: Coercing boolean to numeric in K677 / R677C11\n#&gt; Warning: Coercing boolean to numeric in K678 / R678C11\n#&gt; Warning: Coercing boolean to numeric in K679 / R679C11\n#&gt; Warning: Coercing boolean to numeric in K680 / R680C11\n#&gt; Warning: Coercing boolean to numeric in K681 / R681C11\n#&gt; Warning: Coercing boolean to numeric in K682 / R682C11\n#&gt; Warning: Coercing boolean to numeric in K683 / R683C11\n#&gt; Warning: Coercing boolean to numeric in K684 / R684C11\n#&gt; Warning: Coercing boolean to numeric in K685 / R685C11\n#&gt; Warning: Coercing boolean to numeric in K686 / R686C11\n#&gt; Warning: Coercing boolean to numeric in K687 / R687C11\n#&gt; Warning: Coercing boolean to numeric in K688 / R688C11\n#&gt; Warning: Coercing boolean to numeric in K689 / R689C11\n#&gt; Warning: Coercing boolean to numeric in K690 / R690C11\n#&gt; Warning: Coercing boolean to numeric in K691 / R691C11\n#&gt; Warning: Coercing boolean to numeric in K692 / R692C11\n#&gt; Warning: Coercing boolean to numeric in K693 / R693C11\n#&gt; Warning: Coercing boolean to numeric in K694 / R694C11\n#&gt; Warning: Coercing boolean to numeric in K695 / R695C11\n#&gt; Warning: Coercing boolean to numeric in K696 / R696C11\n#&gt; Warning: Coercing boolean to numeric in K697 / R697C11\n#&gt; Warning: Coercing boolean to numeric in K698 / R698C11\n#&gt; Warning: Coercing boolean to numeric in K699 / R699C11\n#&gt; Warning: Coercing boolean to numeric in K700 / R700C11\n#&gt; Warning: Coercing boolean to numeric in K701 / R701C11\n#&gt; Warning: Coercing boolean to numeric in K702 / R702C11\n#&gt; Warning: Coercing boolean to numeric in K703 / R703C11\n#&gt; Warning: Coercing boolean to numeric in K704 / R704C11\n#&gt; Warning: Coercing boolean to numeric in K705 / R705C11\n#&gt; Warning: Coercing boolean to numeric in K706 / R706C11\n#&gt; Warning: Coercing boolean to numeric in K707 / R707C11\n#&gt; Warning: Coercing boolean to numeric in K708 / R708C11\n#&gt; Warning: Coercing boolean to numeric in K709 / R709C11\n#&gt; Warning: Coercing boolean to numeric in K710 / R710C11\n#&gt; Warning: Coercing boolean to numeric in K711 / R711C11\n#&gt; Warning: Coercing boolean to numeric in K712 / R712C11\n#&gt; Warning: Coercing boolean to numeric in K713 / R713C11\n#&gt; Warning: Coercing boolean to numeric in K714 / R714C11\n#&gt; Warning: Coercing boolean to numeric in K715 / R715C11\n#&gt; Warning: Coercing boolean to numeric in K716 / R716C11\n#&gt; Warning: Coercing boolean to numeric in K717 / R717C11\n#&gt; Warning: Coercing boolean to numeric in K718 / R718C11\n#&gt; Warning: Coercing boolean to numeric in K719 / R719C11\n#&gt; Warning: Coercing boolean to numeric in K720 / R720C11\n#&gt; Warning: Coercing boolean to numeric in K721 / R721C11\n#&gt; Warning: Coercing boolean to numeric in K722 / R722C11\n#&gt; Warning: Coercing boolean to numeric in K723 / R723C11\n#&gt; Warning: Coercing boolean to numeric in K724 / R724C11\n#&gt; Warning: Coercing boolean to numeric in K725 / R725C11\n#&gt; Warning: Coercing boolean to numeric in K726 / R726C11\n#&gt; Warning: Coercing boolean to numeric in K727 / R727C11\n#&gt; Warning: Coercing boolean to numeric in K728 / R728C11\n#&gt; Warning: Coercing boolean to numeric in K731 / R731C11\n#&gt; Warning: Coercing boolean to numeric in K732 / R732C11\n#&gt; Warning: Coercing boolean to numeric in K733 / R733C11\n#&gt; Warning: Coercing boolean to numeric in K734 / R734C11\n#&gt; Warning: Coercing boolean to numeric in K735 / R735C11\n#&gt; Warning: Coercing boolean to numeric in K736 / R736C11\n#&gt; Warning: Coercing boolean to numeric in K737 / R737C11\n#&gt; Warning: Coercing boolean to numeric in K738 / R738C11\n#&gt; Warning: Coercing boolean to numeric in K739 / R739C11\n#&gt; Warning: Coercing boolean to numeric in K740 / R740C11\n#&gt; Warning: Coercing boolean to numeric in K741 / R741C11\n#&gt; Warning: Coercing boolean to numeric in K742 / R742C11\n#&gt; Warning: Coercing boolean to numeric in K743 / R743C11\n#&gt; Warning: Coercing boolean to numeric in K744 / R744C11\n#&gt; Warning: Coercing boolean to numeric in K745 / R745C11\n#&gt; Warning: Coercing boolean to numeric in K746 / R746C11\n#&gt; Warning: Coercing boolean to numeric in K747 / R747C11\n#&gt; Warning: Coercing boolean to numeric in K748 / R748C11\n#&gt; Warning: Coercing boolean to numeric in K749 / R749C11\n#&gt; Warning: Coercing boolean to numeric in K750 / R750C11\n#&gt; Warning: Coercing boolean to numeric in K751 / R751C11\n#&gt; Warning: Coercing boolean to numeric in K752 / R752C11\n#&gt; Warning: Coercing boolean to numeric in K753 / R753C11\n#&gt; Warning: Coercing boolean to numeric in K754 / R754C11\n#&gt; Warning: Coercing boolean to numeric in K755 / R755C11\n#&gt; Warning: Coercing boolean to numeric in K756 / R756C11\n#&gt; Warning: Coercing boolean to numeric in K757 / R757C11\n#&gt; Warning: Coercing boolean to numeric in K758 / R758C11\n#&gt; Warning: Coercing boolean to numeric in K759 / R759C11\n#&gt; Warning: Coercing boolean to numeric in K760 / R760C11\n#&gt; Warning: Coercing boolean to numeric in K761 / R761C11\n#&gt; Warning: Coercing boolean to numeric in K762 / R762C11\n#&gt; Warning: Coercing boolean to numeric in K763 / R763C11\n#&gt; Warning: Coercing boolean to numeric in K764 / R764C11\n#&gt; Warning: Coercing boolean to numeric in K765 / R765C11\n#&gt; Warning: Coercing boolean to numeric in K766 / R766C11\n#&gt; Warning: Coercing boolean to numeric in K767 / R767C11\n#&gt; Warning: Coercing boolean to numeric in K768 / R768C11\n#&gt; Warning: Coercing boolean to numeric in K769 / R769C11\n#&gt; Warning: Coercing boolean to numeric in K770 / R770C11\n#&gt; Warning: Coercing boolean to numeric in K771 / R771C11\n#&gt; Warning: Coercing boolean to numeric in K772 / R772C11\n#&gt; Warning: Coercing boolean to numeric in K773 / R773C11\n#&gt; Warning: Coercing boolean to numeric in K774 / R774C11\n#&gt; Warning: Coercing boolean to numeric in K775 / R775C11\n#&gt; Warning: Coercing boolean to numeric in K776 / R776C11\n#&gt; Warning: Coercing boolean to numeric in K777 / R777C11\n#&gt; Warning: Coercing boolean to numeric in K778 / R778C11\n#&gt; Warning: Coercing boolean to numeric in K779 / R779C11\n#&gt; Warning: Coercing boolean to numeric in K780 / R780C11\n#&gt; Warning: Coercing boolean to numeric in K781 / R781C11\n#&gt; Warning: Coercing boolean to numeric in K782 / R782C11\n#&gt; Warning: Coercing boolean to numeric in K783 / R783C11\n#&gt; Warning: Coercing boolean to numeric in K784 / R784C11\n#&gt; Warning: Coercing boolean to numeric in K785 / R785C11\n#&gt; Warning: Coercing boolean to numeric in K786 / R786C11\n#&gt; Warning: Coercing boolean to numeric in K787 / R787C11\n#&gt; Warning: Coercing boolean to numeric in K788 / R788C11\n#&gt; Warning: Coercing boolean to numeric in K789 / R789C11\n#&gt; Warning: Coercing boolean to numeric in K790 / R790C11\n#&gt; Warning: Coercing boolean to numeric in K791 / R791C11\n#&gt; Warning: Coercing boolean to numeric in K792 / R792C11\n#&gt; Warning: Coercing boolean to numeric in K793 / R793C11\n#&gt; Warning: Coercing boolean to numeric in K794 / R794C11\n#&gt; Warning: Coercing boolean to numeric in K795 / R795C11\n#&gt; Warning: Coercing boolean to numeric in K796 / R796C11\n#&gt; Warning: Coercing boolean to numeric in K797 / R797C11\n#&gt; Warning: Coercing boolean to numeric in K798 / R798C11\n#&gt; Warning: Coercing boolean to numeric in K799 / R799C11\n#&gt; Warning: Coercing boolean to numeric in K800 / R800C11\n#&gt; Warning: Coercing boolean to numeric in K801 / R801C11\n#&gt; Warning: Coercing boolean to numeric in K802 / R802C11\n#&gt; Warning: Coercing boolean to numeric in K803 / R803C11\n#&gt; Warning: Coercing boolean to numeric in K804 / R804C11\n#&gt; Warning: Coercing boolean to numeric in K805 / R805C11\n#&gt; Warning: Coercing boolean to numeric in K806 / R806C11\n#&gt; Warning: Coercing boolean to numeric in K807 / R807C11\n#&gt; Warning: Coercing boolean to numeric in K808 / R808C11\n#&gt; Warning: Coercing boolean to numeric in K809 / R809C11\n#&gt; Warning: Coercing boolean to numeric in K810 / R810C11\n#&gt; Warning: Coercing boolean to numeric in K811 / R811C11\n#&gt; Warning: Coercing boolean to numeric in K812 / R812C11\n#&gt; Warning: Coercing boolean to numeric in K813 / R813C11\n#&gt; Warning: Coercing boolean to numeric in K814 / R814C11\n#&gt; Warning: Coercing boolean to numeric in K815 / R815C11\n#&gt; Warning: Coercing boolean to numeric in K816 / R816C11\n#&gt; Warning: Coercing boolean to numeric in K817 / R817C11\n#&gt; Warning: Coercing boolean to numeric in K818 / R818C11\n#&gt; Warning: Coercing boolean to numeric in K819 / R819C11\n#&gt; Warning: Coercing boolean to numeric in K820 / R820C11\n#&gt; Warning: Coercing boolean to numeric in K821 / R821C11\n#&gt; Warning: Coercing boolean to numeric in K822 / R822C11\n#&gt; Warning: Coercing boolean to numeric in K823 / R823C11\n#&gt; Warning: Coercing boolean to numeric in K824 / R824C11\n#&gt; Warning: Coercing boolean to numeric in K825 / R825C11\n#&gt; Warning: Coercing boolean to numeric in K826 / R826C11\n#&gt; Warning: Coercing boolean to numeric in K827 / R827C11\n#&gt; Warning: Coercing boolean to numeric in K828 / R828C11\n#&gt; Warning: Coercing boolean to numeric in K829 / R829C11\n#&gt; Warning: Coercing boolean to numeric in K830 / R830C11\n#&gt; Warning: Coercing boolean to numeric in K831 / R831C11\n#&gt; Warning: Coercing boolean to numeric in K832 / R832C11\n#&gt; Warning: Coercing boolean to numeric in K835 / R835C11\n#&gt; Warning: Coercing boolean to numeric in K837 / R837C11\n#&gt; Warning: Coercing boolean to numeric in K840 / R840C11\n#&gt; Warning: Coercing boolean to numeric in K842 / R842C11\n#&gt; Warning: Coercing boolean to numeric in K843 / R843C11\n#&gt; Warning: Coercing boolean to numeric in K844 / R844C11\n#&gt; Warning: Coercing boolean to numeric in K845 / R845C11\n#&gt; Warning: Coercing boolean to numeric in K846 / R846C11\n#&gt; Warning: Coercing boolean to numeric in K847 / R847C11\n#&gt; Warning: Coercing boolean to numeric in K850 / R850C11\n#&gt; Warning: Coercing boolean to numeric in K851 / R851C11\n#&gt; Warning: Coercing boolean to numeric in K852 / R852C11\n#&gt; Warning: Coercing boolean to numeric in K853 / R853C11\n#&gt; Warning: Coercing boolean to numeric in K855 / R855C11\n#&gt; Warning: Coercing boolean to numeric in K856 / R856C11\n#&gt; Warning: Coercing boolean to numeric in K857 / R857C11\n#&gt; Warning: Coercing boolean to numeric in K858 / R858C11\n#&gt; Warning: Coercing boolean to numeric in K859 / R859C11\n#&gt; Warning: Coercing boolean to numeric in K860 / R860C11\n#&gt; Warning: Coercing boolean to numeric in K861 / R861C11\n#&gt; Warning: Coercing boolean to numeric in K862 / R862C11\n#&gt; Warning: Coercing boolean to numeric in K863 / R863C11\n#&gt; Warning: Coercing boolean to numeric in K864 / R864C11\n#&gt; Warning: Coercing boolean to numeric in K865 / R865C11\n#&gt; Warning: Coercing boolean to numeric in K866 / R866C11\n#&gt; Warning: Coercing boolean to numeric in K867 / R867C11\n#&gt; Warning: Coercing boolean to numeric in K868 / R868C11\n#&gt; Warning: Coercing boolean to numeric in K869 / R869C11\n#&gt; Warning: Coercing boolean to numeric in K870 / R870C11\n#&gt; Warning: Coercing boolean to numeric in K871 / R871C11\n#&gt; Warning: Coercing boolean to numeric in K872 / R872C11\n#&gt; Warning: Coercing boolean to numeric in K873 / R873C11\n#&gt; Warning: Coercing boolean to numeric in K874 / R874C11\n#&gt; Warning: Coercing boolean to numeric in K875 / R875C11\n#&gt; Warning: Coercing boolean to numeric in K876 / R876C11\n#&gt; Warning: Coercing boolean to numeric in K877 / R877C11\n#&gt; Warning: Coercing boolean to numeric in K878 / R878C11\n#&gt; Warning: Coercing boolean to numeric in K879 / R879C11\n#&gt; Warning: Coercing boolean to numeric in K880 / R880C11\n#&gt; Warning: Coercing boolean to numeric in K881 / R881C11\n#&gt; Warning: Coercing boolean to numeric in K882 / R882C11\n#&gt; Warning: Coercing boolean to numeric in K883 / R883C11\n#&gt; Warning: Coercing boolean to numeric in K884 / R884C11\n#&gt; Warning: Coercing boolean to numeric in K887 / R887C11\n#&gt; Warning: Coercing boolean to numeric in K889 / R889C11\n#&gt; Warning: Coercing boolean to numeric in K890 / R890C11\n#&gt; Warning: Coercing boolean to numeric in K891 / R891C11\n#&gt; Warning: Coercing boolean to numeric in K892 / R892C11\n#&gt; Warning: Coercing boolean to numeric in K893 / R893C11\n#&gt; Warning: Coercing boolean to numeric in K894 / R894C11\n#&gt; Warning: Coercing boolean to numeric in K895 / R895C11\n#&gt; Warning: Coercing boolean to numeric in K896 / R896C11\n#&gt; Warning: Coercing boolean to numeric in K897 / R897C11\n#&gt; Warning: Coercing boolean to numeric in K898 / R898C11\n#&gt; Warning: Coercing boolean to numeric in K899 / R899C11\n#&gt; Warning: Coercing boolean to numeric in K900 / R900C11\n#&gt; Warning: Coercing boolean to numeric in K901 / R901C11\n#&gt; Warning: Coercing boolean to numeric in K902 / R902C11\n#&gt; Warning: Coercing boolean to numeric in K903 / R903C11\n#&gt; Warning: Coercing boolean to numeric in K904 / R904C11\n#&gt; Warning: Coercing boolean to numeric in K905 / R905C11\n#&gt; Warning: Coercing boolean to numeric in K906 / R906C11\n#&gt; Warning: Coercing boolean to numeric in K907 / R907C11\n#&gt; Warning: Coercing boolean to numeric in K908 / R908C11\n#&gt; Warning: Coercing boolean to numeric in K909 / R909C11\n#&gt; Warning: Coercing boolean to numeric in K910 / R910C11\n#&gt; Warning: Coercing boolean to numeric in K911 / R911C11\n#&gt; Warning: Coercing boolean to numeric in K912 / R912C11\n#&gt; Warning: Coercing boolean to numeric in K913 / R913C11\n#&gt; Warning: Coercing boolean to numeric in K914 / R914C11\n#&gt; Warning: Coercing boolean to numeric in K915 / R915C11\n#&gt; Warning: Coercing boolean to numeric in K916 / R916C11\n#&gt; Warning: Coercing boolean to numeric in K917 / R917C11\n#&gt; Warning: Coercing boolean to numeric in K920 / R920C11\n#&gt; Warning: Coercing boolean to numeric in K921 / R921C11\n#&gt; Warning: Coercing boolean to numeric in K922 / R922C11\n#&gt; Warning: Coercing boolean to numeric in K923 / R923C11\n#&gt; Warning: Coercing boolean to numeric in K924 / R924C11\n#&gt; Warning: Coercing boolean to numeric in K925 / R925C11\n#&gt; Warning: Coercing boolean to numeric in K926 / R926C11\n#&gt; Warning: Coercing boolean to numeric in K927 / R927C11\n#&gt; Warning: Coercing boolean to numeric in K928 / R928C11\n#&gt; Warning: Coercing boolean to numeric in K929 / R929C11\n#&gt; Warning: Coercing boolean to numeric in K930 / R930C11\n#&gt; Warning: Coercing boolean to numeric in K931 / R931C11\n#&gt; Warning: Coercing boolean to numeric in K932 / R932C11\n#&gt; Warning: Coercing boolean to numeric in K933 / R933C11\n#&gt; Warning: Coercing boolean to numeric in K935 / R935C11\n#&gt; Warning: Coercing boolean to numeric in K936 / R936C11\n#&gt; Warning: Coercing boolean to numeric in K937 / R937C11\n#&gt; Warning: Coercing boolean to numeric in K939 / R939C11\n#&gt; Warning: Coercing boolean to numeric in K940 / R940C11\n#&gt; Warning: Coercing boolean to numeric in K941 / R941C11\n#&gt; Warning: Coercing boolean to numeric in K942 / R942C11\n#&gt; Warning: Coercing boolean to numeric in K943 / R943C11\n#&gt; Warning: Coercing boolean to numeric in K944 / R944C11\n#&gt; Warning: Coercing boolean to numeric in K945 / R945C11\n#&gt; Warning: Coercing boolean to numeric in K946 / R946C11\n#&gt; Warning: Coercing boolean to numeric in K947 / R947C11\n#&gt; Warning: Coercing boolean to numeric in K948 / R948C11\n#&gt; Warning: Coercing boolean to numeric in K949 / R949C11\n#&gt; Warning: Coercing boolean to numeric in K951 / R951C11\n#&gt; Warning: Coercing boolean to numeric in K952 / R952C11\n#&gt; Warning: Coercing boolean to numeric in K953 / R953C11\n#&gt; Warning: Coercing boolean to numeric in K954 / R954C11\n#&gt; Warning: Coercing boolean to numeric in K955 / R955C11\n#&gt; Warning: Coercing boolean to numeric in K956 / R956C11\n#&gt; Warning: Coercing boolean to numeric in K957 / R957C11\n#&gt; Warning: Coercing boolean to numeric in K958 / R958C11\n#&gt; Warning: Coercing boolean to numeric in K959 / R959C11\n#&gt; Warning: Coercing boolean to numeric in K960 / R960C11\n#&gt; Warning: Coercing boolean to numeric in K961 / R961C11\n#&gt; Warning: Coercing boolean to numeric in K962 / R962C11\n#&gt; Warning: Coercing boolean to numeric in K963 / R963C11\n#&gt; Warning: Coercing boolean to numeric in K965 / R965C11\n#&gt; Warning: Coercing boolean to numeric in K966 / R966C11\n#&gt; Warning: Coercing boolean to numeric in K967 / R967C11\n#&gt; Warning: Coercing boolean to numeric in K968 / R968C11\n#&gt; Warning: Coercing boolean to numeric in K969 / R969C11\n#&gt; Warning: Coercing boolean to numeric in K970 / R970C11\n#&gt; Warning: Coercing boolean to numeric in K971 / R971C11\n#&gt; Warning: Coercing boolean to numeric in K972 / R972C11\n#&gt; Warning: Coercing boolean to numeric in K973 / R973C11\n#&gt; Warning: Coercing boolean to numeric in K974 / R974C11\n#&gt; Warning: Coercing boolean to numeric in K975 / R975C11\n#&gt; Warning: Coercing boolean to numeric in K976 / R976C11\n#&gt; Warning: Coercing boolean to numeric in K977 / R977C11\n#&gt; Warning: Coercing boolean to numeric in K978 / R978C11\n#&gt; Warning: Coercing boolean to numeric in K980 / R980C11\n#&gt; Warning: Coercing boolean to numeric in K981 / R981C11\n#&gt; Warning: Coercing boolean to numeric in K982 / R982C11\n#&gt; Warning: Coercing boolean to numeric in K983 / R983C11\n#&gt; Warning: Coercing boolean to numeric in K984 / R984C11\n#&gt; Warning: Coercing boolean to numeric in K985 / R985C11\n#&gt; Warning: Coercing boolean to numeric in K986 / R986C11\n#&gt; Warning: Coercing boolean to numeric in K987 / R987C11\n#&gt; Warning: Coercing boolean to numeric in K991 / R991C11\n#&gt; Warning: Coercing boolean to numeric in K992 / R992C11\n#&gt; Warning: Coercing boolean to numeric in K993 / R993C11\n#&gt; Warning: Coercing boolean to numeric in K995 / R995C11\n#&gt; Warning: Coercing boolean to numeric in K996 / R996C11\n#&gt; Warning: Coercing boolean to numeric in K997 / R997C11\n#&gt; Warning: Coercing boolean to numeric in K998 / R998C11\n#&gt; Warning: Coercing boolean to numeric in K999 / R999C11\n#&gt; Warning: Coercing boolean to numeric in K1000 / R1000C11\n#&gt; Warning: Coercing boolean to numeric in K1001 / R1001C11\n#&gt; Warning: Coercing boolean to numeric in K1002 / R1002C11\n#&gt; Warning: Coercing boolean to numeric in K1003 / R1003C11\n#&gt; Warning: Coercing boolean to numeric in K1004 / R1004C11\n#&gt; Warning: Coercing boolean to numeric in K1005 / R1005C11\n#&gt; Warning: Coercing boolean to numeric in K1006 / R1006C11\n#&gt; Warning: Coercing boolean to numeric in K1007 / R1007C11\n#&gt; Warning: Coercing boolean to numeric in K1008 / R1008C11\n#&gt; Warning: Coercing boolean to numeric in K1009 / R1009C11\n#&gt; Warning: Coercing boolean to numeric in K1010 / R1010C11\n#&gt; Warning: Coercing boolean to numeric in K1011 / R1011C11\n#&gt; Warning: Coercing boolean to numeric in K1012 / R1012C11\n#&gt; Warning: Coercing boolean to numeric in K1013 / R1013C11\n#&gt; Warning: Coercing boolean to numeric in K1014 / R1014C11\n#&gt; Warning: Coercing boolean to numeric in K1015 / R1015C11\n#&gt; Warning: Coercing boolean to numeric in K1016 / R1016C11\n#&gt; Warning: Coercing boolean to numeric in K1017 / R1017C11\n#&gt; Warning: Coercing boolean to numeric in K1018 / R1018C11\n#&gt; Warning: Coercing boolean to numeric in K1019 / R1019C11\n#&gt; Warning: Coercing boolean to numeric in K1020 / R1020C11\n#&gt; Warning: Coercing boolean to numeric in K1021 / R1021C11\n#&gt; Warning: Coercing boolean to numeric in K1022 / R1022C11\n#&gt; Warning: Coercing boolean to numeric in K1023 / R1023C11\n#&gt; Warning: Coercing boolean to numeric in K1024 / R1024C11\n#&gt; Warning: Coercing boolean to numeric in K1025 / R1025C11\n#&gt; Warning: Coercing boolean to numeric in K1026 / R1026C11\n#&gt; Warning: Coercing boolean to numeric in K1028 / R1028C11\n#&gt; Warning: Coercing boolean to numeric in K1029 / R1029C11\n#&gt; Warning: Coercing boolean to numeric in K1030 / R1030C11\n#&gt; Warning: Coercing boolean to numeric in K1031 / R1031C11\n#&gt; Warning: Coercing boolean to numeric in K1032 / R1032C11\n#&gt; Warning: Coercing boolean to numeric in K1033 / R1033C11\n#&gt; Warning: Coercing boolean to numeric in K1034 / R1034C11\n#&gt; Warning: Coercing boolean to numeric in K1035 / R1035C11\n#&gt; Warning: Coercing boolean to numeric in K1036 / R1036C11\n#&gt; Warning: Coercing boolean to numeric in K1037 / R1037C11\n#&gt; Warning: Coercing boolean to numeric in K1038 / R1038C11\n#&gt; Warning: Coercing boolean to numeric in K1039 / R1039C11\n#&gt; Warning: Coercing boolean to numeric in K1040 / R1040C11\n#&gt; Warning: Coercing boolean to numeric in K1041 / R1041C11\n#&gt; Warning: Coercing boolean to numeric in K1042 / R1042C11\n#&gt; Warning: Coercing boolean to numeric in K1043 / R1043C11\n#&gt; Warning: Coercing boolean to numeric in K1044 / R1044C11\n#&gt; Warning: Coercing boolean to numeric in K1045 / R1045C11\n#&gt; Warning: Coercing boolean to numeric in K1046 / R1046C11\n#&gt; Warning: Coercing boolean to numeric in K1051 / R1051C11\n#&gt; Warning: Coercing boolean to numeric in K1054 / R1054C11\n#&gt; Warning: Coercing boolean to numeric in K1057 / R1057C11\n#&gt; Warning: Coercing boolean to numeric in K1058 / R1058C11\n#&gt; Warning: Coercing boolean to numeric in K1059 / R1059C11\n#&gt; Warning: Coercing boolean to numeric in K1060 / R1060C11\n#&gt; Warning: Coercing boolean to numeric in K1061 / R1061C11\n#&gt; Warning: Coercing boolean to numeric in K1062 / R1062C11\n#&gt; Warning: Coercing boolean to numeric in K1063 / R1063C11\n#&gt; Warning: Coercing boolean to numeric in K1064 / R1064C11\n#&gt; Warning: Coercing boolean to numeric in K1065 / R1065C11\n#&gt; Warning: Coercing boolean to numeric in K1066 / R1066C11\n#&gt; Warning: Coercing boolean to numeric in K1067 / R1067C11\n#&gt; Warning: Coercing boolean to numeric in K1068 / R1068C11\n#&gt; Warning: Coercing boolean to numeric in K1069 / R1069C11\n#&gt; Warning: Coercing boolean to numeric in K1070 / R1070C11\n#&gt; Warning: Coercing boolean to numeric in K1071 / R1071C11\n#&gt; Warning: Coercing boolean to numeric in K1072 / R1072C11\n#&gt; Warning: Coercing boolean to numeric in K1073 / R1073C11\n#&gt; Warning: Coercing boolean to numeric in K1074 / R1074C11\n#&gt; Warning: Coercing boolean to numeric in K1075 / R1075C11\n#&gt; Warning: Coercing boolean to numeric in K1076 / R1076C11\n#&gt; Warning: Coercing boolean to numeric in K1077 / R1077C11\n#&gt; Warning: Coercing boolean to numeric in K1078 / R1078C11\n#&gt; Warning: Coercing boolean to numeric in K1079 / R1079C11\n#&gt; Warning: Coercing boolean to numeric in K1080 / R1080C11\n#&gt; Warning: Coercing boolean to numeric in K1081 / R1081C11\n#&gt; Warning: Coercing boolean to numeric in K1082 / R1082C11\n#&gt; Warning: Coercing boolean to numeric in K1083 / R1083C11\n#&gt; Warning: Coercing boolean to numeric in K1084 / R1084C11\n#&gt; Warning: Coercing boolean to numeric in K1085 / R1085C11\n#&gt; Warning: Coercing boolean to numeric in K1086 / R1086C11\n#&gt; Warning: Coercing boolean to numeric in K1087 / R1087C11\n#&gt; Warning: Coercing boolean to numeric in K1088 / R1088C11\n#&gt; Warning: Coercing boolean to numeric in K1089 / R1089C11\n#&gt; Warning: Coercing boolean to numeric in K1090 / R1090C11\n#&gt; Warning: Coercing boolean to numeric in K1091 / R1091C11\n#&gt; Warning: Coercing boolean to numeric in K1092 / R1092C11\n#&gt; Warning: Coercing boolean to numeric in K1093 / R1093C11\n#&gt; Warning: Coercing boolean to numeric in K1094 / R1094C11\n#&gt; Warning: Coercing boolean to numeric in K1095 / R1095C11\n#&gt; Warning: Coercing boolean to numeric in K1096 / R1096C11\n#&gt; Warning: Coercing boolean to numeric in K1097 / R1097C11\n#&gt; Warning: Coercing boolean to numeric in K1098 / R1098C11\n#&gt; Warning: Coercing boolean to numeric in K1099 / R1099C11\n#&gt; Warning: Coercing boolean to numeric in K1101 / R1101C11\n#&gt; Warning: Coercing boolean to numeric in K1102 / R1102C11\n#&gt; Warning: Coercing boolean to numeric in K1103 / R1103C11\n#&gt; Warning: Coercing boolean to numeric in K1104 / R1104C11\n#&gt; Warning: Coercing boolean to numeric in K1105 / R1105C11\n#&gt; Warning: Coercing boolean to numeric in K1106 / R1106C11\n#&gt; Warning: Coercing boolean to numeric in K1107 / R1107C11\n#&gt; Warning: Coercing boolean to numeric in K1108 / R1108C11\n#&gt; Warning: Coercing boolean to numeric in K1109 / R1109C11\n#&gt; Warning: Coercing boolean to numeric in K1111 / R1111C11\n#&gt; Warning: Coercing boolean to numeric in K1112 / R1112C11\n#&gt; Warning: Coercing boolean to numeric in K1113 / R1113C11\n#&gt; Warning: Coercing boolean to numeric in K1114 / R1114C11\n#&gt; Warning: Coercing boolean to numeric in K1115 / R1115C11\n#&gt; Warning: Coercing boolean to numeric in K1116 / R1116C11\n#&gt; Warning: Coercing boolean to numeric in K1118 / R1118C11\n#&gt; Warning: Coercing boolean to numeric in K1120 / R1120C11\n#&gt; Warning: Coercing boolean to numeric in K1122 / R1122C11\n#&gt; Warning: Coercing boolean to numeric in K1123 / R1123C11\n#&gt; Warning: Coercing boolean to numeric in K1124 / R1124C11\n#&gt; Warning: Coercing boolean to numeric in K1125 / R1125C11\n#&gt; Warning: Coercing boolean to numeric in K1126 / R1126C11\n#&gt; Warning: Coercing boolean to numeric in K1127 / R1127C11\n#&gt; Warning: Coercing boolean to numeric in K1128 / R1128C11\n#&gt; Warning: Coercing boolean to numeric in K1129 / R1129C11\n#&gt; Warning: Coercing boolean to numeric in K1130 / R1130C11\n#&gt; Warning: Coercing boolean to numeric in K1131 / R1131C11\n#&gt; Warning: Coercing boolean to numeric in K1132 / R1132C11\n#&gt; Warning: Coercing boolean to numeric in K1133 / R1133C11\n#&gt; Warning: Coercing boolean to numeric in K1134 / R1134C11\n#&gt; Warning: Coercing boolean to numeric in K1135 / R1135C11\n#&gt; Warning: Coercing boolean to numeric in K1136 / R1136C11\n#&gt; Warning: Coercing boolean to numeric in K1137 / R1137C11\n#&gt; Warning: Coercing boolean to numeric in K1138 / R1138C11\n#&gt; Warning: Coercing boolean to numeric in K1139 / R1139C11\n#&gt; Warning: Coercing boolean to numeric in K1140 / R1140C11\n#&gt; Warning: Coercing boolean to numeric in K1141 / R1141C11\n#&gt; Warning: Coercing boolean to numeric in K1142 / R1142C11\n#&gt; Warning: Coercing boolean to numeric in K1143 / R1143C11\n#&gt; Warning: Coercing boolean to numeric in K1144 / R1144C11\n#&gt; Warning: Coercing boolean to numeric in K1145 / R1145C11\n#&gt; Warning: Coercing boolean to numeric in K1146 / R1146C11\n#&gt; Warning: Coercing boolean to numeric in K1147 / R1147C11\n#&gt; Warning: Coercing boolean to numeric in K1148 / R1148C11\n#&gt; Warning: Coercing boolean to numeric in K1149 / R1149C11\n#&gt; Warning: Coercing boolean to numeric in K1151 / R1151C11\n#&gt; Warning: Coercing boolean to numeric in K1152 / R1152C11\n#&gt; Warning: Coercing boolean to numeric in K1153 / R1153C11\n#&gt; Warning: Coercing boolean to numeric in K1154 / R1154C11\n#&gt; Warning: Coercing boolean to numeric in K1155 / R1155C11\n#&gt; Warning: Coercing boolean to numeric in K1156 / R1156C11\n#&gt; Warning: Coercing boolean to numeric in K1157 / R1157C11\n#&gt; Warning: Coercing boolean to numeric in K1158 / R1158C11\n#&gt; Warning: Coercing boolean to numeric in K1159 / R1159C11\n#&gt; Warning: Coercing boolean to numeric in K1160 / R1160C11\n#&gt; Warning: Coercing boolean to numeric in K1161 / R1161C11\n#&gt; Warning: Coercing boolean to numeric in K1162 / R1162C11\n#&gt; Warning: Coercing boolean to numeric in K1163 / R1163C11\n#&gt; Warning: Coercing boolean to numeric in K1164 / R1164C11\n#&gt; Warning: Coercing boolean to numeric in K1165 / R1165C11\n#&gt; Warning: Coercing boolean to numeric in K1166 / R1166C11\n#&gt; Warning: Coercing boolean to numeric in K1167 / R1167C11\n#&gt; Warning: Coercing boolean to numeric in K1168 / R1168C11\n#&gt; Warning: Coercing boolean to numeric in K1169 / R1169C11\n#&gt; Warning: Coercing boolean to numeric in K1170 / R1170C11\n#&gt; Warning: Coercing boolean to numeric in K1171 / R1171C11\n#&gt; Warning: Coercing boolean to numeric in K1172 / R1172C11\n#&gt; Warning: Coercing boolean to numeric in K1173 / R1173C11\n#&gt; Warning: Coercing boolean to numeric in K1174 / R1174C11\n#&gt; Warning: Coercing boolean to numeric in K1175 / R1175C11\n#&gt; Warning: Coercing boolean to numeric in K1176 / R1176C11\n#&gt; Warning: Coercing boolean to numeric in K1177 / R1177C11\n#&gt; Warning: Coercing boolean to numeric in K1178 / R1178C11\n#&gt; Warning: Coercing boolean to numeric in K1179 / R1179C11\n#&gt; Warning: Coercing boolean to numeric in K1180 / R1180C11\n#&gt; Warning: Coercing boolean to numeric in K1181 / R1181C11\n#&gt; Warning: Coercing boolean to numeric in K1182 / R1182C11\n#&gt; Warning: Coercing boolean to numeric in K1183 / R1183C11\n#&gt; Warning: Coercing boolean to numeric in K1184 / R1184C11\n#&gt; Warning: Coercing boolean to numeric in K1185 / R1185C11\n#&gt; Warning: Coercing boolean to numeric in K1186 / R1186C11\n#&gt; Warning: Coercing boolean to numeric in K1187 / R1187C11\n#&gt; Warning: Coercing boolean to numeric in K1188 / R1188C11\n#&gt; Warning: Coercing boolean to numeric in K1189 / R1189C11\n#&gt; Warning: Coercing boolean to numeric in K1190 / R1190C11\n#&gt; Warning: Coercing boolean to numeric in K1191 / R1191C11\n#&gt; Warning: Coercing boolean to numeric in K1192 / R1192C11\n#&gt; Warning: Coercing boolean to numeric in K1193 / R1193C11\n#&gt; Warning: Coercing boolean to numeric in K1194 / R1194C11\n#&gt; Warning: Coercing boolean to numeric in K1195 / R1195C11\n#&gt; Warning: Coercing boolean to numeric in K1196 / R1196C11\n#&gt; Warning: Coercing boolean to numeric in K1197 / R1197C11\n#&gt; Warning: Coercing boolean to numeric in K1198 / R1198C11\n#&gt; Warning: Coercing boolean to numeric in K1199 / R1199C11\n#&gt; Warning: Coercing boolean to numeric in K1200 / R1200C11\n#&gt; Warning: Coercing boolean to numeric in K1201 / R1201C11\n#&gt; Warning: Coercing boolean to numeric in K1202 / R1202C11\n#&gt; Warning: Coercing boolean to numeric in K1203 / R1203C11\n#&gt; Warning: Coercing boolean to numeric in K1204 / R1204C11\n#&gt; Warning: Coercing boolean to numeric in K1205 / R1205C11\n#&gt; Warning: Coercing boolean to numeric in K1206 / R1206C11\n#&gt; Warning: Coercing boolean to numeric in K1207 / R1207C11\n#&gt; Warning: Coercing boolean to numeric in K1208 / R1208C11\n#&gt; Warning: Coercing boolean to numeric in K1209 / R1209C11\n#&gt; Warning: Coercing boolean to numeric in K1212 / R1212C11\n#&gt; Warning: Coercing boolean to numeric in K1213 / R1213C11\n#&gt; Warning: Coercing boolean to numeric in K1214 / R1214C11\n#&gt; Warning: Coercing boolean to numeric in K1215 / R1215C11\n#&gt; Warning: Coercing boolean to numeric in K1216 / R1216C11\n#&gt; Warning: Coercing boolean to numeric in K1217 / R1217C11\n#&gt; Warning: Coercing boolean to numeric in K1218 / R1218C11\n#&gt; Warning: Coercing boolean to numeric in K1219 / R1219C11\n#&gt; Warning: Coercing boolean to numeric in K1220 / R1220C11\n#&gt; Warning: Coercing boolean to numeric in K1222 / R1222C11\n#&gt; Warning: Coercing boolean to numeric in K1223 / R1223C11\n#&gt; Warning: Coercing boolean to numeric in K1224 / R1224C11\n#&gt; Warning: Coercing boolean to numeric in K1225 / R1225C11\n#&gt; Warning: Coercing boolean to numeric in K1226 / R1226C11\n#&gt; Warning: Coercing boolean to numeric in K1227 / R1227C11\n#&gt; Warning: Coercing boolean to numeric in K1228 / R1228C11\n#&gt; Warning: Coercing boolean to numeric in K1229 / R1229C11\n#&gt; Warning: Coercing boolean to numeric in K1230 / R1230C11\n#&gt; Warning: Coercing boolean to numeric in K1231 / R1231C11\n#&gt; Warning: Coercing boolean to numeric in K1234 / R1234C11\n#&gt; Warning: Coercing boolean to numeric in K1235 / R1235C11\n#&gt; Warning: Coercing boolean to numeric in K1237 / R1237C11\n#&gt; Warning: Coercing boolean to numeric in K1238 / R1238C11\n#&gt; Warning: Coercing boolean to numeric in K1239 / R1239C11\n#&gt; Warning: Coercing boolean to numeric in K1240 / R1240C11\n#&gt; Warning: Coercing boolean to numeric in K1241 / R1241C11\n#&gt; Warning: Coercing boolean to numeric in K1242 / R1242C11\n#&gt; Warning: Coercing boolean to numeric in K1246 / R1246C11\n#&gt; Warning: Coercing boolean to numeric in K1247 / R1247C11\n#&gt; Warning: Coercing boolean to numeric in K1248 / R1248C11\n#&gt; Warning: Coercing boolean to numeric in K1250 / R1250C11\n#&gt; Warning: Coercing boolean to numeric in K1252 / R1252C11\n#&gt; Warning: Coercing boolean to numeric in K1253 / R1253C11\n#&gt; Warning: Coercing boolean to numeric in K1254 / R1254C11\n#&gt; Warning: Coercing boolean to numeric in K1255 / R1255C11\n#&gt; Warning: Coercing boolean to numeric in K1256 / R1256C11\n#&gt; Warning: Coercing boolean to numeric in K1257 / R1257C11\n#&gt; Warning: Coercing boolean to numeric in K1258 / R1258C11\n#&gt; Warning: Coercing boolean to numeric in K1259 / R1259C11\n#&gt; Warning: Coercing boolean to numeric in K1260 / R1260C11\n#&gt; Warning: Coercing boolean to numeric in K1261 / R1261C11\n#&gt; Warning: Coercing boolean to numeric in K1262 / R1262C11\n#&gt; Warning: Coercing boolean to numeric in K1263 / R1263C11\n#&gt; Warning: Coercing boolean to numeric in K1264 / R1264C11\n#&gt; Warning: Coercing boolean to numeric in K1265 / R1265C11\n#&gt; Warning: Coercing boolean to numeric in K1266 / R1266C11\n#&gt; Warning: Coercing boolean to numeric in K1267 / R1267C11\n#&gt; Warning: Coercing boolean to numeric in K1268 / R1268C11\n#&gt; Warning: Coercing boolean to numeric in K1270 / R1270C11\n#&gt; Warning: Coercing boolean to numeric in K1271 / R1271C11\n#&gt; Warning: Coercing boolean to numeric in K1273 / R1273C11\n#&gt; Warning: Coercing boolean to numeric in K1274 / R1274C11\n#&gt; Warning: Coercing boolean to numeric in K1275 / R1275C11\n#&gt; Warning: Coercing boolean to numeric in K1276 / R1276C11\n#&gt; Warning: Coercing boolean to numeric in K1278 / R1278C11\n#&gt; Warning: Coercing boolean to numeric in K1279 / R1279C11\n#&gt; Warning: Coercing boolean to numeric in K1280 / R1280C11\n#&gt; Warning: Coercing boolean to numeric in K1281 / R1281C11\n#&gt; Warning: Coercing boolean to numeric in K1282 / R1282C11\n#&gt; Warning: Coercing boolean to numeric in K1283 / R1283C11\n#&gt; Warning: Coercing boolean to numeric in K1284 / R1284C11\n#&gt; Warning: Coercing boolean to numeric in K1285 / R1285C11\n#&gt; Warning: Coercing boolean to numeric in K1286 / R1286C11\n#&gt; Warning: Coercing boolean to numeric in K1287 / R1287C11\n#&gt; Warning: Coercing boolean to numeric in K1288 / R1288C11\n#&gt; Warning: Coercing boolean to numeric in K1289 / R1289C11\n#&gt; Warning: Coercing boolean to numeric in K1290 / R1290C11\n#&gt; Warning: Coercing boolean to numeric in K1291 / R1291C11\n#&gt; Warning: Coercing boolean to numeric in K1292 / R1292C11\n#&gt; Warning: Coercing boolean to numeric in K1293 / R1293C11\n#&gt; Warning: Coercing boolean to numeric in K1294 / R1294C11\n#&gt; Warning: Coercing boolean to numeric in K1295 / R1295C11\n#&gt; Warning: Coercing boolean to numeric in K1296 / R1296C11\n#&gt; Warning: Coercing boolean to numeric in K1297 / R1297C11\n#&gt; Warning: Coercing boolean to numeric in K1298 / R1298C11\n#&gt; Warning: Coercing boolean to numeric in K1299 / R1299C11\n#&gt; Warning: Coercing boolean to numeric in K1300 / R1300C11\n#&gt; Warning: Coercing boolean to numeric in K1301 / R1301C11\n#&gt; Warning: Coercing boolean to numeric in K1302 / R1302C11\n#&gt; Warning: Coercing boolean to numeric in K1303 / R1303C11\n#&gt; Warning: Coercing boolean to numeric in K1304 / R1304C11\n#&gt; Warning: Coercing boolean to numeric in K1305 / R1305C11\n#&gt; Warning: Coercing boolean to numeric in K1306 / R1306C11\n#&gt; Warning: Coercing boolean to numeric in K1307 / R1307C11\n#&gt; Warning: Coercing boolean to numeric in K1308 / R1308C11\n#&gt; Warning: Coercing boolean to numeric in K1309 / R1309C11\n#&gt; Warning: Coercing boolean to numeric in K1310 / R1310C11\n#&gt; Warning: Coercing boolean to numeric in K1311 / R1311C11\n#&gt; Warning: Coercing boolean to numeric in K1312 / R1312C11\n#&gt; Warning: Coercing boolean to numeric in K1313 / R1313C11\n#&gt; Warning: Coercing boolean to numeric in K1314 / R1314C11\n#&gt; Warning: Coercing boolean to numeric in K1316 / R1316C11\n#&gt; Warning: Coercing boolean to numeric in K1317 / R1317C11\n#&gt; Warning: Coercing boolean to numeric in K1319 / R1319C11\n#&gt; Warning: Coercing boolean to numeric in K1320 / R1320C11\n#&gt; Warning: Coercing boolean to numeric in K1321 / R1321C11\n#&gt; Warning: Coercing boolean to numeric in K1322 / R1322C11\n#&gt; Warning: Coercing boolean to numeric in K1323 / R1323C11\n#&gt; Warning: Coercing boolean to numeric in K1324 / R1324C11\n#&gt; Warning: Coercing boolean to numeric in K1325 / R1325C11\n#&gt; Warning: Coercing boolean to numeric in K1327 / R1327C11\n#&gt; Warning: Coercing boolean to numeric in K1328 / R1328C11\n#&gt; Warning: Coercing boolean to numeric in K1329 / R1329C11\n#&gt; Warning: Coercing boolean to numeric in K1331 / R1331C11\n#&gt; Warning: Coercing boolean to numeric in K1332 / R1332C11\n#&gt; Warning: Coercing boolean to numeric in K1333 / R1333C11\n#&gt; Warning: Coercing boolean to numeric in K1334 / R1334C11\n#&gt; Warning: Coercing boolean to numeric in K1335 / R1335C11\n#&gt; Warning: Coercing boolean to numeric in K1337 / R1337C11\n#&gt; Warning: Coercing boolean to numeric in K1338 / R1338C11\n#&gt; Warning: Coercing boolean to numeric in K1339 / R1339C11\n#&gt; Warning: Coercing boolean to numeric in K1340 / R1340C11\n#&gt; Warning: Coercing boolean to numeric in K1341 / R1341C11\n#&gt; Warning: Coercing boolean to numeric in K1342 / R1342C11\n#&gt; Warning: Coercing boolean to numeric in K1343 / R1343C11\n#&gt; Warning: Coercing boolean to numeric in K1344 / R1344C11\n#&gt; Warning: Coercing boolean to numeric in K1346 / R1346C11\n#&gt; Warning: Coercing boolean to numeric in K1347 / R1347C11\n#&gt; Warning: Coercing boolean to numeric in K1350 / R1350C11\n#&gt; Warning: Coercing boolean to numeric in K1351 / R1351C11\n#&gt; Warning: Coercing boolean to numeric in K1352 / R1352C11\n#&gt; Warning: Coercing boolean to numeric in K1353 / R1353C11\n#&gt; Warning: Coercing boolean to numeric in K1354 / R1354C11\n#&gt; Warning: Coercing boolean to numeric in K1357 / R1357C11\n#&gt; Warning: Coercing boolean to numeric in K1359 / R1359C11\n#&gt; Warning: Coercing boolean to numeric in K1360 / R1360C11\n#&gt; Warning: Coercing boolean to numeric in K1361 / R1361C11\n#&gt; Warning: Coercing boolean to numeric in K1362 / R1362C11\n#&gt; Warning: Coercing boolean to numeric in K1363 / R1363C11\n#&gt; Warning: Coercing boolean to numeric in K1364 / R1364C11\n#&gt; Warning: Coercing boolean to numeric in K1365 / R1365C11\n#&gt; Warning: Coercing boolean to numeric in K1366 / R1366C11\n#&gt; Warning: Coercing boolean to numeric in K1367 / R1367C11\n#&gt; Warning: Coercing boolean to numeric in K1368 / R1368C11\n#&gt; Warning: Coercing boolean to numeric in K1369 / R1369C11\n#&gt; Warning: Coercing boolean to numeric in K1370 / R1370C11\n#&gt; Warning: Coercing boolean to numeric in K1372 / R1372C11\n#&gt; Warning: Coercing boolean to numeric in K1373 / R1373C11\n#&gt; Warning: Coercing boolean to numeric in K1374 / R1374C11\n#&gt; Warning: Coercing boolean to numeric in K1376 / R1376C11\n#&gt; Warning: Coercing boolean to numeric in K1377 / R1377C11\n#&gt; Warning: Coercing boolean to numeric in K1378 / R1378C11\n#&gt; Warning: Coercing boolean to numeric in K1379 / R1379C11\n#&gt; Warning: Coercing boolean to numeric in K1380 / R1380C11\n#&gt; Warning: Coercing boolean to numeric in K1381 / R1381C11\n#&gt; Warning: Coercing boolean to numeric in K1382 / R1382C11\n#&gt; Warning: Coercing boolean to numeric in K1383 / R1383C11\n#&gt; Warning: Coercing boolean to numeric in K1384 / R1384C11\n#&gt; Warning: Coercing boolean to numeric in K1385 / R1385C11\n#&gt; Warning: Coercing boolean to numeric in K1386 / R1386C11\n#&gt; Warning: Coercing boolean to numeric in K1388 / R1388C11\n#&gt; Warning: Coercing boolean to numeric in K1390 / R1390C11\n#&gt; Warning: Coercing boolean to numeric in K1391 / R1391C11\n#&gt; Warning: Coercing boolean to numeric in K1392 / R1392C11\n#&gt; Warning: Coercing boolean to numeric in K1393 / R1393C11\n#&gt; Warning: Coercing boolean to numeric in K1394 / R1394C11\n# CD (Comprehensive Development Zones)\n## Deal with these separately, need to do some wrangling \n\nocp_subdivision &lt;- rbind(rr1_rr2, rr3, sr) %&gt;%\n  filter(!is.na(pid))\n\nocp_subdivision_parcelmap &lt;- merge(ocp_subdivision, bowen_parcelmap, by.x = \"pid\", by.y = \"Name\") %&gt;%\n  mutate(subdividable = case_when(\n    `Can Subdivide?` == 0 ~ FALSE,\n    `Can Subdivide?` &gt; 0 ~ TRUE\n  ))\n\nggplot(ocp_subdivision_parcelmap) +\n  geom_sf(aes(fill = `subdividable`, geometry = geom), color = NA) \n\n\n\n\n\n\n\n\n\nCode\nggplot(ocp_subdivision_parcelmap) +\n  geom_sf(aes(fill = `Can Subdivide?`, geometry = geom), color = NA) +\n  scale_fill_viridis_c(direction = -1,\n                       breaks = c(0, 10, 20, 40),\n                       trans = scales::pseudo_log_trans(sigma = 1))",
    "crumbs": [
      "Threats",
      "Threats: Development"
    ]
  },
  {
    "objectID": "vignettes/input_sdm.html",
    "href": "vignettes/input_sdm.html",
    "title": "Species",
    "section": "",
    "text": "This page describes the preparing of species layers for input into the Zonation5 conservation prioritization software.",
    "crumbs": [
      "Species"
    ]
  },
  {
    "objectID": "vignettes/input_sdm.html#introduction",
    "href": "vignettes/input_sdm.html#introduction",
    "title": "Species",
    "section": "",
    "text": "This page describes the preparing of species layers for input into the Zonation5 conservation prioritization software.",
    "crumbs": [
      "Species"
    ]
  },
  {
    "objectID": "vignettes/input_sdm.html#setup",
    "href": "vignettes/input_sdm.html#setup",
    "title": "Species",
    "section": "Setup",
    "text": "Setup\n\n\nCode\n#### Palen Lab Packages ####\nlibrary(bowen.biodiversity.webapp)\n\n#### Other Packages ####\nlibrary(here)\nlibrary(dplyr)\nlibrary(stringr)\nlibrary(foreach)\nlibrary(sf)\nlibrary(terra)\nlibrary(tidyterra)\nlibrary(readxl)\nlibrary(googlesheets4)",
    "crumbs": [
      "Species"
    ]
  },
  {
    "objectID": "vignettes/input_sdm.html#species-distribution-models",
    "href": "vignettes/input_sdm.html#species-distribution-models",
    "title": "Species",
    "section": "Species Distribution Models",
    "text": "Species Distribution Models\nThe species distribution models (SDMs) included in the Bowen Island Conservation Plan analyses were originally produced by Viorel Popescu (Popescu et al., 2020). Out of the 341 SDMs available, we included 193 of the SDMs. Occurrence locations of small vertebrate species were gathered from Global Biodiversity Information Facility (data.gbif.org) and Nature Counts (birdscanada.org/birdmon) open-access databases. Inclusion of small mammal species was based on Appendix 2 & 3 from the 2005 Environmental Inventory report, which states species presence on Bowen Island. We used the iNaturalist and eBird databases of observations for the inclusion criteria for reptiles, amphibians, and birds (described in further detail in Methods).\n\n\nCode\n#### SPECIES DISTRIBUTION MODELS ####\n# Contents of \"data-raw/species_distribution_models/\" downloaded from Cumulative effects - SFU Teams Sharepoint \n# https://1sfu.sharepoint.com/:f:/r/teams/Cumulativeeffects-SFUTeams9/Shared%20Documents/BCH_project_backup/SPECIES?csf=1&web=1&e=FpNkgc \n# Directory Path: BCH_project_backup/SPECIES/\n# Paper: https://www.nature.com/articles/s41598-020-64501-7#MOESM1\n# See Wendy Palen (SFU) for access \n#### PROCESSING SDM ####\n# Get list of available SDMs\nsdm_folder &lt;- here(\"data-raw/species_distribution_models\")\nsdm_folder_tif &lt;- list.files(sdm_folder, recursive = T, pattern = \"*.tif$\") # Get only .tif files\n# Correspondence with Viorel Popescu confirms that _NAs_ should be SDMs with rock, ice, large lakes layers masked\nsdm_folder_tif_NAs &lt;- sdm_folder_tif[grepl(\"_NAs_\", sdm_folder_tif)] # Get only .tif with \"_NAs_\" in filename\n# Directory to save SDMs\nsdm_output_dir &lt;- here(\"inst/extdata/bowen_sdm\")\nif(!dir.exists(sdm_output_dir)) {\n  dir.create(sdm_output_dir)\n}\n\n\n\n\nCode\n# Load Bowen Island Mask (created with vignettes/input_mask.qmd)\nbowen_mask &lt;- rast(here(\"inst/extdata/bowen_mask.tif\"))\n# Bowen Land, from zoning \nbowen_land &lt;- bowen_zoning[!bowen_zoning$ZONE_CODE %in% c(\"WG1\", \"WG1(a)\"),] %&gt;% \n  vect()\n\n#### PREPARE SDMs TO BOWEN ISLAND ####\n# Weights for terra::focal() function that provides moving window average\n# - Smoothing algorithm \n# - Use this to fill some empty cells on Bowen Island with weighted mean of the neighbouring cells.\nweights &lt;- matrix(c(0, 0, 1, 1, 1, 0, 0,\n                    0, 1, 1, 2, 1, 1, 0,\n                    1, 1, 3, 3, 3, 1, 1,\n                    1, 2, 3, 5, 3, 2, 1,\n                    1, 1, 3, 3, 3, 1, 1,\n                    0, 1, 1, 2, 1, 1, 0,\n                    0, 0, 1, 1, 1, 0, 0\n), nrow=7)\n# Create species list from available SDMs\nspecies_list &lt;- sdm_folder_tif_NAs %&gt;%\n  basename() %&gt;%\n  stringr::str_extract(\"^\\\\S+\\\\.[a-zA-Z]+_\") %&gt;%\n  stringr::str_remove(\"_\") %&gt;%\n  stringr::str_replace(\"\\\\.\", \" \")\n# Create taxon list \ntaxon_list &lt;- sdm_folder_tif_NAs %&gt;%\n  dirname() %&gt;%\n  str_remove(\"_mask\")\n\n# Loop through SDMs\nsdm_inat &lt;- foreach(i = 1:length(sdm_folder_tif_NAs), .combine = \"rbind\") %do% {\n  #### iNaturalist CHECK ####\n  # Progress Message \n  print(paste0(\"Currently working on species \", i, \" out of \", length(species_list),\". This is \", species_list[i], \".\"))\n  # Query iNaturalist by species name and Bowen Island Administrative Boundaries\n  rinat_results_sf &lt;- tryCatch({\n    Sys.sleep(3) # Need to slow down queries to prevent requests being blocked\n    rinat::get_inat_obs_sf(taxon_name = species_list[i],\n                           area = st_as_sf(bowen_island_admin),\n                           maxresults = 10000)\n  }, error = function(cond) {\n    NA\n  })\n  # Get number of iNaturalist observations\n  if(!is.data.frame(rinat_results_sf)) {\n    inat_n_obs &lt;- 0\n  } else {\n    inat_n_obs &lt;- nrow(rinat_results_sf)\n  }\n  \n  #### PREP RASTERS ####\n  sdm_tif &lt;- sdm_folder_tif_NAs[i]\n  sdm_path &lt;- here(sdm_folder, sdm_tif) \n  sdm_output_path &lt;- here(sdm_output_dir, basename(sdm_tif))\n  sdm &lt;- rast(sdm_path)\n  # Normalize SDMs that range from 0 to 1000\n  sdm_minmax &lt;- terra::minmax(sdm)\n  if(sdm_minmax[2] &gt; 1) {\n    sdm &lt;- sdm / 1000\n  }\n  sdm_output &lt;- sdm %&gt;%\n    #### Reproject SDM ####\n    terra::project(y = project_crs) %&gt;%\n    #### Crop SDM ####\n    # Figured out why the SDMs were cropped incorrectly\n    # The default for cropping a raster by a polygon is to snap = \"near\"\n    # This means that the polygon extent is snapped to the closest raster\n    # We need snap = \"out\" to make sure the full extent of the polygon is covered by the output raster\n    terra::crop(bowen_mask, snap = \"out\") %&gt;%\n    #### Extrapolate for Southern Parts of Bowen Island\n    # - fills the NA values missing in south part of Bowen Island\n    terra::focal(w = weights,\n                 fun = \"mean\",\n                 na.policy = \"only\") %&gt;%\n    #### Downsamples ####\n    # - from 400 m to 100 m resolution\n    terra::disagg(fact = 4) %&gt;%\n    #### Smooths the raster ####\n    terra::focal(w = weights,\n                 fun = \"mean\",\n                 na.rm = T,\n                 na.policy = \"omit\") %&gt;%\n    terra::crop(bowen_mask, mask = T)\n  writeRaster(sdm_output, sdm_output_path, overwrite = T)\n  \n  # Get highest value in SDM\n  sdm_max &lt;- sdm_output %&gt;% \n    minmax() %&gt;% \n    max()\n  \n    # PREPARE OUTPUT ROW\n  # 1. scientific species name\n  # 2. highest SDM cell value within area \n  # 3. observation count from iNaturalist\n  # 4. taxon group\n  # 5. filepath where SDM was saved\n  result &lt;- data.frame(species = species_list[i],\n                       sdm_max_value = sdm_max,\n                       inat_n_obs = inat_n_obs,\n                       taxon_group = taxon_list[i],\n                       filepath = sdm_output_path)\n}\n# \n# # Get iNaturalist and SDM congruence\n# sdm_inat &lt;- foreach(i = 1:length(species_list), .combine = \"rbind\") %do% {\n#   # Progress Message \n#   print(paste0(\"Currently working on species \", i, \" out of \", length(species_list),\". This is \", species_list[i], \".\"))\n#   # Query iNaturalist by species name and Bowen Island Administrative Boundaries\n#   rinat_results_sf &lt;- tryCatch({\n#     Sys.sleep(3) # Need to slow down queries to prevent requests being blocked\n#     rinat::get_inat_obs_sf(taxon_name = species_list[i],\n#                            area = st_as_sf(bowen_island_admin),\n#                            maxresults = 10000)\n#   }, error = function(cond) {\n#     NA\n#   })\n#   # Get number of iNaturalist observations\n#   if(!is.data.frame(rinat_results_sf)) {\n#     inat_n_obs &lt;- 0\n#   } else {\n#     inat_n_obs &lt;- nrow(rinat_results_sf)\n#   }\n#   # Get Bowen Island SDM\n#   sdm &lt;- paste0(str_replace(species_list[i], \" \", \".\"), \"_NAs_pu_mask.tif\") %&gt;%\n#     here(sdm_output_dir, .) %&gt;%\n#     rast()\n#   # Get highest value in SDM\n#   sdm_max &lt;- sdm %&gt;% \n#     minmax() %&gt;% \n#     max()\n#   \n#   #### PREPARE OUTPUT ROW ####\n#   # 1. scientific species name\n#   # 2. highest SDM cell value within area \n#   # 3. observation count from iNaturalist\n#   # 4. filepath where SDM was saved\n#   result &lt;- data.frame(species = species_list[i],\n#                        sdm_max_value = sdm_max,\n#                        inat_n_obs = inat_n_obs,\n#                        filepath = sdm_output_path)\n# }\n# sdm_inat$taxon_group &lt;- taxon_list\n#### Query eBird for birds ####\n# Number of eBird observations by bird species on Bowen Island\n# - Results from Natasha Beauregard (Summer 2024 USRA)\nbowen_ebird &lt;- read.csv(here(\"data-raw/bowen_ebird/final_bird.csv\")) %&gt;%\n  select(c(\"scientific_name\", \"n_ebird\"))\n# Combine eBird and iNaturalist counts\nbowen_SDM_iNat_ebird &lt;- merge(sdm_inat, \n                              bowen_ebird, \n                              by.x = \"species\", \n                              by.y = \"scientific_name\",\n                              all.x = TRUE) %&gt;%\n  rename(n_obs_inat = inat_n_obs,\n         n_obs_ebird = n_ebird) %&gt;%\n  select(\n    species,\n    sdm_max_value,\n    taxon_group,\n    n_obs_inat,\n    n_obs_ebird\n  )\n# Query Pottinger Report (2005) for small mammals\nbowen_mammals &lt;- read_xlsx(here(\"data-raw/pottinger_report/Appendix 2 - Expected Occurrence of Wildlife Species In The Cape Roger Curtis Area.xlsx\")) %&gt;%\n  filter(`Documented on Bowen` == \"y\" | `Documented on Bowen` == \"?\" | `Documented on Bowen` == \"One or more spp\" )\n# Include Species if they meet any of the following criteria:\n# - eBird observations &gt; 0\n# - iNaturalist observations &gt; 0\n# - included in Pottinger Report \ninclude_threshold &lt;- 0.5 # Min SDM cell value somewhere on Bowen Island for including species into focal list\nbowen_SDM_obs_focal_df &lt;- bowen_SDM_iNat_ebird %&gt;%\n  mutate(include = case_when(\n    (n_obs_inat &gt; 0 | n_obs_ebird &gt; 0 ) & sdm_max_value &gt; include_threshold ~ \"y\",\n    species %in% bowen_mammals$`Scientific name` ~ \"y\")\n  )\n# Create list of species names to include\nbowen_focal_list &lt;- bowen_SDM_obs_focal_df %&gt;%\n  filter(include == \"y\") %&gt;%\n  select(species) %&gt;%\n  unlist() %&gt;%\n  unname() \n# Get filepath for each SDM\nbowen_SDM_iNat_ebird$filepath &lt;- lapply(bowen_SDM_iNat_ebird$species, function(x) {paste0(str_replace(x, \" \", \".\"), \"_NAs_pu_mask.tif\")})\n# Add columns that can be adjusted manually\nbowen_SDM_iNat_ebird$prov_status &lt;- \"\"\nbowen_SDM_iNat_ebird$fed_status &lt;- \"\"\nbowen_SDM_iNat_ebird$IUCN_status &lt;- \"\"\nbowen_SDM_iNat_ebird$weights &lt;- 1.0\n# Dataframe for focal species on Bowen Island\nbowen_sdm_focal &lt;- bowen_SDM_iNat_ebird %&gt;%\n  filter(species %in% bowen_focal_list)\n#### UPLOAD ####\n# This sheet was uploaded to Google Sheets\n# WARNING: DO NOT RUN OR WILL OVERWRITE MANUAL INPUT TO GOOGLE SHEETS\n# write_sheet(bowen_sdm_focal,\n#             \"https://docs.google.com/spreadsheets/d/1ehO30w4i7EDafilNyRpq3sgc86fm8g_TmYMI4ql3qms/edit?usp=sharing\",\n#             \"species\")\nsaveRDS(bowen_sdm_focal, file = here(\"inst/extdata/sdm/sdm_focal.rds\"))\n\n\n\nCreating Species Information Spreadsheet\nConservation statuses for species at the provincial, federal, and global levels were obtained from the BC Species & Ecosystems Explorer and the IUCN Red List. Provincial statuses followed the Red, Blue, and Yellow List classifications, while federal statuses were based on COSEWIC assessments where applicable. In cases of taxonomic discrepancies, species names were updated to reflect current classifications and documented accordingly.\nSources for Threatened Status Classification of Species: BC Species and Ecosystems Explorer\nIUCN Red List\nThe spreadsheet below contains all of the information on species name, taxon group, threatened status, weights to use for Zonation.\nThe weights are saved to be accessible for the conservation prioritization step. These weights can be modified directly in the spreadsheet.\nVisit the spreadsheet, hosted on Google Drive.\n\n\nCode\nsdm_focal &lt;- readRDS(here(\"inst/extdata/sdm/sdm_focal.rds\"))\n#### REVISION ####\n# - This section necessary, since Google Sheet was uploaded at earlier time\n# - Changes since made to the creation of Bowen SDM Focal\n# - Michael Tylo (USRA Spring 2025) did the work in the Google Sheet\n# Manually look up species and correct taxonomy, add conservation status\nsdm_googlesheet &lt;- read_sheet(\"https://docs.google.com/spreadsheets/d/1ehO30w4i7EDafilNyRpq3sgc86fm8g_TmYMI4ql3qms/edit?usp=sharing\") %&gt;%\n  select(!c(\"full_path\", \"filename\"))\n# Drop duplicate columns, keep columns for n eBird and iNaturalist observations, max SDM values\nbowen_sdm_focal_sel &lt;- sdm_focal %&gt;%\n  select(!c(\"taxon_group\", \"prov_status\", \"fed_status\", \"IUCN_status\", \"weights\"))\n# Merge\nbowen_sdm_status &lt;- merge(bowen_sdm_focal_sel, sdm_googlesheet, by.x = \"species\", by.y = \"sci_name\", all.x = T) %&gt;%\n  rename(weight = weights,\n         name = species) %&gt;%\n  mutate(filename = as.character(filepath),\n         path = here(sdm_output_dir, filename),\n         category = taxon_group,\n         source = \"Viorel Popescu (2020), modified by Jay Matsushiba (2025)\") %&gt;%\n  select(!filepath) %&gt;%\n  relocate(path, filename, name, weight, category, source, notes)\n\n# Save to CSV\nwrite.csv(bowen_sdm_status, here(sdm_output_dir, paste0(Sys.Date(),\"_sdm.csv\")))\n# Save to Google Sheets, will be read in for Zonation\nsdm_url &lt;- \"https://docs.google.com/spreadsheets/d/1IGFwkr9LidcZwbzOJJGSEXLsmpKp0a9gBs65EY-H1xw/edit?usp=sharing\"\nwrite_sheet(\n  bowen_sdm_status,\n  sdm_url,\n  sheet = as.character(Sys.Date())\n)",
    "crumbs": [
      "Species"
    ]
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Bowen Island Biodiversity Plan",
    "section": "",
    "text": "The purpose of this website is to capture and share the analyses for conducting spatial prioritization of conservation areas on Bowen Island. This is part of a greater effort to inform the decision-making and community planning for the Bowen Island Municipality.\nThis work should go hand-in-hand with professional environmental consulting on a site-by-site basis to verify our analyses. This analysis extensively uses existing data products provided by academic, government, NGO, and individual contributors. As a result, this work should be verified by professionals at the on-the-ground level when making site specific decisions.\nThis documentation website summarizes the work conducted by the team from September 2024 to date.\n\n\nThe analyses is organized mainly into the following sections.\n\n\nThis section prepares the species distribution models, previous environmental impact assessments, and local knowledge to create maps of species presence. These layers are prepared as inputs into the conservation prioritization algorithm, in the “Values” section.\n\n\n\nUsing the Terrestrial Ecosystem Mapping (TEM), Sensitive Ecosystem Inventory (SEI), and local knowledge, this section creates maps of habitat richness and extent. Human disturbance layers are also prepared as an input into the conservation prioritization algorithm.\n\n\n\nThis section describes the conservation prioritization analysis that provides an output of conservation values across Bowen Island. This analysis uses the Zonation5 software that provides algorithms for conservation prioritization.\n\n\n\nThis is the section that describes potential threats towards Bowen Island’s biodiversity. These include future development and wildfires. These threats are spatially overlaid with the conservation values to identify potential locations with highest risk and highest values of biodiversity.\n\n\n\nThe section contains the analysis for actions to mitigate the threats towards the conservation values. This primarily consists of identifying locations which would be good new protected areas on public lands.\n\n\n\nAdditional spatial layers that were of interest to community members.\n\n\n\n\n\n\nJay Matsushiba\nMichael Tylo\nWendy Palen\nTom Sisk\n\n\n\nMaya Persam\nKyra Rolfe\nValerie Kwok\n\n\n\n\nAdd workshop participants",
    "crumbs": [
      "Home"
    ]
  },
  {
    "objectID": "index.html#overview",
    "href": "index.html#overview",
    "title": "Bowen Island Biodiversity Plan",
    "section": "",
    "text": "The analyses is organized mainly into the following sections.\n\n\nThis section prepares the species distribution models, previous environmental impact assessments, and local knowledge to create maps of species presence. These layers are prepared as inputs into the conservation prioritization algorithm, in the “Values” section.\n\n\n\nUsing the Terrestrial Ecosystem Mapping (TEM), Sensitive Ecosystem Inventory (SEI), and local knowledge, this section creates maps of habitat richness and extent. Human disturbance layers are also prepared as an input into the conservation prioritization algorithm.\n\n\n\nThis section describes the conservation prioritization analysis that provides an output of conservation values across Bowen Island. This analysis uses the Zonation5 software that provides algorithms for conservation prioritization.\n\n\n\nThis is the section that describes potential threats towards Bowen Island’s biodiversity. These include future development and wildfires. These threats are spatially overlaid with the conservation values to identify potential locations with highest risk and highest values of biodiversity.\n\n\n\nThe section contains the analysis for actions to mitigate the threats towards the conservation values. This primarily consists of identifying locations which would be good new protected areas on public lands.\n\n\n\nAdditional spatial layers that were of interest to community members.",
    "crumbs": [
      "Home"
    ]
  },
  {
    "objectID": "index.html#contributors",
    "href": "index.html#contributors",
    "title": "Bowen Island Biodiversity Plan",
    "section": "",
    "text": "Jay Matsushiba\nMichael Tylo\nWendy Palen\nTom Sisk\n\n\n\nMaya Persam\nKyra Rolfe\nValerie Kwok\n\n\n\n\nAdd workshop participants",
    "crumbs": [
      "Home"
    ]
  },
  {
    "objectID": "vignettes/2025_05_02_output_zonation.html",
    "href": "vignettes/2025_05_02_output_zonation.html",
    "title": "Values",
    "section": "",
    "text": "This Rmarkdown documents the Zonation5 conservation prioritization analysis used for Bowen Island Biodiversity Planning.\nMore information on Zonation5",
    "crumbs": [
      "Values"
    ]
  },
  {
    "objectID": "vignettes/2025_05_02_output_zonation.html#introduction",
    "href": "vignettes/2025_05_02_output_zonation.html#introduction",
    "title": "Values",
    "section": "",
    "text": "This Rmarkdown documents the Zonation5 conservation prioritization analysis used for Bowen Island Biodiversity Planning.\nMore information on Zonation5",
    "crumbs": [
      "Values"
    ]
  },
  {
    "objectID": "vignettes/2025_05_02_output_zonation.html#setup",
    "href": "vignettes/2025_05_02_output_zonation.html#setup",
    "title": "Values",
    "section": "Setup",
    "text": "Setup\n\n\nCode\n#### Palen Lab Packages ####\nlibrary(bowen.biodiversity.webapp)\n\n#### Other Packages ####\nlibrary(here)\nlibrary(dplyr)\nlibrary(stringr)\nlibrary(foreach)\nlibrary(sf)\nlibrary(terra)\nlibrary(tidyterra)\nlibrary(readxl)\nlibrary(googlesheets4)\nlibrary(ggplot2)\nlibrary(ggnewscale)\nlibrary(RColorBrewer)\n\nsdm_url &lt;- \"https://docs.google.com/spreadsheets/d/1IGFwkr9LidcZwbzOJJGSEXLsmpKp0a9gBs65EY-H1xw/edit?usp=sharing\"\nhabitats_url &lt;- \"https://docs.google.com/spreadsheets/d/1yDKw4r3tbXYivwtxbbfxc-pYSbtbj_o2ee1pwlNCOO4/edit?usp=drive_link\"\noutput_date &lt;- \"2025-06-30\"\noutput_dir &lt;- here(\"inst/extdata/output_zonation\", output_date)",
    "crumbs": [
      "Values"
    ]
  },
  {
    "objectID": "vignettes/2025_05_02_output_zonation.html#zonation",
    "href": "vignettes/2025_05_02_output_zonation.html#zonation",
    "title": "Values",
    "section": "Zonation",
    "text": "Zonation\n\nZonation 5 is a spatial prioritization software that can be used to identify priority areas to support conservation planning, land use planning, ecological impact avoidance and other similar tasks. The software uses spatial raster data on the distributions of individual biodiversity features (species, habitats, ecosystem services etc.) to identify which locations in a landscape are most important for retaining biodiversity. Zonation can account for local habitat quality and ecological connectivity together with costs, threats and different land tenure, thus providing a quantitative method for spatial planning that enhances the persistence of biodiversity in the long term.\n\nhttps://zonationteam.github.io/Zonation5/\nWe took all of the rasters prepared earlier and fed these into the Zonation 5 software. This should provide a relative ranking for locations from highest to lowest for the purposes of biodiversity conservation.\nNote: Zonation 5 is usually a standalone application. Here, I have enabled running of Zonation from R, using command line functions. This way we can adjust and automatically run Zonation, reading from data in R.\nCheck input layers hosted at this link: https://github.com/Palen-Lab/bowen.biodiversity.webapp/tree/main/vignettes/figures/output_zonation_02_05_2025\nInformation about input layers to the Zonation run here: Habitats - https://docs.google.com/spreadsheets/d/1yDKw4r3tbXYivwtxbbfxc-pYSbtbj_o2ee1pwlNCOO4/edit?gid=1153014884#gid=1153014884 SDMs - https://docs.google.com/spreadsheets/d/1IGFwkr9LidcZwbzOJJGSEXLsmpKp0a9gBs65EY-H1xw/edit?gid=702573996#gid=702573996\n\n\nCode\n#### CREATE DATAFRAME FOR INPUT LAYERS ####\n# Read from Google Sheets\nhabitats_df &lt;- read_sheet(habitats_url, sheet = output_date)\nhabitats_df$weight &lt;- habitats_df$weight / nrow(habitats_df)\nsdm_df &lt;- read_sheet(sdm_url, sheet = output_date) %&gt;%\n  select(colnames(habitats_df)) # Select common columns\nsdm_df$weight &lt;- sdm_df$weight / nrow(sdm_df)\n# Bind all input layers together\nlayers_df &lt;- bind_rows(habitats_df, sdm_df) %&gt;%\n  filter(weight &gt; 0)\n\n# # Check input layers with figure output\n# foreach(i=1:nrow(layers_df)) %do% {\n#   input_raster &lt;- layers_df[[i, \"path\"]] %&gt;% rast()\n#   bowen_plot &lt;- bowen_map(\n#     raster_layer = input_raster,\n#     title = layers_df[[i, \"name\"]],\n#     subtitle = paste0(\n#       \"Category: \", layers_df[[i, \"category\"]], \" \", \n#       \"Filepath: \", layers_df[[i, \"filename\"]], \" \", \n#       \"Weight: \", layers_df[[i, \"weight\"]], \" \",\n#       \"Notes: \", layers_df[[i, \"notes\"]]\n#     ),\n#     caption = paste0(\"Source: \", layers_df[[i, \"source\"]]),\n#     legend_label = \"value\"\n#   )\n#   figure_output_path &lt;- here(\"vignettes/figures/output_zonation_02_05_2025/\")\n#   if(!dir.exists(figure_output_path)) {\n#     dir.create(figure_output_path)\n#   }\n#   ggplot2::ggsave(\n#     here(figure_output_path, paste0(tools::file_path_sans_ext(layers_df[[i, \"filename\"]]), \".png\")),\n#     bowen_plot,\n#     device = ragg::agg_png,\n#     width = 9, height = 12, units = \"in\", res = 300\n#   )\n# }\n\n\n\n\nCode\n#### UPDATE features.txt FOR ZONATION RUN ####\n# UPDATE features.txt from files available in data\nfeatures_path &lt;- here(\"vignettes/zonation/features.txt\")\ncat('\"weight\" \"filename\"', \n    file = features_path,\n    sep = \"\\n\")\nfor(i in 1:nrow(layers_df)) {\n  next_row &lt;- paste0(layers_df[i, \"weight\"], \" \", layers_df[i, \"path\"])\n  cat(next_row,\n      file = features_path,\n      append = TRUE,\n      sep = \"\\n\")\n}\n#### SET PARAMS FOR ZONATION RUN ####\nzonation5_location &lt;- here(\"vignettes/zonation/zonation5\") \nzonation5_mode &lt;- \"CAZ2\"\n# Zonation5 Setting Text File\nzonation5_settings &lt;-  here(\"vignettes/zonation/settings.z5\")\nzonation5_settings_txt &lt;- c(\"feature list file = features.txt\", \n                            paste0(\"analysis area mask layer = \", here(\"inst/extdata/bowen_mask.tif\"))) # Add Bowen Island Mask\nwriteLines(zonation5_settings_txt, zonation5_settings)\nzonation5_output &lt;- here(\"vignettes/zonation/output\") \nzonation5_command &lt;- str_glue(\n  '{zonation5_location} -a -w --mode={zonation5_mode} {zonation5_settings} {zonation5_output}',\n  zonation5_location = zonation5_location,\n  zonation5_mode = zonation5_mode,\n  zonation5_settings = zonation5_settings,\n  zonation5_output = zonation5_output\n) %&gt;%\n  str_c()\n#### ZONATION RUN ####\nsystem(command = zonation5_command)\n\n#### Save Zonation Run #### \ndir.create(output_dir)\nfile.copy(list.files(here(\"vignettes/zonation/output\"), full.names = T, recursive = T),\n          output_dir,\n          recursive = T)",
    "crumbs": [
      "Values"
    ]
  },
  {
    "objectID": "vignettes/2025_05_02_output_zonation.html#output",
    "href": "vignettes/2025_05_02_output_zonation.html#output",
    "title": "Values",
    "section": "Output",
    "text": "Output\n\n\nCode\n#### VISUALIZE OUTPUT ####\nrankmap &lt;- here(output_dir , \"rankmap.tif\") %&gt;% rast()\nplot(rankmap)",
    "crumbs": [
      "Values"
    ]
  },
  {
    "objectID": "vignettes/2025_05_02_output_zonation.html#overlap-statistics",
    "href": "vignettes/2025_05_02_output_zonation.html#overlap-statistics",
    "title": "Values",
    "section": "Overlap Statistics",
    "text": "Overlap Statistics\nHere we calculate the overlap of the top % of conservation values with these other layers:\n\nProtected areas\nPrivate land\nHuman Footprint (HFP)\nFreshwater habitats\n\nLakes\nPonds\nStreams\nWetlands\nRiparian\n\n\n\n\nCode\n# Function for converting Zonation output to boolean based on percentage (in top XX%)\nrankmap &lt;- here(output_dir , \"rankmap.tif\") %&gt;% rast() %&gt;% project(project_crs)\n\n#' Only keep top or bottom cell values by quantile \n#'\n#' @param x SpatRaster \n#' @param prob Quantile between 0 and 1\n#' @param direction \"top\" or \"bottom\", for direction of keep / discard cell values\n#'\n#' @returns SpatRaster\n#' @export\nremove_by_quantile &lt;- function(x, prob, direction = \"top\") {\n  val &lt;- x %&gt;%\n    values() %&gt;%\n    quantile(probs = prob, na.rm = T)\n  min_val &lt;- x %&gt;%\n    values() %&gt;%\n    min(na.rm = T)\n  max_val &lt;- x %&gt;%\n    values() %&gt;%\n    max(na.rm = T)\n  if(direction == \"top\") {\n    m &lt;- matrix(c(\n      min_val, val, NA,\n      val, max_val, 1\n    ), ncol = 3, byrow = T)\n  } else if (direction == \"bottom\") {\n    m &lt;- matrix(c(\n      min_val, val, 1,\n      val, max_val, NA\n    ), ncol = 3, byrow = T)\n  }\n  mask_quantile &lt;- x %&gt;%\n    classify(m,, include.lowest = T) \n  mask_quantile * x\n}\n\n#' Provide ratio of overlap between two rasters (in terms of NA vs nonNA)\n#'  \nraster_overlap_ratio &lt;- function(top_rast, area_rast) {\n  overlap_res &lt;- (top_rast * area_rast)\n  top_cell_count &lt;- top_rast %&gt;% terra::global(fun=\"notNA\")\n  overlap_cell_count &lt;- overlap_res %&gt;% terra::global(fun=\"notNA\")\n  overlap_ratio &lt;- (overlap_cell_count / top_cell_count) %&gt;% as.numeric()\n  return(overlap_ratio)\n}\n\n# Protected Areas from JD\nbowen_protectedareas_rast &lt;- bowen.biodiversity.webapp::bowen_protectedareas %&gt;%\n  bowen.biodiversity.webapp::bowen_rasterize()\n\n# Private Land\nbowen_mask &lt;- rast(here(\"inst/extdata/bowen_mask.tif\"))\nbowen_parcelmap_rast &lt;- bowen.biodiversity.webapp::bowen_parcelmap %&gt;%\n  st_cast(\"MULTIPOLYGON\") %&gt;% # Need this due to MULTISURFACE - see: https://gis.stackexchange.com/questions/389814/r-st-centroid-geos-error-unknown-wkb-type-12 \n  filter(OwnerType == \"Private\") %&gt;%\n  bowen.biodiversity.webapp::bowen_rasterize()\n\n# Freshwater Habitats \nfw_rast_paths &lt;- c(\n  here(\"inst/extdata/habitats/lakes.tif\"),\n  here(\"inst/extdata/habitats/ponds.tif\"),\n  here(\"inst/extdata/habitats/riparian.tif\"),\n  here(\"inst/extdata/habitats/wetlands.tif\"),\n  here(\"inst/extdata/habitats/streams.tif\")\n)\nfw_rast_stack &lt;- lapply(fw_rast_paths, rast) %&gt;%\n  rast()\nfw_rast_dissolve &lt;- fw_rast_stack %&gt;% \n  sum(na.rm = T) \n\n# Human Footprint (classified)\nbowen_hfp &lt;- here(\"inst/extdata/habitats/bowen_human_footprint_recl.tif\") %&gt;%\n  rast()\nbowen_hfp_low &lt;- bowen_hfp %&gt;%\n  classify(cbind(3, NA)) %&gt;%\n  classify(cbind(2, NA))\nbowen_hfp_med &lt;- bowen_hfp %&gt;%\n  classify(cbind(3, NA)) %&gt;%\n  classify(cbind(1, NA))\nbowen_hfp_high &lt;- bowen_hfp %&gt;%\n  classify(cbind(2, NA)) %&gt;%\n  classify(cbind(1, NA))\n\n# Overlap calculation \noverlap_stats &lt;- function(top_rast) {\n  data.frame(\n    protectedareas_overlap = raster_overlap_ratio(top_rast, bowen_protectedareas_rast),\n    privatelands_overlap = raster_overlap_ratio(top_rast, bowen_parcelmap_rast),\n    freshwater_overlap = raster_overlap_ratio(top_rast, fw_rast_dissolve),\n    hfp_low_overlap = raster_overlap_ratio(top_rast, bowen_hfp_low),\n    hfp_med_overlap = raster_overlap_ratio(top_rast, bowen_hfp_med),\n    hfp_high_overlap = raster_overlap_ratio(top_rast, bowen_hfp_high)\n  )\n}\n\nquants &lt;- seq(from = 0, to = 1, by = 0.1)\noverlap_results &lt;- foreach(quant = quants, .combine = \"rbind\") %do% {\n  rankmap %&gt;%\n    remove_by_quantile(quant) %&gt;%\n    overlap_stats() %&gt;% \n    mutate(\"removed_bottom_quantile\" = quant) %&gt;%\n    relocate(\"removed_bottom_quantile\")\n}\n# Visualize output as table for overlap % \nknitr::kable(overlap_results)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nremoved_bottom_quantile\nprotectedareas_overlap\nprivatelands_overlap\nfreshwater_overlap\nhfp_low_overlap\nhfp_med_overlap\nhfp_high_overlap\n\n\n\n\n0.0\n0.3446264\n0.5810277\n0.4756258\n0.0329381\n0.6519857\n0.3150762\n\n\n0.1\n0.3793392\n0.6041405\n0.4962359\n0.0305312\n0.6382267\n0.3312422\n\n\n0.2\n0.3780287\n0.6184427\n0.5088215\n0.0183486\n0.6334980\n0.3481534\n\n\n0.3\n0.3672043\n0.6387097\n0.5174731\n0.0182796\n0.6196237\n0.3620968\n\n\n0.4\n0.3936637\n0.6483689\n0.5269762\n0.0153701\n0.6286073\n0.3560226\n\n\n0.5\n0.4136244\n0.6605194\n0.5333082\n0.0112909\n0.6398193\n0.3488897\n\n\n0.6\n0.4322672\n0.6806209\n0.5555033\n0.0075259\n0.6387582\n0.3537159\n\n\n0.7\n0.4548306\n0.6894605\n0.5777917\n0.0037641\n0.6317440\n0.3644918\n\n\n0.8\n0.4553151\n0.6782690\n0.6114770\n0.0037629\n0.5879586\n0.4082785\n\n\n0.9\n0.5169173\n0.6409774\n0.6390977\n0.0056391\n0.5469925\n0.4473684\n\n\n1.0\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN",
    "crumbs": [
      "Values"
    ]
  },
  {
    "objectID": "vignettes/2025_05_02_output_zonation.html#overlap-statistics---polygon-on-raster",
    "href": "vignettes/2025_05_02_output_zonation.html#overlap-statistics---polygon-on-raster",
    "title": "Values",
    "section": "Overlap Statistics - Polygon on Raster",
    "text": "Overlap Statistics - Polygon on Raster\nHere we calculate the overlap of the top % of conservation values with these other layers:\n\nProtected areas\n\nFrom John Dowler’s Protected Areas, vs Bowen Island Municipality Protected Areas polygons used for February 1 ver.\nContains main municipal parks, provincial parks, federal parks (both JD and BIM ver.)\nAddition of covenants, park land exchanges, small municipal parks in JD ver.\nSlightly higher than original February 1 ver. (~18% vs ~21%)\nProtected areas polygons / Bowen Island full polygon (inc. Hutt Island) = 0.2149664\nProtected area extent proportion of Bowen Island using raster method = 0.2189496\n\nPrivate land\n\n“Private” - Defined as “Private” in BC ParcelMap polygons\n“Other” - Defined as anything other than “Private” in BC ParcelMap polygons\n\nUsed to see how much of BC ParcelMap polygons are not Private lands\n\nDoes not add up to 100%, since there are large areas that are not included in BC ParcelMap\nPrivate lands polygons / Bowen Island full polygon (inc. Hutt Island) = 0.4398566\nPrivate lands extent proportion of Bowen Island using raster method = 0.4398923\n\nHuman Footprint (HFP)\n\nProportion of each HFP category (low, medium, high) in the top XX% of biodiversity values\nShould add up to 100%\n\nFreshwater habitats\n\nLakes\nPonds\nStreams\nWetlands\nRiparian\n\n\n\n\nCode\n# Function for converting Zonation output to boolean based on percentage (in top XX%)\nrankmap &lt;- here(output_dir , \"rankmap.tif\") %&gt;% rast() %&gt;% project(project_crs)\n\n#' Only keep top or bottom cell values by quantile \n#'\n#' @param x SpatRaster \n#' @param prob Quantile between 0 and 1\n#' @param direction \"top\" or \"bottom\", for direction of keep / discard cell values\n#'\n#' @returns SpatRaster\n#' @export\nremove_by_quantile &lt;- function(x, prob, direction = \"top\") {\n  val &lt;- x %&gt;%\n    values() %&gt;%\n    quantile(probs = prob, na.rm = T)\n  min_val &lt;- x %&gt;%\n    values() %&gt;%\n    min(na.rm = T)\n  max_val &lt;- x %&gt;%\n    values() %&gt;%\n    max(na.rm = T)\n  if(direction == \"top\") {\n    m &lt;- matrix(c(\n      min_val, val, NA,\n      val, max_val, 1\n    ), ncol = 3, byrow = T)\n  } else if (direction == \"bottom\") {\n    m &lt;- matrix(c(\n      min_val, val, 1,\n      val, max_val, NA\n    ), ncol = 3, byrow = T)\n  }\n  mask_quantile &lt;- x %&gt;%\n    classify(m,, include.lowest = T) \n  mask_quantile * x\n}\n\n#' Rasterize to Bowen Island Mask\nbowen_rasterize_cover &lt;- function(sf) {\n  bowen_island_mask &lt;- here(\"inst/extdata/bowen_mask.tif\") %&gt;%\n    rast() %&gt;%\n    project(bowen.biodiversity.webapp::project_crs)\n\n  output &lt;- sf %&gt;%\n    terra::vect() %&gt;% # Change to SpatVector for rasterization\n    terra::project(bowen.biodiversity.webapp::project_crs) %&gt;% # Reproject to the mask CRS\n    terra::rasterize(bowen_island_mask,\n                     cover = T, # Return proportion of cell covered by polygon \n                     background = NA) # Rasterize to match mask, set background values to NA\n}\n\n#' Provide ratio of overlap between two rasters (in terms of NA vs nonNA)\nraster_overlap_ratio &lt;- function(top_rast, area_rast) {\n  overlap_res &lt;- (top_rast * area_rast)\n  top_cell_count &lt;- top_rast %&gt;% \n    global(\"sum\", na.rm = T)\n  overlap_cell_values &lt;- overlap_res %&gt;% \n    values(na.rm = T) \n  overlap_cell_area &lt;-overlap_cell_values %&gt;% sum()\n  overlap_ratio &lt;- (overlap_cell_area / top_cell_count) %&gt;% as.numeric()\n  return(overlap_ratio)\n}\n\n# Bowen entire area\nbowen_island &lt;- st_read(here(\"data-raw/bowen_island_shoreline_w_hutt.gpkg\"), layer = \"bowen_island_shoreline_w_hutt__bowen_islands\")\n\n\nReading layer `bowen_island_shoreline_w_hutt__bowen_islands' from data source \n  `/home/jay/Programming_Projects/bowen.biodiversity.webapp/data-raw/bowen_island_shoreline_w_hutt.gpkg' \n  using driver `GPKG'\nSimple feature collection with 11 features and 1 field\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: 4001956 ymin: 2020764 xmax: 4013988 ymax: 2028901\nProjected CRS: NAD83 / Statistics Canada Lambert\n\n\nCode\n# Protected Areas from JD\nbowen_protectedareas_include &lt;- bowen.biodiversity.webapp::bowen_protectedareas %&gt;%\n  filter(type != \"Agricultural Land Reserve\") # Remove ALR\n# Protected Areas from Bowen Island Municipality \nbowen_protectedareas_2 &lt;- st_read(here(\"data-raw/archive/bowen_island_protectedareas/BM_PROTECTED_AREAS.shp\")) %&gt;%\n  filter(NAME != \"Old Growth Management Area\") \n\n\nReading layer `BM_PROTECTED_AREAS' from data source \n  `/home/jay/Programming_Projects/bowen.biodiversity.webapp/data-raw/archive/bowen_island_protectedareas/BM_PROTECTED_AREAS.shp' \n  using driver `ESRI Shapefile'\nSimple feature collection with 61 features and 2 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 468632.2 ymin: 5464739 xmax: 476690.7 ymax: 5472342\nProjected CRS: NAD83 / UTM zone 10N\n\n\nCode\n# JD protected areas is more complete, with smaller municipal parks, covenants, and park land exchanges\n\nbowen_protectedareas_rast &lt;- bowen_protectedareas_include %&gt;%\n  bowen_rasterize_cover()\n\n# Check with polygon / polygon area calculations for full Bowen Island\nsum(st_area(bowen_protectedareas_include)) / sum(st_area(bowen_island)) # 0.2149664\n\n\n0.2149664 [1]\n\n\nCode\nsum(st_area(bowen_protectedareas_2)) / sum(st_area(bowen_island)) # 0.17935\n\n\n0.17935 [1]\n\n\nCode\n# Private Land\nbowen_mask &lt;- rast(here(\"inst/extdata/bowen_mask.tif\"))\nbowen_parcelmap_priv &lt;- bowen.biodiversity.webapp::bowen_parcelmap %&gt;%\n  st_cast(\"MULTIPOLYGON\") %&gt;% # Need this due to MULTISURFACE - see: https://gis.stackexchange.com/questions/389814/r-st-centroid-geos-error-unknown-wkb-type-12 \n  filter(OwnerType == \"Private\")\nbowen_parcelmap_rast &lt;- bowen_parcelmap_priv %&gt;%\n  bowen_rasterize_cover()\n\n# Check with polygon / polygon area calculations for full Bowen Island \nsum(st_area(bowen_parcelmap_priv)) / sum(st_area(bowen_island)) # 0.4398566\n\n\n0.4398566 [1]\n\n\nCode\n# Other Land\nbowen_mask &lt;- rast(here(\"inst/extdata/bowen_mask.tif\"))\nbowen_parcelmap_other_rast &lt;- bowen.biodiversity.webapp::bowen_parcelmap %&gt;%\n  st_cast(\"MULTIPOLYGON\") %&gt;%# Need this due to MULTISURFACE - see: https://gis.stackexchange.com/questions/389814/r-st-centroid-geos-error-unknown-wkb-type-12 \n  filter(OwnerType != \"Private\") %&gt;%\n  bowen_rasterize_cover()\n\n# Freshwater Habitats \nfw_rast_paths &lt;- c(\n  here(\"inst/extdata/habitats/lakes.tif\"),\n  here(\"inst/extdata/habitats/ponds.tif\"),\n  here(\"inst/extdata/habitats/riparian.tif\"),\n  here(\"inst/extdata/habitats/wetlands.tif\"),\n  here(\"inst/extdata/habitats/streams.tif\")\n)\nfw_rast_stack &lt;- lapply(fw_rast_paths, rast) %&gt;%\n  rast()\nfw_rast_dissolve &lt;- fw_rast_stack %&gt;% \n  sum(na.rm = T) %&gt;%\n  not.na() %&gt;%\n  classify(cbind(FALSE, NA)) \n\n# Human Footprint (classified)\nbowen_hfp &lt;- here(\"inst/extdata/habitats/bowen_human_footprint_recl.tif\") %&gt;%\n  rast()\nbowen_hfp_low &lt;- bowen_hfp %&gt;%\n  classify(cbind(3, NA)) %&gt;%\n  classify(cbind(2, NA)) %&gt;%\n  not.na() %&gt;%\n  classify(cbind(FALSE, NA)) \nbowen_hfp_med &lt;- bowen_hfp %&gt;%\n  classify(cbind(3, NA)) %&gt;%\n  classify(cbind(1, NA)) %&gt;%\n  not.na() %&gt;%\n  classify(cbind(FALSE, NA)) \nbowen_hfp_high &lt;- bowen_hfp %&gt;%\n  classify(cbind(2, NA)) %&gt;%\n  classify(cbind(1, NA)) %&gt;%\n  not.na() %&gt;%\n  classify(cbind(FALSE, NA)) \n\n# Overlap calculation \noverlap_stats &lt;- function(top_rast) {\n  data.frame(\n    protectedareas_overlap = raster_overlap_ratio(top_rast, bowen_protectedareas_rast),\n    privatelands_overlap = raster_overlap_ratio(top_rast, bowen_parcelmap_rast),\n    otherlands_overlap = raster_overlap_ratio(top_rast, bowen_parcelmap_other_rast),\n    freshwater_overlap = raster_overlap_ratio(top_rast, fw_rast_dissolve),\n    hfp_low_overlap = raster_overlap_ratio(top_rast, bowen_hfp_low),\n    hfp_med_overlap = raster_overlap_ratio(top_rast, bowen_hfp_med),\n    hfp_high_overlap = raster_overlap_ratio(top_rast, bowen_hfp_high)\n  )\n}\n\nquants &lt;- seq(from = 0.9, to = 0, by = -0.1)\noverlap_results &lt;- foreach(quant = quants, .combine = \"rbind\") %do% {\n  rankmap %&gt;%\n    remove_by_quantile(quant) %&gt;%\n    overlap_stats() %&gt;% \n    mutate(\"top_bioval_prop\" = 1-quant) %&gt;%\n    relocate(\"top_bioval_prop\") \n}\n# Visualize output as table for overlap % \nknitr::kable(overlap_results)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ntop_bioval_prop\nprotectedareas_overlap\nprivatelands_overlap\notherlands_overlap\nfreshwater_overlap\nhfp_low_overlap\nhfp_med_overlap\nhfp_high_overlap\n\n\n\n\n0.1\n0.3174649\n0.3945937\n0.2928323\n0.6387667\n0.0055659\n0.5481426\n0.4462914\n\n\n0.2\n0.2647937\n0.4394002\n0.2660174\n0.6126650\n0.0038225\n0.5859312\n0.4102463\n\n\n0.3\n0.2626128\n0.4703340\n0.2489584\n0.5831383\n0.0037686\n0.6252945\n0.3709370\n\n\n0.4\n0.2485606\n0.4735271\n0.2376814\n0.5641232\n0.0067621\n0.6326465\n0.3605914\n\n\n0.5\n0.2409733\n0.4664929\n0.2377358\n0.5465734\n0.0095868\n0.6342642\n0.3561491\n\n\n0.6\n0.2304698\n0.4625577\n0.2359358\n0.5410867\n0.0124238\n0.6278010\n0.3597752\n\n\n0.7\n0.2200468\n0.4605420\n0.2301998\n0.5348029\n0.0142620\n0.6228655\n0.3628725\n\n\n0.8\n0.2235007\n0.4550586\n0.2259611\n0.5307384\n0.0145557\n0.6280725\n0.3573717\n\n\n0.9\n0.2253763\n0.4524188\n0.2228878\n0.5272985\n0.0176638\n0.6297194\n0.3526168\n\n\n1.0\n0.2234341\n0.4512389\n0.2218854\n0.5247490\n0.0179839\n0.6310762\n0.3509399",
    "crumbs": [
      "Values"
    ]
  },
  {
    "objectID": "vignettes/input_habitats.html",
    "href": "vignettes/input_habitats.html",
    "title": "Habitats",
    "section": "",
    "text": "This page describes the preparing of habitat layers for input into the Zonation5 conservation prioritization software.",
    "crumbs": [
      "Habitats"
    ]
  },
  {
    "objectID": "vignettes/input_habitats.html#introduction",
    "href": "vignettes/input_habitats.html#introduction",
    "title": "Habitats",
    "section": "",
    "text": "This page describes the preparing of habitat layers for input into the Zonation5 conservation prioritization software.",
    "crumbs": [
      "Habitats"
    ]
  },
  {
    "objectID": "vignettes/input_habitats.html#setup",
    "href": "vignettes/input_habitats.html#setup",
    "title": "Habitats",
    "section": "Setup",
    "text": "Setup\n\n\nCode\nlibrary(bowen.biodiversity.webapp)\nlibrary(here)\nlibrary(sf)\nlibrary(tidyverse)\nlibrary(terra)\nlibrary(leaflet)\nlibrary(googlesheets4)\n\n# Load Bowen Island Mask Created Previously\nbowen_island_mask &lt;- here(\"inst/extdata/bowen_mask.tif\") %&gt;%\n  rast() %&gt;%\n  project(project_crs)\n\n# Rasterize to Bowen Island Mask \nbowen_rasterize &lt;- function(sf) {\n  output &lt;- sf %&gt;% \n    terra::vect() %&gt;% # Change to SpatVector for rasterization\n    terra::project(project_crs) %&gt;% # Reproject to the mask CRS\n    terra::rasterize(bowen_island_mask,\n                     touches = T,\n                     background = NA) # Rasterize to match mask, set background values to NA\n}\n\n# Path for this vignette's outputs\noutput_path &lt;- here(\"inst/extdata/habitats\")\n\n# Habitats table \nhabitats_df &lt;- data.frame(\n  path = as.character(),\n  filename = as.character(),\n  name = as.character(),\n  weight = as.numeric(),\n  category = as.character(),\n  source = as.character(),\n  notes = as.character()\n)",
    "crumbs": [
      "Habitats"
    ]
  },
  {
    "objectID": "vignettes/input_habitats.html#metro-vancouver-sensitive-ecosystem-inventory",
    "href": "vignettes/input_habitats.html#metro-vancouver-sensitive-ecosystem-inventory",
    "title": "Habitats",
    "section": "Metro Vancouver Sensitive Ecosystem Inventory",
    "text": "Metro Vancouver Sensitive Ecosystem Inventory\nPreviously, for the Feb 1 2025 workshop, we used the Sensitive Ecosystem Inventory from Metro Vancouver. These habitat types were originally represented as polygon areas, which was converted to raster.\n\n\nCode\n#### Metro Vancouver Sensitive Ecosystems Inventory ####\n# Contents of \"data-raw/metrovancouver_sensitive_ecosystem_inventory/\" downloaded from MetroVancouver Open Data Catalogue\n# GeoPackage download: https://arcg.is/TnfXL \n# Reports download: https://metrovancouver.org/services/regional-planning/sensitive-ecosystem-inventory-mapping-app\nmvsei &lt;- st_read(here(\"data-raw/metrovancouver_sensitive_ecosystem_inventory/Sensitive_Ecosystem_Inventory_for_Metro_Vancouver__2020__-5580727563910851507.gpkg\")) %&gt;%\n  st_transform(crs = bowen.biodiversity.webapp::project_crs)\n\n\nReading layer `Sensitive_Ecosystem_Inventory_for_Metro_Vancouver__2020_' from data source `/home/jay/Programming_Projects/bowen.biodiversity.webapp/data-raw/metrovancouver_sensitive_ecosystem_inventory/Sensitive_Ecosystem_Inventory_for_Metro_Vancouver__2020__-5580727563910851507.gpkg' \n  using driver `GPKG'\nSimple feature collection with 25637 features and 99 fields\nGeometry type: MULTIPOLYGON\nDimension:     XYZ\nBounding box:  xmin: 468516.6 ymin: 5427679 xmax: 547072.5 ymax: 5495732\nz_range:       zmin: 0 zmax: 0\nProjected CRS: NAD83 / UTM zone 10N\n\n\nCode\nmvsei_secl_codes &lt;- read.csv(here(\"data-raw/metrovancouver_sensitive_ecosystem_inventory/SEI_SECl_codes.csv\"))\nmvsei_sesubcl_codes &lt;- read.csv(here(\"data-raw/metrovancouver_sensitive_ecosystem_inventory/SEI_SEsubcl_codes.csv\"))\n\n# Bowen Island SEI \nbowen_sei &lt;- mvsei %&gt;% \n  st_intersection(st_as_sf(bowen.biodiversity.webapp::bowen_boundary)) \n\n\nWarning: attribute variables are assumed to be spatially constant throughout\nall geometries",
    "crumbs": [
      "Habitats"
    ]
  },
  {
    "objectID": "vignettes/input_habitats.html#wetlands",
    "href": "vignettes/input_habitats.html#wetlands",
    "title": "Habitats",
    "section": "Wetlands",
    "text": "Wetlands\nThere were some areas identified as potentially incorrect during the Feb 1 2025 workshop. We followed up with Alan Whitehead and John Dowler via email for additional details. See issue here: Link\nAlan Whitehead provided ponds and wetlands shapefiles, that he had created over the years as an environmental consultant on Bowen Island.\nIn the first Zonation run, we combined WN for both SECl_1 and SECl_2. This overestimated wetland extent, since this included areas that were more likely to have another habitat quality based off of MV methodology (which was mostly based on aerial surveys). We also pulled out the “Shallow Water” subcategory into its seperate layer.\nFor this next Zonation run, we will use the wetlands layer provided by Alan Whitehead. This layer seemed to be more complete with ground-truthing of the location of these wetlands, in comparison to the SEI layers from MetroVancouver that were verified using aerial imagery. “Shallow Water” is no longer a separate habitat type, since Alan Whitehead’s layers do not provide this classification.\n\n\nCode\n# Alan Whitehead's Wetland Layer\nwetlands_aw &lt;- bowen.biodiversity.webapp::bowen_wetlands_whitehead_consultants\n# Bowen SEI SECl_1 \nbowen_sei_wn_1 &lt;- bowen_sei %&gt;%\n  filter(SECl_1 == \"WN\")\n# Bowen SEI SECl_2\nbowen_sei_wn_2 &lt;- bowen_sei %&gt;%\n  filter(SECl_2 == \"WN\")\n\nwetlands_aw_rast &lt;- bowen_rasterize(wetlands_aw)\nbowen_sei_wn_1_rast &lt;- bowen_rasterize(bowen_sei_wn_1)\nbowen_sei_wn_2_rast &lt;- bowen_rasterize(bowen_sei_wn_2)\n\n# Compare wetlands \nleaflet(width = \"100%\", height = \"800px\") %&gt;%\n  addProviderTiles(provider = providers$Stadia.AlidadeSmooth) %&gt;%\n  addRasterImage(x = wetlands_aw_rast, group = \"A. Whitehead Wetlands\", colors = \"green\") %&gt;%\n  addPolygons(data = st_transform(wetlands_aw, 4326), group = \"A. Whitehead Wetlands\", color = \"darkgreen\") %&gt;%\n  addRasterImage(x = bowen_sei_wn_1_rast, group = \"Bowen SEI SECl_1 Wetlands\", colors = \"blue\") %&gt;%\n  addPolygons(data = st_transform(bowen_sei_wn_1, 4326), group = \"Bowen SEI SECl_1 Wetlands\", color = \"darkblue\") %&gt;%\n  addRasterImage(x = bowen_sei_wn_2_rast, group = \"Bowen SEI SECl_2 Wetlands\", colors = \"orange\") %&gt;%\n  addPolygons(data = st_transform(bowen_sei_wn_2, 4326), group = \"Bowen SEI SECl_2 Wetlands\", color = \"darkorange\") %&gt;%\n  addLayersControl(overlayGroups = c(\"A. Whitehead Wetlands\", \n                                     \"Bowen SEI SECl_1 Wetlands\", \n                                     \"Bowen SEI SECl_2 Wetlands\"\n  ),\n  options = layersControlOptions(collapsed = F)) \n\n\n\n\n\n\nCode\n# Output \nwriteRaster(wetlands_aw_rast, here(output_path, \"wetlands.tif\"), overwrite = T)\nhabitats_df &lt;- data.frame(\n  path = here(output_path, \"wetlands.tif\"),\n  filename = \"wetlands.tif\",\n  name = \"Wetlands\",\n  weight = 1.0,\n  category = \"Freshwater\",\n  source = \"Alan Whitehead\",\n  notes = \"replaces MVSEI\"\n) %&gt;%\n  bind_rows(habitats_df)",
    "crumbs": [
      "Habitats"
    ]
  },
  {
    "objectID": "vignettes/input_habitats.html#freshwater",
    "href": "vignettes/input_habitats.html#freshwater",
    "title": "Habitats",
    "section": "Freshwater",
    "text": "Freshwater\nThe initial Feb1 Zonation run used the SEI categories to represent freshwater ecosystems. Each subcategory of freshwater was used as a distinct layer in the Zonation run. We have since acquired some new layers, which we can simply convert to raster and include as a conservation value input to start.\nAlan Whitehead’s Ponds layer seems much more complete than what is available in SEI, so we will use that instead to create the habitat layer.\n\n\nCode\n#### Ponds ####\n# Create Ponds Layer from Alan Whitehead's Map and SEI Freshwaster Ponds\nponds_aw &lt;- bowen.biodiversity.webapp::bowen_ponds_whitehead_consultants\nponds_aw\n\n\nSimple feature collection with 122 features and 7 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 469230.7 ymin: 5464929 xmax: 476786.3 ymax: 5473554\nProjected CRS: NAD83 / UTM zone 10N\nFirst 10 features:\n   ID    Area                  NAME\n1  66  196.48       Everhard's Pond\n2  67  701.58        Trethewey Pond\n3  42  793.69           Ballou Pond\n4  78   84.99              un named\n5  79  416.44                island\n6  80  183.33              un named\n7  72 2701.43 Little Josephine Lake\n8  36 3962.48          Macleod Pond\n9  37 1761.08     Upper Quarry Pond\n10 69  816.51           Carter Pond\n                                            COMMENT                 OCP_CLASS\n1                          constructed private pond          non-fish bearing\n2                          constructed private pond          non-fish bearing\n3                          constructed private pond          non-fish bearing\n4                          constructed private pond          non-fish bearing\n5     island in constructed pond FID43; fix polygon                      &lt;NA&gt;\n6                          constructed private pond          non-fish bearing\n7  constructed private pond, hist. w/ stocked trout tributary to fish-fearing\n8                   constructed pond, former quarry tributary to fish-bearing\n9                   constructed pond, former quarry tributary to fish-bearing\n10     in Terminal Creek, water source for hatchery              fish-bearing\n   Source Perimeter                           geom\n1    &lt;NA&gt;        52 MULTIPOLYGON (((474905.9 54...\n2    &lt;NA&gt;        97 MULTIPOLYGON (((475005 5470...\n3    &lt;NA&gt;       146 MULTIPOLYGON (((474696.6 54...\n4    &lt;NA&gt;        57 MULTIPOLYGON (((470954.3 54...\n5      AW        76 MULTIPOLYGON (((471305.8 54...\n6    &lt;NA&gt;        52 MULTIPOLYGON (((471427.8 54...\n7    &lt;NA&gt;       477 MULTIPOLYGON (((472313.9 54...\n8    &lt;NA&gt;       355 MULTIPOLYGON (((471303.8 54...\n9    &lt;NA&gt;       163 MULTIPOLYGON (((471181.1 54...\n10   &lt;NA&gt;        72 MULTIPOLYGON (((474527 5469...\n\n\nCode\n# Source for ponds is Islands Trust TEM\nbowen_sei_fw_pd &lt;- bowen_sei %&gt;%\n  filter(SEsubcl_1 == \"pd\" | SEsubcl_2 == \"pd\") %&gt;%\n  st_transform(st_crs(ponds_aw))\n# Ponds Rasters \nponds_aw_rast &lt;- bowen_rasterize(ponds_aw)\nbowen_sei_fw_pd_rast &lt;- bowen_rasterize(bowen_sei_fw_pd)\n# Compare ponds \nleaflet(width = \"100%\", height = \"800px\") %&gt;%\n  addProviderTiles(provider = providers$Stadia.AlidadeSmooth) %&gt;%\n  addRasterImage(x = ponds_aw_rast, group = \"A. Whitehead Ponds\", colors = \"green\") %&gt;%\n  addPolygons(data = st_transform(ponds_aw, 4326), group = \"A. Whitehead Ponds\", color = \"darkgreen\") %&gt;%\n  addRasterImage(x = bowen_sei_fw_pd_rast, group = \"Bowen SEI Ponds\", colors = \"blue\") %&gt;%\n  addPolygons(data = st_transform(bowen_sei_fw_pd, 4326), group = \"Bowen SEI Ponds\", color = \"darkblue\") %&gt;%\n  addLayersControl(overlayGroups = c(\"A. Whitehead Ponds\", \n                                     \"Bowen SEI Ponds\"\n  ),\n  options = layersControlOptions(collapsed = F)) \n\n\n\n\n\n\nCode\n# Save AW ponds\nwriteRaster(ponds_aw_rast, here(output_path, \"ponds.tif\"), overwrite = T)\nhabitats_df &lt;- data.frame(\n  path = here(output_path, \"ponds.tif\"),\n  filename = \"ponds.tif\",\n  name = \"Ponds\",\n  weight = 1.0,\n  category = \"Freshwater\",\n  source = \"Alan Whitehead\",\n  notes = \"replaces MVSEI\"\n) %&gt;%\n  bind_rows(habitats_df)\n#### Lakes ####\nbowen_sei_fw_la_rast &lt;- bowen_sei %&gt;%\n  filter(SEsubcl_1 == \"la\" | SEsubcl_2 == \"la\") %&gt;%\n  bowen_rasterize()\nwriteRaster(bowen_sei_fw_la_rast, here(output_path, \"lakes.tif\"), overwrite = T)\nhabitats_df &lt;- data.frame(\n  path = here(output_path, \"lakes.tif\"),\n  filename = \"lakes.tif\",\n  name = \"Lakes\",\n  weight = 1.0,\n  category = \"Freshwater\",\n  source = \"MVSEI\",\n  notes = \"\"\n) %&gt;%\n  bind_rows(habitats_df)\n\n#### Fish Bearing Streams ####\n# Create separate raster for each OCP class\nstreams_fishbearing_rast &lt;- bowen.biodiversity.webapp::bowen_fish_whitehead_consultants %&gt;%\n  filter(OCP_CLASS == \"fish-bearing\") %&gt;%\n  bowen_rasterize() %&gt;%\n  classify(matrix(c(1, 3), ncol = 2, byrow = T)) # Assign value 3 \nstreams_tributary_rast &lt;- bowen.biodiversity.webapp::bowen_fish_whitehead_consultants %&gt;%\n  filter(OCP_CLASS == \"tributary to fish-bearing\") %&gt;%\n  bowen_rasterize() %&gt;%\n  classify(matrix(c(1, 2), ncol = 2, byrow = T)) # Assign value 2\nstreams_nonfishbearing_rast &lt;- bowen.biodiversity.webapp::bowen_fish_whitehead_consultants %&gt;%\n  filter(OCP_CLASS == \"non-fish bearing\") %&gt;%\n  bowen_rasterize() %&gt;%\n  classify(matrix(c(1, 1), ncol = 2, byrow = T)) # Assign value 1\nstreams_drainage_rast &lt;- bowen.biodiversity.webapp::bowen_fish_whitehead_consultants %&gt;%\n  filter(OCP_CLASS == \"drainage channel\") %&gt;% \n  bowen_rasterize() %&gt;% \n  classify(matrix(c(1, 1), ncol = 2, byrow = T)) # Assign value 1\nstreams_NA_rast &lt;- bowen.biodiversity.webapp::bowen_fish_whitehead_consultants %&gt;%\n  filter(is.na(OCP_CLASS)) %&gt;%\n  bowen_rasterize() %&gt;%\n  classify(matrix(c(1, 1), ncol = 2, byrow = T)) # Assign value 1\n# Combine stream rasters together, cover in order of importance\nstreams_rast &lt;- streams_NA_rast %&gt;%\n  cover(streams_drainage_rast) %&gt;%\n  cover(streams_nonfishbearing_rast) %&gt;%\n  cover(streams_tributary_rast) %&gt;%\n  cover(streams_fishbearing_rast)\nwriteRaster(streams_rast, here(output_path, \"streams.tif\"), overwrite = T)\nhabitats_df &lt;- data.frame(\n  path = here(output_path, \"streams.tif\"),\n  filename = \"streams.tif\",\n  name = \"Streams\",\n  weight = 1.0,\n  category = \"Freshwater\",\n  source = \"Alan Whitehead\",\n  notes = \"Raster value 3 for fish-bearing streams, 2 for non-fish bearing, 1 for drainage channel and NA\"\n) %&gt;%\n  bind_rows(habitats_df)\n\n#### Riparian #### \n# Combine ff (fringe) and gu (gully) riparian classes into one habitat layer\nbowen_sei_ri_rast &lt;- bowen_sei %&gt;%\n  filter(SECl_1 == \"RI\" | SECl_2 == \"RI\") %&gt;%\n  bowen_rasterize()\nwriteRaster(bowen_sei_ri_rast, here(output_path, \"riparian.tif\"), overwrite = T)\nhabitats_df &lt;- data.frame(\n  path = here(output_path, \"riparian.tif\"),\n  filename = \"riparian.tif\",\n  name = \"Riparian\",\n  weight = 1.0,\n  category = \"Freshwater\",\n  source = \"MVSEI\",\n  notes = \"\"\n) %&gt;%\n  bind_rows(habitats_df)",
    "crumbs": [
      "Habitats"
    ]
  },
  {
    "objectID": "vignettes/input_habitats.html#terrestrial-ecosystem-mapping",
    "href": "vignettes/input_habitats.html#terrestrial-ecosystem-mapping",
    "title": "Habitats",
    "section": "Terrestrial Ecosystem Mapping",
    "text": "Terrestrial Ecosystem Mapping\nWe originally used the Metro Vancouver SEI for the Feb 1 Zonation run, but many of the habitat types are not very specific. Ex. “Mature Forest” is a habitat category that covers much of Bowen Island, but does not provide detail of what species exist there.\nWe got the TEM (Terrestrial Ecosystem Mapping) layers from Jeff Matheson via email on April 6 2025.\nFrom my own digging through the MVSEI layers and comparing to the TEM, I think that the original 2009 version of the TEMs are included in the current MVSEI. Since then TEM has been updated (2011 and 2017), mostly with larger polygons being split into smaller and more specific areas, but these have not been incorporated into MVSEI. The most recent additions to MVSEI from the TEM are in 2016, before the most recent updates.\n\n\nCode\n#### Bowen TEM for detailed terrestrial habitat identity ####\nbowen_TEM &lt;- st_read(here(\"data-raw/bowen_TEM/BM_TEM.shp\")) %&gt;%\n  # Remove habitat types that are already represented or not important ecosystems\n  filter(!SITE_S1_LA %in% c(\n    # Freshwater  \n    \"Reservoir\",\n    \"Shallow Open Water\",\n    \"Lake\",\n    # Developed \n    \"Gravel Pit\",\n    \"Cultivated Field\",\n    \"Golf Course\",\n    \"Rural\",\n    \"Industrial\",\n    \"Urban/Suburban\",\n    # Wetlands - already represented in A.Whitehead's layers\n    \"Wetland swamp\",\n    \"Wetland fenn\"\n    )\n  )\n\n\nReading layer `BM_TEM' from data source \n  `/home/jay/Programming_Projects/bowen.biodiversity.webapp/data-raw/bowen_TEM/BM_TEM.shp' \n  using driver `ESRI Shapefile'\nSimple feature collection with 615 features and 43 fields\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: 468516.6 ymin: 5464606 xmax: 477662.2 ymax: 5474194\nProjected CRS: NAD83 / UTM zone 10N\n\n\nCode\n# Create rasters and save\nbowen_TEM_categories &lt;- unique(bowen_TEM$SITE_S1_LA)\nfor(tem_code in bowen_TEM_categories) {\n  output &lt;- bowen_TEM[bowen_TEM$SITE_S1_LA == tem_code,] %&gt;%\n    bowen_rasterize()\n  output_filename &lt;- tem_code %&gt;% \n    gsub(\"-\", \"_\", .) %&gt;%\n    gsub(\" \", \"\", .) %&gt;%\n    gsub(\"'\", \"\", .) %&gt;%\n    paste0(\".tif\")\n  writeRaster(output, here(output_path, output_filename), overwrite = T)\n  habitats_df &lt;- data.frame(\n    path = here(output_path, output_filename),\n    filename = output_filename,\n    name = tem_code,\n    weight = 1.0,\n    category = \"Terrestrial\",\n    source = \"TEM\",\n    notes = \"Detailed types, plant community descriptions\"\n  ) %&gt;%\n    bind_rows(habitats_df)\n}\n\n#### Metro Vancouver SEI for Young Forest, Mature Forest, Old Forest designation ####\n# OF - Old Forest\n# MF - Mature Forest\n# YF - Young Forest\n# YS - Young Forest (Small)\nbowen_SEI_forests &lt;- bowen_sei %&gt;%\n  select(SECl_1) %&gt;%\n  filter(SECl_1 %in% c(\"OF\", \"MF\", \"YF\", \"YS\")) %&gt;%\n  st_transform(st_crs(bowen_TEM))\nbowen_TEM_forests &lt;- bowen_sei %&gt;%\n  select(SECl_1) %&gt;%\n  filter(SECl_1 %in% c(\"OF\", \"MF\", \"YF\", \"YS\")) %&gt;%\n  st_transform(st_crs(bowen_TEM)) %&gt;%\n  st_join(bowen_TEM, ., largest = T) # Spatial join by largest, so each TEM polygon has forest category\n\n\nWarning: attribute variables are assumed to be spatially constant throughout\nall geometries\n\n\nCode\n# Compare forest maps to check\nggplot(bowen_TEM_forests) + geom_sf(aes(fill = SECl_1))\n\n\n\n\n\n\n\n\n\nCode\nggplot(bowen_SEI_forests) + geom_sf(aes(fill = SECl_1))\n\n\n\n\n\n\n\n\n\nCode\n# Create rasters and save\nbowen_forest_categories &lt;- unique(bowen_TEM_forests$SECl_1) \nbowen_forest_categories &lt;- bowen_forest_categories[!is.na(bowen_forest_categories)]\nfor(category in bowen_forest_categories) {\n  output &lt;- bowen_TEM_forests[bowen_TEM_forests$SECl_1 == category,] %&gt;%\n    bowen_rasterize()\n  output_filename &lt;- category %&gt;% \n    gsub(\"-\", \"_\", .) %&gt;%\n    gsub(\" \", \"\", .) %&gt;%\n    gsub(\"'\", \"\", .) %&gt;%\n    paste0(\".tif\")\n  writeRaster(output, here(output_path, output_filename), overwrite = T)\n  habitats_df &lt;- data.frame(\n    path = here(output_path, output_filename),\n    filename = output_filename,\n    name = category,\n    weight = 1.0,\n    category = \"Terrestrial\",\n    source = \"MVSEI\",\n    notes = mvsei_secl_codes[mvsei_secl_codes$code == category, \"description\"]\n  ) %&gt;%\n    bind_rows(habitats_df)\n}\n\n# Metro Vancouver SEI for coastal areas - intertidal (IT), herbaceous (HB)\nbowen_sei_no_tem &lt;- bowen_sei %&gt;%\n  filter(!ProjType == \"TEM\" & !ProjType == \"NEM\") %&gt;%\n  # Remove polygons with SECl x__, because these are lost ecosystem areas \n  filter(!SECl_1 %in% c(\"xRI\", \"xWD\", \"xMF\")) %&gt;%\n  # Remove polygons with these SEsubcl, since represented elsewhere\n  # co conifer dominated\n  # ff riparian fringe\n  # sp swamp\n  # sw shallow water\n  # mx mixed confider broadleaf\n  filter(!SEsubcl_1 %in% c(\"co\", \"ff\", \"sp\", \"sw\", \"mx\")) \n\nbowen_sei_no_tem_categories &lt;- bowen_sei_no_tem$SEsubcl_1 %&gt;% unique()\nfor(category in bowen_sei_no_tem_categories) {\n  output &lt;- bowen_sei_no_tem[bowen_sei_no_tem$SEsubcl_1 == category,] %&gt;%\n    bowen_rasterize()\n  output_filename &lt;- category %&gt;% \n    gsub(\"-\", \"_\", .) %&gt;%\n    gsub(\" \", \"\", .) %&gt;%\n    gsub(\"'\", \"\", .) %&gt;%\n    paste0(\".tif\")\n  writeRaster(output, here(output_path, output_filename), overwrite = T)\n  habitats_df &lt;- data.frame(\n    path = here(output_path, output_filename),\n    filename = output_filename,\n    name = category,\n    weight = 1.0,\n    category = \"Terrestrial\",\n    source = \"MVSEI\",\n    notes = mvsei_sesubcl_codes[mvsei_sesubcl_codes$SEsubcl == category, \"description\"]\n  ) %&gt;%\n    bind_rows(habitats_df)\n}",
    "crumbs": [
      "Habitats"
    ]
  },
  {
    "objectID": "vignettes/input_habitats.html#bowen-heron-watch",
    "href": "vignettes/input_habitats.html#bowen-heron-watch",
    "title": "Habitats",
    "section": "Bowen Heron Watch",
    "text": "Bowen Heron Watch\nData on Heron and Raptor nest sites on Bowen Island from Carla Skuce on Feb 4 2025.\nChallenges:\n\nNo common ID between Excel spreadsheet and shapefile point locations\n\nAddressed by manually looking up location description on Google Maps and matching to points in QGIS. For some points, I created new points that matched the location description. I figured at the 100 m resolution that we are working with, the precise location would not be that necessary.\nDue to sensitivity of this data, this layer will not be provided or mapped on its own.\n\n\nCode\n#### Heron Nests ####\n# This geopackage was created in QGIS with manual matching between excel spreadsheet and shapefile provided from Bowen Heron Watch\nbowen_heron_watch &lt;- st_read(here(\"data-raw/bowen_heron_watch/bowen_heron_watch.gpkg\")) \n# Replace NAs\nbowen_heron_watch[is.na(bowen_heron_watch)] &lt;- 0 \nbowen_heron_watch$bowen_heron_watch_2018 &lt;- as.numeric(bowen_heron_watch$bowen_heron_watch_2018)\n# Summarize - total nests all time\nbowen_heron_watch$total &lt;- bowen_heron_watch[,6:31] %&gt;%\n  st_drop_geometry() %&gt;%\n  rowSums()\n# Rasterize the heron sites \nbowen_heron_nest_rast &lt;- bowen_heron_watch %&gt;%\n  vect() %&gt;% \n  project(bowen_island_mask) %&gt;%\n  rasterize(bowen_island_mask, field = \"total\", fun = sum, cover = T, touches = T) \nplot(bowen_heron_nest_rast)\n\n\nCode\nwriteRaster(bowen_heron_nest_rast, here(output_path, \"bowen_heron_nest.tif\"), overwrite = T)\nhabitats_df &lt;- data.frame(\n    path = here(output_path, \"bowen_heron_nest.tif\"),\n    filename = \"bowen_heron_nest.tif\",\n    name = \"Heron Nests\",\n    weight = 1.0,\n    category = \"Bird Nesting Site\",\n    source = \"Bowen Heron Watch\",\n    notes = \"Heron Nests\"\n  ) %&gt;%\n    bind_rows(habitats_df)\n\n#### Raptor Nests ####\nbowen_raptor_watch_rast &lt;- st_read(here(\"data-raw/bowen_heron_watch/2025_01_30_bowen_heron_watch/RaptorNest.shp\")) %&gt;%\n  vect() %&gt;%\n  project(bowen_island_mask) %&gt;%\n  rasterize(bowen_island_mask, cover = T, touches = T) \nplot(bowen_raptor_watch_rast)\n\n\nCode\nwriteRaster(bowen_raptor_watch_rast, here(output_path, \"bowen_raptor_nest.tif\"), overwrite = T)\nhabitats_df &lt;- data.frame(\n    path = here(output_path, \"bowen_raptor_nest.tif\"),\n    filename = \"bowen_raptor_nest.tif\",\n    name = \"Raptor Nests\",\n    weight = 1.0,\n    category = \"Bird Nesting Site\",\n    source = \"Bowen Heron Watch\",\n    notes = \"Raptor Nests\"\n  ) %&gt;%\n    bind_rows(habitats_df)",
    "crumbs": [
      "Habitats"
    ]
  },
  {
    "objectID": "vignettes/input_habitats.html#human-disturbance",
    "href": "vignettes/input_habitats.html#human-disturbance",
    "title": "Habitats",
    "section": "Human Disturbance",
    "text": "Human Disturbance\nWe followed the methods from Arias-Patino et al. (2024) for the human disturbance layers included in the analyses. Pressures included urban areas, buildings, population density, roads, railways, navigable waterways, transmission lines, seismic lines, pipelines, mining, dams and reservoirs, oil and gas infrastructure, agriculture, pastures, forest harvesting, and recreation features. We reclassified the human disturbance raster into four levels based on intensity of disturbance: intact, low disturbance, medium disturbance, and high disturbance. We then normalized and inverted the values to prepare the disturbance data for input into Zonation, ensuring that areas with less disturbance correspond to higher values on a 0-1 scale.\n\n\nCode\n#### Human Disturbance #### \n# Contents of \"data-raw/human_disturbance/\" received from Miguel Arias Patino (marias@unbc.ca)\n# https://1sfu.sharepoint.com/:f:/r/teams/Cumulativeeffects-SFUTeams9/Shared%20Documents/General/BC%20Hydro%202025%20IRP/Environmental%20Layers/Human%20Footprint?csf=1&web=1&e=hUYDs7 \n# Thesis (methods): https://unbc.arcabc.ca/islandora/object/unbc%3A59107\n# Paper (methods): https://doi.org/10.1016/j.ecolind.2024.112407 \n# Paper (methods): https://doi.org/10.1139/facets-2021-0063  \ndisturb_path &lt;- here(\"data-raw/human_disturbance/human_footprint_30m_v2.tif\")\ndisturb &lt;- terra::rast(disturb_path)\n# Load Bowen Island Mask Created Previously\nbowen_island_mask &lt;- here(\"inst/extdata/bowen_mask.tif\") %&gt;%\n  rast()\n#### Resample Raster to Bowen Island ####\ndisturb_resamp &lt;- \n  terra::project(disturb, bowen_island_mask) %&gt;%\n  terra::resample(bowen_island_mask) %&gt;%\n  terra::focal(w = 9,\n               fun = \"mean\",\n               na.policy = \"only\") %&gt;%\n  terra::crop(bowen_island_mask, mask = T)\n\nwriteRaster(disturb_resamp, \n            here::here(output_path, \"bowen_human_footprint.tif\"), \n            overwrite=TRUE)\nhabitats_df &lt;- data.frame(\n    path = here(output_path, \"bowen_human_footprint.tif\"),\n    filename = \"bowen_human_footprint.tif\",\n    name = \"Human Disturbance\",\n    weight = 0,\n    category = \"Human Disturbance\",\n    source = \"Miguel Arias Patino (marias@unbc.ca)\",\n    notes = \"Original human disturbance layer\"\n  ) %&gt;%\n    bind_rows(habitats_df)\n#### Reclassify Raster to Intact, Low, Medium, High ####\n# https://www.facetsjournal.com/doi/10.1139/facets-2021-0063#sec-2 \n# Intact is 0 to 1 \n# Low disturbance is 1 to 4\n# Medium disturbance is 4 to 10\n# High disturbance is 10+ \n# Maximum theoretical value is 66\ndisturb_m &lt;- c(0, 1, 0,\n       1, 4, 1,\n       4, 10, 2,\n       10, 100, 3) %&gt;%\n  matrix(ncol = 3, byrow = T)\n# Reclassify disturbance to levels\ndisturb_recl &lt;- disturb_resamp %&gt;%\n  classify(disturb_m, include.lowest = T)\nwriteRaster(disturb_recl, \n            here::here(output_path, \"bowen_human_footprint_recl.tif\"), \n            overwrite=TRUE)\nhabitats_df &lt;- data.frame(\n    path = here(output_path, \"bowen_human_footprint_recl.tif\"),\n    filename = \"bowen_human_footprint_recl.tif\",\n    name = \"Classified Human Disturbance\",\n    weight = 0,\n    category = \"Human Disturbance\",\n    source = \"Miguel Arias Patino (marias@unbc.ca)\",\n    notes = \"Reclassified to Low Medium High disturbance\"\n  ) %&gt;%\n    bind_rows(habitats_df)\n#### Inverse Disturbance ####\n#' Normalize on 0 to 1 scale\nnormalize &lt;- function(input_rast) {\n  mm &lt;- minmax(input_rast)\n  min &lt;- mm[1]\n  max &lt;- mm[2]\n  normalized &lt;- (input_rast - min) / (max - min)\n}\n#' Invert raster, so max values are min and vice versa. \ninvert &lt;- function(input_rast) {\n  mm &lt;- minmax(input_rast)\n  max &lt;- mm[2]\n  inverted &lt;- max - input_rast \n}\n# Normalize and invert the disturbance, so its positive as Zonation input\ndisturb_inv &lt;- disturb_resamp %&gt;% \n  normalize() %&gt;%\n  invert()\nwriteRaster(disturb_inv, here(output_path,\"bowen_human_footprint_inv.tif\"), overwrite=TRUE)\nhabitats_df &lt;- data.frame(\n    path = here(output_path, \"bowen_human_footprint_inv.tif\"),\n    filename = \"bowen_human_footprint_inv.tif\",\n    name = \"Inverse Human Disturbance\",\n    weight = 1.0,\n    category = \"Human Disturbance\",\n    source = \"Miguel Arias Patino (marias@unbc.ca)\",\n    notes = \"Inverse with low values describing high disturbance and vice versa, use for zonation\"\n  ) %&gt;%\n    bind_rows(habitats_df)",
    "crumbs": [
      "Habitats"
    ]
  },
  {
    "objectID": "vignettes/input_habitats.html#save-habitat-weights",
    "href": "vignettes/input_habitats.html#save-habitat-weights",
    "title": "Habitats",
    "section": "Save Habitat Weights",
    "text": "Save Habitat Weights\nThe weights are saved to be accessible for the conservation prioritization step. These weights can be modified directly in the spreadsheet.\nThe paths and weights for each habitat layer are saved to the habitats spreadsheet hosted here: Habitat Spreadsheet\n\n\nCode\n# Save to CSV\nwrite.csv(habitats_df, here(output_path, paste0(Sys.Date(),\"_habitats.csv\")))\n# Save to Google Sheets\nhabitats_url &lt;- \"https://docs.google.com/spreadsheets/d/1yDKw4r3tbXYivwtxbbfxc-pYSbtbj_o2ee1pwlNCOO4/edit?usp=drive_link\"\nwrite_sheet(\n  habitats_df,\n  habitats_url,\n  sheet = as.character(Sys.Date())\n)",
    "crumbs": [
      "Habitats"
    ]
  },
  {
    "objectID": "vignettes/input_habitats.html#exploring-habitat-rasters",
    "href": "vignettes/input_habitats.html#exploring-habitat-rasters",
    "title": "Habitats",
    "section": "Exploring Habitat Rasters",
    "text": "Exploring Habitat Rasters\nYou can use this interactive map to explore some of the input habitat layers.\n\n\nCode\nleaflet(width = \"100%\", height = \"800px\") %&gt;%\n  addProviderTiles(provider = providers$Stadia.AlidadeSmooth) %&gt;%\n  addRasterImage(x = wetlands_aw_rast, group = \"A. Whitehead Wetlands\", colors = \"lightgreen\") %&gt;%\n  addRasterImage(x = bowen_sei_wn_1_rast, group = \"Bowen SEI SECl_1 Wetlands\", colors = \"green\") %&gt;%\n  addRasterImage(x = bowen_sei_wn_2_rast, group = \"Bowen SEI SECl_2 Wetlands\", colors = \"darkgreen\") %&gt;%\n  addRasterImage(x = bowen_sei_ri_rast, group = \"Bowen SEI Riparian\", colors = \"lightblue\") %&gt;%\n  addRasterImage(x = bowen_sei_fw_la_rast, group = \"Bowen SEI Freshwater Lakes\", colors = \"darkblue\") %&gt;%\n  addRasterImage(x = ponds_aw_rast, group = \"A. Whitehead Freshwater Ponds\", colors = \"blue\") %&gt;%\n  # addPolygons(data = bowen_sei_fw_pd, label = \"Bowen SEI ponds\") %&gt;%\n  # addPolygons(data = ponds_aw, label = \"A. Whitehead ponds\") %&gt;%\n  addRasterImage(x = streams_rast, group = \"A. Whitehead Streams\") %&gt;%\n  addLayersControl(overlayGroups = c(\"A. Whitehead Wetlands\", \n                                     \"Bowen SEI SECl_1 Wetlands\", \n                                     \"Bowen SEI SECl_2 Wetlands\", \n                                     \"Bowen SEI Riparian\", \n                                     \"Bowen SEI Freshwater Lakes\", \n                                     \"Bowen SEI + A. Whitehead Freshwater Ponds\", \n                                     \"A. Whitehead Streams\"\n                                     ),\n                   options = layersControlOptions(collapsed = F))",
    "crumbs": [
      "Habitats"
    ]
  },
  {
    "objectID": "vignettes/threats_fire.html",
    "href": "vignettes/threats_fire.html",
    "title": "Threats: Fire",
    "section": "",
    "text": "Code\nlibrary(bowen.biodiversity.webapp)\nlibrary(here)\nlibrary(sf)\nlibrary(ggplot2)\nlibrary(leaflet)\nlibrary(tidyverse)\nlibrary(terra)",
    "crumbs": [
      "Threats",
      "Threats: Fire"
    ]
  },
  {
    "objectID": "vignettes/threats_fire.html#convert-to-raster-matching-the-resolution-and-extent-of-zonation-inputs",
    "href": "vignettes/threats_fire.html#convert-to-raster-matching-the-resolution-and-extent-of-zonation-inputs",
    "title": "Threats: Fire",
    "section": "Convert to raster matching the resolution and extent of Zonation inputs",
    "text": "Convert to raster matching the resolution and extent of Zonation inputs\n\n\nCode\nbowen_mask &lt;- here(\"inst/extdata/bowen_mask.tif\") %&gt;% rast()\nbowen_wui_vect &lt;- bowen_wui %&gt;% vect() %&gt;% project(bowen_mask)\n\nbowen_wui_rast &lt;- bowen_wui_vect %&gt;%\n  rasterize(bowen_mask, \"WUI_PSTA\", touches = T)",
    "crumbs": [
      "Threats",
      "Threats: Fire"
    ]
  },
  {
    "objectID": "vignettes/threats_fire.html#notes-on-threat-due-to-fire-from-tom-sisk",
    "href": "vignettes/threats_fire.html#notes-on-threat-due-to-fire-from-tom-sisk",
    "title": "Threats: Fire",
    "section": "Notes on threat due to fire from Tom Sisk",
    "text": "Notes on threat due to fire from Tom Sisk\nObjective: Index of Vulnerability to Fire. We are not trying to assess the probability of fire nor how hot it might burn or its behavior. Instead, we want to know the relative vulnerability to biodiversity loss due to fire, if habitats were to burn.\nThree major components of vulnerability:\n\nSlope. Fires spread more quickly when they move uphill. Relative ranking might look like this:\n1 0-10 degree slopes: lower vulnerability 2 10-30 degrees: moderate vulnerability 3 Above 30 degrees: higher vulnerability\nAspect. Southerly exposures burn hotter, fire spreads more quickly, effects more uniform and destructive than on northern exposures, all else being equal. Might consider this as a first approximation: 1 0-45: Low vulnerability because fires unlikely to spread as fast or burn as hot 2 45-90: moderately low 4 90-135: moderately high 6 135-225: southerly exposures burn hotter, spread quickly and more uniformly 4 225-270: Moderately high 2 270-315 Moderately low 1 315-360: Low vulnerability\nFuels. On Bowen, the main differences in fuel loads have to do with whether a location is forested or not forested. Forested areas burn hotter and longer and long, hot burns have a more detrimental effect that shorter less intense fires. So the main distinctions should be made between forested and unforested. Forest stands comprised of larger trees are, of course, of higher value to biodiversity than denser stands with smaller trees, so we would like to be able to distinguish between forest structures to some degree. At the same time, when more mesic habitats burn the biodiversity effects tend to be high, because species are not adapted to fire. So we will need to rank habitats based on the differential effects of forest fuels present, as well as the difference in flora and fauna that make those locations more or less vulnerable in terms of biodiversity loss. First Cut Ranking Scheme: 14 Forest, large/old trees 10 Forest, mature second growth 6 Forest, young regrowth 6 Shrublands 2 Grasslands: often burn and effects are modest, even positive in some cases 4 Riparian: seldom burns, but if it burns biodiversity effects may be very negative 2 Wetlands: seldom burn, more often they create fire breaks 0 Water: does not burn, but is vulnerable to ash deposition NA Built environment: NA (default to WUI map when talking about the built environment\n\nI suggest that we think about these basic ideas:\n\nWe pursue an index of vulnerability, rather than a more sophisticated approach to modeling fire or adapting an index that was developed for other purposes (i.e. WUI).\nWe create a simple index that allows us to compare the relative vulnerability of all locations on Bowen (with the exception of the built environment).\nWe consider slope, aspect, and fuels by habitat as the three components of an index.\nWe determine the relative ranks within each of the three components\nIntegrate the scores into an index that produces an aggregate vulnerability index score for each pixel. As a first approximation, this should be the additive (sum) of the three components – and then let’s see how that performs.\n\n\nRationale for score scaling from Tom\nCalculating rasters from the LiDAR data directly\nAdd together the three components raster\n\n\n\nCode\n# Slope Score\n## Create slope raster from LiDAR data\nslope &lt;- rast(here(\"data/bowen_slope.tif\"))\n## Create matrix of scores\n### 1 0-10 degree slopes: lower vulnerability\n### 2 10-30 degrees: moderate vulnerability\n### 3 Above 30 degrees: higher vulnerability\nslope_m &lt;- matrix(c(\n  0, 10, 1,\n  10, 30, 2,\n  30, 91, 3\n), ncol = 3, byrow = T)\n## Classify original slope raster to slope score \nslope_score &lt;- slope %&gt;%\n  classify(slope_m)\n\n# Aspect Score\n## Create aspect raster from LiDAR data\naspect &lt;- rast(here(\"data/bowen_aspect.tif\"))\n## Create matrix of scores\n### 1 0-45: Low vulnerability because fires unlikely to spread as fast or burn as hot \n### 2 45-90: moderately low \n### 4 90-135: moderately high \n### 6 135-225: southerly exposures burn hotter, spread quickly and more uniformly \n### 4 225-270: Moderately high \n### 2 270-315 Moderately low \n### 1 315-360: Low vulnerability\naspect_m &lt;- matrix(c(\n  0, 45, 1,\n  45, 90, 2,\n  90, 135, 4,\n  135, 225, 6,\n  225, 270, 4,\n  270, 315, 2,\n  315, 360, 1\n), ncol = 3, byrow = T)\n## Classify original aspect raster to aspect score \naspect_score &lt;- aspect %&gt;%\n  classify(aspect_m)\n\n# Fuel Score\n## Get habitat classes from combination of WUI, MVSEI, TEM, AW layers \nmv_sei &lt;- st_read(here(\"data-raw/metrovancouver_sensitive_ecosystem_inventory/Sensitive_Ecosystem_Inventory_for_Metro_Vancouver__2020__-5580727563910851507.gpkg\")) %&gt;%\n  st_transform(project_crs) %&gt;%\n  st_crop(bowen_boundary) \n\n\nWarning in CPL_read_ogr(dsn, layer, query, as.character(options), quiet, : GDAL\nMessage 1: This version of GeoPackage user_version=0x000028A0 (10400, v1.4.0)\non\n'/home/jay/Programming_Projects/bowen.biodiversity.webapp/data-raw/metrovancouver_sensitive_ecosystem_inventory/Sensitive_Ecosystem_Inventory_for_Metro_Vancouver__2020__-5580727563910851507.gpkg'\nmay only be partially supported\n\n\nReading layer `Sensitive_Ecosystem_Inventory_for_Metro_Vancouver__2020_' from data source `/home/jay/Programming_Projects/bowen.biodiversity.webapp/data-raw/metrovancouver_sensitive_ecosystem_inventory/Sensitive_Ecosystem_Inventory_for_Metro_Vancouver__2020__-5580727563910851507.gpkg' \n  using driver `GPKG'\n\n\nWarning in CPL_read_ogr(dsn, layer, query, as.character(options), quiet, : GDAL\nMessage 1: Non-conformant content for record 1 in column SourceDate,\n2011-04-29T00:00:00.0Z, successfully parsed\n\n\nSimple feature collection with 25637 features and 99 fields\nGeometry type: MULTIPOLYGON\nDimension:     XYZ\nBounding box:  xmin: 468516.6 ymin: 5427679 xmax: 547072.5 ymax: 5495732\nz_range:       zmin: 0 zmax: 0\nProjected CRS: NAD83 / UTM zone 10N\n\n\nWarning: attribute variables are assumed to be spatially constant throughout\nall geometries\n\n\nCode\nmv_sei_secl_codes &lt;- read.csv(here(\"data-raw/metrovancouver_sensitive_ecosystem_inventory/SEI_SECl_codes.csv\"))\n\n## Generate fuel score raster based on habitat type \n### 14 Forest, large/old trees \n### 10 Forest, mature second growth \n### 6 Forest, young regrowth \n### 6 Shrublands \n### 2 Grasslands: often burn and effects are modest, even positive in some cases \n### 4 Riparian: seldom burns, but if it burns biodiversity effects may be very negative \n### 2 Wetlands: seldom burn, more often they create fire breaks \n### 0 Water: does not burn, but is vulnerable to ash deposition \n### NA Built environment: NA (default to WUI map when talking about the built environment\n\n### Using SEI \n### TODO: use A. Whitehead wetland and freshwater layers \nmv_sei_mod &lt;- mv_sei %&gt;%\n  select(\"SECl_1\", \"SEsubcl_1\", \"SECl_2\") %&gt;%\n  filter(!str_detect(SECl_1, \"x\")) %&gt;% # remove lost habitats\n  mutate(\n    fuel_score = \n      case_when(\n        SECl_1 == \"OF\" ~ 14,\n        SECl_1 == \"MF\" ~ 10,\n        SECl_1 == \"YF\" ~ 6,\n        SECl_1 == \"YS\" ~ 6,\n        SECl_1 == \"WD\" ~ 6, # TODO: what score for \"Woodland\" category? \n        SECl_1 == \"HB\" & SEsubcl_1 == \"sh\" ~ 6, # Herbaceous, shrub\n        SECl_1 == \"HB\" & SEsubcl_1 != \"sh\" ~ 2, # Herbaceous, non-shrub\n        SECl_1 == \"RI\" ~ 4, # \"Riparian\"\n        SECl_1 == \"WN\" ~ 2, # \"Wetland\"\n        SECl_1 == \"OD\" ~ 2, # \"Old Field\"\n        SECl_1 == \"SV\" ~ 0, # TODO: what score for \"Sparsely Vegetated\" category?\n        SECl_1 == \"IT\" ~ 0, # TODO: what score for \"Intertidal\" category? \n        SECl_1 == \"FW\" ~ 0,\n        # Deal with XX Non-SE\n        SECl_1 == \"XX\" & SECl_2 == \"MF\" ~ 10,\n        SECl_1 == \"XX\" & SECl_2 == \"YS\" ~ 6,\n        SECl_1 == \"XX\" & SECl_2 == \"WD\" ~ 6,\n        SECl_1 == \"XX\" & SECl_2 == \"RI\" ~ 4,\n        SECl_1 == \"XX\" & SECl_2 == \"SV\" ~ 0,\n      )\n  )\n# Rasterize habitat polygons fuel score\nfuel_score &lt;- mv_sei_mod %&gt;%\n  vect() %&gt;%\n  project(aspect_score) %&gt;%\n  rasterize(aspect_score, field = \"fuel_score\") \n\n# Cumulative Fire Vulnerability Index\nfire_index &lt;- slope_score + aspect_score + fuel_score\nplot(fire_index)",
    "crumbs": [
      "Threats",
      "Threats: Fire"
    ]
  },
  {
    "objectID": "vignettes/threats_logging.html",
    "href": "vignettes/threats_logging.html",
    "title": "Threats: Logging",
    "section": "",
    "text": "Code\nlibrary(bowen.biodiversity.webapp)",
    "crumbs": [
      "Threats",
      "Threats: Logging"
    ]
  },
  {
    "objectID": "vignettes/threats_logging.html#work-in-progress",
    "href": "vignettes/threats_logging.html#work-in-progress",
    "title": "Threats: Logging",
    "section": "",
    "text": "Code\nlibrary(bowen.biodiversity.webapp)",
    "crumbs": [
      "Threats",
      "Threats: Logging"
    ]
  },
  {
    "objectID": "vignettes/tree_density_from_lidar.html",
    "href": "vignettes/tree_density_from_lidar.html",
    "title": "Tree Density from LiDAR",
    "section": "",
    "text": "Code\nlibrary(bowen.biodiversity.webapp)\nlibrary(here)\nlibrary(sf)\nlibrary(leaflet)\nlibrary(leaflet.extras)\nlibrary(future)\nlibrary(dplyr)\n\n# install.packages('lasR', repos = 'https://r-lidar.r-universe.dev')\nlibrary(lasR)",
    "crumbs": [
      "Supplementary",
      "Tree Density from LiDAR"
    ]
  },
  {
    "objectID": "vignettes/tree_density_from_lidar.html#setup",
    "href": "vignettes/tree_density_from_lidar.html#setup",
    "title": "Tree Density from LiDAR",
    "section": "",
    "text": "Code\nlibrary(bowen.biodiversity.webapp)\nlibrary(here)\nlibrary(sf)\nlibrary(leaflet)\nlibrary(leaflet.extras)\nlibrary(future)\nlibrary(dplyr)\n\n# install.packages('lasR', repos = 'https://r-lidar.r-universe.dev')\nlibrary(lasR)",
    "crumbs": [
      "Supplementary",
      "Tree Density from LiDAR"
    ]
  },
  {
    "objectID": "vignettes/tree_density_from_lidar.html#extract-tree-tops-from-lidar-data",
    "href": "vignettes/tree_density_from_lidar.html#extract-tree-tops-from-lidar-data",
    "title": "Tree Density from LiDAR",
    "section": "Extract Tree Tops from LiDAR Data",
    "text": "Extract Tree Tops from LiDAR Data\nLiDAR data files were downloaded from LidarBC\nThe lasR package was used to extract tree tops data from the LiDAR data.\n\n\nCode\nset_parallel_strategy(concurrent_files(4))\n# Read las \nctg &lt;- readLAScatalog(here(\"temp/las\"))\n\ndel = triangulate(filter = keep_ground())\nnorm = transform_with(del, \"-\")\nwrite = write_las(here(\"temp/normalized/*_normalized.las\"))\nchm = rasterize(2, \"max\", ofile = here(\"temp/chm/chm.tif\"))\nlm = local_maximum_raster(chm, 5)\npipeline2 = reader() + del + norm + write + chm + lm\n\nans = exec(pipeline2, on = ctg)\nttops &lt;- ans$local_maximum %&gt;% st_transform(4326)\nst_write(ttops, here(\"data-raw/ttops.gpkg\"))",
    "crumbs": [
      "Supplementary",
      "Tree Density from LiDAR"
    ]
  },
  {
    "objectID": "vignettes/tree_density_from_lidar.html#visualize-tree-tops-data-with-heatmap",
    "href": "vignettes/tree_density_from_lidar.html#visualize-tree-tops-data-with-heatmap",
    "title": "Tree Density from LiDAR",
    "section": "Visualize Tree Tops Data with Heatmap",
    "text": "Visualize Tree Tops Data with Heatmap\n\n\nCode\nttops &lt;- st_read(here(\"data-raw/ttops.gpkg\")) \n\n\nReading layer `ttops' from data source \n  `/home/jay/Programming_Projects/bowen.biodiversity.webapp/data-raw/ttops.gpkg' \n  using driver `GPKG'\nSimple feature collection with 660834 features and 0 fields\nGeometry type: POINT\nDimension:     XYZ\nBounding box:  xmin: -123.4483 ymin: 49.32728 xmax: -123.3 ymax: 49.42478\nz_range:       zmin: 2 zmax: 1383.31\nGeodetic CRS:  WGS 84\n\n\nCode\nttops_coord &lt;- ttops %&gt;% st_coordinates() %&gt;% as.data.frame()\nleaflet(ttops_coord) %&gt;%      \n  addProviderTiles(providers$CartoDB.Positron) %&gt;%\n  addHeatmap(lng=~X, lat=~Y, blur= 15, max = 65, radius = 30)",
    "crumbs": [
      "Supplementary",
      "Tree Density from LiDAR"
    ]
  },
  {
    "objectID": "vignettes/protected_areas.html",
    "href": "vignettes/protected_areas.html",
    "title": "Protected Areas",
    "section": "",
    "text": "First map / filter - Public lands (crown, municipal, MV lands) - Not in existing protected areas\nSecond map / filter - Top 30% of conservation values - Wetland / water / riparian values\nAlgorithms in Zonation and Marxann for identifying these - Find cluster\n\n# Current package within which this vignette is included\nlibrary(bowen.biodiversity.webapp)\n# Spatial \nlibrary(sf)\n\nLinking to GEOS 3.11.1, GDAL 3.6.4, PROJ 9.1.1; sf_use_s2() is TRUE\n\nlibrary(terra)\n\nterra 1.8.5\n\nlibrary(tidyterra)\n\n\nAttaching package: 'tidyterra'\n\n\nThe following object is masked from 'package:stats':\n\n    filter\n\n# Analysis / Plotting\nlibrary(dplyr)\n\n\nAttaching package: 'dplyr'\n\n\nThe following objects are masked from 'package:terra':\n\n    intersect, union\n\n\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n\n\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n\nlibrary(tidyr)\n\n\nAttaching package: 'tidyr'\n\n\nThe following object is masked from 'package:terra':\n\n    extract\n\nlibrary(ggplot2)\nlibrary(here)\n\nhere() starts at /home/jay/Programming_Projects/bowen.biodiversity.webapp\n\n# Google Sheets\nlibrary(googlesheets4)\n# Prioritizr and deps\nlibrary(gurobi)\n\nWarning: package 'gurobi' was built under R version 4.5.0\n\n\nLoading required package: slam\n\nlibrary(prioritizr)\n\ncaption &lt;- paste0(\"Map created: \", date(), \". Palen Lab. Created by Jay Matsushiba (jmatsush@sfu.ca)\")\n\n\n\n\nsdm_url &lt;- \"https://docs.google.com/spreadsheets/d/1IGFwkr9LidcZwbzOJJGSEXLsmpKp0a9gBs65EY-H1xw/edit?usp=sharing\"\nhabitats_url &lt;- \"https://docs.google.com/spreadsheets/d/1yDKw4r3tbXYivwtxbbfxc-pYSbtbj_o2ee1pwlNCOO4/edit?usp=drive_link\"\noutput_dir &lt;- here(\"vignettes/figures/protected_areas\")\nif(!dir.exists(output_dir)) {\n  dir.create(output_dir)\n}\n\n#### Zonation Raster Layers ####\n# Load Zonation Output / Conservation Values\nzonation &lt;- here(\"inst/extdata/output_zonation/2025-06-30/rankmap.tif\") %&gt;%\n  rast()\n# For assessing freshwater habitat overlap with potential protected areas. \n# Read from Google Sheets\nhabitats_df &lt;- read_sheet(habitats_url, sheet = \"2025-06-30\")\n\nℹ Suitable tokens found in the cache, associated with these emails:\n\n\n• 'hello@jmatsushiba.com'\n\n\n• 'jay.matsushiba@gmail.com'\n\n\n• 'palenlab@gmail.com'\n\n\n  Defaulting to the first email.\n\n\n! Using an auto-discovered, cached token.\n\n\n  To suppress this message, modify your code or options to clearly consent to\n  the use of a cached token.\n\n\n  See gargle's \"Non-interactive auth\" vignette for more details:\n\n\n  &lt;https://gargle.r-lib.org/articles/non-interactive-auth.html&gt;\n\n\nℹ The googlesheets4 package is using a cached token for\n  'hello@jmatsushiba.com'.\n\n\n✔ Reading from \"habitats\".\n\n\n✔ Range ''2025-06-30''.\n\nhabitats_df$weight &lt;- habitats_df$weight / nrow(habitats_df)\nsdm_df &lt;- read_sheet(sdm_url, sheet = \"2025-06-30\") \n\n✔ Reading from \"sdm\".\n✔ Range ''2025-06-30''.\n\nsdm_df$weight &lt;- sdm_df$weight / nrow(sdm_df)\n# Bind all input layers together\nlayers_df &lt;- sdm_df %&gt;%\n  select(colnames(habitats_df)) %&gt;% # Select common columns\n  bind_rows(habitats_df) %&gt;%\n  filter(weight &gt; 0)\n\n\n#### Vector Layers ####\nparcels &lt;- bowen.biodiversity.webapp::bowen_parcelmap %&gt;%\n  # filter(!OwnerType %in% c(\"Private\", \"Unclassified\", \"Mixed Ownership\")) %&gt;%\n  filter(PID != 31243550) %&gt;% # Remove ferry route \n  st_transform(st_crs(bowen_protectedareas))\n\nparcels$geom &lt;- parcels$geom %&gt;%\n  st_cast(\"MULTIPOLYGON\") %&gt;%\n  st_make_valid()\n\nbowen_protectedareas_valid &lt;- bowen_protectedareas %&gt;%\n  st_make_valid()\n\n\n\n\n\n\nThis is the first filter for potential protected area candidates. We need to find public lands parcels that are not in existing protected areas.\n\n# Dissolve protected areas into one geometry\ndissolved_protectedareas &lt;- bowen_protectedareas_valid %&gt;%\n  summarise() %&gt;%\n  st_cast() %&gt;%\n  st_buffer(1) # cleans up geometry slivers compared to 0, buffer distance in metres\n# st_difference after \n# doing st_difference without dissolving protected areas into one geometry \nnotprotected_parcels &lt;- st_difference(parcels, dissolved_protectedareas)\n\nWarning: attribute variables are assumed to be spatially constant throughout\nall geometries\n\n# filter for public lands \nnotprotected_parcels$OwnerType %&gt;% unique()\n\n[1] \"Private\"          \"Crown Provincial\" \"Local Government\" \"Mixed Ownership\" \n[5] \"Crown Agency\"     \"Federal\"          \"Unclassified\"    \n\n# [1] \"Private\"          \"Crown Provincial\" \"Local Government\" \"Mixed Ownership\"  \"Crown Agency\"     \"Federal\"         \n# [7] \"Unclassified\" \nnotprotected_publiclands &lt;- notprotected_parcels[!notprotected_parcels$OwnerType %in% c(\"Private\", \"Mixed Ownership\", \"Unclassified\"),] \nnotprotected_privatelands &lt;- notprotected_parcels[notprotected_parcels$OwnerType %in% c(\"Private\", \"Mixed Ownership\", \"Unclassified\"),] \n\n\n\n\n\npotential_protected_areas_ggfunc &lt;- function() {\n  protected_colour &lt;- \"#b3e2cd\"\n  notprotected_public_colour &lt;-  \"#fdcdac\"\n  notprotected_private_colour &lt;- \"#cbd5e8\"\n  output &lt;- list(\n    geom_sf(data = bowen_protectedareas_valid, aes(fill = protected_colour)),\n    geom_sf(data = notprotected_publiclands, aes(fill = notprotected_public_colour)),\n    geom_sf(data = notprotected_privatelands, aes(fill = notprotected_private_colour)),\n    scale_fill_identity(name = \"\",\n                          breaks = c(protected_colour, notprotected_public_colour, notprotected_private_colour),\n                          labels = c(\"Protected\", \"Unprotected Public\", \"Unprotected Private\"),\n                          guide = \"legend\"\n    ),\n    ggnewscale::new_scale_fill(),\n    ggnewscale::new_scale_colour()\n  )\n  return(output)\n}\n\ncaption &lt;- paste0(\"Map created: \", date(), \". Palen Lab. Created by Jay Matsushiba (jmatsush@sfu.ca)\")\nprotected_areas_ggplot &lt;- bowen_map_ggplot(\n  potential_protected_areas_ggfunc,\n  title = \"Protected Areas and Parcels on Bowen Island\",\n  subtitle = \"Mapping the Protected Areas and unprotected parcels to identify potential parcels for future protection.\",\n  caption = caption\n)\n\nReading layer `bowen_island_shoreline_w_hutt__bowen_islands' from data source \n  `/home/jay/Programming_Projects/bowen.biodiversity.webapp/data-raw/bowen_island_shoreline_w_hutt.gpkg' \n  using driver `GPKG'\nSimple feature collection with 11 features and 1 field\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: 4001956 ymin: 2020764 xmax: 4013988 ymax: 2028901\nProjected CRS: NAD83 / Statistics Canada Lambert\nLoading basemap 'backdrop' from map service 'maptiler'...\n\n\n&lt;SpatRaster&gt; resampled to 501000 cells.\n\nggplot2::ggsave(\n  here(output_dir, \"/\", paste0(Sys.Date(), \"_protected_areas_parcels.png\")),\n  protected_areas_ggplot,\n  device = ragg::agg_png,\n  width = 9, height = 12, units = \"in\", res = 300\n)\n\n\n\n\n\nTop 30% of conservation values\nWetland / water / riparian values\n\n\n#### Conservation values summed by parcel ####\n# extract zonation raster values from cells within each parcel\nnotprotected_cons_vals &lt;- notprotected_parcels %&gt;% \n  vect() %&gt;%\n  terra::extract(zonation, ., \n                 sum, \n                 na.rm = TRUE, \n                 weights = TRUE, # sum biodiversity value by approx fraction of cell covered by polygon\n                 bind = TRUE) \n\nWarning: [extract] transforming vector data to the CRS of the raster\n\n#### Top 30% conservation values summed by parcel ####\n# create top 30% zonation raster \nrcl &lt;- matrix(c(\n  0, 1, 1\n), ncol = 3, byrow = T)\nzonation_top_30 &lt;- zonation %&gt;%\n  remove_by_quantile(\n    prob = 0.7\n  ) %&gt;% \n  classify(rcl)\nnames(zonation_top_30) &lt;- \"rankmap_top_30\"\n# extract number of top conservation value cells within each parcel\nnotprotected_cons_1 &lt;- notprotected_cons_vals %&gt;%\n  terra::extract(zonation_top_30, ., \n                 sum, \n                 na.rm = TRUE, \n                 weights = TRUE, # sum biodiversity value by approx fraction of cell covered by polygon\n                 bind = TRUE) \n\nWarning: [extract] transforming vector data to the CRS of the raster\n\n#### Freshwater (wetland, ponds, rivers) ####\n# Get freshwater rasters, same used in zonation and data atlas\nfw_df &lt;- layers_df[layers_df$category == \"Freshwater\",]\nfw_rast_stack &lt;- layers_df[layers_df$category == \"Freshwater\", \"path\"] %&gt;%\n  unlist() %&gt;%\n  lapply(rast) %&gt;%\n  rast() \nfw_rast_stack %&gt;% sources() # see order of paths \n\n[1] \"/home/jay/Programming_Projects/bowen.biodiversity.webapp/inst/extdata/habitats/riparian.tif\"\n[2] \"/home/jay/Programming_Projects/bowen.biodiversity.webapp/inst/extdata/habitats/streams.tif\" \n[3] \"/home/jay/Programming_Projects/bowen.biodiversity.webapp/inst/extdata/habitats/lakes.tif\"   \n[4] \"/home/jay/Programming_Projects/bowen.biodiversity.webapp/inst/extdata/habitats/ponds.tif\"   \n[5] \"/home/jay/Programming_Projects/bowen.biodiversity.webapp/inst/extdata/habitats/wetlands.tif\"\n\nnames(fw_rast_stack) &lt;- c(\"riparian\", \"streams\", \"lakes\", \"ponds\", \"wetlands\") # assign names to layers\n# TODO: decide what to do with stream classes, leave them as is?\n# 3 is fish-bearing streams, 2 is tributary to fish-bearing, 1 is non-fishbearing / drainage channel / unclassified \n\nfw_richness &lt;- fw_rast_stack %&gt;%\n  lapply(not.na) %&gt;%\n  lapply(function(x) {classify(x, cbind(FALSE, NA))}) %&gt;%\n  rast() %&gt;%\n  sum(na.rm = T) \nnames(fw_richness) &lt;- \"fw_richness\"\n# summed richness by parcel\nnotprotected_cons_2 &lt;- notprotected_cons_1 %&gt;%\n  terra::extract(fw_richness, ., \n                 sum, \n                 na.rm = TRUE, \n                 weights = TRUE, # sum biodiversity value by approx fraction of cell covered by polygon\n                 bind = TRUE) \n\nWarning: [extract] transforming vector data to the CRS of the raster\n\nnotprotected_cons_2 &lt;- notprotected_cons_2 %&gt;%\n  tidyterra::rename(fw_sum_richness = \"fw_richness\")\n# fw habitat diversity by parcel\nnotprotected_cons_3 &lt;- notprotected_cons_2 %&gt;%\n  terra::extract(fw_rast_stack, ., \n                 max, \n                 na.rm = TRUE,\n                 bind = TRUE) \n\nWarning: [extract] transforming vector data to the CRS of the raster\n\n#### Convert to sf for better data.frame utilities ####\nnotprotected_cons_vals_sf &lt;- notprotected_cons_3 %&gt;%\n  st_as_sf() %&gt;%\n  tidyr::replace_na(list( # Replace NAs with 0 in freshwater columns\n    riparian = 0, \n    streams = 0, \n    lakes = 0, \n    ponds = 0, \n    wetlands = 0\n  )) %&gt;% \n  mutate(fw_num_hab_pres = rowSums(across(names(fw_rast_stack)), na.rm = T)) # Get number of habitat types in each parcel\n\n\n#### PLOTTING ####\n# Quick plot to check\nggplot(notprotected_cons_vals_sf) +\n  geom_sf(aes(fill = fw_num_hab_pres))\n\n\n\n\n\n\n\n# Caption for all maps\ncaption &lt;- paste0(\"Map created: \", date(), \". Palen Lab. Created by Jay Matsushiba (jmatsush@sfu.ca)\")\n\n# Conservation Vals Continuous\nconservation_vals_cont_gg &lt;- function() {\n  notprotected_public_colour &lt;-  \"green\"\n  notprotected_private_colour &lt;- \"red\"\n  list(\n    geom_sf(data = notprotected_cons_vals_sf, aes(fill = rankmap), color = NA),\n    scale_fill_viridis_c(),\n    geom_sf(data = notprotected_privatelands, aes(colour = notprotected_private_colour), linewidth = 0.3, fill = NA),\n    geom_sf(data = notprotected_publiclands, aes(colour = notprotected_public_colour), linewidth = 0.3, fill = NA),\n    scale_colour_identity(\n      name = \"\",\n      breaks = c(notprotected_public_colour, notprotected_private_colour),\n      labels = c(\"Unprotected Public\", \"Unprotected Private\"),\n      guide = \"legend\"\n    ),\n    ggnewscale::new_scale_fill(),\n    ggnewscale::new_scale_colour()\n  )\n}\nconservation_vals_cont_ggplot &lt;- bowen_map_ggplot(\n  conservation_vals_cont_gg,\n  title = \"Conservation Values by Unprotected Parcels\",\n  subtitle = \"Mapping the unprotected parcels and their relative biodiversity values to identify potential parcels for future protection.\",\n  caption = caption\n)\n\nReading layer `bowen_island_shoreline_w_hutt__bowen_islands' from data source \n  `/home/jay/Programming_Projects/bowen.biodiversity.webapp/data-raw/bowen_island_shoreline_w_hutt.gpkg' \n  using driver `GPKG'\nSimple feature collection with 11 features and 1 field\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: 4001956 ymin: 2020764 xmax: 4013988 ymax: 2028901\nProjected CRS: NAD83 / Statistics Canada Lambert\nLoading basemap 'backdrop' from map service 'maptiler'...\n\n\n&lt;SpatRaster&gt; resampled to 501000 cells.\n\nggplot2::ggsave(\n  here(output_dir, \"/\", paste0(Sys.Date(), \"_conservation_vals_continuous_parcels.png\")),\n  conservation_vals_cont_ggplot,\n  device = ragg::agg_png,\n  width = 9, height = 12, units = \"in\", res = 300\n)\n\n# Conservation Vals Top 30\nconservation_vals_top_gg &lt;- function() {\n  notprotected_public_colour &lt;-  \"green\"\n  notprotected_private_colour &lt;- \"red\"\n  list(\n    geom_sf(data = notprotected_cons_vals_sf, aes(fill = rankmap_top_30), color = NA),\n    scale_fill_viridis_c(),\n    geom_sf(data = notprotected_privatelands, aes(colour = notprotected_private_colour), linewidth = 0.3, fill = NA),\n    geom_sf(data = notprotected_publiclands, aes(colour = notprotected_public_colour), linewidth = 0.3, fill = NA),\n    scale_colour_identity(\n      name = \"\",\n      breaks = c(notprotected_public_colour, notprotected_private_colour),\n      labels = c(\"Unprotected Public\", \"Unprotected Private\"),\n      guide = \"legend\"\n    ),\n    ggnewscale::new_scale_fill(),\n    ggnewscale::new_scale_colour()\n  )\n}\nconservation_vals_top_ggplot &lt;- bowen_map_ggplot(\n  conservation_vals_top_gg,\n  title = \"Top Conservation Values by Unprotected Parcels\",\n  subtitle = \"Mapping the unprotected parcels and number of top 30% conservation value cells to identify potential parcels for future protection.\",\n  caption = caption\n)\n\nReading layer `bowen_island_shoreline_w_hutt__bowen_islands' from data source \n  `/home/jay/Programming_Projects/bowen.biodiversity.webapp/data-raw/bowen_island_shoreline_w_hutt.gpkg' \n  using driver `GPKG'\nSimple feature collection with 11 features and 1 field\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: 4001956 ymin: 2020764 xmax: 4013988 ymax: 2028901\nProjected CRS: NAD83 / Statistics Canada Lambert\nLoading basemap 'backdrop' from map service 'maptiler'...\n\n\n&lt;SpatRaster&gt; resampled to 501000 cells.\n\nggplot2::ggsave(\n  here(output_dir, \"/\", paste0(Sys.Date(), \"_conservation_vals_top_parcels.png\")),\n  conservation_vals_top_ggplot,\n  device = ragg::agg_png,\n  width = 9, height = 12, units = \"in\", res = 300\n)\n\n# Freshwater sum richness\nfreshwater_sum_gg &lt;- function() {\n  notprotected_public_colour &lt;-  \"green\"\n  notprotected_private_colour &lt;- \"red\"\n  list(\n    geom_sf(data = notprotected_cons_vals_sf, aes(fill = fw_sum_richness), color = NA),\n    scale_fill_viridis_c(),\n    geom_sf(data = notprotected_privatelands, aes(colour = notprotected_private_colour), linewidth = 0.3, fill = NA),\n    geom_sf(data = notprotected_publiclands, aes(colour = notprotected_public_colour), linewidth = 0.3, fill = NA),\n    scale_colour_identity(\n      name = \"\",\n      breaks = c(notprotected_public_colour, notprotected_private_colour),\n      labels = c(\"Unprotected Public\", \"Unprotected Private\"),\n      guide = \"legend\"\n    ),\n    ggnewscale::new_scale_fill(),\n    ggnewscale::new_scale_colour()\n  )\n}\nfreshwater_sum_ggplot &lt;- bowen_map_ggplot(\n  freshwater_sum_gg,\n  title = \"Relative Freshwater Habitat Richness by Unprotected Parcels\",\n  subtitle = \"Mapping the unprotected parcels and the total sum of freshwater habitat richness cells to identify potential parcels for future protection.\",\n  caption = caption\n)\n\nReading layer `bowen_island_shoreline_w_hutt__bowen_islands' from data source \n  `/home/jay/Programming_Projects/bowen.biodiversity.webapp/data-raw/bowen_island_shoreline_w_hutt.gpkg' \n  using driver `GPKG'\nSimple feature collection with 11 features and 1 field\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: 4001956 ymin: 2020764 xmax: 4013988 ymax: 2028901\nProjected CRS: NAD83 / Statistics Canada Lambert\nLoading basemap 'backdrop' from map service 'maptiler'...\n\n\n&lt;SpatRaster&gt; resampled to 501000 cells.\n\nggplot2::ggsave(\n  here(output_dir, \"/\", paste0(Sys.Date(), \"_fw_sum_richness_parcels.png\")),\n  freshwater_sum_ggplot,\n  device = ragg::agg_png,\n  width = 9, height = 12, units = \"in\", res = 300\n)\n# Freshwater num habitats richness\nfreshwater_num_hab_gg &lt;- function() {\n  notprotected_public_colour &lt;-  \"green\"\n  notprotected_private_colour &lt;- \"red\"\n  list(\n    geom_sf(data = notprotected_cons_vals_sf, aes(fill = fw_num_hab_pres), color = NA),\n    scale_fill_viridis_c(),\n    geom_sf(data = notprotected_privatelands, aes(colour = notprotected_private_colour), linewidth = 0.3, fill = NA),\n    geom_sf(data = notprotected_publiclands, aes(colour = notprotected_public_colour), linewidth = 0.3, fill = NA),\n    scale_colour_identity(\n      name = \"\",\n      breaks = c(notprotected_public_colour, notprotected_private_colour),\n      labels = c(\"Unprotected Public\", \"Unprotected Private\"),\n      guide = \"legend\"\n    ),\n    ggnewscale::new_scale_fill(),\n    ggnewscale::new_scale_colour()\n  )\n}\nfreshwater_num_hab_ggplot &lt;- bowen_map_ggplot(\n  freshwater_num_hab_gg,\n  title = \"Number of Freshwater Habitats in Unprotected Parcels\",\n  subtitle = \"Mapping the unprotected parcels and number of freshwater habitat types present to identify potential parcels for future protection.\",\n  caption = caption\n)\n\nReading layer `bowen_island_shoreline_w_hutt__bowen_islands' from data source \n  `/home/jay/Programming_Projects/bowen.biodiversity.webapp/data-raw/bowen_island_shoreline_w_hutt.gpkg' \n  using driver `GPKG'\nSimple feature collection with 11 features and 1 field\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: 4001956 ymin: 2020764 xmax: 4013988 ymax: 2028901\nProjected CRS: NAD83 / Statistics Canada Lambert\nLoading basemap 'backdrop' from map service 'maptiler'...\n\n\n&lt;SpatRaster&gt; resampled to 501000 cells.\n\nggplot2::ggsave(\n  here(output_dir, \"/\", paste0(Sys.Date(), \"_fw_num_hab_parcels.png\")),\n  freshwater_num_hab_ggplot,\n  device = ragg::agg_png,\n  width = 9, height = 12, units = \"in\", res = 300\n)\n\n#### PLOTTING PUBLIC LANDS ####\n# Conservation Vals Continuous\nconservation_vals_cont_pub_gg &lt;- function() {\n  list(\n    geom_sf(data = notprotected_cons_vals_sf[!notprotected_cons_vals_sf$OwnerType %in% c(\"Private\", \"Mixed Ownership\", \"Unclassified\"),] , aes(fill = rankmap), color = NA),\n    scale_fill_viridis_c(),\n    ggnewscale::new_scale_fill(),\n    ggnewscale::new_scale_colour()\n  )\n}\nconservation_vals_cont_pub_ggplot &lt;- bowen_map_ggplot(\n  conservation_vals_cont_pub_gg,\n  title = \"Conservation Values by Unprotected Parcels\",\n  subtitle = \"Mapping the unprotected parcels and their relative biodiversity values to identify potential parcels for future protection.\",\n  caption = caption\n)\n\nReading layer `bowen_island_shoreline_w_hutt__bowen_islands' from data source \n  `/home/jay/Programming_Projects/bowen.biodiversity.webapp/data-raw/bowen_island_shoreline_w_hutt.gpkg' \n  using driver `GPKG'\nSimple feature collection with 11 features and 1 field\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: 4001956 ymin: 2020764 xmax: 4013988 ymax: 2028901\nProjected CRS: NAD83 / Statistics Canada Lambert\nLoading basemap 'backdrop' from map service 'maptiler'...\n\n\n&lt;SpatRaster&gt; resampled to 501000 cells.\n\nggplot2::ggsave(\n  here(output_dir, \"/\", paste0(Sys.Date(), \"_conservation_vals_continuous_pub_parcels.png\")),\n  conservation_vals_cont_pub_ggplot,\n  device = ragg::agg_png,\n  width = 9, height = 12, units = \"in\", res = 300\n)\n\n# Conservation Vals Top 30\nconservation_vals_top_pub_gg &lt;- function() {\n  list(\n    geom_sf(data = notprotected_cons_vals_sf[!notprotected_cons_vals_sf$OwnerType %in% c(\"Private\", \"Mixed Ownership\", \"Unclassified\"),], aes(fill = rankmap_top_30), color = NA),\n    scale_fill_viridis_c(),\n    ggnewscale::new_scale_fill(),\n    ggnewscale::new_scale_colour()\n  )\n}\nconservation_vals_top_pub_ggplot &lt;- bowen_map_ggplot(\n  conservation_vals_top_pub_gg,\n  title = \"Top Conservation Values by Unprotected Parcels\",\n  subtitle = \"Mapping the unprotected parcels and number of top 30% conservation value cells to identify potential parcels for future protection.\",\n  caption = caption\n)\n\nReading layer `bowen_island_shoreline_w_hutt__bowen_islands' from data source \n  `/home/jay/Programming_Projects/bowen.biodiversity.webapp/data-raw/bowen_island_shoreline_w_hutt.gpkg' \n  using driver `GPKG'\nSimple feature collection with 11 features and 1 field\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: 4001956 ymin: 2020764 xmax: 4013988 ymax: 2028901\nProjected CRS: NAD83 / Statistics Canada Lambert\nLoading basemap 'backdrop' from map service 'maptiler'...\n\n\n&lt;SpatRaster&gt; resampled to 501000 cells.\n\nggplot2::ggsave(\n  here(output_dir, \"/\", paste0(Sys.Date(), \"_conservation_vals_top_pub_parcels.png\")),\n  conservation_vals_top_pub_ggplot,\n  device = ragg::agg_png,\n  width = 9, height = 12, units = \"in\", res = 300\n)\n\n# Freshwater sum richness\nfreshwater_sum_pub_gg &lt;- function() {\n  list(\n    geom_sf(data = notprotected_cons_vals_sf[!notprotected_cons_vals_sf$OwnerType %in% c(\"Private\", \"Mixed Ownership\", \"Unclassified\"),], aes(fill = fw_sum_richness), color = NA),\n    scale_fill_viridis_c(),\n    ggnewscale::new_scale_fill(),\n    ggnewscale::new_scale_colour()\n  )\n}\nfreshwater_sum_pub_ggplot &lt;- bowen_map_ggplot(\n  freshwater_sum_pub_gg,\n  title = \"Relative Freshwater Habitat Richness by Unprotected Parcels\",\n  subtitle = \"Mapping the unprotected parcels and the total sum of freshwater habitat richness cells to identify potential parcels for future protection.\",\n  caption = caption\n)\n\nReading layer `bowen_island_shoreline_w_hutt__bowen_islands' from data source \n  `/home/jay/Programming_Projects/bowen.biodiversity.webapp/data-raw/bowen_island_shoreline_w_hutt.gpkg' \n  using driver `GPKG'\nSimple feature collection with 11 features and 1 field\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: 4001956 ymin: 2020764 xmax: 4013988 ymax: 2028901\nProjected CRS: NAD83 / Statistics Canada Lambert\nLoading basemap 'backdrop' from map service 'maptiler'...\n\n\n&lt;SpatRaster&gt; resampled to 501000 cells.\n\nggplot2::ggsave(\n  here(output_dir, \"/\", paste0(Sys.Date(), \"_fw_sum_richness_pub_parcels.png\")),\n  freshwater_sum_pub_ggplot,\n  device = ragg::agg_png,\n  width = 9, height = 12, units = \"in\", res = 300\n)\n# Freshwater num habitats richness\nfreshwater_num_hab_pub_gg &lt;- function() {\n  list(\n    geom_sf(data = notprotected_cons_vals_sf[!notprotected_cons_vals_sf$OwnerType %in% c(\"Private\", \"Mixed Ownership\", \"Unclassified\"),], aes(fill = fw_num_hab_pres), color = NA),\n    scale_fill_viridis_c(),\n    ggnewscale::new_scale_fill(),\n    ggnewscale::new_scale_colour()\n  )\n}\nfreshwater_num_hab_pub_ggplot &lt;- bowen_map_ggplot(\n  freshwater_num_hab_pub_gg,\n  title = \"Number of Freshwater Habitats in Unprotected Parcels\",\n  subtitle = \"Mapping the unprotected parcels and number of freshwater habitat types present to identify potential parcels for future protection.\",\n  caption = caption\n)\n\nReading layer `bowen_island_shoreline_w_hutt__bowen_islands' from data source \n  `/home/jay/Programming_Projects/bowen.biodiversity.webapp/data-raw/bowen_island_shoreline_w_hutt.gpkg' \n  using driver `GPKG'\nSimple feature collection with 11 features and 1 field\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: 4001956 ymin: 2020764 xmax: 4013988 ymax: 2028901\nProjected CRS: NAD83 / Statistics Canada Lambert\nLoading basemap 'backdrop' from map service 'maptiler'...\n\n\n&lt;SpatRaster&gt; resampled to 501000 cells.\n\nggplot2::ggsave(\n  here(output_dir, \"/\", paste0(Sys.Date(), \"_fw_num_hab_pub_parcels.png\")),\n  freshwater_num_hab_pub_ggplot,\n  device = ragg::agg_png,\n  width = 9, height = 12, units = \"in\", res = 300\n)\n\n\n\n\n\n\n\n\n# Dissolve protected areas into one geometry\ndissolved_protectedareas &lt;- bowen_protectedareas_valid %&gt;%\n  summarise() %&gt;%\n  st_cast() %&gt;%\n  st_buffer(1) \n\ncrown_valid &lt;- crown %&gt;% \n  st_snap(x = ., y = ., tolerance = 0.1) %&gt;%\n  st_make_valid() \nnotprotected_crown &lt;- st_difference(crown_valid, dissolved_protectedareas)\n\nWarning: attribute variables are assumed to be spatially constant throughout\nall geometries\n\n# Manually check each crown land polygon\nfor(i in 1:nrow(notprotected_crown)) {\n  plot(notprotected_crown[i,])\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n# Remove polygons that should not be included in notprotected areas \n# rowname 1 (Fairy Fen Natural Reserve), sliver\n# rowname 74 (Seymour Bay Park), wrong polygon in the first place\nnotprotected_crown_clean &lt;- notprotected_crown[!rownames(notprotected_crown) %in% c(\"1\",\"74\"),]\n\n\n\n\nRasterize layer Identify candidate protected areas Two ways that crown land can be good candidates 1. High value pixels that are contiguous with other protected areas Things that fall under the top 30% are adjacent to protected areas Ex. large areas west of Killarney Lake, northeast corner of Bowen Island,\n\nContiguous pixels of high value that are not connected to protected areas Large enough for arguing for protection, 10 to 50 hectares or bigger\n\nGreat place to start using prioritizr! https://prioritizr.net/\n\n\n\nbowen_mask_broken &lt;- rast(here(\"inst/extdata/bowen_mask.tif\")) %&gt;%\n  project(zonation)\n# for some reason, when bowen_mask is reprojected to match the zonation\n# raster, it ends up changing NA values to an extremely large number. \n# probably some bit rollover issue?\nplot(bowen_mask_broken, main = \"Broken Bowen Mask\")\n\n\n\n\n\n\n\nbowen_mask_broken %&gt;%\n  values() %&gt;%\n  max() # 4294967296\n\n[1] 4294967296\n\n# this value is the highest unsigned 32-bit integer\n# https://github.com/rspatial/terra/issues/1356\n# seems like this issue has been reported, but not fixed\n\n# planning units\nbowen_mask &lt;- rast(here(\"inst/extdata/bowen_mask.tif\")) %&gt;%\n  project(zonation) %&gt;% \n  mask(zonation) \n\nplot(bowen_mask, main = \"Bowen Mask\")\n\n\n\n\n\n\n\n# features\nplot(zonation, main = \"Zonation Output\")\n\n\n\n\n\n\n\n\n\n\n\n\n# calculate budget, get prop of pixels of planning units\nprop_pixels &lt;- 0.3 # for some reason, this provides weird results when not large enough\nbudget &lt;- terra::global(bowen_mask, \"sum\", na.rm = T)[[1]] * prop_pixels \n\n# create problem\np1 &lt;- problem(bowen_mask, features = zonation) %&gt;%\n  add_min_shortfall_objective(budget) %&gt;%\n  add_relative_targets(1) %&gt;% # need to be at least double the budget\n  # since we only have one feature, this target is meaningless but is a\n  # requirement for priortizr to work \n  add_binary_decisions() %&gt;%\n  add_default_solver(gap = 0.05, verbose = FALSE) \n  # gap needs to be smaller than the difference between prop_pixels and locked constraints\n  # if this is not, leads to nonsensical solutions \n  # gap value is the % from optimal\n  # therefore, if gap is too large, then any solution is close enough to optimal\n\n# print conservation problem\nprint(p1)\n\nA conservation problem (&lt;ConservationProblem&gt;)\n├•data\n│├•features:    \"rankmap\"\n│└•planning units:\n│ ├•data:       &lt;SpatRaster&gt; (5314 total)\n│ ├•costs:      constant values (all equal to 1)\n│ ├•extent:     1186687.5, 483187.5, 1195387.5, 492987.5 (xmin, ymin, xmax, ymax)\n│ └•CRS:        NAD83 / BC Albers (projected)\n├•formulation\n│├•objective:   minimum shortfall objective (`budget` = 1594.2)\n│├•penalties:   none specified\n│├•targets:     relative targets (between 1 and 1)\n│├•constraints: none specified\n│└•decisions:   binary decision\n└•optimization\n ├•portfolio:   default portfolio\n └•solver:      gurobi solver (`gap` = 0.05, `time_limit` = 2147483647, `first_feasible` = FALSE, …)\n# ℹ Use `summary(...)` to see complete formulation.\n\npresolve_check(p1)\n\nWarning in presolve_check(compile(x), warn = warn): Problem failed presolve checks.\n\nThese checks indicate that solutions might not identify meaningful priority\nareas:\n\n✖ The problem only contains a single feature.\n→ Conservation planning generally requires multiple features (e.g., species,\n  ecosystem types) to identify meaningful priority areas.\n\nℹ For more information, see `presolve_check()`.\n\n\n[1] FALSE\n\ns1 &lt;- solve(p1, force = T)\n\nWarning in solve(p1, force = T): → Problem failed presolve checks.\n\nThese checks indicate that solutions might not identify meaningful priority\nareas:\n\n✖ The problem only contains a single feature.\n→ Conservation planning generally requires multiple features (e.g., species,\n  ecosystem types) to identify meaningful priority areas.\n\nℹ For more information, see `presolve_check()`.\n\n# extract the objective\nprint(attr(s1, \"objective\"))\n\nsolution_1 \n 0.4900132 \n\n# compare plots, check for agreement between priortizr and zonation\nplot(s1, main = \"Priortizr Solution\", axes = FALSE)\n\n\n\n\n\n\n\nremove_by_quantile(zonation, 1 - prop_pixels) %&gt;%\n  plot(main = \"Top Zonation Pixels\")\n\n\n\n\n\n\n\n# check for number of cells \ns1 %&gt;% values() %&gt;% sum(na.rm = T) # 265 cells selected\n\n[1] 1594\n\n# it works! basic top pixels identified, and agrees with zonation\n# the main goal is to not use priortizr for conservation values\n# the goal is to use the constraints and penalties that are part \n# of the package\n\n# Existing Protected Areas\nbowen_protectedareas %&gt;% plot() \n\n\n\n\n\n\n\n# trying removing covenants, since very fragmented\nbowen_pa_rast &lt;- bowen_protectedareas[bowen_protectedareas$type != \"Covenants\",] %&gt;%\n  vect() %&gt;%\n  project(bowen_mask) %&gt;%\n  rasterize(bowen_mask, background = 0) %&gt;%\n  mask(bowen_mask) \n\n# bowen_pa_rast_2 &lt;- bowen_protectedareas %&gt;%\n#   vect() %&gt;%\n#   project(bowen_mask) %&gt;%\n#   rasterize(bowen_mask, background = 0) %&gt;%\n#   mask(bowen_mask) \n\nbowen_pa_cell_count &lt;- bowen_pa_rast %&gt;%\n  values() %&gt;%\n  sum(na.rm = T)\nbowen_pa_prop &lt;- bowen_pa_cell_count / sum(values(bowen_mask), na.rm = T)\n\nplot(bowen_pa_rast, main = \"Existing Protected Areas\")\n\n\n\n\n\n\n\n# create new problem with locked in constraints \np2 &lt;- \n  p1 %&gt;%\n  add_locked_in_constraints(bowen_pa_rast)\n\ns2 &lt;- solve(p2, force = T)\n\nWarning in solve(p2, force = T): → Problem failed presolve checks.\n\nThese checks indicate that solutions might not identify meaningful priority\nareas:\n\n✖ The problem only contains a single feature.\n→ Conservation planning generally requires multiple features (e.g., species,\n  ecosystem types) to identify meaningful priority areas.\n\nℹ For more information, see `presolve_check()`.\n\nplot(s2, main = \"Solution with Existing Protected Areas\")\n\n\n\n\n\n\n\n# Crown land\n## Maybe combine analysis with parcels? \n## Keep seperate for now, combine later\n\ncrown_rast &lt;- crown %&gt;%\n  vect() %&gt;%\n  project(bowen_mask) %&gt;%\n  rasterize(bowen_mask, background = 0, touches = T) %&gt;%\n  mask(bowen_mask)\n\n# need to make sure it includes the protected areas\ncrown_pa &lt;- max(c(crown_rast, bowen_pa_rast))\n\n# reverse for locked out constraints\nm &lt;- rbind(\n  c(0, 1),\n  c(1, 0)\n)\n\nlockedout &lt;- crown_pa %&gt;%\n  classify(m)\n\n# create new problem with locked out constraints\np3 &lt;-\n  p2 %&gt;%\n  add_locked_out_constraints(lockedout)\ns3 &lt;- solve(p3, force = T)\n\nWarning in solve(p3, force = T): → Problem failed presolve checks.\n\nThese checks indicate that solutions might not identify meaningful priority\nareas:\n\n✖ The problem only contains a single feature.\n→ Conservation planning generally requires multiple features (e.g., species,\n  ecosystem types) to identify meaningful priority areas.\n\nℹ For more information, see `presolve_check()`.\n\nplot(s3, main = \"Solution with PA and Crown\")\n\n\n\n\n\n\n\n# add boundary penalties\np4 &lt;-\n  p3 %&gt;%\n  add_boundary_penalties(penalty = 0.000001, edge_factor = 0.5)\ns4 &lt;- solve(p4, force = T)\n\nWarning in solve(p4, force = T): → Problem failed presolve checks.\n\nThese checks indicate that solutions might not identify meaningful priority\nareas:\n\n✖ The problem only contains a single feature.\n→ Conservation planning generally requires multiple features (e.g., species,\n  ecosystem types) to identify meaningful priority areas.\n\nℹ For more information, see `presolve_check()`.\n\ns4 %&gt;% values() %&gt;% sum(na.rm = T) # 1593\n\n[1] 1586\n\n# the total pixels selected under no boundary penalty is 1594\n# therefore, with this penalty value of 0.000001\n# boundary penalty has an effect, but not overly so that \n# step just selects pixels around existing protected areas\n\nplot(s4, main = \"Solution with PA, Crown, and Boundary\")\n\n\n\n\n\n\n\n# importance scores\nimp &lt;- \n  p4 %&gt;%\n  eval_rank_importance(s4, n = 5, force = T)\n\nWarning in matrix(compile(x)$lb(), ncol = n_z, nrow = n_pu): data length\n[15687] is not a sub-multiple or multiple of the number of rows [5314]\n\n\nWarning in .local(x, solution, ...): → Problem failed presolve checks.\n\nThese checks indicate that solutions might not identify meaningful priority\nareas:\n\n✖ The problem only contains a single feature.\n→ Conservation planning generally requires multiple features (e.g., species,\n  ecosystem types) to identify meaningful priority areas.\n\nℹ For more information, see `presolve_check()`.\n\nprint(imp)\n\nclass       : SpatRaster \ndimensions  : 98, 87, 1  (nrow, ncol, nlyr)\nresolution  : 100, 100  (x, y)\nextent      : 1186688, 1195388, 483187.5, 492987.5  (xmin, xmax, ymin, ymax)\ncoord. ref. : NAD83 / BC Albers (EPSG:3005) \nsource(s)   : memory\nvarname     : rankmap \nname        : rs \nmin value   :  0 \nmax value   :  1 \n\nimp &lt;- terra::mask(imp, s4, maskvalues = 0, updatevalue = -1)\nplot(imp, main = \"Importance Scores\")\n\n\n\n\n\n\n\n# remove existing protected areas \nm &lt;- c(\n  -1, 0, NA\n)\nimp_clean &lt;- (imp - 2 * bowen_pa_rast) %&gt;%\n  ifel(. &lt;= -1, NA, .) \n\n\n\n\n\n\n# gg\ncrown_poten_ggfunc &lt;- function() {\n  protected_colour &lt;- \"#b3e2cd\"\n  parcels_colour &lt;-  \"#fdcdac\"\n  output &lt;- list(\n    geom_spatraster(data = imp_clean, na.rm = T),\n    scale_fill_viridis_c(na.value = NA, name = \"Protected Area Potential\"),\n    ggnewscale::new_scale_fill(),\n    geom_sf(data = parcels, aes(fill = parcels_colour)),\n    geom_sf(data = bowen_protectedareas_valid, aes(fill = protected_colour)),\n    scale_fill_identity(name = \"\",\n                          breaks = c(protected_colour, parcels_colour),\n                          labels = c(\"Protected\", \"Parcels\"),\n                          guide = \"legend\"\n    ),\n    ggnewscale::new_scale_fill(),\n    ggnewscale::new_scale_colour()\n  )\n  return(output)\n}\ncrown_poten_ggplot &lt;- bowen_map_ggplot(\n  crown_poten_ggfunc,\n  title = \"Top Locations for Protected Areas (30x30)\",\n  subtitle = \"Mapping optimal Crown land for reaching 30x30 targets, using the conservation values analysis and existing protected areas. This output considers connectivity by applying boundary penalties, which prioritizes shorter boundaries relative to area. Currently, about 20% of Bowen Island is under some protection.\",\n  caption = caption\n)\n\nReading layer `bowen_island_shoreline_w_hutt__bowen_islands' from data source \n  `/home/jay/Programming_Projects/bowen.biodiversity.webapp/data-raw/bowen_island_shoreline_w_hutt.gpkg' \n  using driver `GPKG'\nSimple feature collection with 11 features and 1 field\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: 4001956 ymin: 2020764 xmax: 4013988 ymax: 2028901\nProjected CRS: NAD83 / Statistics Canada Lambert\nLoading basemap 'backdrop' from map service 'maptiler'...\n\n\n&lt;SpatRaster&gt; resampled to 501000 cells.\n\nggplot2::ggsave(\n  here(output_dir, \"/\", paste0(Sys.Date(), \"_crown_potential.png\")),\n  crown_poten_ggplot,\n  device = ragg::agg_png,\n  width = 9, height = 12, units = \"in\", res = 300\n)",
    "crumbs": [
      "Action",
      "Protected Areas"
    ]
  },
  {
    "objectID": "vignettes/protected_areas.html#input-layers",
    "href": "vignettes/protected_areas.html#input-layers",
    "title": "Protected Areas",
    "section": "",
    "text": "sdm_url &lt;- \"https://docs.google.com/spreadsheets/d/1IGFwkr9LidcZwbzOJJGSEXLsmpKp0a9gBs65EY-H1xw/edit?usp=sharing\"\nhabitats_url &lt;- \"https://docs.google.com/spreadsheets/d/1yDKw4r3tbXYivwtxbbfxc-pYSbtbj_o2ee1pwlNCOO4/edit?usp=drive_link\"\noutput_dir &lt;- here(\"vignettes/figures/protected_areas\")\nif(!dir.exists(output_dir)) {\n  dir.create(output_dir)\n}\n\n#### Zonation Raster Layers ####\n# Load Zonation Output / Conservation Values\nzonation &lt;- here(\"inst/extdata/output_zonation/2025-06-30/rankmap.tif\") %&gt;%\n  rast()\n# For assessing freshwater habitat overlap with potential protected areas. \n# Read from Google Sheets\nhabitats_df &lt;- read_sheet(habitats_url, sheet = \"2025-06-30\")\n\nℹ Suitable tokens found in the cache, associated with these emails:\n\n\n• 'hello@jmatsushiba.com'\n\n\n• 'jay.matsushiba@gmail.com'\n\n\n• 'palenlab@gmail.com'\n\n\n  Defaulting to the first email.\n\n\n! Using an auto-discovered, cached token.\n\n\n  To suppress this message, modify your code or options to clearly consent to\n  the use of a cached token.\n\n\n  See gargle's \"Non-interactive auth\" vignette for more details:\n\n\n  &lt;https://gargle.r-lib.org/articles/non-interactive-auth.html&gt;\n\n\nℹ The googlesheets4 package is using a cached token for\n  'hello@jmatsushiba.com'.\n\n\n✔ Reading from \"habitats\".\n\n\n✔ Range ''2025-06-30''.\n\nhabitats_df$weight &lt;- habitats_df$weight / nrow(habitats_df)\nsdm_df &lt;- read_sheet(sdm_url, sheet = \"2025-06-30\") \n\n✔ Reading from \"sdm\".\n✔ Range ''2025-06-30''.\n\nsdm_df$weight &lt;- sdm_df$weight / nrow(sdm_df)\n# Bind all input layers together\nlayers_df &lt;- sdm_df %&gt;%\n  select(colnames(habitats_df)) %&gt;% # Select common columns\n  bind_rows(habitats_df) %&gt;%\n  filter(weight &gt; 0)\n\n\n#### Vector Layers ####\nparcels &lt;- bowen.biodiversity.webapp::bowen_parcelmap %&gt;%\n  # filter(!OwnerType %in% c(\"Private\", \"Unclassified\", \"Mixed Ownership\")) %&gt;%\n  filter(PID != 31243550) %&gt;% # Remove ferry route \n  st_transform(st_crs(bowen_protectedareas))\n\nparcels$geom &lt;- parcels$geom %&gt;%\n  st_cast(\"MULTIPOLYGON\") %&gt;%\n  st_make_valid()\n\nbowen_protectedareas_valid &lt;- bowen_protectedareas %&gt;%\n  st_make_valid()",
    "crumbs": [
      "Action",
      "Protected Areas"
    ]
  },
  {
    "objectID": "vignettes/protected_areas.html#parcels---potential-protected-areas",
    "href": "vignettes/protected_areas.html#parcels---potential-protected-areas",
    "title": "Protected Areas",
    "section": "",
    "text": "This is the first filter for potential protected area candidates. We need to find public lands parcels that are not in existing protected areas.\n\n# Dissolve protected areas into one geometry\ndissolved_protectedareas &lt;- bowen_protectedareas_valid %&gt;%\n  summarise() %&gt;%\n  st_cast() %&gt;%\n  st_buffer(1) # cleans up geometry slivers compared to 0, buffer distance in metres\n# st_difference after \n# doing st_difference without dissolving protected areas into one geometry \nnotprotected_parcels &lt;- st_difference(parcels, dissolved_protectedareas)\n\nWarning: attribute variables are assumed to be spatially constant throughout\nall geometries\n\n# filter for public lands \nnotprotected_parcels$OwnerType %&gt;% unique()\n\n[1] \"Private\"          \"Crown Provincial\" \"Local Government\" \"Mixed Ownership\" \n[5] \"Crown Agency\"     \"Federal\"          \"Unclassified\"    \n\n# [1] \"Private\"          \"Crown Provincial\" \"Local Government\" \"Mixed Ownership\"  \"Crown Agency\"     \"Federal\"         \n# [7] \"Unclassified\" \nnotprotected_publiclands &lt;- notprotected_parcels[!notprotected_parcels$OwnerType %in% c(\"Private\", \"Mixed Ownership\", \"Unclassified\"),] \nnotprotected_privatelands &lt;- notprotected_parcels[notprotected_parcels$OwnerType %in% c(\"Private\", \"Mixed Ownership\", \"Unclassified\"),] \n\n\n\n\n\npotential_protected_areas_ggfunc &lt;- function() {\n  protected_colour &lt;- \"#b3e2cd\"\n  notprotected_public_colour &lt;-  \"#fdcdac\"\n  notprotected_private_colour &lt;- \"#cbd5e8\"\n  output &lt;- list(\n    geom_sf(data = bowen_protectedareas_valid, aes(fill = protected_colour)),\n    geom_sf(data = notprotected_publiclands, aes(fill = notprotected_public_colour)),\n    geom_sf(data = notprotected_privatelands, aes(fill = notprotected_private_colour)),\n    scale_fill_identity(name = \"\",\n                          breaks = c(protected_colour, notprotected_public_colour, notprotected_private_colour),\n                          labels = c(\"Protected\", \"Unprotected Public\", \"Unprotected Private\"),\n                          guide = \"legend\"\n    ),\n    ggnewscale::new_scale_fill(),\n    ggnewscale::new_scale_colour()\n  )\n  return(output)\n}\n\ncaption &lt;- paste0(\"Map created: \", date(), \". Palen Lab. Created by Jay Matsushiba (jmatsush@sfu.ca)\")\nprotected_areas_ggplot &lt;- bowen_map_ggplot(\n  potential_protected_areas_ggfunc,\n  title = \"Protected Areas and Parcels on Bowen Island\",\n  subtitle = \"Mapping the Protected Areas and unprotected parcels to identify potential parcels for future protection.\",\n  caption = caption\n)\n\nReading layer `bowen_island_shoreline_w_hutt__bowen_islands' from data source \n  `/home/jay/Programming_Projects/bowen.biodiversity.webapp/data-raw/bowen_island_shoreline_w_hutt.gpkg' \n  using driver `GPKG'\nSimple feature collection with 11 features and 1 field\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: 4001956 ymin: 2020764 xmax: 4013988 ymax: 2028901\nProjected CRS: NAD83 / Statistics Canada Lambert\nLoading basemap 'backdrop' from map service 'maptiler'...\n\n\n&lt;SpatRaster&gt; resampled to 501000 cells.\n\nggplot2::ggsave(\n  here(output_dir, \"/\", paste0(Sys.Date(), \"_protected_areas_parcels.png\")),\n  protected_areas_ggplot,\n  device = ragg::agg_png,\n  width = 9, height = 12, units = \"in\", res = 300\n)\n\n\n\n\n\nTop 30% of conservation values\nWetland / water / riparian values\n\n\n#### Conservation values summed by parcel ####\n# extract zonation raster values from cells within each parcel\nnotprotected_cons_vals &lt;- notprotected_parcels %&gt;% \n  vect() %&gt;%\n  terra::extract(zonation, ., \n                 sum, \n                 na.rm = TRUE, \n                 weights = TRUE, # sum biodiversity value by approx fraction of cell covered by polygon\n                 bind = TRUE) \n\nWarning: [extract] transforming vector data to the CRS of the raster\n\n#### Top 30% conservation values summed by parcel ####\n# create top 30% zonation raster \nrcl &lt;- matrix(c(\n  0, 1, 1\n), ncol = 3, byrow = T)\nzonation_top_30 &lt;- zonation %&gt;%\n  remove_by_quantile(\n    prob = 0.7\n  ) %&gt;% \n  classify(rcl)\nnames(zonation_top_30) &lt;- \"rankmap_top_30\"\n# extract number of top conservation value cells within each parcel\nnotprotected_cons_1 &lt;- notprotected_cons_vals %&gt;%\n  terra::extract(zonation_top_30, ., \n                 sum, \n                 na.rm = TRUE, \n                 weights = TRUE, # sum biodiversity value by approx fraction of cell covered by polygon\n                 bind = TRUE) \n\nWarning: [extract] transforming vector data to the CRS of the raster\n\n#### Freshwater (wetland, ponds, rivers) ####\n# Get freshwater rasters, same used in zonation and data atlas\nfw_df &lt;- layers_df[layers_df$category == \"Freshwater\",]\nfw_rast_stack &lt;- layers_df[layers_df$category == \"Freshwater\", \"path\"] %&gt;%\n  unlist() %&gt;%\n  lapply(rast) %&gt;%\n  rast() \nfw_rast_stack %&gt;% sources() # see order of paths \n\n[1] \"/home/jay/Programming_Projects/bowen.biodiversity.webapp/inst/extdata/habitats/riparian.tif\"\n[2] \"/home/jay/Programming_Projects/bowen.biodiversity.webapp/inst/extdata/habitats/streams.tif\" \n[3] \"/home/jay/Programming_Projects/bowen.biodiversity.webapp/inst/extdata/habitats/lakes.tif\"   \n[4] \"/home/jay/Programming_Projects/bowen.biodiversity.webapp/inst/extdata/habitats/ponds.tif\"   \n[5] \"/home/jay/Programming_Projects/bowen.biodiversity.webapp/inst/extdata/habitats/wetlands.tif\"\n\nnames(fw_rast_stack) &lt;- c(\"riparian\", \"streams\", \"lakes\", \"ponds\", \"wetlands\") # assign names to layers\n# TODO: decide what to do with stream classes, leave them as is?\n# 3 is fish-bearing streams, 2 is tributary to fish-bearing, 1 is non-fishbearing / drainage channel / unclassified \n\nfw_richness &lt;- fw_rast_stack %&gt;%\n  lapply(not.na) %&gt;%\n  lapply(function(x) {classify(x, cbind(FALSE, NA))}) %&gt;%\n  rast() %&gt;%\n  sum(na.rm = T) \nnames(fw_richness) &lt;- \"fw_richness\"\n# summed richness by parcel\nnotprotected_cons_2 &lt;- notprotected_cons_1 %&gt;%\n  terra::extract(fw_richness, ., \n                 sum, \n                 na.rm = TRUE, \n                 weights = TRUE, # sum biodiversity value by approx fraction of cell covered by polygon\n                 bind = TRUE) \n\nWarning: [extract] transforming vector data to the CRS of the raster\n\nnotprotected_cons_2 &lt;- notprotected_cons_2 %&gt;%\n  tidyterra::rename(fw_sum_richness = \"fw_richness\")\n# fw habitat diversity by parcel\nnotprotected_cons_3 &lt;- notprotected_cons_2 %&gt;%\n  terra::extract(fw_rast_stack, ., \n                 max, \n                 na.rm = TRUE,\n                 bind = TRUE) \n\nWarning: [extract] transforming vector data to the CRS of the raster\n\n#### Convert to sf for better data.frame utilities ####\nnotprotected_cons_vals_sf &lt;- notprotected_cons_3 %&gt;%\n  st_as_sf() %&gt;%\n  tidyr::replace_na(list( # Replace NAs with 0 in freshwater columns\n    riparian = 0, \n    streams = 0, \n    lakes = 0, \n    ponds = 0, \n    wetlands = 0\n  )) %&gt;% \n  mutate(fw_num_hab_pres = rowSums(across(names(fw_rast_stack)), na.rm = T)) # Get number of habitat types in each parcel\n\n\n#### PLOTTING ####\n# Quick plot to check\nggplot(notprotected_cons_vals_sf) +\n  geom_sf(aes(fill = fw_num_hab_pres))\n\n\n\n\n\n\n\n# Caption for all maps\ncaption &lt;- paste0(\"Map created: \", date(), \". Palen Lab. Created by Jay Matsushiba (jmatsush@sfu.ca)\")\n\n# Conservation Vals Continuous\nconservation_vals_cont_gg &lt;- function() {\n  notprotected_public_colour &lt;-  \"green\"\n  notprotected_private_colour &lt;- \"red\"\n  list(\n    geom_sf(data = notprotected_cons_vals_sf, aes(fill = rankmap), color = NA),\n    scale_fill_viridis_c(),\n    geom_sf(data = notprotected_privatelands, aes(colour = notprotected_private_colour), linewidth = 0.3, fill = NA),\n    geom_sf(data = notprotected_publiclands, aes(colour = notprotected_public_colour), linewidth = 0.3, fill = NA),\n    scale_colour_identity(\n      name = \"\",\n      breaks = c(notprotected_public_colour, notprotected_private_colour),\n      labels = c(\"Unprotected Public\", \"Unprotected Private\"),\n      guide = \"legend\"\n    ),\n    ggnewscale::new_scale_fill(),\n    ggnewscale::new_scale_colour()\n  )\n}\nconservation_vals_cont_ggplot &lt;- bowen_map_ggplot(\n  conservation_vals_cont_gg,\n  title = \"Conservation Values by Unprotected Parcels\",\n  subtitle = \"Mapping the unprotected parcels and their relative biodiversity values to identify potential parcels for future protection.\",\n  caption = caption\n)\n\nReading layer `bowen_island_shoreline_w_hutt__bowen_islands' from data source \n  `/home/jay/Programming_Projects/bowen.biodiversity.webapp/data-raw/bowen_island_shoreline_w_hutt.gpkg' \n  using driver `GPKG'\nSimple feature collection with 11 features and 1 field\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: 4001956 ymin: 2020764 xmax: 4013988 ymax: 2028901\nProjected CRS: NAD83 / Statistics Canada Lambert\nLoading basemap 'backdrop' from map service 'maptiler'...\n\n\n&lt;SpatRaster&gt; resampled to 501000 cells.\n\nggplot2::ggsave(\n  here(output_dir, \"/\", paste0(Sys.Date(), \"_conservation_vals_continuous_parcels.png\")),\n  conservation_vals_cont_ggplot,\n  device = ragg::agg_png,\n  width = 9, height = 12, units = \"in\", res = 300\n)\n\n# Conservation Vals Top 30\nconservation_vals_top_gg &lt;- function() {\n  notprotected_public_colour &lt;-  \"green\"\n  notprotected_private_colour &lt;- \"red\"\n  list(\n    geom_sf(data = notprotected_cons_vals_sf, aes(fill = rankmap_top_30), color = NA),\n    scale_fill_viridis_c(),\n    geom_sf(data = notprotected_privatelands, aes(colour = notprotected_private_colour), linewidth = 0.3, fill = NA),\n    geom_sf(data = notprotected_publiclands, aes(colour = notprotected_public_colour), linewidth = 0.3, fill = NA),\n    scale_colour_identity(\n      name = \"\",\n      breaks = c(notprotected_public_colour, notprotected_private_colour),\n      labels = c(\"Unprotected Public\", \"Unprotected Private\"),\n      guide = \"legend\"\n    ),\n    ggnewscale::new_scale_fill(),\n    ggnewscale::new_scale_colour()\n  )\n}\nconservation_vals_top_ggplot &lt;- bowen_map_ggplot(\n  conservation_vals_top_gg,\n  title = \"Top Conservation Values by Unprotected Parcels\",\n  subtitle = \"Mapping the unprotected parcels and number of top 30% conservation value cells to identify potential parcels for future protection.\",\n  caption = caption\n)\n\nReading layer `bowen_island_shoreline_w_hutt__bowen_islands' from data source \n  `/home/jay/Programming_Projects/bowen.biodiversity.webapp/data-raw/bowen_island_shoreline_w_hutt.gpkg' \n  using driver `GPKG'\nSimple feature collection with 11 features and 1 field\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: 4001956 ymin: 2020764 xmax: 4013988 ymax: 2028901\nProjected CRS: NAD83 / Statistics Canada Lambert\nLoading basemap 'backdrop' from map service 'maptiler'...\n\n\n&lt;SpatRaster&gt; resampled to 501000 cells.\n\nggplot2::ggsave(\n  here(output_dir, \"/\", paste0(Sys.Date(), \"_conservation_vals_top_parcels.png\")),\n  conservation_vals_top_ggplot,\n  device = ragg::agg_png,\n  width = 9, height = 12, units = \"in\", res = 300\n)\n\n# Freshwater sum richness\nfreshwater_sum_gg &lt;- function() {\n  notprotected_public_colour &lt;-  \"green\"\n  notprotected_private_colour &lt;- \"red\"\n  list(\n    geom_sf(data = notprotected_cons_vals_sf, aes(fill = fw_sum_richness), color = NA),\n    scale_fill_viridis_c(),\n    geom_sf(data = notprotected_privatelands, aes(colour = notprotected_private_colour), linewidth = 0.3, fill = NA),\n    geom_sf(data = notprotected_publiclands, aes(colour = notprotected_public_colour), linewidth = 0.3, fill = NA),\n    scale_colour_identity(\n      name = \"\",\n      breaks = c(notprotected_public_colour, notprotected_private_colour),\n      labels = c(\"Unprotected Public\", \"Unprotected Private\"),\n      guide = \"legend\"\n    ),\n    ggnewscale::new_scale_fill(),\n    ggnewscale::new_scale_colour()\n  )\n}\nfreshwater_sum_ggplot &lt;- bowen_map_ggplot(\n  freshwater_sum_gg,\n  title = \"Relative Freshwater Habitat Richness by Unprotected Parcels\",\n  subtitle = \"Mapping the unprotected parcels and the total sum of freshwater habitat richness cells to identify potential parcels for future protection.\",\n  caption = caption\n)\n\nReading layer `bowen_island_shoreline_w_hutt__bowen_islands' from data source \n  `/home/jay/Programming_Projects/bowen.biodiversity.webapp/data-raw/bowen_island_shoreline_w_hutt.gpkg' \n  using driver `GPKG'\nSimple feature collection with 11 features and 1 field\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: 4001956 ymin: 2020764 xmax: 4013988 ymax: 2028901\nProjected CRS: NAD83 / Statistics Canada Lambert\nLoading basemap 'backdrop' from map service 'maptiler'...\n\n\n&lt;SpatRaster&gt; resampled to 501000 cells.\n\nggplot2::ggsave(\n  here(output_dir, \"/\", paste0(Sys.Date(), \"_fw_sum_richness_parcels.png\")),\n  freshwater_sum_ggplot,\n  device = ragg::agg_png,\n  width = 9, height = 12, units = \"in\", res = 300\n)\n# Freshwater num habitats richness\nfreshwater_num_hab_gg &lt;- function() {\n  notprotected_public_colour &lt;-  \"green\"\n  notprotected_private_colour &lt;- \"red\"\n  list(\n    geom_sf(data = notprotected_cons_vals_sf, aes(fill = fw_num_hab_pres), color = NA),\n    scale_fill_viridis_c(),\n    geom_sf(data = notprotected_privatelands, aes(colour = notprotected_private_colour), linewidth = 0.3, fill = NA),\n    geom_sf(data = notprotected_publiclands, aes(colour = notprotected_public_colour), linewidth = 0.3, fill = NA),\n    scale_colour_identity(\n      name = \"\",\n      breaks = c(notprotected_public_colour, notprotected_private_colour),\n      labels = c(\"Unprotected Public\", \"Unprotected Private\"),\n      guide = \"legend\"\n    ),\n    ggnewscale::new_scale_fill(),\n    ggnewscale::new_scale_colour()\n  )\n}\nfreshwater_num_hab_ggplot &lt;- bowen_map_ggplot(\n  freshwater_num_hab_gg,\n  title = \"Number of Freshwater Habitats in Unprotected Parcels\",\n  subtitle = \"Mapping the unprotected parcels and number of freshwater habitat types present to identify potential parcels for future protection.\",\n  caption = caption\n)\n\nReading layer `bowen_island_shoreline_w_hutt__bowen_islands' from data source \n  `/home/jay/Programming_Projects/bowen.biodiversity.webapp/data-raw/bowen_island_shoreline_w_hutt.gpkg' \n  using driver `GPKG'\nSimple feature collection with 11 features and 1 field\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: 4001956 ymin: 2020764 xmax: 4013988 ymax: 2028901\nProjected CRS: NAD83 / Statistics Canada Lambert\nLoading basemap 'backdrop' from map service 'maptiler'...\n\n\n&lt;SpatRaster&gt; resampled to 501000 cells.\n\nggplot2::ggsave(\n  here(output_dir, \"/\", paste0(Sys.Date(), \"_fw_num_hab_parcels.png\")),\n  freshwater_num_hab_ggplot,\n  device = ragg::agg_png,\n  width = 9, height = 12, units = \"in\", res = 300\n)\n\n#### PLOTTING PUBLIC LANDS ####\n# Conservation Vals Continuous\nconservation_vals_cont_pub_gg &lt;- function() {\n  list(\n    geom_sf(data = notprotected_cons_vals_sf[!notprotected_cons_vals_sf$OwnerType %in% c(\"Private\", \"Mixed Ownership\", \"Unclassified\"),] , aes(fill = rankmap), color = NA),\n    scale_fill_viridis_c(),\n    ggnewscale::new_scale_fill(),\n    ggnewscale::new_scale_colour()\n  )\n}\nconservation_vals_cont_pub_ggplot &lt;- bowen_map_ggplot(\n  conservation_vals_cont_pub_gg,\n  title = \"Conservation Values by Unprotected Parcels\",\n  subtitle = \"Mapping the unprotected parcels and their relative biodiversity values to identify potential parcels for future protection.\",\n  caption = caption\n)\n\nReading layer `bowen_island_shoreline_w_hutt__bowen_islands' from data source \n  `/home/jay/Programming_Projects/bowen.biodiversity.webapp/data-raw/bowen_island_shoreline_w_hutt.gpkg' \n  using driver `GPKG'\nSimple feature collection with 11 features and 1 field\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: 4001956 ymin: 2020764 xmax: 4013988 ymax: 2028901\nProjected CRS: NAD83 / Statistics Canada Lambert\nLoading basemap 'backdrop' from map service 'maptiler'...\n\n\n&lt;SpatRaster&gt; resampled to 501000 cells.\n\nggplot2::ggsave(\n  here(output_dir, \"/\", paste0(Sys.Date(), \"_conservation_vals_continuous_pub_parcels.png\")),\n  conservation_vals_cont_pub_ggplot,\n  device = ragg::agg_png,\n  width = 9, height = 12, units = \"in\", res = 300\n)\n\n# Conservation Vals Top 30\nconservation_vals_top_pub_gg &lt;- function() {\n  list(\n    geom_sf(data = notprotected_cons_vals_sf[!notprotected_cons_vals_sf$OwnerType %in% c(\"Private\", \"Mixed Ownership\", \"Unclassified\"),], aes(fill = rankmap_top_30), color = NA),\n    scale_fill_viridis_c(),\n    ggnewscale::new_scale_fill(),\n    ggnewscale::new_scale_colour()\n  )\n}\nconservation_vals_top_pub_ggplot &lt;- bowen_map_ggplot(\n  conservation_vals_top_pub_gg,\n  title = \"Top Conservation Values by Unprotected Parcels\",\n  subtitle = \"Mapping the unprotected parcels and number of top 30% conservation value cells to identify potential parcels for future protection.\",\n  caption = caption\n)\n\nReading layer `bowen_island_shoreline_w_hutt__bowen_islands' from data source \n  `/home/jay/Programming_Projects/bowen.biodiversity.webapp/data-raw/bowen_island_shoreline_w_hutt.gpkg' \n  using driver `GPKG'\nSimple feature collection with 11 features and 1 field\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: 4001956 ymin: 2020764 xmax: 4013988 ymax: 2028901\nProjected CRS: NAD83 / Statistics Canada Lambert\nLoading basemap 'backdrop' from map service 'maptiler'...\n\n\n&lt;SpatRaster&gt; resampled to 501000 cells.\n\nggplot2::ggsave(\n  here(output_dir, \"/\", paste0(Sys.Date(), \"_conservation_vals_top_pub_parcels.png\")),\n  conservation_vals_top_pub_ggplot,\n  device = ragg::agg_png,\n  width = 9, height = 12, units = \"in\", res = 300\n)\n\n# Freshwater sum richness\nfreshwater_sum_pub_gg &lt;- function() {\n  list(\n    geom_sf(data = notprotected_cons_vals_sf[!notprotected_cons_vals_sf$OwnerType %in% c(\"Private\", \"Mixed Ownership\", \"Unclassified\"),], aes(fill = fw_sum_richness), color = NA),\n    scale_fill_viridis_c(),\n    ggnewscale::new_scale_fill(),\n    ggnewscale::new_scale_colour()\n  )\n}\nfreshwater_sum_pub_ggplot &lt;- bowen_map_ggplot(\n  freshwater_sum_pub_gg,\n  title = \"Relative Freshwater Habitat Richness by Unprotected Parcels\",\n  subtitle = \"Mapping the unprotected parcels and the total sum of freshwater habitat richness cells to identify potential parcels for future protection.\",\n  caption = caption\n)\n\nReading layer `bowen_island_shoreline_w_hutt__bowen_islands' from data source \n  `/home/jay/Programming_Projects/bowen.biodiversity.webapp/data-raw/bowen_island_shoreline_w_hutt.gpkg' \n  using driver `GPKG'\nSimple feature collection with 11 features and 1 field\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: 4001956 ymin: 2020764 xmax: 4013988 ymax: 2028901\nProjected CRS: NAD83 / Statistics Canada Lambert\nLoading basemap 'backdrop' from map service 'maptiler'...\n\n\n&lt;SpatRaster&gt; resampled to 501000 cells.\n\nggplot2::ggsave(\n  here(output_dir, \"/\", paste0(Sys.Date(), \"_fw_sum_richness_pub_parcels.png\")),\n  freshwater_sum_pub_ggplot,\n  device = ragg::agg_png,\n  width = 9, height = 12, units = \"in\", res = 300\n)\n# Freshwater num habitats richness\nfreshwater_num_hab_pub_gg &lt;- function() {\n  list(\n    geom_sf(data = notprotected_cons_vals_sf[!notprotected_cons_vals_sf$OwnerType %in% c(\"Private\", \"Mixed Ownership\", \"Unclassified\"),], aes(fill = fw_num_hab_pres), color = NA),\n    scale_fill_viridis_c(),\n    ggnewscale::new_scale_fill(),\n    ggnewscale::new_scale_colour()\n  )\n}\nfreshwater_num_hab_pub_ggplot &lt;- bowen_map_ggplot(\n  freshwater_num_hab_pub_gg,\n  title = \"Number of Freshwater Habitats in Unprotected Parcels\",\n  subtitle = \"Mapping the unprotected parcels and number of freshwater habitat types present to identify potential parcels for future protection.\",\n  caption = caption\n)\n\nReading layer `bowen_island_shoreline_w_hutt__bowen_islands' from data source \n  `/home/jay/Programming_Projects/bowen.biodiversity.webapp/data-raw/bowen_island_shoreline_w_hutt.gpkg' \n  using driver `GPKG'\nSimple feature collection with 11 features and 1 field\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: 4001956 ymin: 2020764 xmax: 4013988 ymax: 2028901\nProjected CRS: NAD83 / Statistics Canada Lambert\nLoading basemap 'backdrop' from map service 'maptiler'...\n\n\n&lt;SpatRaster&gt; resampled to 501000 cells.\n\nggplot2::ggsave(\n  here(output_dir, \"/\", paste0(Sys.Date(), \"_fw_num_hab_pub_parcels.png\")),\n  freshwater_num_hab_pub_ggplot,\n  device = ragg::agg_png,\n  width = 9, height = 12, units = \"in\", res = 300\n)",
    "crumbs": [
      "Action",
      "Protected Areas"
    ]
  },
  {
    "objectID": "vignettes/protected_areas.html#crown-land---outside-of-parcels",
    "href": "vignettes/protected_areas.html#crown-land---outside-of-parcels",
    "title": "Protected Areas",
    "section": "",
    "text": "# Dissolve protected areas into one geometry\ndissolved_protectedareas &lt;- bowen_protectedareas_valid %&gt;%\n  summarise() %&gt;%\n  st_cast() %&gt;%\n  st_buffer(1) \n\ncrown_valid &lt;- crown %&gt;% \n  st_snap(x = ., y = ., tolerance = 0.1) %&gt;%\n  st_make_valid() \nnotprotected_crown &lt;- st_difference(crown_valid, dissolved_protectedareas)\n\nWarning: attribute variables are assumed to be spatially constant throughout\nall geometries\n\n# Manually check each crown land polygon\nfor(i in 1:nrow(notprotected_crown)) {\n  plot(notprotected_crown[i,])\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n# Remove polygons that should not be included in notprotected areas \n# rowname 1 (Fairy Fen Natural Reserve), sliver\n# rowname 74 (Seymour Bay Park), wrong polygon in the first place\nnotprotected_crown_clean &lt;- notprotected_crown[!rownames(notprotected_crown) %in% c(\"1\",\"74\"),]\n\n\n\n\nRasterize layer Identify candidate protected areas Two ways that crown land can be good candidates 1. High value pixels that are contiguous with other protected areas Things that fall under the top 30% are adjacent to protected areas Ex. large areas west of Killarney Lake, northeast corner of Bowen Island,\n\nContiguous pixels of high value that are not connected to protected areas Large enough for arguing for protection, 10 to 50 hectares or bigger\n\nGreat place to start using prioritizr! https://prioritizr.net/\n\n\n\nbowen_mask_broken &lt;- rast(here(\"inst/extdata/bowen_mask.tif\")) %&gt;%\n  project(zonation)\n# for some reason, when bowen_mask is reprojected to match the zonation\n# raster, it ends up changing NA values to an extremely large number. \n# probably some bit rollover issue?\nplot(bowen_mask_broken, main = \"Broken Bowen Mask\")\n\n\n\n\n\n\n\nbowen_mask_broken %&gt;%\n  values() %&gt;%\n  max() # 4294967296\n\n[1] 4294967296\n\n# this value is the highest unsigned 32-bit integer\n# https://github.com/rspatial/terra/issues/1356\n# seems like this issue has been reported, but not fixed\n\n# planning units\nbowen_mask &lt;- rast(here(\"inst/extdata/bowen_mask.tif\")) %&gt;%\n  project(zonation) %&gt;% \n  mask(zonation) \n\nplot(bowen_mask, main = \"Bowen Mask\")\n\n\n\n\n\n\n\n# features\nplot(zonation, main = \"Zonation Output\")\n\n\n\n\n\n\n\n\n\n\n\n\n# calculate budget, get prop of pixels of planning units\nprop_pixels &lt;- 0.3 # for some reason, this provides weird results when not large enough\nbudget &lt;- terra::global(bowen_mask, \"sum\", na.rm = T)[[1]] * prop_pixels \n\n# create problem\np1 &lt;- problem(bowen_mask, features = zonation) %&gt;%\n  add_min_shortfall_objective(budget) %&gt;%\n  add_relative_targets(1) %&gt;% # need to be at least double the budget\n  # since we only have one feature, this target is meaningless but is a\n  # requirement for priortizr to work \n  add_binary_decisions() %&gt;%\n  add_default_solver(gap = 0.05, verbose = FALSE) \n  # gap needs to be smaller than the difference between prop_pixels and locked constraints\n  # if this is not, leads to nonsensical solutions \n  # gap value is the % from optimal\n  # therefore, if gap is too large, then any solution is close enough to optimal\n\n# print conservation problem\nprint(p1)\n\nA conservation problem (&lt;ConservationProblem&gt;)\n├•data\n│├•features:    \"rankmap\"\n│└•planning units:\n│ ├•data:       &lt;SpatRaster&gt; (5314 total)\n│ ├•costs:      constant values (all equal to 1)\n│ ├•extent:     1186687.5, 483187.5, 1195387.5, 492987.5 (xmin, ymin, xmax, ymax)\n│ └•CRS:        NAD83 / BC Albers (projected)\n├•formulation\n│├•objective:   minimum shortfall objective (`budget` = 1594.2)\n│├•penalties:   none specified\n│├•targets:     relative targets (between 1 and 1)\n│├•constraints: none specified\n│└•decisions:   binary decision\n└•optimization\n ├•portfolio:   default portfolio\n └•solver:      gurobi solver (`gap` = 0.05, `time_limit` = 2147483647, `first_feasible` = FALSE, …)\n# ℹ Use `summary(...)` to see complete formulation.\n\npresolve_check(p1)\n\nWarning in presolve_check(compile(x), warn = warn): Problem failed presolve checks.\n\nThese checks indicate that solutions might not identify meaningful priority\nareas:\n\n✖ The problem only contains a single feature.\n→ Conservation planning generally requires multiple features (e.g., species,\n  ecosystem types) to identify meaningful priority areas.\n\nℹ For more information, see `presolve_check()`.\n\n\n[1] FALSE\n\ns1 &lt;- solve(p1, force = T)\n\nWarning in solve(p1, force = T): → Problem failed presolve checks.\n\nThese checks indicate that solutions might not identify meaningful priority\nareas:\n\n✖ The problem only contains a single feature.\n→ Conservation planning generally requires multiple features (e.g., species,\n  ecosystem types) to identify meaningful priority areas.\n\nℹ For more information, see `presolve_check()`.\n\n# extract the objective\nprint(attr(s1, \"objective\"))\n\nsolution_1 \n 0.4900132 \n\n# compare plots, check for agreement between priortizr and zonation\nplot(s1, main = \"Priortizr Solution\", axes = FALSE)\n\n\n\n\n\n\n\nremove_by_quantile(zonation, 1 - prop_pixels) %&gt;%\n  plot(main = \"Top Zonation Pixels\")\n\n\n\n\n\n\n\n# check for number of cells \ns1 %&gt;% values() %&gt;% sum(na.rm = T) # 265 cells selected\n\n[1] 1594\n\n# it works! basic top pixels identified, and agrees with zonation\n# the main goal is to not use priortizr for conservation values\n# the goal is to use the constraints and penalties that are part \n# of the package\n\n# Existing Protected Areas\nbowen_protectedareas %&gt;% plot() \n\n\n\n\n\n\n\n# trying removing covenants, since very fragmented\nbowen_pa_rast &lt;- bowen_protectedareas[bowen_protectedareas$type != \"Covenants\",] %&gt;%\n  vect() %&gt;%\n  project(bowen_mask) %&gt;%\n  rasterize(bowen_mask, background = 0) %&gt;%\n  mask(bowen_mask) \n\n# bowen_pa_rast_2 &lt;- bowen_protectedareas %&gt;%\n#   vect() %&gt;%\n#   project(bowen_mask) %&gt;%\n#   rasterize(bowen_mask, background = 0) %&gt;%\n#   mask(bowen_mask) \n\nbowen_pa_cell_count &lt;- bowen_pa_rast %&gt;%\n  values() %&gt;%\n  sum(na.rm = T)\nbowen_pa_prop &lt;- bowen_pa_cell_count / sum(values(bowen_mask), na.rm = T)\n\nplot(bowen_pa_rast, main = \"Existing Protected Areas\")\n\n\n\n\n\n\n\n# create new problem with locked in constraints \np2 &lt;- \n  p1 %&gt;%\n  add_locked_in_constraints(bowen_pa_rast)\n\ns2 &lt;- solve(p2, force = T)\n\nWarning in solve(p2, force = T): → Problem failed presolve checks.\n\nThese checks indicate that solutions might not identify meaningful priority\nareas:\n\n✖ The problem only contains a single feature.\n→ Conservation planning generally requires multiple features (e.g., species,\n  ecosystem types) to identify meaningful priority areas.\n\nℹ For more information, see `presolve_check()`.\n\nplot(s2, main = \"Solution with Existing Protected Areas\")\n\n\n\n\n\n\n\n# Crown land\n## Maybe combine analysis with parcels? \n## Keep seperate for now, combine later\n\ncrown_rast &lt;- crown %&gt;%\n  vect() %&gt;%\n  project(bowen_mask) %&gt;%\n  rasterize(bowen_mask, background = 0, touches = T) %&gt;%\n  mask(bowen_mask)\n\n# need to make sure it includes the protected areas\ncrown_pa &lt;- max(c(crown_rast, bowen_pa_rast))\n\n# reverse for locked out constraints\nm &lt;- rbind(\n  c(0, 1),\n  c(1, 0)\n)\n\nlockedout &lt;- crown_pa %&gt;%\n  classify(m)\n\n# create new problem with locked out constraints\np3 &lt;-\n  p2 %&gt;%\n  add_locked_out_constraints(lockedout)\ns3 &lt;- solve(p3, force = T)\n\nWarning in solve(p3, force = T): → Problem failed presolve checks.\n\nThese checks indicate that solutions might not identify meaningful priority\nareas:\n\n✖ The problem only contains a single feature.\n→ Conservation planning generally requires multiple features (e.g., species,\n  ecosystem types) to identify meaningful priority areas.\n\nℹ For more information, see `presolve_check()`.\n\nplot(s3, main = \"Solution with PA and Crown\")\n\n\n\n\n\n\n\n# add boundary penalties\np4 &lt;-\n  p3 %&gt;%\n  add_boundary_penalties(penalty = 0.000001, edge_factor = 0.5)\ns4 &lt;- solve(p4, force = T)\n\nWarning in solve(p4, force = T): → Problem failed presolve checks.\n\nThese checks indicate that solutions might not identify meaningful priority\nareas:\n\n✖ The problem only contains a single feature.\n→ Conservation planning generally requires multiple features (e.g., species,\n  ecosystem types) to identify meaningful priority areas.\n\nℹ For more information, see `presolve_check()`.\n\ns4 %&gt;% values() %&gt;% sum(na.rm = T) # 1593\n\n[1] 1586\n\n# the total pixels selected under no boundary penalty is 1594\n# therefore, with this penalty value of 0.000001\n# boundary penalty has an effect, but not overly so that \n# step just selects pixels around existing protected areas\n\nplot(s4, main = \"Solution with PA, Crown, and Boundary\")\n\n\n\n\n\n\n\n# importance scores\nimp &lt;- \n  p4 %&gt;%\n  eval_rank_importance(s4, n = 5, force = T)\n\nWarning in matrix(compile(x)$lb(), ncol = n_z, nrow = n_pu): data length\n[15687] is not a sub-multiple or multiple of the number of rows [5314]\n\n\nWarning in .local(x, solution, ...): → Problem failed presolve checks.\n\nThese checks indicate that solutions might not identify meaningful priority\nareas:\n\n✖ The problem only contains a single feature.\n→ Conservation planning generally requires multiple features (e.g., species,\n  ecosystem types) to identify meaningful priority areas.\n\nℹ For more information, see `presolve_check()`.\n\nprint(imp)\n\nclass       : SpatRaster \ndimensions  : 98, 87, 1  (nrow, ncol, nlyr)\nresolution  : 100, 100  (x, y)\nextent      : 1186688, 1195388, 483187.5, 492987.5  (xmin, xmax, ymin, ymax)\ncoord. ref. : NAD83 / BC Albers (EPSG:3005) \nsource(s)   : memory\nvarname     : rankmap \nname        : rs \nmin value   :  0 \nmax value   :  1 \n\nimp &lt;- terra::mask(imp, s4, maskvalues = 0, updatevalue = -1)\nplot(imp, main = \"Importance Scores\")\n\n\n\n\n\n\n\n# remove existing protected areas \nm &lt;- c(\n  -1, 0, NA\n)\nimp_clean &lt;- (imp - 2 * bowen_pa_rast) %&gt;%\n  ifel(. &lt;= -1, NA, .) \n\n\n\n\n\n\n# gg\ncrown_poten_ggfunc &lt;- function() {\n  protected_colour &lt;- \"#b3e2cd\"\n  parcels_colour &lt;-  \"#fdcdac\"\n  output &lt;- list(\n    geom_spatraster(data = imp_clean, na.rm = T),\n    scale_fill_viridis_c(na.value = NA, name = \"Protected Area Potential\"),\n    ggnewscale::new_scale_fill(),\n    geom_sf(data = parcels, aes(fill = parcels_colour)),\n    geom_sf(data = bowen_protectedareas_valid, aes(fill = protected_colour)),\n    scale_fill_identity(name = \"\",\n                          breaks = c(protected_colour, parcels_colour),\n                          labels = c(\"Protected\", \"Parcels\"),\n                          guide = \"legend\"\n    ),\n    ggnewscale::new_scale_fill(),\n    ggnewscale::new_scale_colour()\n  )\n  return(output)\n}\ncrown_poten_ggplot &lt;- bowen_map_ggplot(\n  crown_poten_ggfunc,\n  title = \"Top Locations for Protected Areas (30x30)\",\n  subtitle = \"Mapping optimal Crown land for reaching 30x30 targets, using the conservation values analysis and existing protected areas. This output considers connectivity by applying boundary penalties, which prioritizes shorter boundaries relative to area. Currently, about 20% of Bowen Island is under some protection.\",\n  caption = caption\n)\n\nReading layer `bowen_island_shoreline_w_hutt__bowen_islands' from data source \n  `/home/jay/Programming_Projects/bowen.biodiversity.webapp/data-raw/bowen_island_shoreline_w_hutt.gpkg' \n  using driver `GPKG'\nSimple feature collection with 11 features and 1 field\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: 4001956 ymin: 2020764 xmax: 4013988 ymax: 2028901\nProjected CRS: NAD83 / Statistics Canada Lambert\nLoading basemap 'backdrop' from map service 'maptiler'...\n\n\n&lt;SpatRaster&gt; resampled to 501000 cells.\n\nggplot2::ggsave(\n  here(output_dir, \"/\", paste0(Sys.Date(), \"_crown_potential.png\")),\n  crown_poten_ggplot,\n  device = ragg::agg_png,\n  width = 9, height = 12, units = \"in\", res = 300\n)",
    "crumbs": [
      "Action",
      "Protected Areas"
    ]
  }
]